<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Augmentation Dashboard | UE5 Learning</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg:#06090f; --surface:#0c1220; --card:#131c2e;
      --border:rgba(255,255,255,0.06); --glow:rgba(59,130,246,0.08);
      --accent:#3b82f6; --purple:#a78bfa; --cyan:#22d3ee;
      --green:#10b981; --emerald:#34d399; --orange:#f97316;
      --yellow:#f59e0b; --red:#ef4444; --rose:#fb7185;
      --text:#e2e8f0; --dim:#94a3b8; --muted:#64748b;
    }
    *{margin:0;padding:0;box-sizing:border-box;}
    html{scroll-behavior:smooth;}
    body{font-family:'Inter',-apple-system,sans-serif;background:var(--bg);color:var(--text);min-height:100vh;}

    /* ---- HERO ---- */
    .hero {
      position:relative;
      padding:60px 40px 48px;
      overflow:hidden;
      border-bottom:1px solid var(--border);
    }
    .hero::before {
      content:'';position:absolute;inset:0;
      background:radial-gradient(ellipse 80% 60% at 20% 40%,rgba(59,130,246,0.08),transparent),
                 radial-gradient(ellipse 60% 50% at 80% 30%,rgba(167,139,250,0.06),transparent);
      pointer-events:none;
    }
    .hero-inner { position:relative; max-width:1400px; margin:0 auto; }
    .hero-badge {
      display:inline-flex; align-items:center; gap:6px;
      padding:4px 14px; border-radius:20px;
      background:rgba(59,130,246,0.1); border:1px solid rgba(59,130,246,0.2);
      font-size:11px; font-weight:600; color:var(--accent);
      margin-bottom:16px;
    }
    .hero-badge .dot { width:6px; height:6px; border-radius:50%; background:var(--green); animation:pulse 2s infinite; }
    @keyframes pulse { 0%,100%{opacity:1;} 50%{opacity:0.4;} }
    .hero h1 {
      font-size:42px; font-weight:900; line-height:1.1;
      background:linear-gradient(135deg,var(--text)60%,var(--accent));
      -webkit-background-clip:text; background-clip:text;
      -webkit-text-fill-color:transparent;
      margin-bottom:10px;
    }
    .hero .subtitle { font-size:16px; color:var(--dim); max-width:600px; line-height:1.5; margin-bottom:32px; }
    .hero .subtitle strong { color:var(--text); }

    /* ---- STAT RINGS ---- */
    .hero-stats {
      display:flex; gap:24px; flex-wrap:wrap;
    }
    .hero-stat {
      display:flex; align-items:center; gap:14px;
      background:var(--card);
      border:1px solid var(--border);
      border-radius:14px;
      padding:16px 24px;
      min-width:200px;
      transition:transform 0.15s, border-color 0.15s;
    }
    .hero-stat:hover { transform:translateY(-2px); border-color:rgba(255,255,255,0.1); }
    .hero-stat .icon {
      width:44px; height:44px; border-radius:12px;
      display:flex; align-items:center; justify-content:center;
      font-size:20px;
    }
    .hero-stat .val { font-size:26px; font-weight:800; font-family:'JetBrains Mono',monospace; }
    .hero-stat .lbl { font-size:11px; color:var(--muted); margin-top:2px; }

    /* ---- GRADE DISTRIBUTION ---- */
    .section-heading {
      font-size:11px; font-weight:700; color:var(--muted);
      text-transform:uppercase; letter-spacing:1px;
      margin:40px 0 16px;
    }

    .content { max-width:1400px; margin:0 auto; padding:0 40px 60px; }

    .grade-row {
      display:flex; gap:10px; margin-bottom:32px;
    }
    .grade-card {
      flex:1;
      background:var(--card);
      border:1px solid var(--border);
      border-radius:12px;
      padding:20px;
      text-align:center;
      position:relative;
      overflow:hidden;
      transition:transform 0.15s, border-color 0.15s;
    }
    .grade-card:hover { transform:translateY(-2px); border-color:rgba(255,255,255,0.1); }
    .grade-card .bar-bg {
      position:absolute; bottom:0; left:0; right:0;
      transition:height 0.5s ease;
    }
    .grade-card .letter { font-size:28px; font-weight:900; position:relative; }
    .grade-card .cnt { font-size:22px; font-weight:700; font-family:'JetBrains Mono',monospace; position:relative; margin-top:4px; }
    .grade-card .pct { font-size:11px; color:var(--muted); position:relative; margin-top:2px; }
    .gc-A .letter{color:var(--green);} .gc-A .bar-bg{background:rgba(16,185,129,0.06);}
    .gc-B .letter{color:var(--accent);} .gc-B .bar-bg{background:rgba(59,130,246,0.06);}
    .gc-C .letter{color:var(--yellow);} .gc-C .bar-bg{background:rgba(245,158,11,0.06);}
    .gc-D .letter{color:var(--orange);} .gc-D .bar-bg{background:rgba(249,115,22,0.06);}
    .gc-F .letter{color:var(--red);} .gc-F .bar-bg{background:rgba(239,68,68,0.06);}

    /* ---- INSIGHTS ROW ---- */
    .insights-grid {
      display:grid;
      grid-template-columns:repeat(3, 1fr);
      gap:12px;
      margin-bottom:36px;
    }
    .insight-card {
      background:var(--card);
      border:1px solid var(--border);
      border-radius:12px;
      padding:20px;
    }
    .insight-card .heading {
      font-size:12px; font-weight:700; color:var(--dim);
      text-transform:uppercase; letter-spacing:0.5px;
      margin-bottom:12px;
      display:flex; align-items:center; gap:6px;
    }
    .insight-card .big { font-size:28px; font-weight:800; font-family:'JetBrains Mono',monospace; }
    .insight-card .note { font-size:12px; color:var(--muted); margin-top:6px; line-height:1.4; }
    .insight-bar { height:6px; border-radius:3px; margin-top:10px; overflow:hidden; display:flex; }
    .insight-bar div { height:100%; }

    /* ---- COURSE CARDS ---- */
    .courses-grid {
      display:grid;
      grid-template-columns:repeat(auto-fill, minmax(320px, 1fr));
      gap:12px;
      margin-bottom:36px;
    }
    .course-card {
      background:var(--card);
      border:1px solid var(--border);
      border-radius:12px;
      padding:18px 20px;
      cursor:pointer;
      transition:transform 0.15s, border-color 0.15s;
    }
    .course-card:hover { transform:translateY(-2px); border-color:rgba(255,255,255,0.12); }
    .course-card .top {
      display:flex; justify-content:space-between; align-items:center;
      margin-bottom:10px;
    }
    .course-card .code {
      font-size:10px; font-weight:700; color:var(--accent);
      text-transform:uppercase; letter-spacing:0.5px;
      padding:2px 8px; border-radius:6px;
      background:rgba(59,130,246,0.1);
    }
    .course-card .avg-grade {
      font-size:14px; font-weight:800;
    }
    .course-card .stats {
      display:flex; gap:16px; font-size:11px; color:var(--dim);
    }
    .course-card .stats span { display:flex; align-items:center; gap:4px; }
    .course-card .mini-grades {
      display:flex; gap:3px; margin-top:10px;
    }
    .course-card .mini-grade-dot {
      width:8px; height:8px; border-radius:2px;
    }
    .mg-A{background:var(--green);} .mg-B{background:var(--accent);}
    .mg-C{background:var(--yellow);} .mg-D{background:var(--orange);}
    .mg-F{background:var(--red);} .mg-none{background:var(--muted);opacity:0.3;}

    /* ---- FILTERS ---- */
    .filters-bar {
      display:flex; gap:8px; align-items:center; flex-wrap:wrap;
      margin-bottom:16px;
      position:sticky; top:0; z-index:10;
      background:var(--bg); padding:12px 0;
    }
    .pill {
      padding:6px 16px; border-radius:20px;
      border:1px solid var(--border);
      background:rgba(255,255,255,0.02);
      color:var(--dim); font-size:11px; font-weight:600;
      cursor:pointer; font-family:'Inter',sans-serif;
      transition:all 0.15s;
    }
    .pill:hover { background:rgba(255,255,255,0.05); color:var(--text); }
    .pill.active { background:var(--accent); color:white; border-color:var(--accent); }
    .search-input {
      flex:1; min-width:220px; padding:8px 16px;
      border-radius:10px; border:1px solid var(--border);
      background:rgba(255,255,255,0.03);
      color:var(--text); font-size:13px; font-family:'Inter',sans-serif;
      outline:none; transition:border-color 0.2s;
    }
    .search-input:focus { border-color:var(--accent); }
    .search-input::placeholder { color:var(--muted); }
    .result-count { font-size:11px; color:var(--muted); white-space:nowrap; }

    /* ---- VIDEO TABLE ---- */
    .video-table { width:100%; border-collapse:collapse; }
    .video-table th {
      text-align:left; padding:10px 12px;
      font-size:10px; font-weight:700; color:var(--muted);
      text-transform:uppercase; letter-spacing:0.5px;
      border-bottom:2px solid var(--border);
      cursor:pointer; -webkit-user-select:none; user-select:none;
      white-space:nowrap; transition:color 0.15s;
    }
    .video-table th:hover { color:var(--text); }
    .video-table th .arr { font-size:8px; margin-left:4px; opacity:0.4; }
    .video-table th.sorted .arr { opacity:1; color:var(--accent); }
    .video-table td {
      padding:12px; border-bottom:1px solid rgba(255,255,255,0.03);
      font-size:13px; vertical-align:middle;
    }
    .video-table tr { transition:background 0.1s; }
    .video-table tbody tr:hover td { background:rgba(255,255,255,0.015); }
    .g-cell { font-weight:900; font-size:15px; text-align:center; width:44px; }
    .s-cell { font-family:'JetBrains Mono',monospace; font-size:12px; text-align:center; width:64px; }
    .t-cell .crse { font-size:10px; color:var(--muted); margin-right:6px; font-weight:600; }
    .t-cell { font-weight:500; }
    .c-cell { font-family:'JetBrains Mono',monospace; font-size:12px; text-align:center; width:44px; color:var(--dim); }
    .a-cell { width:120px; text-align:right; white-space:nowrap; }

    .vtag {
      padding:2px 8px; border-radius:10px; font-size:9px; font-weight:700;
      text-transform:uppercase; letter-spacing:0.3px; white-space:nowrap;
    }
    .vtag-NEEDS_AUGMENTATION { background:rgba(239,68,68,0.08); color:var(--rose); }
    .vtag-ADEQUATE { background:rgba(245,158,11,0.08); color:var(--yellow); }
    .vtag-STRONG { background:rgba(16,185,129,0.08); color:var(--emerald); }

    .ratio-bar { display:flex; width:56px; height:4px; border-radius:2px; overflow:hidden; }
    .ratio-bar .rp { background:var(--orange); } .ratio-bar .rc { background:var(--cyan); }

    .link-btn {
      padding:4px 12px; border-radius:20px; font-size:10px; font-weight:600;
      text-decoration:none; border:1px solid var(--border);
      color:var(--dim); transition:all 0.15s; margin-left:4px;
    }
    .link-btn:hover { background:rgba(59,130,246,0.1); color:var(--accent); border-color:rgba(59,130,246,0.3); }
    .link-btn.eval { color:var(--purple); }
    .link-btn.view { color:var(--accent); }

    .gc-A .letter,.grade-A{color:var(--green);} .gc-B .letter,.grade-B{color:var(--accent);}
    .gc-C .letter,.grade-C{color:var(--yellow);} .gc-D .letter,.grade-D{color:var(--orange);}
    .gc-F .letter,.grade-F{color:var(--red);} .grade-\\?{color:var(--muted);}

    .loading { display:flex; align-items:center; justify-content:center; height:60vh; flex-direction:column; gap:16px; }
    .spinner { width:36px; height:36px; border:3px solid rgba(255,255,255,0.1); border-top-color:var(--accent); border-radius:50%; animation:spin 0.8s linear infinite; }
    @keyframes spin { to{transform:rotate(360deg);} }
  </style>
</head>
<body>

<div id="app">
  <div class="loading"><div class="spinner"></div><p style="color:var(--muted)">Loading dashboard‚Ä¶</p></div>
</div>

<script>
function esc(s){const d=document.createElement('div');d.textContent=s||'';return d.innerHTML;}
let allVideos=[], currentFilter='all', currentSort={col:'score',dir:'asc'};

async function init(){
  const res=await fetch('augmentation_summary.json');
  if(!res.ok){document.getElementById('app').innerHTML='<div class="loading"><p style="color:var(--red)">Run: python scripts/build_augmentation_summary.py</p></div>';return;}
  const data=await res.json();
  allVideos=data.videos;
  render(data);
}

function render(data){
  const o=data.overall, n=data.total_videos;
  const maxGrade=Math.max(...Object.values(o.grade_distribution),1);

  // Build course groups
  const courseMap={};
  data.videos.forEach(v=>{
    if(!courseMap[v.course])courseMap[v.course]={videos:[],totalScore:0,grades:[]};
    courseMap[v.course].videos.push(v);
    courseMap[v.course].totalScore+=v.score;
    courseMap[v.course].grades.push(v.grade);
  });

  document.getElementById('app').innerHTML=`
    <!-- HERO -->
    <div class="hero">
      <div class="hero-inner">
        <div class="hero-badge"><span class="dot"></span> Pipeline Active ‚Äî ${n} videos processed</div>
        <h1>Augmentation<br>Dashboard</h1>
        <p class="subtitle">AI-generated conceptual analysis of <strong>${n} Unreal Engine tutorial videos</strong>. Each video is evaluated against 11 pedagogical criteria to identify where conceptual depth is missing.</p>

        <div class="hero-stats">
          <div class="hero-stat">
            <div class="icon" style="background:rgba(59,130,246,0.1);color:var(--accent);">üé¨</div>
            <div><div class="val" style="color:var(--accent)">${n}</div><div class="lbl">Videos Analyzed</div></div>
          </div>
          <div class="hero-stat">
            <div class="icon" style="background:rgba(245,158,11,0.1);color:var(--yellow);">üìä</div>
            <div><div class="val" style="color:var(--yellow)">${o.avg_score}<span style="font-size:14px;color:var(--muted)">/55</span></div><div class="lbl">Average Score</div></div>
          </div>
          <div class="hero-stat">
            <div class="icon" style="background:rgba(239,68,68,0.1);color:var(--red);">‚ö†Ô∏è</div>
            <div><div class="val" style="color:var(--red)">${o.verdict_distribution.NEEDS_AUGMENTATION||0}</div><div class="lbl">Need Augmentation</div></div>
          </div>
          <div class="hero-stat">
            <div class="icon" style="background:rgba(16,185,129,0.1);color:var(--green);">‚úÖ</div>
            <div><div class="val" style="color:var(--green)">${(o.verdict_distribution.ADEQUATE||0)+(o.verdict_distribution.STRONG||0)}</div><div class="lbl">Adequate or Strong</div></div>
          </div>
        </div>
      </div>
    </div>

    <div class="content">
      <!-- GRADE DISTRIBUTION -->
      <div class="section-heading">Grade Distribution</div>
      <div class="grade-row">
        ${['A','B','C','D','F'].map(g=>{
          const cnt=o.grade_distribution[g]||0;
          const pct=n?Math.round(cnt/n*100):0;
          const barH=Math.max(cnt/maxGrade*60,4);
          return `<div class="grade-card gc-${g}">
            <div class="bar-bg" style="height:${barH}px"></div>
            <div class="letter">${g}</div>
            <div class="cnt">${cnt}</div>
            <div class="pct">${pct}% of videos</div>
          </div>`;
        }).join('')}
      </div>

      <!-- INSIGHTS -->
      <div class="section-heading">Content Insights</div>
      <div class="insights-grid">
        <div class="insight-card">
          <div class="heading">üìê Avg Procedural / Conceptual</div>
          <div style="display:flex;gap:20px;">
            <div><div class="big" style="color:var(--orange)">${o.avg_procedural_pct}%</div><div class="note">Procedural</div></div>
            <div><div class="big" style="color:var(--cyan)">${o.avg_conceptual_pct}%</div><div class="note">Conceptual</div></div>
          </div>
          <div class="insight-bar">
            <div style="width:${o.avg_procedural_pct}%;background:var(--orange);border-radius:3px 0 0 3px;"></div>
            <div style="width:${o.avg_conceptual_pct}%;background:var(--cyan);border-radius:0 3px 3px 0;"></div>
          </div>
          <div class="note" style="margin-top:8px;">Target: ‚â•40% conceptual for effective learning</div>
        </div>
        <div class="insight-card">
          <div class="heading">üß† AI-Generated Augmentations</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
            <div><div class="big" style="color:var(--purple)">${o.total_theory_breaks}</div><div class="note">Theory Breaks</div></div>
            <div><div class="big" style="color:var(--accent)">${o.total_why_annotations}</div><div class="note">Why Annotations</div></div>
            <div><div class="big" style="color:var(--cyan)">${o.total_prompts}</div><div class="note">Think Prompts</div></div>
            <div><div class="big" style="color:var(--orange)">${o.total_warnings}</div><div class="note">Arch. Warnings</div></div>
          </div>
        </div>
        <div class="insight-card">
          <div class="heading">üìò Knowledge Gaps</div>
          <div><div class="big" style="color:var(--rose)">${o.total_prereqs}</div><div class="note">Missing prerequisites detected across all videos ‚Äî concepts the videos assume you already know but never explain.</div></div>
        </div>
      </div>

      <!-- COURSE CARDS -->
      <div class="section-heading">Courses (${Object.keys(courseMap).length})</div>
      <div class="courses-grid">
        ${Object.entries(courseMap).sort((a,b)=>a[0].localeCompare(b[0])).map(([code,c])=>{
          const avg=Math.round(c.totalScore/c.videos.length);
          const avgGrade=avg>=45?'A':avg>=39?'B':avg>=33?'C':avg>=22?'D':'F';
          return `<div class="course-card" onclick="document.getElementById('tableSection').scrollIntoView({behavior:'smooth'});setFilter('all',null,'${code}')">
            <div class="top">
              <span class="code">${esc(code)}</span>
              <span class="avg-grade grade-${avgGrade}">${avgGrade} ¬∑ ${avg}/55</span>
            </div>
            <div class="stats">
              <span>üé¨ ${c.videos.length} videos</span>
              <span>üß† ${c.videos.reduce((s,v)=>s+v.theory_breaks,0)} breaks</span>
              <span>‚ö†Ô∏è ${c.videos.reduce((s,v)=>s+v.warnings,0)} warnings</span>
            </div>
            <div class="mini-grades">${c.grades.map(g=>`<div class="mini-grade-dot mg-${g}" title="${g}"></div>`).join('')}</div>
          </div>`;
        }).join('')}
      </div>

      <!-- TABLE -->
      <div id="tableSection"></div>
      <div class="section-heading">All Videos</div>
      <div class="filters-bar">
        <button class="pill active" onclick="setFilter('all',this)">All</button>
        <button class="pill" onclick="setFilter('NEEDS_AUGMENTATION',this)">Needs Augmentation</button>
        <button class="pill" onclick="setFilter('ADEQUATE',this)">Adequate</button>
        <button class="pill" onclick="setFilter('STRONG',this)">Strong</button>
        <input class="search-input" placeholder="üîç  Search videos or courses‚Ä¶" oninput="applyFilters()" id="searchBox">
        <span class="result-count" id="resultCount"></span>
      </div>

      <table class="video-table">
        <thead><tr>
          <th onclick="sortBy('grade')">Grade <span class="arr">‚ñº</span></th>
          <th onclick="sortBy('score')">Score <span class="arr">‚ñº</span></th>
          <th onclick="sortBy('title')">Video <span class="arr">‚ñº</span></th>
          <th onclick="sortBy('verdict')">Verdict <span class="arr">‚ñº</span></th>
          <th>Ratio</th>
          <th onclick="sortBy('theory_breaks')" title="Theory Breaks">üß† <span class="arr">‚ñº</span></th>
          <th onclick="sortBy('why_annotations')" title="Why Annotations">üí° <span class="arr">‚ñº</span></th>
          <th onclick="sortBy('warnings')" title="Warnings">‚ö†Ô∏è <span class="arr">‚ñº</span></th>
          <th>Actions</th>
        </tr></thead>
        <tbody id="videoRows"></tbody>
      </table>
    </div>
  `;
  applyFilters();
}

let courseFilterVal='';
function renderRows(videos){
  const tbody=document.getElementById('videoRows');
  document.getElementById('resultCount').textContent=`${videos.length} video${videos.length!==1?'s':''}`;
  tbody.innerHTML=videos.map(v=>`
    <tr>
      <td class="g-cell grade-${v.grade}">${v.grade}</td>
      <td class="s-cell">${v.score}/55</td>
      <td class="t-cell"><span class="crse">${esc(v.course)}</span>${esc(v.title)}</td>
      <td><span class="vtag vtag-${v.verdict}">${(v.verdict||'?').replace(/_/g,' ')}</span></td>
      <td><div class="ratio-bar"><div class="rp" style="width:${v.procedural_pct}%"></div><div class="rc" style="width:${v.conceptual_pct}%"></div></div></td>
      <td class="c-cell">${v.theory_breaks}</td>
      <td class="c-cell">${v.why_annotations}</td>
      <td class="c-cell">${v.warnings}</td>
      <td class="a-cell">
        <a class="link-btn eval" href="augmentation_evaluator.html?video=${v.key}" target="_blank">Evaluate</a>
        <a class="link-btn view" href="augmentation_viewer.html?video=${v.key}" target="_blank">Guide</a>
      </td>
    </tr>
  `).join('');
}

function setFilter(verdict,btn,course){
  currentFilter=verdict;
  courseFilterVal=course||'';
  document.querySelectorAll('.pill').forEach(b=>b.classList.remove('active'));
  if(btn)btn.classList.add('active');
  else document.querySelector('.pill')?.classList.add('active');
  applyFilters();
}

function applyFilters(){
  const q=(document.getElementById('searchBox')?.value||'').toLowerCase();
  let filtered=allVideos;
  if(currentFilter!=='all') filtered=filtered.filter(v=>v.verdict===currentFilter);
  if(courseFilterVal) filtered=filtered.filter(v=>v.course===courseFilterVal);
  if(q) filtered=filtered.filter(v=>v.title.toLowerCase().includes(q)||v.course.toLowerCase().includes(q));
  sortVideos(filtered);
  renderRows(filtered);
}

function sortBy(col){
  if(currentSort.col===col) currentSort.dir=currentSort.dir==='asc'?'desc':'asc';
  else{currentSort.col=col;currentSort.dir=col==='score'?'asc':'desc';}
  applyFilters();
}

function sortVideos(arr){
  const{col,dir}=currentSort;
  const mul=dir==='asc'?1:-1;
  arr.sort((a,b)=>{
    let va=a[col],vb=b[col];
    if(typeof va==='string') return mul*va.localeCompare(vb);
    return mul*(va-vb);
  });
}

init();
</script>
</body>
</html>

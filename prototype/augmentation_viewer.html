<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Blueprint Editor ‚Äî Augmented Guide | UE5 Learning</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0a0e17;
      --card-bg: rgba(15, 23, 42, 0.92);
      --card-border: rgba(59, 130, 246, 0.25);
      --accent: #3b82f6;
      --purple: #a78bfa;
      --cyan: #22d3ee;
      --green: #10b981;
      --orange: #f97316;
      --yellow: #f59e0b;
      --text: #e2e8f0;
      --text-dim: #94a3b8;
      --text-muted: #64748b;
      --radius: 14px;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Inter', -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      height: 100vh;
      overflow: hidden;
    }

    /* ---- FULL-SCREEN VIDEO ---- */
    .video-stage {
      position: relative;
      width: 100%;
      height: 100vh;
      background: #000;
    }

    .video-stage iframe {
      width: 100%;
      height: 100%;
      border: 0;
    }

    /* ---- START OVERLAY ---- */
    .start-overlay {
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 100;
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      transition: opacity 0.4s ease;
    }

    .start-overlay.hidden {
      opacity: 0;
      pointer-events: none;
    }

    .start-overlay h1 {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 6px;
    }

    .start-overlay .sub {
      font-size: 15px;
      color: var(--text-dim);
      margin-bottom: 28px;
      text-align: center;
      max-width: 480px;
      line-height: 1.5;
    }

    .start-btn {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 14px 36px;
      border: none;
      border-radius: 50px;
      background: linear-gradient(135deg, var(--accent), var(--purple));
      color: white;
      font-size: 16px;
      font-weight: 600;
      font-family: 'Inter', sans-serif;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 4px 24px rgba(59, 130, 246, 0.3);
    }

    .start-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 32px rgba(59, 130, 246, 0.5);
    }

    .start-hint {
      margin-top: 14px;
      font-size: 12px;
      color: var(--text-muted);
    }

    /* ---- PREREQS BAR (top) ---- */
    .prereqs-bar {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      padding: 10px 20px;
      background: linear-gradient(180deg, rgba(0,0,0,0.7) 0%, transparent 100%);
      display: flex;
      align-items: center;
      gap: 8px;
      z-index: 20;
      flex-wrap: wrap;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .prereqs-bar.visible { opacity: 1; }

    .prereqs-bar .label {
      font-size: 11px;
      font-weight: 600;
      color: var(--yellow);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .prereqs-bar .chip {
      font-size: 11px;
      padding: 3px 10px;
      border-radius: 20px;
      background: rgba(245, 158, 11, 0.15);
      color: var(--text-dim);
      border: 1px solid rgba(245, 158, 11, 0.2);
    }

    /* ---- CONCEPT OVERLAY CARD ---- */
    .concept-overlay {
      position: absolute;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%) translateY(20px);
      width: 90%;
      max-width: 720px;
      z-index: 50;
      opacity: 0;
      pointer-events: none;
      transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    }

    .concept-overlay.visible {
      opacity: 1;
      pointer-events: auto;
      transform: translateX(-50%) translateY(0);
    }

    .concept-card {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: var(--radius);
      padding: 20px 24px;
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      box-shadow: 0 8px 40px rgba(0, 0, 0, 0.5);
    }

    .concept-card .card-type {
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .concept-card h3 {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .concept-card p {
      font-size: 13px;
      color: var(--text-dim);
      line-height: 1.6;
    }

    .concept-card .tip {
      margin-top: 10px;
      padding: 10px 14px;
      border-radius: 8px;
      font-size: 12px;
      color: var(--text-dim);
      line-height: 1.5;
      display: flex;
      align-items: flex-start;
      gap: 8px;
    }

    .concept-card .tip.warn {
      background: rgba(249, 115, 22, 0.1);
      border: 1px solid rgba(249, 115, 22, 0.15);
    }

    .concept-card .tip.good {
      background: rgba(16, 185, 129, 0.1);
      border: 1px solid rgba(16, 185, 129, 0.15);
    }

    .concept-card .tip .icon { flex-shrink: 0; }

    /* Think prompt variant */
    .concept-card.think {
      border-color: rgba(34, 211, 238, 0.25);
    }

    .concept-card .think-q {
      font-size: 15px;
      font-weight: 500;
      color: var(--text);
      margin-bottom: 10px;
    }

    .concept-card .reveal-btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      font-weight: 500;
      color: var(--cyan);
      background: rgba(34, 211, 238, 0.1);
      border: 1px solid rgba(34, 211, 238, 0.2);
      border-radius: 20px;
      padding: 5px 14px;
      cursor: pointer;
      font-family: 'Inter', sans-serif;
      transition: all 0.15s ease;
    }

    .concept-card .reveal-btn:hover { background: rgba(34, 211, 238, 0.2); }

    .concept-card .reveal-answer {
      display: none;
      margin-top: 10px;
      padding: 10px 14px;
      background: rgba(34, 211, 238, 0.06);
      border-radius: 8px;
      font-size: 13px;
      color: var(--text-dim);
      line-height: 1.6;
      border-left: 2px solid var(--cyan);
    }

    .concept-card .reveal-answer.show { display: block; }

    /* Dismiss button */
    .dismiss-btn {
      position: absolute;
      top: 12px;
      right: 14px;
      width: 28px;
      height: 28px;
      border: none;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.08);
      color: var(--text-muted);
      font-size: 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.15s;
      font-family: 'Inter', sans-serif;
    }

    .dismiss-btn:hover {
      background: rgba(255, 255, 255, 0.15);
      color: var(--text);
    }

    /* ---- TIMELINE BAR ---- */
    .timeline-bar {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      width: 90%;
      max-width: 720px;
      z-index: 40;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .timeline-bar.visible { opacity: 1; }

    .timeline-track {
      position: relative;
      height: 6px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 3px;
      cursor: pointer;
    }

    .timeline-progress {
      height: 100%;
      background: linear-gradient(90deg, var(--accent), var(--purple));
      border-radius: 3px;
      transition: width 0.3s linear;
    }

    .timeline-markers {
      position: absolute;
      inset: 0;
    }

    .timeline-marker {
      position: absolute;
      top: 50%;
      transform: translate(-50%, -50%);
      width: 12px;
      height: 12px;
      border-radius: 50%;
      border: 2px solid var(--bg);
      cursor: pointer;
      transition: all 0.2s;
      z-index: 2;
    }

    .timeline-marker:hover {
      transform: translate(-50%, -50%) scale(1.4);
    }

    .timeline-marker.theory { background: var(--purple); }
    .timeline-marker.why { background: var(--accent); }
    .timeline-marker.think { background: var(--cyan); }
    .timeline-marker.active { box-shadow: 0 0 10px currentColor; transform: translate(-50%, -50%) scale(1.3); }

    .timeline-info {
      display: flex;
      justify-content: space-between;
      margin-top: 8px;
      font-size: 11px;
      color: var(--text-muted);
    }

    .timeline-info .timer {
      font-family: 'JetBrains Mono', monospace;
    }

    /* Controls */
    .controls {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 6px;
    }

    .ctrl-btn {
      padding: 4px 12px;
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 20px;
      background: rgba(255,255,255,0.05);
      color: var(--text-dim);
      font-size: 11px;
      font-weight: 500;
      cursor: pointer;
      font-family: 'Inter', sans-serif;
      transition: all 0.15s;
    }

    .ctrl-btn:hover { background: rgba(255,255,255,0.1); color: var(--text); }
    .ctrl-btn.active { background: var(--accent); color: white; border-color: var(--accent); }

    /* Color type labels */
    .type-theory { color: var(--purple); }
    .type-why { color: var(--accent); }
    .type-think { color: var(--cyan); }

    /* ---- QUIZ OVERLAY ---- */
    .quiz-overlay {
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.85);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 200;
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.5s ease;
    }

    .quiz-overlay.visible {
      opacity: 1;
      pointer-events: auto;
    }

    .quiz-container {
      width: 90%;
      max-width: 640px;
      max-height: 85vh;
      overflow-y: auto;
    }

    .quiz-header {
      text-align: center;
      margin-bottom: 24px;
    }

    .quiz-header h2 {
      font-size: 22px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .quiz-header .quiz-sub {
      font-size: 13px;
      color: var(--text-muted);
    }

    .quiz-progress {
      display: flex;
      gap: 6px;
      justify-content: center;
      margin-bottom: 24px;
    }

    .quiz-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: rgba(255,255,255,0.15);
      transition: all 0.2s;
    }

    .quiz-dot.active { background: var(--accent); box-shadow: 0 0 8px var(--accent); }
    .quiz-dot.correct { background: var(--green); }
    .quiz-dot.wrong { background: var(--orange); }

    .quiz-question {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: var(--radius);
      padding: 24px;
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
    }

    .quiz-question .q-number {
      font-size: 11px;
      font-weight: 600;
      color: var(--accent);
      text-transform: uppercase;
      letter-spacing: 0.8px;
      margin-bottom: 8px;
    }

    .quiz-question .q-text {
      font-size: 16px;
      font-weight: 500;
      margin-bottom: 16px;
      line-height: 1.5;
    }

    .quiz-option {
      display: block;
      width: 100%;
      text-align: left;
      padding: 12px 16px;
      margin-bottom: 8px;
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 10px;
      background: rgba(255,255,255,0.03);
      color: var(--text);
      font-size: 14px;
      font-family: 'Inter', sans-serif;
      cursor: pointer;
      transition: all 0.15s;
      line-height: 1.4;
    }

    .quiz-option:hover:not(.disabled) {
      background: rgba(59, 130, 246, 0.1);
      border-color: var(--accent);
    }

    .quiz-option.selected {
      background: rgba(59, 130, 246, 0.15);
      border-color: var(--accent);
    }

    .quiz-option.correct-answer {
      background: rgba(16, 185, 129, 0.15);
      border-color: var(--green);
      color: var(--green);
    }

    .quiz-option.wrong-answer {
      background: rgba(239, 68, 68, 0.1);
      border-color: #ef4444;
      color: #ef4444;
    }

    .quiz-option.disabled { cursor: default; opacity: 0.6; }
    .quiz-option.disabled:hover { background: rgba(255,255,255,0.03); border-color: rgba(255,255,255,0.1); }

    .quiz-feedback {
      margin-top: 14px;
      padding: 12px 16px;
      border-radius: 10px;
      font-size: 13px;
      line-height: 1.5;
      display: none;
    }

    .quiz-feedback.show { display: block; }

    .quiz-feedback.correct {
      background: rgba(16, 185, 129, 0.1);
      border: 1px solid rgba(16, 185, 129, 0.2);
      color: var(--green);
    }

    .quiz-feedback.wrong {
      background: rgba(239, 68, 68, 0.08);
      border: 1px solid rgba(239, 68, 68, 0.15);
      color: var(--text-dim);
    }

    .quiz-nav {
      display: flex;
      justify-content: center;
      margin-top: 20px;
    }

    .quiz-next-btn {
      display: none;
      padding: 10px 28px;
      border: none;
      border-radius: 50px;
      background: linear-gradient(135deg, var(--accent), var(--purple));
      color: white;
      font-size: 14px;
      font-weight: 600;
      font-family: 'Inter', sans-serif;
      cursor: pointer;
      transition: all 0.2s;
    }

    .quiz-next-btn.show { display: inline-flex; }
    .quiz-next-btn:hover { transform: translateY(-1px); box-shadow: 0 4px 16px rgba(59, 130, 246, 0.3); }

    /* Results */
    .quiz-results {
      text-align: center;
    }

    .quiz-results .score-circle {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      margin: 0 auto 16px;
      font-size: 32px;
      font-weight: 800;
      border: 3px solid;
    }

    .quiz-results .score-circle.great { border-color: var(--green); color: var(--green); background: rgba(16, 185, 129, 0.1); }
    .quiz-results .score-circle.okay { border-color: var(--yellow); color: var(--yellow); background: rgba(245, 158, 11, 0.1); }
    .quiz-results .score-circle.needs-work { border-color: var(--orange); color: var(--orange); background: rgba(249, 115, 22, 0.1); }

    .quiz-results .score-label { font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
    .quiz-results .results-msg { font-size: 14px; color: var(--text-dim); margin-bottom: 20px; }

    .quiz-review-item {
      text-align: left;
      padding: 14px 16px;
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 10px;
      margin-bottom: 8px;
      font-size: 13px;
    }

    .quiz-review-item .review-q { color: var(--text); font-weight: 500; margin-bottom: 4px; }
    .quiz-review-item .review-a { color: var(--green); }

    .quiz-restart-btn {
      margin-top: 20px;
      padding: 10px 28px;
      border: 1px solid rgba(255,255,255,0.15);
      border-radius: 50px;
      background: rgba(255,255,255,0.05);
      color: var(--text);
      font-size: 14px;
      font-weight: 500;
      font-family: 'Inter', sans-serif;
      cursor: pointer;
      transition: all 0.15s;
    }

    .quiz-restart-btn:hover { background: rgba(255,255,255,0.1); }
  </style>
</head>
<body>

<div class="video-stage">
  <iframe
    src="https://drive.google.com/file/d/1Z5DakBvLP41LiH4H4atpIbb45Aoxt6Z7/preview"
    allow="autoplay; encrypted-media"
    allowfullscreen
    title="Blueprint Editor Video">
  </iframe>

  <!-- Start overlay -->
  <div class="start-overlay" id="startOverlay">
    <h1>Blueprint Editor</h1>
    <p class="sub">This video has been augmented with conceptual annotations. Press play on the video, then start the guide ‚Äî cards will appear at key moments with the concepts the video doesn't cover.</p>
    <button class="start-btn" onclick="startGuide()">‚ñ∂ Start Guided Mode</button>
    <div class="start-hint">Press play on the video first, then click this button</div>
  </div>

  <!-- Prereqs -->
  <div class="prereqs-bar" id="prereqsBar">
    <span class="label">üìò Before you start:</span>
    <span class="chip">Variables & Data Types</span>
    <span class="chip">Event-Driven Programming</span>
    <span class="chip">Actor-Component Model</span>
  </div>

  <!-- Concept overlay -->
  <div class="concept-overlay" id="conceptOverlay">
    <div class="concept-card" id="conceptCard">
      <button class="dismiss-btn" onclick="dismissCard()">‚úï</button>
    </div>
  </div>

  <!-- Timeline -->
  <div class="timeline-bar" id="timelineBar">
    <div class="timeline-track" onclick="seekTimeline(event)">
      <div class="timeline-progress" id="timelineProgress"></div>
      <div class="timeline-markers" id="timelineMarkers"></div>
    </div>
    <div class="timeline-info">
      <span class="timer" id="timerDisplay">0:00 / 3:40</span>
      <div class="controls">
        <button class="ctrl-btn" id="pauseBtn" onclick="togglePause()">‚è∏ Pause Guide</button>
        <button class="ctrl-btn" onclick="resetGuide()">‚Ü∫ Restart</button>
      </div>
    </div>
  </div>

  <!-- Quiz overlay -->
  <div class="quiz-overlay" id="quizOverlay">
    <div style="position:relative;width:90%;max-width:640px;">
      <button class="dismiss-btn" style="position:absolute;top:-16px;right:-16px;width:32px;height:32px;z-index:210;" onclick="document.getElementById('quizOverlay').classList.remove('visible')">‚úï</button>
      <div class="quiz-container" id="quizContainer"></div>
    </div>
  </div>
</div>

<script>
const TOTAL_DURATION = 220; // 3:40 in seconds

// All overlay events sorted by time
const EVENTS = [
  {
    time: 7,
    type: 'why',
    html: `
      <div class="card-type type-why">üí° WHY IT MATTERS</div>
      <h3>Why Blueprints Abstract C++</h3>
      <p>Blueprints let you prototype at 10x speed by hiding C++ syntax. But there's a tradeoff: complex Blueprint graphs run slower than equivalent C++. The best practice is to <strong>prototype in Blueprint, then move performance-critical logic to C++</strong> once your design is proven.</p>
    `
  },
  {
    time: 21,
    type: 'think',
    html: `
      <div class="card-type type-think">ü§î THINK ABOUT IT</div>
      <div class="think-q">Why is a flowchart metaphor useful for game logic?</div>
      <button class="reveal-btn" onclick="toggleReveal(this)">Show Answer ‚ñ∏</button>
      <div class="reveal-answer">Game logic is inherently about flow ‚Äî "if the player presses jump, then check if grounded, then apply force." A visual flowchart makes branching and conditional paths obvious at a glance, and debuggable by non-programmers.</div>
    `
  },
  {
    time: 37,
    type: 'theory',
    html: `
      <div class="card-type type-theory">üß† KEY CONCEPT</div>
      <h3>Actor-Component Model</h3>
      <p>Blueprints use the Actor-Component pattern. Think of an Actor as an empty container ‚Äî you fill it with Components (a mesh for visuals, lights, collision, audio). Each component does one job. You build complexity by composing simple, reusable pieces.</p>
      <div class="tip warn">
        <span class="icon">‚ö†Ô∏è</span>
        <span><strong>Avoid Hard-Reference Casting</strong> ‚Äî directly referencing another Blueprint creates tight coupling. Use Blueprint Interfaces or Event Dispatchers instead for communication.</span>
      </div>
      <div class="tip good">
        <span class="icon">‚úÖ</span>
        <span>Use Interfaces for loose coupling ‚Äî Blueprints can talk without knowing each other's type.</span>
      </div>
    `
  },
  {
    time: 75,
    type: 'think',
    html: `
      <div class="card-type type-think">ü§î THINK ABOUT IT</div>
      <div class="think-q">How do Blueprint variables relate to exposed parameters in the editor?</div>
      <button class="reveal-btn" onclick="toggleReveal(this)">Show Answer ‚ñ∏</button>
      <div class="reveal-answer">Variables marked as "Instance Editable" become exposed parameters in the Details panel. Designers can tweak them per-instance without opening the Blueprint ‚Äî enabling rapid iteration without touching logic.</div>
    `
  },
  {
    time: 102,
    type: 'theory',
    html: `
      <div class="card-type type-theory">üß† KEY CONCEPT</div>
      <h3>Event Graph vs. Construction Script</h3>
      <p>These are two completely different execution contexts ‚Äî the most common beginner mistake is confusing them:</p>
      <div class="tip warn">
        <span class="icon">üìã</span>
        <span><strong>Construction Script</strong> = runs in the editor when you place or move the actor. For setup, defaults, and previews.</span>
      </div>
      <div class="tip good">
        <span class="icon">üìã</span>
        <span><strong>Event Graph</strong> = runs at runtime when you press Play. For game logic, input handling, and player interaction.</span>
      </div>
    `
  },
  {
    time: 115,
    type: 'why',
    html: `
      <div class="card-type type-why">üí° WHY IT MATTERS</div>
      <h3>Construction Script Performance</h3>
      <p>Heavy Construction Scripts fire every time you move an actor in the editor. If yours does complex calculations or spawns dozens of meshes, your editor becomes sluggish.</p>
      <div class="tip good">
        <span class="icon">‚úÖ</span>
        <span>Keep Construction Scripts fast and simple. Move runtime logic to the Event Graph. Reserve the Construction Script for static setup only.</span>
      </div>
    `
  },
  {
    time: 133,
    type: 'think',
    html: `
      <div class="card-type type-think">ü§î THINK ABOUT IT</div>
      <div class="think-q">What could go wrong if you put game logic in the Construction Script?</div>
      <button class="reveal-btn" onclick="toggleReveal(this)">Show Answer ‚ñ∏</button>
      <div class="reveal-answer">It would execute every time the actor is moved, duplicated, or the level loads in the editor ‚Äî causing unintended side effects, spawning extra objects, and creating bugs that can't be reproduced during Play mode.</div>
    `
  },
  {
    time: 194,
    type: 'theory',
    html: `
      <div class="card-type type-theory">üß† KEY CONCEPT</div>
      <h3>Blueprint Compilation</h3>
      <p>That "Compile" button isn't decorative. UE5 compiles your Blueprint nodes into optimized bytecode (or native C++ via nativization). Uncompiled Blueprints show warnings and can cause runtime hitches. Always compile after changes.</p>
      <div class="tip warn">
        <span class="icon">‚ö†Ô∏è</span>
        <span>If you see the yellow "Needs Compile" icon ‚Äî don't ignore it. Uncompiled changes won't take effect and can cause unpredictable behavior.</span>
      </div>
    `
  }
];

// ---- STATE ----
let elapsed = 0;
let paused = false;
let intervalId = null;
let currentEventIdx = -1;
let cardDismissed = false;
const CARD_DISPLAY_SECS = 15;

// ---- INIT ----
function initMarkers() {
  const container = document.getElementById('timelineMarkers');
  EVENTS.forEach((ev, i) => {
    const pct = (ev.time / TOTAL_DURATION) * 100;
    const marker = document.createElement('div');
    marker.className = `timeline-marker ${ev.type}`;
    marker.style.left = pct + '%';
    marker.title = `${ev.type} @ ${formatTime(ev.time)}`;
    marker.onclick = (e) => { e.stopPropagation(); jumpTo(ev.time); };
    marker.id = `marker-${i}`;
    container.appendChild(marker);
  });
}

// ---- GUIDE CONTROL ----
function startGuide() {
  document.getElementById('startOverlay').classList.add('hidden');
  document.getElementById('prereqsBar').classList.add('visible');
  document.getElementById('timelineBar').classList.add('visible');
  elapsed = 0;
  paused = false;
  currentEventIdx = -1;
  tick();
  intervalId = setInterval(tick, 1000);
}

function tick() {
  if (paused) return;

  updateTimeline();
  checkEvents();

  elapsed++;
  if (elapsed > TOTAL_DURATION) {
    clearInterval(intervalId);
    hideCard();
    showQuiz();
  }
}

function togglePause() {
  paused = !paused;
  const btn = document.getElementById('pauseBtn');
  btn.textContent = paused ? '‚ñ∂ Resume' : '‚è∏ Pause Guide';
  btn.classList.toggle('active', paused);
}

function resetGuide() {
  clearInterval(intervalId);
  elapsed = 0;
  paused = false;
  currentEventIdx = -1;
  cardDismissed = false;
  hideCard();
  document.getElementById('pauseBtn').textContent = '‚è∏ Pause Guide';
  document.getElementById('pauseBtn').classList.remove('active');
  // Clear active markers
  document.querySelectorAll('.timeline-marker').forEach(m => m.classList.remove('active'));
  tick();
  intervalId = setInterval(tick, 1000);
}

function jumpTo(time) {
  elapsed = time;
  currentEventIdx = -1; // reset so checkEvents re-evaluates
  cardDismissed = false;
  checkEvents();
  updateTimeline();
}

// ---- EVENTS ----
function checkEvents() {
  for (let i = 0; i < EVENTS.length; i++) {
    const ev = EVENTS[i];
    if (elapsed === ev.time) {
      showCard(ev, i);
      return;
    }
  }

  // Auto-hide after CARD_DISPLAY_SECS
  if (currentEventIdx >= 0 && !cardDismissed) {
    const ev = EVENTS[currentEventIdx];
    if (elapsed > ev.time + CARD_DISPLAY_SECS) {
      hideCard();
    }
  }
}

function showCard(ev, idx) {
  const overlay = document.getElementById('conceptOverlay');
  const card = document.getElementById('conceptCard');
  const dismissHtml = '<button class="dismiss-btn" onclick="dismissCard()">‚úï</button>';
  card.innerHTML = dismissHtml + ev.html;

  // Remove colored border from previous type
  card.className = 'concept-card';
  if (ev.type === 'think') card.classList.add('think');

  overlay.classList.add('visible');
  currentEventIdx = idx;
  cardDismissed = false;

  // Highlight marker
  document.querySelectorAll('.timeline-marker').forEach(m => m.classList.remove('active'));
  const marker = document.getElementById(`marker-${idx}`);
  if (marker) marker.classList.add('active');
}

function hideCard() {
  document.getElementById('conceptOverlay').classList.remove('visible');
  document.querySelectorAll('.timeline-marker').forEach(m => m.classList.remove('active'));
}

function dismissCard() {
  hideCard();
  cardDismissed = true;
}

// ---- TIMELINE ----
function updateTimeline() {
  const pct = Math.min((elapsed / TOTAL_DURATION) * 100, 100);
  document.getElementById('timelineProgress').style.width = pct + '%';
  document.getElementById('timerDisplay').textContent = `${formatTime(elapsed)} / ${formatTime(TOTAL_DURATION)}`;
}

function seekTimeline(e) {
  const rect = e.currentTarget.getBoundingClientRect();
  const pct = (e.clientX - rect.left) / rect.width;
  elapsed = Math.floor(pct * TOTAL_DURATION);
  currentEventIdx = -1;
  cardDismissed = false;
  checkEvents();
  updateTimeline();
}

function formatTime(s) {
  const mins = Math.floor(s / 60);
  const secs = s % 60;
  return `${mins}:${secs.toString().padStart(2, '0')}`;
}

function toggleReveal(btn) {
  const answer = btn.nextElementSibling;
  const isOpen = answer.classList.contains('show');
  answer.classList.toggle('show');
  btn.textContent = isOpen ? 'Show Answer ‚ñ∏' : 'Hide Answer ‚óÇ';
}

// ---- QUIZ ----
const QUIZ = [
  {
    question: "What is the relationship between Blueprints and C++ in Unreal Engine?",
    options: [
      "Blueprints completely replace C++ ‚Äî you never need it",
      "Blueprints compile to bytecode/C++ ‚Äî they're an abstraction layer for rapid prototyping",
      "Blueprints are slower but cannot be converted to C++",
      "C++ and Blueprints are completely separate systems"
    ],
    correct: 1,
    explanation: "Blueprints are compiled into optimized bytecode or native C++. They let you prototype fast, but performance-critical code should be moved to C++ once proven."
  },
  {
    question: "What's wrong with Hard-Reference Casting between Blueprints?",
    options: [
      "It doesn't work at all in UE5",
      "It creates tight coupling ‚Äî both Blueprints must be loaded into memory and changes can break each other",
      "It only works in the Construction Script",
      "It makes Blueprints run faster but uses more memory"
    ],
    correct: 1,
    explanation: "Hard-Reference Casting creates tight coupling. Use Blueprint Interfaces or Event Dispatchers instead for loose, scalable communication."
  },
  {
    question: "When does the Construction Script execute?",
    options: [
      "Only when you press Play",
      "Every frame during gameplay",
      "In the editor ‚Äî when you place, move, or modify the actor",
      "Only when the game is packaged"
    ],
    correct: 2,
    explanation: "The Construction Script runs in the editor at design time. The Event Graph runs at runtime. Confusing them is one of the most common Blueprint mistakes."
  },
  {
    question: "What happens if you put complex game logic in the Construction Script?",
    options: [
      "It runs faster because the editor is optimized",
      "It executes every time the actor is moved or the level loads in the editor, causing bugs and slowdowns",
      "Nothing ‚Äî the editor ignores Construction Script logic",
      "It automatically moves to the Event Graph at compile time"
    ],
    correct: 1,
    explanation: "Construction Scripts fire on every editor action. Heavy logic there causes sluggish editors and bugs that can't be reproduced during Play mode."
  },
  {
    question: "What is the Actor-Component model?",
    options: [
      "Actors contain all functionality in a single monolithic class",
      "Components are visual-only ‚Äî they can't have logic",
      "Actors are empty containers filled with Components, each providing a specific capability",
      "Components replace Actors in UE5"
    ],
    correct: 2,
    explanation: "The Actor-Component model is about composition: an Actor is a container, and Components (mesh, light, collision, audio) each do one job. You build complexity by combining simple, reusable pieces."
  }
];

let quizIdx = 0;
let quizScore = 0;
let quizAnswered = false;
let quizResults = [];

function showQuiz() {
  document.getElementById('quizOverlay').classList.add('visible');
  document.getElementById('timelineBar').classList.remove('visible');
  document.getElementById('prereqsBar').classList.remove('visible');
  quizIdx = 0;
  quizScore = 0;
  quizResults = [];
  renderQuestion();
}

function renderQuestion() {
  const q = QUIZ[quizIdx];
  const container = document.getElementById('quizContainer');
  quizAnswered = false;

  const dots = QUIZ.map((_, i) => {
    let cls = 'quiz-dot';
    if (i === quizIdx) cls += ' active';
    if (i < quizIdx && quizResults[i]) cls += ' correct';
    if (i < quizIdx && !quizResults[i]) cls += ' wrong';
    return `<div class="${cls}"></div>`;
  }).join('');

  container.innerHTML = `
    <div class="quiz-header">
      <h2>üìù Knowledge Check</h2>
      <div class="quiz-sub">Test what you learned from the Blueprint Editor guide</div>
    </div>
    <div class="quiz-progress">${dots}</div>
    <div class="quiz-question">
      <div class="q-number">Question ${quizIdx + 1} of ${QUIZ.length}</div>
      <div class="q-text">${q.question}</div>
      ${q.options.map((opt, i) => `
        <button class="quiz-option" onclick="answerQuiz(${i})" id="opt-${i}">${opt}</button>
      `).join('')}
      <div class="quiz-feedback" id="quizFeedback"></div>
    </div>
    <div class="quiz-nav">
      <button class="quiz-next-btn" id="quizNextBtn" onclick="nextQuestion()">
        ${quizIdx < QUIZ.length - 1 ? 'Next Question ‚Üí' : 'See Results'}
      </button>
    </div>
  `;
}

function answerQuiz(choice) {
  if (quizAnswered) return;
  quizAnswered = true;

  const q = QUIZ[quizIdx];
  const isCorrect = choice === q.correct;
  if (isCorrect) quizScore++;
  quizResults.push(isCorrect);

  // Style options
  q.options.forEach((_, i) => {
    const btn = document.getElementById(`opt-${i}`);
    btn.classList.add('disabled');
    if (i === q.correct) btn.classList.add('correct-answer');
    if (i === choice && !isCorrect) btn.classList.add('wrong-answer');
    if (i === choice && isCorrect) btn.classList.add('correct-answer');
  });

  // Show feedback
  const fb = document.getElementById('quizFeedback');
  fb.className = `quiz-feedback show ${isCorrect ? 'correct' : 'wrong'}`;
  fb.innerHTML = isCorrect
    ? `‚úÖ <strong>Correct!</strong> ${q.explanation}`
    : `‚ùå <strong>Not quite.</strong> ${q.explanation}`;

  document.getElementById('quizNextBtn').classList.add('show');
}

function nextQuestion() {
  quizIdx++;
  if (quizIdx < QUIZ.length) {
    renderQuestion();
  } else {
    showResults();
  }
}

function showResults() {
  const pct = Math.round((quizScore / QUIZ.length) * 100);
  let grade, msg, cls;
  if (pct >= 80) { grade = 'A'; msg = 'Excellent! You have a strong understanding of these Blueprint concepts.'; cls = 'great'; }
  else if (pct >= 60) { grade = 'B'; msg = 'Good foundation! Review the concepts you missed below.'; cls = 'okay'; }
  else { grade = 'C'; msg = 'Consider rewatching with the guided annotations to reinforce these concepts.'; cls = 'needs-work'; }

  const wrongItems = QUIZ.map((q, i) => {
    if (quizResults[i]) return '';
    return `
      <div class="quiz-review-item">
        <div class="review-q">‚ùå ${q.question}</div>
        <div class="review-a">‚úÖ ${q.options[q.correct]}</div>
      </div>
    `;
  }).join('');

  document.getElementById('quizContainer').innerHTML = `
    <div class="quiz-results">
      <div class="quiz-header">
        <h2>üìù Results</h2>
      </div>
      <div class="score-circle ${cls}">
        ${quizScore}/${QUIZ.length}
        <div class="score-label">${pct}%</div>
      </div>
      <div class="results-msg">${msg}</div>
      ${wrongItems ? '<div style="margin-bottom:8px;font-size:12px;color:var(--text-muted);text-align:left;">Review these concepts:</div>' + wrongItems : ''}
      <button class="quiz-restart-btn" onclick="restartAll()">‚Ü∫ Watch Again with Guide</button>
    </div>
  `;
}

function restartAll() {
  document.getElementById('quizOverlay').classList.remove('visible');
  document.getElementById('startOverlay').classList.remove('hidden');
}

initMarkers();
</script>
</body>
</html>

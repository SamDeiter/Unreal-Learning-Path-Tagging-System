import{a as Je,j as e,o as _t,s as wt,_ as ae,g as ze}from"./index-CAihgul4.js";import{a as j,P as f}from"./vendor-cytoscape-hdah7_Xt.js";import{c as Xe,p as Ct,r as St,d as kt,j as Tt,k as It,n as Et,m as Fe}from"./vendor-firebase-BQvzIQYL.js";import{t as re}from"./TagGraphService-CUbaYz9I.js";import{S as Lt,P as $t}from"./search-Blpc5bje.js";import{c as te}from"./createLucideIcon-YhyuTmrv.js";import{X as et}from"./x-HbUnH9yy.js";import{c as ue,q as tt,b as st,d as Mt,f as Rt,l as qt,g as Pt,s as At}from"./data-courses-Deba-lkK.js";import{d as ee,L as Dt,a as W}from"./logger-HX1K3TKu.js";import{B as Ot,A as ye}from"./book-open-D4v9dAb-.js";import{C as Ee}from"./check-eCXpKYRG.js";import{getFeedbackStatus as zt,recordUpvote as Ft,recordDownvote as Ut,applyFeedbackMultiplier as Gt}from"./feedbackService-CkyHLPU6.js";const Vt=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Ue=te("chevron-down",Vt);const Bt=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],Ge=te("chevron-up",Bt);const Wt=[["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Yt=te("circle-play",Wt);const Qt=[["path",{d:"M14 2v6a2 2 0 0 0 .245.96l5.51 10.08A2 2 0 0 1 18 22H6a2 2 0 0 1-1.755-2.96l5.51-10.08A2 2 0 0 0 10 8V2",key:"18mbvz"}],["path",{d:"M6.453 15h11.094",key:"3shlmq"}],["path",{d:"M8.5 2h7",key:"csnxdl"}]],Kt=te("flask-conical",Qt);const Ht=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],Zt=te("image",Ht);const Jt=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],Xt=te("star",Jt);const es=[["path",{d:"M13.172 2a2 2 0 0 1 1.414.586l6.71 6.71a2.4 2.4 0 0 1 0 3.408l-4.592 4.592a2.4 2.4 0 0 1-3.408 0l-6.71-6.71A2 2 0 0 1 6 9.172V3a1 1 0 0 1 1-1z",key:"16rjxf"}],["path",{d:"M2 7v6.172a2 2 0 0 0 .586 1.414l6.71 6.71a2.4 2.4 0 0 0 3.191.193",key:"178nd4"}],["circle",{cx:"10.5",cy:"6.5",r:".5",fill:"currentColor",key:"12ikhr"}]],Ve=te("tags",es);const ts=[["path",{d:"M12 19h8",key:"baeox8"}],["path",{d:"m4 17 6-6-6-6",key:"1yngyt"}]],ss=te("terminal",ts);const ns=[["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}],["path",{d:"M7 10v12",key:"1qc93n"}]],rs=te("thumbs-up",ns);const as=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],is=te("user",as),os={Audio:"Audio & Sound",Characters:"Characters & Animation",Animation:"Characters & Animation","Character & Avatar":"Characters & Animation","Core Systems":"Core Systems","AI & Navigation":"Core Systems",Ai:"Core Systems","Cinematics & Sequencer":"Cinematics",Cinematic:"Cinematics","Scripting & Programming":"Scripting & Blueprints",Blueprints:"Scripting & Blueprints","Tools & Pipeline":"Tools & Pipeline",Automation:"Tools & Pipeline",Build:"Build & Packaging"};function Re({onSubmit:t,detectedPersona:s,isLoading:n}){const[o,c]=j.useState(""),[l,r]=j.useState([]),[d,a]=j.useState([]),[i,m]=j.useState(null),[p,v]=j.useState(""),[y,x]=j.useState(!1),[h,_]=j.useState(!1),[b,E]=j.useState(!1),M=j.useRef(null),[P,z]=j.useState(()=>{try{const N=JSON.parse(localStorage.getItem("fix-problem-history")||"[]"),T=N.map(g=>typeof g=="string"?{query:g,cartId:null}:g);return N.length>0&&typeof N[0]=="string"&&localStorage.setItem("fix-problem-history",JSON.stringify(T)),T}catch{return[]}}),A=Je(),u=j.useMemo(()=>A?.tags||[],[A?.tags]),S=j.useMemo(()=>{const N={};return u.filter(T=>(T.count||0)>0).forEach(T=>{const g=T.categoryPath?.[0]||T.category||T.id?.split(".")[0]?.replace(/_/g," ").replace(/\b\w/g,w=>w.toUpperCase())||"Other",C=os[g]||g;N[C]||(N[C]=[]),N[C].push(T)}),Object.entries(N).map(([T,g])=>[T,g.sort((C,w)=>(w.count||0)-(C.count||0))]).sort(([T,g],[C,w])=>{if(T==="Other")return 1;if(C==="Other")return-1;const $=g.reduce((U,O)=>U+(O.count||0),0);return w.reduce((U,O)=>U+(O.count||0),0)-$})},[u]),k=j.useCallback(N=>{const T=N.target.value;if(c(T),T.length>15){const g=re.matchErrorSignature(T),C=re.extractTagsFromText(T),w=g.map(I=>({tag:I.tag,confidence:I.confidence})),$=C.matches.map(I=>({tag:I.tag,confidence:I.confidence})),q=[...w,...$],U=new Set,O=q.filter(I=>U.has(I.tag.tag_id)?!1:(U.add(I.tag.tag_id),!0));r(O.slice(0,5))}else r([])},[]),L=j.useCallback(N=>{a(T=>T.includes(N)?T.filter(g=>g!==N):[...T,N])},[]),R=j.useCallback(N=>{const T=N.clipboardData?.items;if(T){for(const g of T)if(g.type.startsWith("image/")){N.preventDefault();const C=g.getAsFile(),w=new FileReader;w.onload=$=>m($.target.result),w.readAsDataURL(C);return}}},[]),G=j.useCallback(N=>{N.preventDefault(),N.stopPropagation(),E(!0)},[]),D=j.useCallback(N=>{N.preventDefault(),N.stopPropagation(),E(!1)},[]),Z=j.useCallback(N=>{N.preventDefault(),N.stopPropagation(),E(!1);const T=N.dataTransfer?.files;if(!T||T.length===0)return;const g=T[0];if(g.type.startsWith("image/")){const C=new FileReader;C.onload=w=>m(w.target.result),C.readAsDataURL(g)}},[]),V=j.useCallback((N,T)=>{z(g=>{const C=g.map(w=>w.query===N?{...w,cartId:T}:w);return localStorage.setItem("fix-problem-history",JSON.stringify(C)),C})},[]),X=j.useCallback((N=null,T=null)=>{const g=(T||o).trim();g.length<10||(z(C=>{const w=C.filter(q=>q.query!==g),$=[{query:g,cartId:N},...w].slice(0,6);return localStorage.setItem("fix-problem-history",JSON.stringify($)),$}),t({query:g,detectedTagIds:l.map(C=>C.tag.tag_id),selectedTagIds:d,personaHint:s?.name,pastedImage:i,errorLog:p.trim()||null,cachedCartId:N||null,updateCartIdForQuery:V}))},[o,l,d,s,t,i,p,V]),Q=j.useCallback(N=>{N.key==="Enter"&&N.ctrlKey&&X()},[X]),J=j.useMemo(()=>['My Blueprint Cast is giving me "Accessed None" error when trying to...',"Lumen is too noisy in my interior scene and I've tried increasing quality...","My character animation stutters when blending between states...","Nanite is causing Z-fighting on overlapping meshes...","Material instances aren't updating at runtime when I change parameters..."],[])[0];return e.jsxs("div",{className:"problem-input-container",onPaste:R,children:[e.jsxs("div",{className:"problem-input-header",children:[e.jsxs("h2",{children:[e.jsx(Lt,{size:22,className:"icon-inline"})," What's the problem?"]}),e.jsx("p",{className:"subtitle",children:"Describe your UE5 issue in plain English. We'll diagnose the root cause and teach you to fix it."})]}),e.jsxs("div",{className:"problem-input-field",children:[e.jsx("textarea",{value:o,onChange:k,onKeyDown:Q,placeholder:J,rows:5,disabled:n,"aria-label":"Problem description"}),e.jsxs("div",{className:"char-count",children:[o.length," characters",o.length<10&&o.length>0&&e.jsx("span",{className:"warning",children:" (minimum 10)"})]})]}),l.length>0&&e.jsxs("div",{className:"detected-tags",children:[e.jsxs("span",{className:"label",children:[e.jsx(Ve,{size:14,className:"icon-inline"})," Detected:"]}),e.jsx("div",{className:"tag-list",children:l.map(N=>e.jsxs("span",{className:"tag-chip",title:N.tag.description||N.tag.display_name,children:[N.tag.display_name,e.jsxs("span",{className:"confidence",children:[Math.round(N.confidence*100),"%"]})]},N.tag.tag_id))})]}),e.jsxs("div",{className:"input-section-toggle",children:[e.jsxs("button",{type:"button",className:`toggle-btn ${y?"active":""}`,onClick:()=>x(N=>!N),children:[e.jsx(Ve,{size:14}),"Select Topics",d.length>0&&e.jsx("span",{className:"badge",children:d.length}),y?e.jsx(Ge,{size:14}):e.jsx(Ue,{size:14})]}),e.jsxs("button",{type:"button",className:`toggle-btn ${h?"active":""}`,onClick:()=>_(N=>!N),children:[e.jsx(ss,{size:14}),"Paste Error Log",p.trim()&&e.jsx("span",{className:"badge",children:"1"}),h?e.jsx(Ge,{size:14}):e.jsx(Ue,{size:14})]})]}),y&&e.jsxs("div",{className:"tag-picker",children:[e.jsx("p",{className:"picker-hint",children:"Select topics to focus your diagnosis on specific UE5 areas"}),S.map(([N,T])=>e.jsxs("div",{className:"tag-group",children:[e.jsx("span",{className:"group-label",children:N}),e.jsx("div",{className:"group-chips",children:T.map(g=>e.jsx("button",{type:"button",className:`picker-chip ${d.includes(g.id)?"selected":""}`,onClick:()=>L(g.id),title:g.description,children:g.name||g.label},g.id))})]},N))]}),h&&e.jsx("div",{className:"error-log-section",children:e.jsx("textarea",{className:"error-log-input",value:p,onChange:N=>v(N.target.value),placeholder:"Paste your error output, build log, or crash log here...",rows:4})}),e.jsx("div",{ref:M,className:`screenshot-zone ${b?"drag-over":""} ${i?"has-image":""}`,onDragOver:G,onDragLeave:D,onDrop:Z,children:i?e.jsxs("div",{className:"pasted-preview",children:[e.jsx("img",{src:i,alt:"Pasted screenshot"}),e.jsx("button",{type:"button",className:"remove-image",onClick:()=>m(null),"aria-label":"Remove screenshot",children:e.jsx(et,{size:14})})]}):e.jsxs("div",{className:"drop-prompt",children:[e.jsx(Zt,{size:20}),e.jsxs("span",{children:["Paste (",e.jsx("kbd",{children:"Ctrl+V"}),") or drag a screenshot here"]})]})}),s&&e.jsxs("div",{className:"persona-context",children:[e.jsxs("span",{className:"label",children:[e.jsx(is,{size:14,className:"icon-inline"})," Context:"]}),e.jsx("span",{className:"persona-chip",children:s.name}),e.jsx("span",{className:"hint",children:"Recommendations will be tailored for you"})]}),e.jsxs("div",{className:"problem-input-actions",children:[e.jsx("button",{className:"submit-btn primary",onClick:()=>X(),disabled:o.trim().length<10||n,children:n?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner"})," Diagnosing..."]}):e.jsx(e.Fragment,{children:"Get Diagnosis â†’"})}),e.jsxs("span",{className:"hint",children:["Press ",e.jsx("kbd",{children:"Ctrl"})," + ",e.jsx("kbd",{children:"Enter"})," to submit"]})]}),P.length>0&&e.jsxs("div",{className:"query-history",children:[e.jsx("span",{className:"history-label",children:"ðŸ•˜ Recent questions:"}),e.jsx("div",{className:"history-chips",children:P.map((N,T)=>{const g=N.query||N,C=N.cartId||null,w=!!C;return e.jsxs("div",{className:"history-chip-row",children:[e.jsxs("button",{type:"button",className:`history-chip ${w?"cached":""}`,onClick:()=>{c(g),k({target:{value:g}}),w&&!n&&setTimeout(()=>X(C,g),50)},title:w?`${g} (cached â€” instant load)`:g,disabled:n,children:[w&&e.jsx("span",{className:"cache-indicator",children:"âš¡"}),g.length>50?g.slice(0,50)+"â€¦":g]}),e.jsx("button",{type:"button",className:"history-delete",onClick:()=>{z($=>{const q=$.filter((U,O)=>O!==T);return localStorage.setItem("fix-problem-history",JSON.stringify(q)),q})},title:"Remove",children:"Ã—"})]},T)})})]})]})}Re.propTypes={onSubmit:f.func.isRequired,detectedPersona:f.shape({id:f.string,name:f.string,emoji:f.string}),isLoading:f.bool};Re.defaultProps={detectedPersona:null,isLoading:!1};function cs({problemSummary:t,courses:s,diagnosis:n}){if(!s||s.length===0)return{title:"Your Learning Path",intro:"Let's solve your problem step by step.",instructors:[],totalDuration:null};const o=ds(s),c=hs(s),l=gs({instructors:o,courseCount:s.length,totalDuration:c,rootCauses:n?.root_causes||[]});return{title:`Your Path: ${ps(t)}`,intro:l,instructors:o,totalDuration:c,courseCount:s.length,rootCauses:n?.root_causes||[]}}function ls(t,s,n){if(!s)return{type:"completion",text:"ðŸŽ‰ Congratulations! You've completed your learning path.",subtext:"You now have the skills to solve this problem and similar ones in the future."};const o=Le(t),c=Le(s),l=s.title||s.name||"the next lesson";return o&&c&&o!==c?{type:"transition",text:`Now let's hear from ${c}`,subtext:`${c} will cover: ${n||l}`,instructor:c}:{type:"continuation",text:`Next up: ${l}`,subtext:n||null,instructor:c}}function ds(t){const s=new Set,n=[];return t.forEach(o=>{const c=Le(o);if(c&&!s.has(c))s.add(c),n.push({name:c,courses:[o.title||o.name],totalDuration:$e(o)});else if(c){const l=n.find(r=>r.name===c);l&&(l.courses.push(o.title||o.name),l.totalDuration+=$e(o))}}),n}function Le(t){return t&&(t.instructor||t.author||t.creator||t.teacher||us(t.title||t.name))||null}function us(t){if(!t)return null;const s=t.match(/\bby\s+([A-Z][a-zA-Z]+(?:\s+[A-Z][a-zA-Z]+)?)/i);if(s)return s[1];const n=t.match(/\bwith\s+([A-Z][a-zA-Z]+(?:\s+[A-Z][a-zA-Z]+)?)/i);return n?n[1]:null}function hs(t){const s=t.reduce((n,o)=>n+$e(o),0);return ms(s)}function $e(t){return t?t.duration_seconds?t.duration_seconds:t.duration_minutes?t.duration_minutes*60:t.videos?.length?t.videos.reduce((s,n)=>s+(n.duration_seconds||0),0):0:0}function ms(t){if(!t||t<=0)return null;const s=Math.floor(t/3600),n=Math.floor(t%3600/60);return s>0?n>0?`${s} hr ${n} min`:`${s} hr`:`${n} min`}function ps(t){if(!t)return"Learning Path";if(t.length<=80)return t;const s=t.slice(0,80),n=s.lastIndexOf(" ");return(n>30?s.slice(0,n):s)+"â€¦"}function gs({instructors:t,courseCount:s,totalDuration:n,rootCauses:o}){const c=[];if(o.length>0&&c.push(`We've identified ${o.length} root cause${o.length>1?"s":""} for your issue:`),t.length===1)c.push(`${t[0].name} will guide you through ${s} lesson${s>1?"s":""}.`);else if(t.length>1){const l=t.map(d=>d.name),r=l.pop();c.push(`You'll learn from ${l.join(", ")} and ${r}.`)}else c.push(`You have ${s} lesson${s>1?"s":""} to complete.`);return n&&c.push(`Total time: ${n}.`),c.join(" ")}function fs(t,s){const n=Math.round((t+1)/s*100);return{text:`Video ${t+1} of ${s}`,percent:n,isComplete:t+1>=s}}function xs(t,s,n,o=0){const l=[...t?.canonical_tags||[],...t?.gemini_system_tags||[],...t?.transcript_tags||[],...t?.extracted_tags||[],...Array.isArray(t?.tags)?t.tags:[]].map(h=>typeof h=="string"?h.split(".").pop():h.name||h.display_name||"").filter(Boolean).filter((h,_,b)=>b.indexOf(h)===_),r=t?.gemini_skill_level||"Intermediate",d=(s||"").toLowerCase(),a=[],i=new Set,m=h=>{for(const _ of h)i.has(_.task)||(i.add(_.task),a.push(_))};if(d){const h=Object.keys(ue).sort((_,b)=>b.length-_.length);for(const _ of h)d.includes(_)&&m(ue[_])}const p=[...l].sort((h,_)=>{const b=d.includes(h.toLowerCase())?1:0;return(d.includes(_.toLowerCase())?1:0)-b});for(const h of p){const _=h.toLowerCase();ue[_]&&m(ue[_])}if(a.length>0){const h=a[o%a.length];return{task:h.task,hint:h.hint,expectedResult:h.expectedResult,docsUrl:h.docsUrl||null,difficulty:r}}const v=l[0]||(n?n.split(/\s+/).slice(0,3).join(" "):"this concept"),y=n?`"${n}"`:"this lesson",x=t?.gemini_outcomes?.[0]||"";return{task:s?`Open UE5 and apply the technique from ${y} to address "${s}". In the Details panel, identify which ${v} settings you changed and note the before/after values.`:`Open UE5, create a test Actor, and set up ${v} from scratch following the approach from ${y}. Document which panels and properties you used.`,hint:x?`Focus on: ${x}. Check Details panel and World Settings for relevant options.`:`Look for ${v} options in the Details panel, Modes panel, or Project Settings â†’ Engine.`,expectedResult:s?`Your original issue ("${s}") should be resolved or visibly improved in the viewport. Compare before/after values in the Details panel to confirm the change took effect.`:`You should see ${v} applied correctly in the viewport or preview. The Details panel should reflect the new settings, and the editor should show no warnings related to your changes.`,difficulty:r}}const nt="ue5_learning_progress";function rt(){try{const t=localStorage.getItem(nt);return t?{...ve(),...JSON.parse(t)}:ve()}catch{return ve()}}function ve(){return{completedPaths:[],tagsEncountered:{},totalVideosWatched:0,reflections:[],streak:{lastDate:null,count:0}}}function ys(t){try{localStorage.setItem(nt,JSON.stringify(t))}catch(s){ee("[LearningProgress] Failed to save:",s.message)}}function vs(t,s,n){const o=rt(),c=new Date().toISOString().split("T")[0];o.completedPaths.includes(t)||o.completedPaths.push(t);for(const l of s){const r=l.extracted_tags||l.tags||[];for(const d of r){const a=typeof d=="string"?d:d.name||d.display_name;a&&(o.tagsEncountered[a]=(o.tagsEncountered[a]||0)+1)}}if(o.totalVideosWatched+=s.length,o.streak.lastDate!==c){const l=new Date;l.setDate(l.getDate()-1);const r=l.toISOString().split("T")[0];o.streak.lastDate===r?o.streak.count+=1:o.streak.count=1,o.streak.lastDate=c}return n&&n.trim().length>0&&o.reflections.push({date:c,pathId:t,text:n.trim()}),ys(o),o}function js(){const t=rt(),s=new Date().toISOString().split("T")[0],n=new Date;n.setDate(n.getDate()-1);const o=n.toISOString().split("T")[0],c=t.streak.lastDate===s||t.streak.lastDate===o;return{count:c?t.streak.count:0,isActive:c}}const F={INTRO:"intro",PLAYING:"playing",QUIZ:"quiz",CHALLENGE:"challenge",BRIDGE:"bridge",COMPLETE:"complete"};function bs({courses:t,diagnosis:s,problemSummary:n,pathSummary:o,onComplete:c,onExit:l}){const[r,d]=j.useState(F.INTRO),[a,i]=j.useState(0),[m,p]=j.useState(0),[v,y]=j.useState(""),[x,h]=j.useState(null),[_,b]=j.useState(!0);j.useEffect(()=>_t(Y=>{h(Y),b(!1)}),[]);const E=j.useCallback(async()=>{b(!0);const{error:I}=await wt();I&&console.error("[GuidedPlayer] Sign in failed:",I),b(!1)},[]),M=t[a]||null,P=t[a+1]||null,z=M?.videos||[],A=z[m]||z[0]||null,u=m<z.length-1,S=m>0||a>0,k=u||!!P,L=z.length,R=j.useMemo(()=>cs({problemSummary:n,courses:t,diagnosis:s}),[n,t,s]),G=j.useMemo(()=>js(),[]),D=j.useMemo(()=>t.reduce((I,Y)=>I+(Y.videos?.length||1),0),[t]),Z=j.useMemo(()=>{let I=0;for(let Y=0;Y<a;Y++)I+=t[Y]?.videos?.length||1;return I+m},[t,a,m]),V=j.useMemo(()=>fs(Z,D),[Z,D]),X=j.useMemo(()=>{if(r!==F.BRIDGE)return null;const I=M?.gemini_outcomes?.[0]||null;return ls(M,P,I)},[r,M,P]),Q=j.useMemo(()=>r!==F.CHALLENGE?null:xs(M,n,A?.title,a),[r,M,n,A,a]),K=j.useCallback(()=>{d(F.PLAYING)},[]),J=j.useCallback(()=>{if(M?._readingStep){P?(i(I=>I+1),p(0),d(F.PLAYING)):(d(F.COMPLETE),c?.());return}if(u)p(I=>I+1);else{const I=tt[M?.code];I&&Object.keys(I).length>0?d(F.QUIZ):d(F.CHALLENGE)}},[u,M,P,c]),N=j.useCallback(()=>{if(m>0)p(I=>I-1);else if(a>0){const I=t[a-1]?.videos||[];i(Y=>Y-1),p(Math.max(0,I.length-1))}},[m,a,t]),T=j.useCallback(()=>{u?p(I=>I+1):P&&(i(I=>I+1),p(0))},[u,P]),g=j.useCallback(()=>{i(0),p(0),d(F.PLAYING)},[]),C=j.useCallback(()=>{d(F.CHALLENGE)},[]),w=j.useCallback(()=>{P?(i(I=>I+1),p(0),d(F.PLAYING)):(d(F.COMPLETE),c?.())},[P,c]),$=j.useCallback(()=>{i(I=>I+1),p(0),d(F.PLAYING)},[]),q=j.useCallback(I=>{i(I),p(0),d(F.PLAYING)},[]),U=j.useCallback(()=>{const I=n?`path-${n.replace(/\s+/g,"-").toLowerCase().slice(0,40)}-${Date.now()}`:`path-${Date.now()}`;vs(I,t,v),l?.()},[n,t,v,l]),O=v.trim().split(/\s+/).filter(Boolean).length;return{stage:r,currentIndex:a,videoIndex:m,reflectionText:v,setReflectionText:y,user:x,authLoading:_,currentCourse:M,nextCourse:P,currentVideos:z,currentVideo:A,hasMoreVideos:u,hasPreviousVideo:S,hasNextVideo:k,courseVideoCount:L,introContent:R,streak:G,progress:V,bridgeContent:X,challengeContent:Q,pathSummary:o,wordCount:O,courses:t,handleSignIn:E,handleStartLearning:K,handleVideoComplete:J,handlePreviousVideo:N,handleNextVideo:T,handleBackToPath:g,handleQuizComplete:C,handleChallengeComplete:w,handleContinue:$,handleSkipTo:q,handleFinish:U,onExit:l}}function Ns(t){if(!t||t<=0)return null;const s=Math.floor(t/3600),n=Math.floor(t%3600/60);return s>0?n>0?`${s} hr ${n} min`:`${s} hr`:`${n} min`}function at(t,s=320){const n=t?.drive_id||t?.driveId;return n?`https://drive.google.com/thumbnail?id=${n}&sz=w${s}`:null}function _s(t,s=320){const n=t?.videos?.[0];return at(n,s)}function it({challengeContent:t,onComplete:s}){return e.jsxs("div",{className:"challenge-card",children:[e.jsx("div",{className:"challenge-icon",children:"ðŸ”¨"}),e.jsx("h3",{children:"Try It Yourself"}),e.jsx("div",{className:"challenge-difficulty",children:e.jsx("span",{className:`difficulty-badge ${t.difficulty.toLowerCase()}`,children:t.difficulty})}),e.jsx("p",{className:"challenge-task",children:t.task}),t.expectedResult&&e.jsxs("div",{className:"challenge-expected",children:[e.jsx("span",{className:"expected-label",children:"ðŸ‘ï¸ What to look for:"})," ",t.expectedResult]}),e.jsxs("div",{className:"challenge-hint",children:[e.jsx("span",{className:"hint-label",children:"ðŸ’¡ Hint:"})," ",t.hint]}),t.docsUrl&&e.jsx("a",{className:"docs-link",href:t.docsUrl,target:"_blank",rel:"noopener noreferrer",children:"ðŸ“– Read the official UE5 docs â†’"}),e.jsx("button",{className:"challenge-done-btn",onClick:s,children:"I tried it â†’"}),e.jsx("button",{className:"challenge-skip-btn",onClick:s,children:"Skip challenge"})]})}it.propTypes={challengeContent:f.shape({task:f.string.isRequired,hint:f.string.isRequired,expectedResult:f.string,docsUrl:f.string,difficulty:f.string.isRequired}).isRequired,onComplete:f.func.isRequired};f.shape({type:f.string.isRequired,text:f.string.isRequired,subtext:f.string}).isRequired,f.func.isRequired;function ot({courses:t,totalDuration:s,reflectionText:n,onReflectionChange:o,wordCount:c,onFinish:l,onBackToPath:r}){return j.useEffect(()=>{if(n.trim())try{localStorage.setItem("lp_reflection_draft",JSON.stringify({text:n,timestamp:Date.now(),courseCount:t.length}))}catch{}},[n,t.length]),j.useEffect(()=>{try{const d=JSON.parse(localStorage.getItem("lp_reflection_draft")||"null");d?.text&&!n&&o(d.text)}catch{}},[]),e.jsxs("div",{className:"complete-card",children:[e.jsx("div",{className:"complete-icon",children:"ðŸŽ‰"}),e.jsx("h2",{children:"Path Complete!"}),e.jsx("p",{children:"You've learned the skills to solve this problem and similar ones in the future."}),e.jsxs("div",{className:"reflection-area",children:[e.jsx("h3",{children:"ðŸ“ What was your main takeaway?"}),e.jsx("p",{className:"reflection-subtitle",children:"Writing your reflection helps cement what you learned."}),e.jsx("textarea",{className:"reflection-input",placeholder:"I learned that...",value:n,onChange:d=>o(d.target.value),rows:4}),e.jsxs("div",{className:"reflection-meta",children:[c===0&&e.jsx("span",{className:"word-hint",children:"Try writing a few sentences"}),c>0&&c<10&&e.jsxs("span",{className:"word-hint",children:[c," words â€” keep going!"]}),c>=10&&e.jsx("span",{className:"word-hint done",children:"Great reflection! âœ“"})]})]}),e.jsxs("div",{className:"stats",children:[e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"value",children:t.length}),e.jsx("span",{className:"label",children:"Lessons"})]}),e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"value",children:s||"â€”"}),e.jsx("span",{className:"label",children:"Total Time"})]})]}),e.jsxs("div",{className:"completion-actions",children:[e.jsx("button",{className:"finish-btn",onClick:()=>{l();try{localStorage.removeItem("lp_reflection_draft")}catch{}},children:n.trim()?"Save & Finish":"Back to Problems"}),r&&e.jsx("button",{className:"back-to-path-btn",onClick:r,children:"â† Back to Learning Path"})]})]})}ot.propTypes={courses:f.array.isRequired,totalDuration:f.string,reflectionText:f.string.isRequired,onReflectionChange:f.func.isRequired,wordCount:f.number.isRequired,onFinish:f.func.isRequired};function fe(t){return t?t.replace(/\.mp4$/i,"").replace(/_/g," ").replace(/^[A-Z]{2,5}\s+\d[\d.]*\s*/gi,"").replace(/^\d+\.\d+\s*/g,"").replace(/^0*\d{1,3}\s+/g,"").replace(/^(\w+)[ _]\1[ _]/i,"").replace(/^(?:and|or)\s+/i,"").replace(/\s+\d{1,3}\s*(NEW|FINAL|EDIT|EDITED|OLD|DRAFT|v\d+)?\s*$/gi,"").replace(/\s+(NEW|FINAL|EDIT|EDITED|OLD|DRAFT|v\d+)\s*$/gi,"").replace(/([a-z])(\d{2})$/g,"$1").replace(/([a-z])([A-Z])/g,"$1 $2").replace(/([A-Z]+)([A-Z][a-z])/g,"$1 $2").replace(/\s+(?:5[0-5]|4[0-9])$/g,"").replace(/[-]+\s*$/g,"").replace(/^\s*[-]+/g,"").replace(/\s{2,}/g," ").trim()||t:"Untitled Video"}function ct({courses:t,currentIndex:s,onSkipTo:n}){const o=t.map(c=>c.code);return e.jsxs("div",{className:"course-sidebar",children:[e.jsx("h4",{children:"Your Path"}),e.jsx("div",{className:"sidebar-courses",children:t.map((c,l)=>{const r=st[c.code],d=r?.prerequisites?.filter(a=>!o.includes(a))||[];return e.jsxs("button",{className:`sidebar-course ${l===s?"active":""} ${l<s?"completed":""}`,onClick:()=>n(l),title:fe(c.videos?.[0]?.title||c.title||c.name),children:[e.jsx("span",{className:"index",children:l<s?"âœ“":l+1}),e.jsx("span",{className:"title",children:fe(c.videos?.[0]?.title||c.title||c.name)}),r?.difficulty&&e.jsx("span",{className:`difficulty-tag ${r.difficulty}`,children:r.difficulty}),d.length>0&&e.jsx("span",{className:"prereq-warning",title:`Recommended: ${d.join(", ")} first`,children:"âš ï¸"})]},c.code||l)})})]})}ct.propTypes={courses:f.array.isRequired,currentIndex:f.number.isRequired,onSkipTo:f.func.isRequired};function lt({courseCode:t,videoKey:s,onComplete:n,onSkip:o}){const[c,l]=j.useState(0),[r,d]=j.useState(null),[a,i]=j.useState(!1),[m,p]=j.useState(0),[v,y]=j.useState(!1),x=j.useMemo(()=>{if(!t||!s)return[];const A=tt[t];if(!A)return[];if(A[s])return A[s];const u=k=>(k||"").replace(/\.mp4$/i,"").replace(/^[\d._]+/,"").replace(/[\s_]+/g,"").toLowerCase(),S=u(s);for(const[k,L]of Object.entries(A)){const R=u(k);if(R===S||R.includes(S)||S.includes(R))return L}return[]},[t,s]);if(x.length===0)return null;const h=x[c],_=r===h?.correct,b=x.length,E=A=>{a||d(A)},M=()=>{r!==null&&(i(!0),r===h.correct&&p(A=>A+1))},P=()=>{c<b-1?(l(A=>A+1),d(null),i(!1)):y(!0)},z=()=>{n({score:m,total:b})};if(v){const A=Math.round(m/b*100),u=A>=80?Xt:A>=50?rs:Ot,S=A>=80?"Excellent! You've got a strong grasp of this material.":A>=50?"Good effort! Consider rewatching for the topics you missed.":"You might want to re-watch this section before moving on.";return e.jsx("div",{className:"quiz-card",children:e.jsxs("div",{className:"quiz-score-summary",children:[e.jsx("div",{className:"score-icon-container",children:e.jsx(u,{size:48,className:"score-icon"})}),e.jsxs("h3",{children:[m,"/",b," Correct"]}),e.jsx("div",{className:"score-bar",children:e.jsx("div",{className:"score-fill",style:{width:`${A}%`}})}),e.jsx("p",{className:"score-message",children:S}),e.jsxs("button",{className:"quiz-continue-btn",onClick:z,children:["Continue ",e.jsx(ye,{size:16})]})]})})}return e.jsxs("div",{className:"quiz-card",children:[e.jsxs("div",{className:"quiz-header",children:[e.jsx("span",{className:"quiz-icon",children:e.jsx(Kt,{size:20})}),e.jsx("h3",{children:"Quick Check"}),e.jsxs("span",{className:"quiz-progress",children:[c+1," / ",b]})]}),e.jsx("p",{className:"quiz-question",children:h.question}),e.jsx("div",{className:"quiz-options",children:h.options.map((A,u)=>{let S="quiz-option";return r===u&&(S+=" selected"),a&&(u===h.correct?S+=" correct":r===u&&(S+=" incorrect")),e.jsxs("button",{className:S,onClick:()=>E(u),disabled:a,children:[e.jsx("span",{className:"option-letter",children:String.fromCharCode(65+u)}),e.jsx("span",{className:"option-text",children:A}),a&&u===h.correct&&e.jsx("span",{className:"option-icon",children:e.jsx(Ee,{size:16})}),a&&r===u&&u!==h.correct&&e.jsx("span",{className:"option-icon",children:e.jsx(et,{size:16})})]},u)})}),a&&h.explanation&&e.jsxs("div",{className:`quiz-explanation ${_?"correct":"incorrect"}`,children:[e.jsx("span",{className:"explanation-icon",children:_?e.jsx(Ee,{size:16}):e.jsx(Dt,{size:16})}),e.jsx("p",{children:h.explanation})]}),e.jsxs("div",{className:"quiz-actions",children:[a?e.jsx("button",{className:"quiz-next-btn",onClick:P,children:c<b-1?e.jsxs(e.Fragment,{children:["Next Question ",e.jsx(ye,{size:16})]}):e.jsxs(e.Fragment,{children:["See Results ",e.jsx(ye,{size:16})]})}):e.jsx("button",{className:"quiz-check-btn",onClick:M,disabled:r===null,children:"Check Answer"}),e.jsx("button",{className:"quiz-skip-btn",onClick:o,children:"Skip Quiz"})]})]})}lt.propTypes={courseCode:f.string,videoKey:f.string,onComplete:f.func.isRequired,onSkip:f.func.isRequired};const ce=new Set(["the","and","for","with","this","that","are","was","has","have","not","can","into","from","how","you","your","will","would","also","just","like","more","very","some","want","need","make","use","used","using","help","helpful","helps","get","getting","let","look","going","come","here","there","know","thing","really","actually","basically","something","everything","slow","fast","leading","exhibiting","experiencing","causing","about","been","being","could","does","doing","done","each","even","every","first","give","good","great","kind","made","much","over","part","right","same","see","show","start","still","take","tell","than","them","then","these","they","those","through","time","took","turn","way","well","what","when","where","which","while","work","working","unreal","engine","introduction","quick"]),ws=new Set(["gonna","going","really","actually","basically","right","thing","things","about","would","could","should","there","their","these","those","where","which","being","doing","using","other","first","second","third","after","before","every","still","again","already","engine","unreal","because","simply","called","allows","looking","provides"]);function je(t){return(t||"").replace(/\.mp4$/i,"").replace(/^[\d._]+/,"").replace(/[\s_]+/g,"").toLowerCase()}function dt({courseCode:t,videoTitle:s,problemSummary:n,matchedKeywords:o}){const[c,l]=j.useState(null);j.useEffect(()=>{let a=!1;return ae(()=>import("./data-transcripts-CYT280mV.js"),[]).then(i=>{a||l(i.default||i)}),()=>{a=!0}},[]);const r=j.useMemo(()=>{if(!t||!c)return[];const a=c[t];if(!a)return[];const i=je(s);let m=null;for(const[h,_]of Object.entries(a))if(je(h)===i){m=_;break}if(!m)for(const[h,_]of Object.entries(a)){const b=je(h);if(b.includes(i)||i.includes(b)){m=_;break}}if(!m||m.length===0)return[];const p=[];if(n&&p.push(...n.toLowerCase().split(/\s+/).filter(h=>h.length>3&&!ce.has(h))),o&&p.push(...o.map(h=>(typeof h=="string"?h:h.display_name||h.id||"").toLowerCase())),p.length===0){const h=m.filter(b=>b.start&&b.start!=="0:00");if(h.length===0)return[];const _=Math.max(1,Math.floor(h.length/3));return h.filter((b,E)=>E%_===0).slice(0,3).map(b=>({...b,score:0,isChapter:!0}))}const y=m.map(h=>{const _=h.text.toLowerCase();let b=0;const E=[];for(const M of p)_.includes(M)&&(b+=10,E.includes(M)||E.push(M));return{...h,score:b,hits:[...new Set(E)]}}).filter(h=>h.score>0).sort((h,_)=>_.score-h.score);if(y.length>0){const h=y.slice(0,3);return h.sort((_,b)=>{const E=M=>{const P=(M||"0:00").split(":").map(Number);return P.length===3?P[0]*3600+P[1]*60+P[2]:P[0]*60+(P[1]||0)};return E(_.start)-E(b.start)}),h}const x=Math.max(1,Math.floor(m.length/3));return m.filter((h,_)=>_%x===0).slice(0,3).map(h=>({...h,score:0,isChapter:!0}))},[t,s,n,o,c]),d=j.useCallback(a=>{if(a.summary)return a.summary;const m=(a.text||"").replace(/[.,;:!?'"()]/g,"").split(/\s+/).filter(y=>y.length>=5&&!ws.has(y.toLowerCase())).map(y=>y.toLowerCase()),p={};for(const y of m)p[y]=(p[y]||0)+1;const v=Object.entries(p).sort((y,x)=>x[1]-y[1]).slice(0,3).map(([y])=>y.charAt(0).toUpperCase()+y.slice(1));return v.length>0?v.join(", "):"Overview"},[]);return r.length===0?null:e.jsx("div",{className:"video-info-cards",children:e.jsxs("div",{className:"info-card transcript-card",children:[e.jsx("h4",{children:r[0]?.isChapter?"ðŸ“‹ Video Chapters":`ðŸŽ¯ ðŸŽ¬ Video Callouts: ${n||"your search"}`}),e.jsx("div",{className:"timestamp-list",children:r.map((a,i)=>e.jsxs("div",{className:`timestamp-item ${a.score>0?"relevant":""}`,children:[e.jsx("span",{className:"timestamp-badge",children:a.start}),e.jsx("span",{className:"timestamp-text",children:d(a)})]},i))})]})})}dt.propTypes={courseCode:f.string,videoTitle:f.string,problemSummary:f.string,matchedKeywords:f.array};function Cs(t){if(!t||typeof t!="string")return t;t=t.replace(/\s*\[\d+(?:[,\s]*\d+)*\]/g,"").trim();const s=[];let n=t,o=0;for(;n.length>0;){const c=[{re:/\*\*(.+?)\*\*/,wrap:a=>e.jsx("strong",{children:a},o++)},{re:/\*(.+?)\*/,wrap:a=>e.jsx("em",{children:a},o++)},{re:/`([^`]+)`/,wrap:a=>e.jsx("code",{className:"inline-code",children:a},o++)},{re:/\[([^\]]+)\]\(([^)]+)\)/,wrap:(a,i)=>e.jsx("a",{href:i,target:"_blank",rel:"noopener noreferrer",children:a},o++)}];let l=null,r=n.length,d=null;for(const a of c){const i=n.match(a.re);i&&i.index<r&&(l=i,r=i.index,d=a)}if(!l){s.push(n);break}r>0&&s.push(n.slice(0,r)),s.push(d.wrap(l[1],l[2])),n=n.slice(r+l[0].length)}return s}function qe(t){const s=bs(t);return e.jsxs("div",{className:"guided-player",children:[e.jsxs("div",{className:"progress-bar",children:[e.jsx("div",{className:"progress-fill",style:{width:`${s.progress.percent}%`}}),e.jsx("span",{className:"progress-text",children:s.progress.text})]}),s.stage===F.INTRO&&e.jsx(Ss,{introContent:s.introContent,streak:s.streak,courses:s.courses,pathSummary:s.pathSummary,user:s.user,authLoading:s.authLoading,onSignIn:s.handleSignIn,onStart:s.handleStartLearning}),s.stage===F.PLAYING&&s.currentCourse&&!s.currentCourse._readingStep&&e.jsx(ks,{course:s.currentCourse,currentVideos:s.currentVideos,currentVideo:s.currentVideo,videoIndex:s.videoIndex,hasMoreVideos:s.hasMoreVideos,microLesson:t.microLesson,courses:s.courses,onVideoComplete:s.handleVideoComplete,onExit:s.onExit}),s.stage===F.PLAYING&&s.currentCourse&&s.currentCourse._readingStep&&e.jsx(ut,{course:s.currentCourse,stepNumber:s.currentIndex+1,totalSteps:s.courses.length,onComplete:s.handleVideoComplete,onExit:s.onExit}),s.stage===F.QUIZ&&e.jsx(lt,{courseCode:s.currentCourse?.code,videoKey:s.currentVideo?.title||s.currentVideo?.name||"",onComplete:s.handleQuizComplete,onSkip:s.handleQuizComplete}),s.stage===F.CHALLENGE&&s.challengeContent&&e.jsx(it,{challengeContent:s.challengeContent,onComplete:s.handleChallengeComplete}),s.stage===F.COMPLETE&&e.jsx(ot,{courses:s.courses,totalDuration:s.introContent.totalDuration,reflectionText:s.reflectionText,onReflectionChange:s.setReflectionText,wordCount:s.wordCount,onFinish:s.handleFinish,onBackToPath:s.handleBackToPath}),s.stage!==F.INTRO&&s.stage!==F.COMPLETE&&e.jsxs("div",{className:"sidebar-column",children:[e.jsx(ct,{courses:s.courses,currentIndex:s.currentIndex,onSkipTo:s.handleSkipTo}),s.stage===F.PLAYING&&s.currentCourse&&e.jsx(dt,{courseCode:s.currentCourse.code,videoTitle:s.currentVideo?.title||s.currentVideo?.name||"",problemSummary:t.problemSummary,matchedKeywords:s.currentCourse._matchedKeywords})]})]})}qe.propTypes={courses:f.array.isRequired,diagnosis:f.object,problemSummary:f.string,microLesson:f.object,pathSummary:f.shape({path_summary:f.string,topics_covered:f.arrayOf(f.string)}),onComplete:f.func,onExit:f.func};qe.defaultProps={diagnosis:null,problemSummary:"",microLesson:null,pathSummary:null,onComplete:()=>{},onExit:()=>{}};function Ss({introContent:t,streak:s,courses:n,pathSummary:o,user:c,authLoading:l,onSignIn:r,onStart:d}){return e.jsxs("div",{className:"intro-card",children:[e.jsx("h2",{children:t.title}),e.jsx("p",{className:"intro-text",children:t.intro}),t.rootCauses?.length>0&&e.jsx("ol",{className:"root-cause-list",children:t.rootCauses.map((a,i)=>e.jsx("li",{children:a.replace(/\s*\[\d+\]/g,"")},i))}),s.isActive&&s.count>1&&e.jsxs("div",{className:"streak-badge",children:["ðŸ”¥ ",s.count,"-day learning streak!"]}),e.jsxs("div",{className:"course-preview",children:[e.jsx("h3",{children:"ðŸ“š What You'll Learn"}),o?.path_summary&&!/unavailable/i.test(o.path_summary)&&e.jsx("div",{className:"path-summary-section",children:e.jsx("p",{className:"path-summary-text",children:o.path_summary})}),e.jsxs("div",{className:"course-list",children:[n.slice(0,5).map((a,i)=>{const m=Mt[a.code]||[],p=a.videos?.[0]?.title||a.title||a.name;return e.jsxs("div",{className:"course-preview-item",children:[e.jsx("span",{className:"number",children:i+1}),e.jsxs("div",{className:"course-preview-details",children:[e.jsx("span",{className:"title",children:p?.replace(/\s+Part\s+[A-Z]$/i,"").trim()}),m.length>0&&e.jsx("ul",{className:"objective-list",children:m.slice(0,2).map((v,y)=>e.jsx("li",{children:v},y))})]})]},a.code||i)}),n.length>5&&e.jsxs("div",{className:"more-courses",children:["+",n.length-5," more"]})]})]}),e.jsx("div",{className:"auth-section",children:l?e.jsx("p",{className:"auth-loading",children:"Checking sign-in status..."}):c?e.jsxs("div",{className:"auth-signed-in",children:[e.jsxs("span",{className:"user-email",children:["âœ“ Signed in as ",c.email]}),e.jsx("button",{className:"start-btn",onClick:d,children:"â–¶ Start Learning"})]}):e.jsxs("div",{className:"auth-prompt",children:[e.jsx("p",{className:"signin-note",children:"Sign in with Google to watch videos from Google Drive"}),e.jsx("button",{className:"signin-btn",onClick:r,children:"ðŸ” Sign in with Google"}),e.jsx("button",{className:"start-btn secondary",onClick:d,children:"Skip sign-in (videos may not load)"})]})})]})}function ks({course:t,currentVideos:s,currentVideo:n,videoIndex:o,hasMoreVideos:c,microLesson:l,courses:r,onVideoComplete:d,onExit:a}){return e.jsxs("div",{className:"video-stage",children:[e.jsxs("div",{className:"video-header",children:[e.jsx("h3",{children:t.title||t.name}),s.length>1&&e.jsxs("span",{className:"video-counter",children:["Video ",o+1," of ",s.length]}),t.gemini_outcomes?.[0]&&e.jsx("p",{className:"objective",children:t.gemini_outcomes[0]})]}),e.jsx("div",{className:"video-container",children:n?.drive_id?e.jsx("iframe",{src:`https://drive.google.com/file/d/${n.drive_id}/preview`,title:n.title||t.title,allow:"autoplay",allowFullScreen:!0},n.drive_id):e.jsxs("div",{className:"video-placeholder",children:[e.jsx("img",{src:at(n),alt:t.title}),e.jsx("div",{className:"play-overlay",children:"â–¶"})]})}),n?.drive_id&&e.jsx("a",{href:`https://drive.google.com/file/d/${n.drive_id}/view`,target:"_blank",rel:"noopener noreferrer",className:"drive-fallback-link",children:"ðŸ”— Video not loading? Open in Google Drive"}),l&&e.jsx(Ts,{microLesson:l,courses:r}),e.jsxs("div",{className:"video-controls",children:[e.jsx("button",{className:"complete-btn",onClick:d,children:c?"Mark Complete & Continue â†’":"Complete & Try Exercise â†’"}),e.jsx("button",{className:"exit-btn",onClick:a,children:"Exit Path"})]})]})}function Ts({microLesson:t,courses:s}){const[n,o]=j.useState(!1),[c,l]=j.useState("quick_fix"),r=t?.quick_fix,d=t?.why_it_works,a=t?.related_situations,i=p=>{l(v=>v===p?null:p)},m=p=>p?p.replace(/\s*\[\d+(?:[,\s]*\d+)*\]/g,"").trim():null;return e.jsxs("div",{className:`gp-ai-lesson ${n?"open":"collapsed"}`,children:[e.jsxs("button",{className:"gp-ai-lesson-toggle",onClick:()=>o(p=>!p),children:[e.jsx("span",{className:"gp-ai-badge",children:"âœ¨ AI Guide"}),e.jsx("span",{className:"gp-ai-subtitle",children:"What to look for"}),e.jsx("span",{className:"gp-ai-chevron",children:n?"â–¾":"â–¸"})]}),n&&e.jsxs("div",{className:"gp-ai-body",children:[r&&e.jsxs("div",{className:`gp-ai-section ${c==="quick_fix"?"expanded":""}`,children:[e.jsxs("button",{className:"gp-ai-section-toggle",onClick:()=>i("quick_fix"),children:[e.jsxs("span",{children:["âš¡ ",r.title||"Quick Fix"]}),e.jsx("span",{className:"gp-ai-section-chevron",children:c==="quick_fix"?"â–¾":"â–¸"})]}),c==="quick_fix"&&r.steps&&e.jsx("ol",{className:"gp-ai-steps",children:r.steps.map((p,v)=>e.jsx("li",{children:m(p)},v))})]}),d&&e.jsxs("div",{className:`gp-ai-section ${c==="why"?"expanded":""}`,children:[e.jsxs("button",{className:"gp-ai-section-toggle",onClick:()=>i("why"),children:[e.jsx("span",{children:"ðŸ§  Why This Works"}),d.key_concept&&e.jsx("span",{className:"gp-ai-concept-tag",children:d.key_concept}),e.jsx("span",{className:"gp-ai-section-chevron",children:c==="why"?"â–¾":"â–¸"})]}),c==="why"&&e.jsx("p",{className:"gp-ai-explanation",children:m(d.explanation)})]}),a&&a.length>0&&e.jsxs("div",{className:`gp-ai-section ${c==="related"?"expanded":""}`,children:[e.jsxs("button",{className:"gp-ai-section-toggle",onClick:()=>i("related"),children:[e.jsx("span",{children:"ðŸ”— Related Situations"}),e.jsx("span",{className:"gp-ai-count-tag",children:a.length}),e.jsx("span",{className:"gp-ai-section-chevron",children:c==="related"?"â–¾":"â–¸"})]}),c==="related"&&e.jsx("div",{className:"gp-ai-scenarios",children:a.map((p,v)=>e.jsxs("div",{className:"gp-ai-scenario",children:[e.jsxs("strong",{children:["ðŸ’¡ ",p.scenario]}),e.jsx("p",{children:m(p.connection)})]},v))})]})]})]})}function ut({course:t,stepNumber:s,totalSteps:n,onComplete:o,onExit:c}){const[l,r]=j.useState(!1),d=t._resourceType==="doc"?"ðŸ“–":"â–¶ï¸",a=t._resourceType==="doc"?"Documentation":"YouTube Video",i=t._resourceType==="doc"?"Epic Docs":t._channel||"YouTube",m=t._resourceType!=="doc",p=(()=>{if(!m||!t._url)return null;try{const y=new URL(t._url);if(y.hostname.includes("youtube.com"))return y.searchParams.get("v");if(y.hostname.includes("youtu.be"))return y.pathname.slice(1)}catch{}return null})(),v=y=>{const x=Math.floor(y/60),h=y%60;return`${x}:${h.toString().padStart(2,"0")}`};return e.jsxs("div",{className:"reading-step",children:[e.jsxs("div",{className:"reading-step-header",children:[e.jsxs("span",{className:"reading-step-badge",children:[d," ",a]}),e.jsxs("span",{className:"reading-step-progress",children:["Step ",s," of ",n]})]}),e.jsx("h2",{className:"reading-step-title",children:t.title}),e.jsxs("div",{className:"reading-step-meta",children:[t._tier&&e.jsx("span",{className:`tier-badge tier-${t._tier}`,children:t._tier}),t._channelTrust&&e.jsx("span",{className:`channel-trust-badge trust-${t._channelTrust}`,children:t._channelTrust==="official"?"âœ“ Official":"â­ Expert"}),e.jsxs("span",{className:"reading-step-time",children:["â± ",t._readTimeMinutes," min ",m?"watch":"read"]})]}),t._topics&&t._topics.length>0&&e.jsx("div",{className:"reading-step-topics",children:t._topics.map((y,x)=>e.jsx("span",{className:"topic-chip",children:y.replace(/_/g," ")},x))}),t._description&&e.jsx("p",{className:"reading-step-description",children:t._description}),p&&e.jsx("div",{className:"reading-step-player",children:e.jsx("iframe",{src:`https://www.youtube-nocookie.com/embed/${p}?rel=0&modestbranding=1`,title:t.title,allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,className:"reading-step-iframe"})}),t._keySteps&&t._keySteps.length>0?e.jsxs("div",{className:"key-steps-section",children:[e.jsx("h3",{className:"key-steps-heading",children:"ðŸŽ¯ Key Takeaways"}),e.jsx("ol",{className:"key-steps-list",children:t._keySteps.map((y,x)=>e.jsx("li",{className:"key-step-item",children:Cs(y)},x))})]}):t._description?e.jsxs("div",{className:"key-steps-section key-steps-fallback",children:[e.jsx("h3",{className:"key-steps-heading",children:"ðŸŽ¯ What to Focus On"}),e.jsxs("ul",{className:"key-steps-list",children:[e.jsxs("li",{className:"key-step-item",children:["Understand how ",e.jsx("strong",{children:t.title})," works in UE5"]}),t._topics&&t._topics.length>0&&t._topics.slice(0,2).map((y,x)=>e.jsxs("li",{className:"key-step-item",children:["Pay attention to ",e.jsx("strong",{children:y.replace(/_/g," ")})," concepts and workflows"]},x)),t._subsystem&&e.jsxs("li",{className:"key-step-item",children:["Note how ",e.jsx("strong",{children:t._subsystem})," integrates with the editor"]}),e.jsx("li",{className:"key-step-item",children:"Try applying these techniques in your own UE5 project"})]})]}):null,t._chapters&&t._chapters.length>0&&e.jsxs("div",{className:"chapters-section",children:[e.jsx("h3",{className:"chapters-heading",children:"ðŸ“‘ Chapters"}),e.jsx("div",{className:"chapters-list",children:t._chapters.map((y,x)=>e.jsxs("a",{href:p?`https://www.youtube.com/watch?v=${p}&t=${y.seconds}`:"#",target:"_blank",rel:"noopener noreferrer",className:"chapter-item",children:[e.jsx("span",{className:"chapter-time",children:v(y.seconds)}),e.jsx("span",{className:"chapter-label",children:y.label})]},x))})]}),t._seeAlso&&t._seeAlso.length>0&&e.jsxs("div",{className:"see-also-section",children:[e.jsx("h3",{className:"see-also-heading",children:"ðŸ”— See Also"}),e.jsx("div",{className:"see-also-links",children:t._seeAlso.map((y,x)=>{const h=Rt[y.docKey],_=h?h.url:"#";return e.jsxs("a",{href:_,target:"_blank",rel:"noopener noreferrer",className:"see-also-link",title:h?h.description:y.label,children:["â†’ ",y.label]},x)})})]}),e.jsx("div",{className:"reading-step-source",children:e.jsxs("span",{className:"reading-step-source-label",children:["Source: ",i]})}),e.jsxs("a",{href:t._url,target:"_blank",rel:"noopener noreferrer",className:"reading-step-link",onClick:()=>r(!0),children:[t._resourceType==="doc"?"ðŸ“„ Open Documentation":"â–¶ï¸ Watch on YouTube",e.jsx("span",{className:"reading-step-link-arrow",children:"â†—"})]}),e.jsxs("div",{className:"reading-step-actions",children:[e.jsx("button",{className:`reading-step-complete ${l?"ready":""}`,onClick:o,title:l?"Continue to next step":"Mark as read and continue",children:l?"âœ“ Read â€” Continue â†’":"Mark as Read â†’ Continue"}),e.jsx("button",{className:"reading-step-exit",onClick:c,children:"âœ• Exit Path"})]})]})}ut.propTypes={course:f.object.isRequired,stepNumber:f.number.isRequired,totalSteps:f.number.isRequired,onComplete:f.func.isRequired,onExit:f.func.isRequired};const ht={},mt={};(qt.courses||[]).forEach(t=>{ht[t.code]=t.title,mt[t.code]=t.versions||[]});function Is(t){const s=mt[t];return!s||s.length===0?!1:s.every(n=>{const o=String(n).replace(/^V/i,"");return o.startsWith("4")&&!o.startsWith("4.")?/^4\d{1,2}$/.test(o):o.startsWith("4.")})}function Es(t){if(!t||t<=0)return"";const s=Math.round(t/60);return s<1?"<1 min":`${s} min`}function Me({video:t,isAdded:s,onToggle:n,userQuery:o}){const{title:c,duration:l,driveId:r,courseCode:d,_curatedMatch:a,role:i,reason:m,matchPercent:p,matchReason:v}=t,y=p>=100?"best":p>=70?"strong":p>=40?"good":"related",x=p>=100?"Best Match":p>=70?"Strong Match":p>=40?"Good Match":"Related",h=c?.replace(/\s+(?:Part\s+[A-Z]|PT\s*\d+)$/i,"").trim()||c,_=d?st[d]:null,b=_?.prereqs||[],[E,M]=j.useState(()=>zt(r)),[P,z]=j.useState(!1),A=j.useRef(null),u=j.useRef(null);j.useEffect(()=>{if(!P)return;const R=G=>{A.current&&!A.current.contains(G.target)&&z(!1)};return document.addEventListener("mousedown",R),()=>document.removeEventListener("mousedown",R)},[P]);const S=R=>{R.stopPropagation(),Ft(r,o||""),M("up")},k=R=>{R.stopPropagation(),Ut(r,o||""),M("down")},L=r?`https://drive.google.com/thumbnail?id=${r}&sz=w320`:null;return e.jsx("div",{ref:u,className:`video-result-card ${s?"added":""} ${a?"curated":""} ${E==="down"?"demoted":""}`,role:"button",tabIndex:0,children:e.jsxs("div",{className:"vrc-compact",children:[e.jsxs("div",{className:"vrc-thumbnail",children:[L?e.jsx("img",{src:L,alt:h,onError:R=>{R.target.style.display="none",R.target.nextSibling.style.display="flex"}}):null,e.jsx("div",{className:"vrc-thumb-fallback",style:{display:L?"none":"flex"},children:e.jsx("span",{className:"vrc-play-icon",children:e.jsx(Yt,{size:24})})}),l>0&&e.jsx("span",{className:"vrc-duration",children:Es(l)})]}),e.jsxs("div",{className:"vrc-badge-row",children:[p!=null&&e.jsxs("span",{className:`vrc-match-badge vrc-match-${y}`,title:`${p}% match`,children:[e.jsx("span",{className:"vrc-match-dot"}),x]}),a&&e.jsx("span",{className:"vrc-curated-badge",children:"âœ“ Solution"}),i&&i!=="core"&&e.jsxs("div",{className:"vrc-role-wrapper",ref:i==="prerequisite"?A:null,children:[e.jsxs("button",{className:`vrc-role-badge vrc-role-${i} ${i==="prerequisite"?"vrc-role-clickable":""}`,onClick:R=>{R.stopPropagation(),i==="prerequisite"&&z(G=>!G)},title:i==="prerequisite"?"Click to see why this is a prerequisite":void 0,children:[i==="prerequisite"&&"ðŸ”— Prerequisite",i==="troubleshooting"&&"ðŸ”§ Troubleshooting",i==="supplemental"&&"ðŸ“š Supplemental"]}),P&&i==="prerequisite"&&e.jsxs("div",{className:"vrc-prereq-tooltip",children:[e.jsx("strong",{children:"Prerequisite Course"}),b.length>0?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"Watch these first:"}),e.jsx("ul",{className:"vrc-prereq-list",children:b.map(R=>e.jsxs("li",{children:["ðŸ“˜ ",ht[R]||R,_?.reasons?.[R]&&e.jsxs("span",{className:"vrc-prereq-why",children:[" â€” ",_.reasons[R]]})]},R))})]}):e.jsx("p",{children:"Watch this first â€” it covers foundational concepts needed before advancing."}),m&&e.jsx("p",{className:"vrc-tip-reason",children:m})]})]}),d&&Is(d)&&e.jsx("span",{className:"vrc-ue4-badge",title:"This content was created for Unreal Engine 4 â€” some details may differ in UE5",children:"âš ï¸ UE4"})]}),e.jsxs("div",{className:"vrc-info",children:[e.jsx("h4",{className:"vrc-title",children:h}),v&&e.jsx("p",{className:"vrc-match-reason",children:v})]}),e.jsxs("div",{className:"vrc-actions",children:[e.jsxs("div",{className:"vrc-feedback",children:[e.jsx("button",{className:`vrc-fb-btn ${E==="up"?"active-up":""}`,onClick:S,"aria-label":"Helpful",title:"This was helpful",children:e.jsx("span",{className:"vrc-fb-emoji",children:"ðŸ‘"})}),e.jsx("button",{className:`vrc-fb-btn ${E==="down"?"active-down":""}`,onClick:k,"aria-label":"Not helpful",title:"Not relevant",children:e.jsx("span",{className:"vrc-fb-emoji",children:"ðŸ‘Ž"})})]}),e.jsx("button",{className:`vrc-add-btn ${s?"vrc-added":""}`,onClick:R=>{R.stopPropagation(),n(t)},"aria-label":s?"Remove from playlist":"Add to playlist",children:s?e.jsxs(e.Fragment,{children:[e.jsx(Ee,{size:14})," Added"]}):e.jsxs(e.Fragment,{children:[e.jsx($t,{size:14})," Add"]})})]})]})})}Me.propTypes={video:f.shape({driveId:f.string,title:f.string.isRequired,courseName:f.string,duration:f.number,matchedTags:f.arrayOf(f.string),courseCode:f.string,topSegments:f.array,docLinks:f.array,_curatedMatch:f.bool,role:f.oneOf(["prerequisite","core","troubleshooting","supplemental"]),reason:f.string,estimatedMinutes:f.number}).isRequired,isAdded:f.bool,onToggle:f.func.isRequired,userQuery:f.string};function Be(t){const s=Math.round(t/60);if(s<1)return"<1 min";if(s>=60){const n=Math.floor(s/60),o=s%60;return o>0?`${n}h ${o}m`:`${n}h`}return`${s} min`}const Ls={video:"ðŸ“º",doc:"ðŸ“–",youtube:"â–¶ï¸"};function pt({cart:t,onRemove:s,onClear:n,onWatchPath:o}){const c=t.reduce((i,m)=>i+(m.duration||(m.readTimeMinutes||m.durationMinutes||0)*60),0),l=t.filter(i=>(i.type||"video")==="video").length,r=t.filter(i=>i.type==="doc").length,d=t.filter(i=>i.type==="youtube").length,a=[];return l>0&&a.push(`${l} video${l!==1?"s":""}`),r>0&&a.push(`${r} doc${r!==1?"s":""}`),d>0&&a.push(`${d} YT`),e.jsxs("div",{className:"cart-panel",children:[e.jsxs("div",{className:"cart-header",children:[e.jsx("h3",{className:"cart-title",children:"ðŸ›’ My Learning Path"}),t.length>0&&e.jsx("button",{className:"cart-clear-btn",onClick:n,title:"Clear all",children:"Clear"})]}),t.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cart-stats",children:[e.jsx("span",{className:"cart-stat-count",children:a.join(" Â· ")}),e.jsx("span",{className:"cart-stat-dot",children:"Â·"}),e.jsx("span",{className:"cart-stat-time",children:Be(c)})]}),c>28800&&e.jsx("div",{className:"cart-warning",children:"âš ï¸ That's over 8 hours of content â€” consider narrowing your focus to the most relevant items."}),e.jsx("div",{className:"cart-items",children:t.map((i,m)=>{const p=i.itemId||i.driveId||m,v=i.type||"video",y=Ls[v]||"ðŸ“º",x=v==="video"?fe(i.title):i.title,h=i.duration>0?Be(i.duration):i.readTimeMinutes?`${i.readTimeMinutes} min read`:i.durationMinutes?`${i.durationMinutes} min`:null;return e.jsxs("div",{className:`cart-item cart-item-${v}`,children:[e.jsx("span",{className:"cart-item-num",children:m+1}),e.jsx("span",{className:"cart-item-icon",title:v,children:y}),e.jsxs("div",{className:"cart-item-info",children:[e.jsx("span",{className:"cart-item-title",children:x}),h&&e.jsx("span",{className:"cart-item-dur",children:h})]}),e.jsx("button",{className:"cart-item-remove",onClick:()=>s(p),"aria-label":`Remove ${i.title}`,children:"Ã—"})]},p)})}),e.jsx("button",{className:"cart-watch-btn",onClick:o,children:"â–¶ Watch Path"})]}):e.jsxs("div",{className:"cart-empty",children:[e.jsx("span",{className:"cart-empty-icon",children:"ðŸ“º"}),e.jsx("p",{children:"Add videos, docs, and resources to build your learning path"})]})]})}pt.propTypes={cart:f.arrayOf(f.shape({itemId:f.string,driveId:f.string,type:f.oneOf(["video","doc","youtube"]),title:f.string.isRequired,duration:f.number,readTimeMinutes:f.number,durationMinutes:f.number})).isRequired,onRemove:f.func.isRequired,onClear:f.func.isRequired,onWatchPath:f.func.isRequired};const gt="ue5_video_cart";function $s(){try{const t=localStorage.getItem(gt);return t?JSON.parse(t):[]}catch{return[]}}function be(t){try{localStorage.setItem(gt,JSON.stringify(t))}catch{}}function he(t){return t.itemId||t.driveId||t.id||`${t.type}_${t.url}`}function Ms(){const[t,s]=j.useState($s),n=j.useCallback(i=>{s(m=>{const p=he(i);if(m.some(x=>he(x)===p))return m;const v={...i,itemId:p,type:i.type||"video"},y=[...m,v];return be(y),y})},[]),o=j.useCallback(i=>{s(m=>{const p=m.filter(v=>he(v)!==i&&v.driveId!==i);return be(p),p})},[]),c=j.useCallback(()=>{s([]),be([])},[]),l=j.useCallback(i=>t.some(m=>he(m)===i||m.driveId===i),[t]),r=t.filter(i=>(i.type||"video")==="video").length,d=j.useMemo(()=>t.reduce((i,m)=>i+(m.duration||(m.readTimeMinutes||m.durationMinutes||0)*60),0),[t]),a=j.useMemo(()=>{const i={video:[],doc:[],youtube:[]};for(const m of t){const p=m.type||"video";(i[p]||i.video).push(m)}return i},[t]);return{cart:t,addToCart:n,removeFromCart:o,clearCart:c,isInCart:l,videoCount:r,totalDuration:d,itemsByType:a}}let Ne=null;async function Rs(){if(!Ne){const t=await ae(()=>import("./data-embeddings-EsTyY_EC.js"),[]);Ne=t.default||t}return Ne}function Pe(t,s){if(!t||!s||t.length!==s.length)return 0;let n=0,o=0,c=0;for(let r=0;r<t.length;r++)n+=t[r]*s[r],o+=t[r]*t[r],c+=s[r]*s[r];const l=Math.sqrt(o)*Math.sqrt(c);return l===0?0:n/l}async function qs(t,s=5,n=.3){const o=await Rs();if(!t||!o?.courses)return[];const c=[];for(const[l,r]of Object.entries(o.courses)){const d=Pe(t,r.embedding);d>=n&&c.push({code:l,title:r.title,similarity:d})}return c.sort((l,r)=>r.similarity-l.similarity),c.slice(0,s)}let _e=null,we=null;async function Ps(){if(!_e){const t=await ae(()=>import("./data-search-SjqZFhcO.js").then(s=>s.s),[]);_e=t.default||t}return _e}async function Ae(){if(!we){const t=await ae(()=>import("./data-search-SjqZFhcO.js").then(s=>s.a),[]);we=t.default||t}return we}let Ce=null,ie=null;function As(t,s=768){const n=atob(t),o=new Uint8Array(n.length);for(let r=0;r<n.length;r++)o[r]=n.charCodeAt(r);const c=new DataView(o.buffer),l=new Float32Array(s);for(let r=0;r<s;r++){const d=c.getUint16(r*2,!0);l[r]=Ds(d)}return l}function Ds(t){const s=t>>15&1,n=t>>10&31,o=t&1023;return n===0?(s?-1:1)*Math.pow(2,-14)*(o/1024):n===31?o?NaN:s?-1/0:1/0:(s?-1:1)*Math.pow(2,n-15)*(1+o/1024)}async function Os(){if(ie)return ie;if(!Ce)try{const s=await fetch(new URL("../data/segment_embeddings.json",import.meta.url));if(!s.ok)throw new Error(`HTTP ${s.status}`);Ce=await s.json()}catch(s){return ee("âš ï¸ segment_embeddings.json not available:",s.message),null}const t=Ce?.segments;if(!t)return null;ie=new Map;for(const[s,n]of Object.entries(t))ie.set(s,{vector:As(n.embedding),courseCode:n.course_code,videoKey:n.video_key,videoTitle:n.video_title,startTimestamp:n.start_timestamp,endTimestamp:n.end_timestamp,startSeconds:n.start_seconds,text:n.text,tokenEstimate:n.token_estimate});return W(`[SegmentSearch] Decoded ${ie.size} segment embeddings`),ie}async function zs(t,s=[]){if(!t||t.length<3)return[];const n=t.toLowerCase().split(/\s+/).filter(r=>r.length>2&&!ce.has(r));if(n.length===0)return[];const o=await Ps(),c=[],l=o?.course_words||{};for(const[r,d]of Object.entries(l)){let a=0;const i=[];for(const m of n)if(d[m]&&(a+=d[m]*10,i.push(m)),m.length>=4)for(const[p,v]of Object.entries(d))p!==m&&p.length>=4&&(p.startsWith(m)||m.startsWith(p))&&(a+=v*3,i.includes(p)||i.push(p));if(a>=30&&i.length>0){const m=s.find(v=>v.code===r),p=await Fs(r,i);c.push({courseCode:r,courseTitle:m?.title||r,score:a,matchedKeywords:i,topSegments:p,estimatedSegment:p.length>0?p[0]:null,videoCount:m?.video_count||0,duration:m?.duration_formatted||"Unknown"})}}return c.sort((r,d)=>d.score-r.score).slice(0,5)}async function Fs(t,s){const o=(await Ae())[t];if(!o||!o.videos)return[];const c=[];for(const[l,r]of Object.entries(o.videos))if(r.segments)for(const d of r.segments){const a=d.text.toLowerCase();let i=0;const m=[];for(const p of s){const v=p.toLowerCase(),y=new RegExp(v.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi"),x=a.match(y);x&&(i+=x.length*10,m.push(p)),a.includes(v)&&(i+=5,m.includes(p)||m.push(p))}if(i>0){let p=d.text;if(p.length>120){const v=m[0]||"",y=p.toLowerCase().indexOf(v.toLowerCase());y>40&&(p="..."+p.substring(y-30)),p.length>120&&(p=p.substring(0,117)+"...")}c.push({videoKey:l,videoTitle:r.title,timestamp:d.start,startSeconds:d.start_seconds,endTimestamp:d.end,previewText:p,matchedKeywords:m,score:i})}}return c.sort((l,r)=>r.score-l.score).slice(0,3)}async function Us(t,s=10,n=.35){if(!t)return[];const o=await Os();if(!o)return[];const c=[];for(const[l,r]of o){const d=Pe(t,r.vector);d>=n&&c.push({id:l,courseCode:r.courseCode,videoKey:r.videoKey,videoTitle:r.videoTitle,timestamp:r.startTimestamp,endTimestamp:r.endTimestamp,startSeconds:r.startSeconds,previewText:r.text,similarity:d,source:"transcript"})}return c.sort((l,r)=>r.similarity-l.similarity),c.slice(0,s)}const Gs=60,Vs=new Set(["rendering.lumen","rendering.nanite","rendering.virtualShadowMaps","rendering.substrate","worldbuilding.worldPartition"]);function Bs(t){const s=(t||"").toLowerCase();return/\bue\s*5\b|\bunreal\s*engine\s*5\b|\b5\.\d\b/.test(s)?5:/\bue\s*4\b|\bunreal\s*engine\s*4\b|\b4\.\d{1,2}\b/.test(s)?4:null}async function We(t,s,n=[],o="",c=[]){if(!s||s.length===0)return[];const l=t?.userQuery||"",r=l.toLowerCase();for(const g of Pt)if(g.patterns.some(w=>r.includes(w))){const w=g.courses.map($=>{const q=s.find(U=>U.code===$);return!q||!q.videos?.length||!q.videos[0]?.drive_id?null:{...q,_relevanceScore:200,_curatedMatch:!0,_curatedExplanation:g.explanation}}).filter(Boolean);if(w.length>0)return W("âœ… Curated solution match:",g.explanation),w}const d=`${l} ${o}`.trim(),a=re.matchErrorSignature(d),i=a.map(g=>g.tag.tag_id),m=[...new Set([...n,...i])];a.length>0&&W("ðŸ” Error signatures detected:",a.map(g=>`${g.tag.display_name} (${g.matchedSignature}, ${g.confidence})`));const p=re.extractTagsFromText(l),v=p.matchedTagIds||[];if(v.length>0){W("ðŸ·ï¸ Tag taxonomy matches:",p.matches.map(g=>`${g.tagId} (via "${g.matchedTerm}", ${g.matchType})`));for(const g of v)m.includes(g)||m.push(g)}const y=o.toLowerCase().split(/[\s\n:;,()[\]{}]+/).filter(g=>g.length>3&&!/^[0-9]+$/.test(g)).slice(0,10),x=l.toLowerCase().split(/\s+/).filter(g=>g.length>2&&!ce.has(g)),h=new Set(x),_=l.toLowerCase();for(const[g,C]of Object.entries(At))if(_.includes(g))for(const w of C)w.split(/\s+/).forEach($=>{$.length>2&&!ce.has($)&&h.add($)});const b=[...h],E=async g=>!g||g.length<5?[]:(await zs(g,s)).map(w=>{const $=s.find(q=>q.code===w.courseCode);return!$||!$.videos?.length||!$.videos[0]?.drive_id?null:{...$,_relevanceScore:w.score,_matchedKeywords:w.matchedKeywords}}).filter(Boolean),M=g=>g.length===0?[]:s.filter(w=>w.videos?.length&&w.videos[0]?.drive_id).map(w=>{const $=(w.title||"").toLowerCase(),q=(w.description||"").toLowerCase(),U=[...w.canonical_tags||[],...w.gemini_system_tags||[],...w.extracted_tags||[]].map(H=>typeof H=="string"?H.toLowerCase():"").join(" ");let O=0;const I=[];for(const H of g)$.includes(H)?(O+=50,I.push(H)):U.includes(H)?(O+=30,I.push(H)):q.includes(H)&&(O+=10,I.push(H));if(v.length>0){const H=(w.canonical_tags||[]).map(se=>se.toLowerCase());v.some(se=>H.some(Nt=>Nt.includes(se.split(".").pop())))&&(O*=3)}const Y=new Set(I).size;Y>=2&&(O*=1+Y*.3);const le=g.length>0?Y/g.length:1;return g.length>=2&&le<.5?O*=.3:le>=1&&(O*=2),O===0?null:{...w,_relevanceScore:O,_matchedKeywords:I}}).filter(Boolean).sort((w,$)=>$._relevanceScore-w._relevanceScore),P=g=>m.length===0?g:g.map(C=>{const $=(C.extracted_tags||C.tags||[]).map(q=>typeof q=="string"?q:q.tag_id||q.name||"").filter(Boolean).some(q=>m.some(U=>q.toLowerCase().includes(U.toLowerCase())||U.toLowerCase().includes(q.toLowerCase())));return{...C,_relevanceScore:$?C._relevanceScore*2:C._relevanceScore*.5}}).sort((C,w)=>w._relevanceScore-C._relevanceScore),z=y.length>0?`${l} ${y.join(" ")}`:l,A=await E(z),u=y.length>0?[...b,...y]:b,S=M(u),k=new Set,L=[];for(const g of A)k.has(g.code)||(L.push(g),k.add(g.code));for(const g of S)if(!k.has(g.code))L.push(g),k.add(g.code);else{const C=L.find(w=>w.code===g.code);C&&(C._relevanceScore+=g._relevanceScore)}const G=(L.length>0?L[0]._relevanceScore:0)>=Gs;if(c.length>0&&!G)for(const g of c)if(k.has(g.code)){const C=L.find(w=>w.code===g.code);C&&(C._relevanceScore+=g.similarity*40)}else{const C=s.find(w=>w.code===g.code);C&&C.videos?.length&&C.videos[0]?.drive_id&&(L.push({...C,_relevanceScore:g.similarity*100,_matchedKeywords:["semantic-match"],_semanticMatch:!0,_tier:2}),k.add(g.code))}else c.length>0;L.sort((g,C)=>C._relevanceScore-g._relevanceScore);const D=P(L);if(D.length>=3)return Se(D.slice(0,5),l);const V=[z,t?.diagnosis?.problem_summary,...t?.intent?.systems||[]].filter(Boolean).join(" "),X=V.toLowerCase().split(/\s+/).filter(g=>g.length>2&&!ce.has(g)),Q=await E(V),K=M(X);for(const g of[...Q,...K])k.has(g.code)||(L.push(g),k.add(g.code));L.sort((g,C)=>C._relevanceScore-g._relevanceScore);const J=P(L);if(J.length>=3)return Se(J.slice(0,5),l);const T=s.map(g=>{const C=re.scoreCourseRelevance(g,u);return{...g,_relevanceScore:C.score,_scoreBreakdown:C.breakdown,_topContributors:C.topContributors}}).filter(g=>g._relevanceScore>0&&g.videos?.length&&g.videos[0]?.drive_id).sort((g,C)=>C._relevanceScore-g._relevanceScore).slice(0,5);return Se(P(T),l)}function Se(t,s){const n=Bs(s);return n?t.map(o=>{const l=[...o.canonical_tags||[],...o.gemini_system_tags||[],...o.extracted_tags||[]].map(r=>typeof r=="string"?r.toLowerCase():"").some(r=>[...Vs].some(d=>r.includes(d.split(".").pop())));return n===4&&l?(W(`â¬‡ï¸ UE4 demotion: ${o.code} (has UE5-only tags)`),{...o,_relevanceScore:o._relevanceScore*.2}):n===5&&l?{...o,_relevanceScore:o._relevanceScore*1.5}:o}).sort((o,c)=>c._relevanceScore-o._relevanceScore):t}let ke=null;async function Ws(){if(!ke){const t=await ae(()=>import("./data-courses-Deba-lkK.js").then(s=>s.j),[]);ke=t.default||t}return ke}const Ys=new Set(["help","helpful","helps","use","used","using","make","made","get","getting","look","going","come","know","thing","work","working","want","need","show","start","take","right","well"]);async function Ye(t,s,n={}){const o=[],c=(s||"").toLowerCase().split(/\s+/).filter(x=>x.length>2),l=await Ws(),r=[],d=(s||"").toLowerCase();for(const[x,h]of Object.entries(l))d.includes(x)&&r.push({label:h.label,url:h.url});for(const x of t){const h=x.videos||[];if(h.length!==0)for(let _=0;_<h.length;_++){const b=h[_];if(!b.drive_id)continue;const E=b.title||b.name||`Video ${_+1}`,M=E.toLowerCase(),P=fe(E),z=c.filter(Q=>M.includes(Q)).length,A=z*50,u=await Qs(x.code,E,_),S=await Ks(x.code,u,c),k=M.includes("intro")||M.includes("wrap up")||M.includes("outro"),L=k?-20:0,R=A+S.score+L+(x._relevanceScore||0),G=Gt(b.drive_id,R);let D="â–¶ Watch full video";const Z=(S.topSegments||[])[0]||S.bestSegment||null;if(Z){const Q=Z.timestamp||"0:00",K=Z.previewText,J=K.length>60?K.substring(0,57)+"...":K;D=Z.startSeconds<5?`ðŸ“ Start of video â€” "${J}"`:`ðŸ“ Jump to ${Q} â€” "${J}"`}const V=n[x.code]||{},X=(()=>{const Q=(x._matchedKeywords||[]).filter(K=>K.length>3&&!Ys.has(K.toLowerCase())).slice(0,3);return Q.length>0?Q:[x.topic||x.tags?.topic||"UE5"].flat().slice(0,3)})();o.push({driveId:b.drive_id,title:P,duration:b.duration_seconds||0,courseCode:x.code,courseName:x.title||x.code,matchedTags:X,videoIndex:_,relevanceScore:G,titleRelevance:z,isIntro:k,timestampHint:S.bestSegment?.timestamp||null,startSeconds:S.bestSegment?.startSeconds||0,topSegments:S.topSegments||[],watchHint:D,docLinks:r,_curatedMatch:x._curatedMatch||!1,_curatedExplanation:x._curatedExplanation||null,role:V.role||null,reason:V.reason||null,estimatedMinutes:V.estimatedMinutes||null})}}const a=new Map;for(const x of o){const h=a.get(x.driveId);(!h||x.relevanceScore>h.relevanceScore)&&a.set(x.driveId,x)}const i=Array.from(a.values());i.sort((x,h)=>h.relevanceScore-x.relevanceScore);const m=new Map,p=1,v=i.filter(x=>{const h=m.get(x.courseCode)||0;return h>=p?!1:(m.set(x.courseCode,h+1),!0)});if(v.length>3){const x=v.map(E=>E.relevanceScore),h=x[Math.floor(x.length/2)],_=Math.max(h*.5,10),b=v.filter(E=>E.relevanceScore>=_);if(b.length>=3){const E=b.slice(0,6);return Qe(E,c),E}}const y=v.slice(0,6);return Qe(y,c),y}function Qe(t,s){if(t.length===0)return;const n=Math.max(t[0].relevanceScore,1);for(const o of t){o.matchPercent=Math.min(100,Math.round(o.relevanceScore/n*100));const c=[];if(o._curatedMatch&&c.push("Known solution for this problem"),o.titleRelevance>0){const l=s.filter(r=>(o.title||"").toLowerCase().includes(r)).slice(0,3);l.length>0&&c.push(`Title matches: ${l.join(", ")}`)}if(o.topSegments.length>0){const l=new Set;for(const d of o.topSegments)for(const a of d.matchedKeywords||[])l.add(a);const r=[...l].slice(0,4);r.length>0&&c.push(`Transcript mentions: ${r.join(", ")}`)}o.matchedTags.length>0&&c.length<2&&c.push(`Tagged: ${o.matchedTags.slice(0,3).join(", ")}`),o.matchReason=c.length>0?c.join(" Â· "):"Related to your query"}}async function Qs(t,s,n){const c=(await Ae())[t];if(!c?.videos)return null;const l=a=>(a||"").toLowerCase().replace(/\.mp4$/i,"").replace(/_/g," ").trim(),r=l(s),d=Object.keys(c.videos);for(const a of d){const i=l(c.videos[a].title||""),m=l(a);if(r.includes(i)||i.includes(r)||r.includes(m)||m.includes(r))return a}return n<d.length?d[n]:d[0]||null}async function Ks(t,s,n){const o={score:0,bestSegment:null,topSegments:[]},l=(await Ae())[t];if(!l?.videos||!s)return o;const r=l.videos[s];if(!r?.segments)return o;const d=[];for(const m of r.segments){const p=m.text.toLowerCase();let v=0;const y=[];for(const x of n)if(p.includes(x)){const h=p.split(x).length-1;v+=h*10,y.push(x)}if(v>0){let x=m.text;if(x.length>100){const h=x.toLowerCase().indexOf(y[0]||"");h>30&&(x="..."+x.substring(h-20)),x.length>100&&(x=x.substring(0,97)+"...")}d.push({timestamp:m.start,startSeconds:m.start_seconds,previewText:x,matchedKeywords:y,score:v})}}d.sort((m,p)=>p.score-m.score);const a=d.slice(0,3);return{score:d.reduce((m,p)=>m+p.score,0),bestSegment:a[0]||null,topSegments:a}}let Te=null,oe=null;function Hs(t,s=768){const n=atob(t),o=new Uint8Array(n.length);for(let r=0;r<n.length;r++)o[r]=n.charCodeAt(r);const c=new DataView(o.buffer),l=new Float32Array(s);for(let r=0;r<s;r++){const d=c.getUint16(r*2,!0);l[r]=Zs(d)}return l}function Zs(t){const s=t>>15&1,n=t>>10&31,o=t&1023;return n===0?(s?-1:1)*Math.pow(2,-14)*(o/1024):n===31?o?NaN:s?-1/0:1/0:(s?-1:1)*Math.pow(2,n-15)*(1+o/1024)}async function Js(){if(oe)return oe;if(!Te)try{const s=await fetch(new URL("../data/docs_embeddings.json",import.meta.url));if(!s.ok)throw new Error(`HTTP ${s.status}`);Te=await s.json()}catch(s){return ee("âš ï¸ docs_embeddings.json not available:",s.message),null}const t=Te?.docs;if(!t)return null;oe=new Map;for(const[s,n]of Object.entries(t))oe.set(s,{vector:Hs(n.embedding),slug:n.slug,url:n.url,title:n.title,section:n.section,text:n.text,tokenEstimate:n.token_estimate});return W(`[DocsSearch] Decoded ${oe.size} doc embeddings`),oe}async function Xs(t,s=5,n=.35){if(!t)return[];const o=await Js();if(!o)return[];const c=[];for(const[l,r]of o){const d=Pe(t,r.vector);d>=n&&c.push({id:l,slug:r.slug,url:r.url,title:r.title,section:r.section,previewText:r.text,similarity:d,source:"epic_docs"})}return c.sort((l,r)=>r.similarity-l.similarity),c.slice(0,s)}let me=null;async function ft(){if(me)return me;try{const t=await ae(()=>import("./data-courses-Deba-lkK.js").then(s=>s.j),[]);return me=t.default||t,me}catch(t){return ee("âš ï¸ doc_links.json not available:",t.message),{}}}const pe={beginner:0,intermediate:1,advanced:2};async function xt(t,{maxTier:s="advanced",limit:n=10}={}){const o=await ft();if(!o||!t?.length)return[];const c=pe[s]??2,l=t.map(a=>a.toLowerCase()),r=[];for(const[a,i]of Object.entries(o)){if((pe[i.tier]??1)>c)continue;let p=0;const v=a.toLowerCase(),y=(i.label||"").toLowerCase(),x=(i.url||"").split("/").pop().replace(/-/g," ").toLowerCase(),h=(i.tags||[]).map(b=>b.toLowerCase()),_=(i.description||"").toLowerCase();for(const b of l)v===b?p+=10:v.includes(b)?p+=5:b.includes(v)||i.subsystem===b||h.includes(b)?p+=4:y.includes(b)?p+=3:h.some(E=>E.includes(b)||b.includes(E))||x.includes(b)?p+=2:_.includes(b)&&(p+=1);p>0&&r.push({key:a,label:i.label,description:i.description||"",url:i.url,tier:i.tier,subsystem:i.subsystem,readTimeMinutes:i.readTimeMinutes||10,prerequisites:i.prerequisites||[],_score:p,source:"epic_docs"})}r.sort((a,i)=>i._score!==a._score?i._score-a._score:(pe[a.tier]??1)-(pe[i.tier]??1));const d=r.length>0?r[0]._score:1;return r.slice(0,n).map(({_score:a,...i})=>({...i,matchScore:Math.round(a/Math.max(d,1)*100)}))}async function en(t,{limit:s=8}={}){const n=await ft();if(!n)return[];const o=await xt(t,{limit:s*2});if(!o.length)return[];const c=new Map(o.map(a=>[a.key,a.matchScore??0])),l=new Set,r=[];function d(a){if(l.has(a))return;l.add(a);const i=n[a];if(i){for(const m of i.prerequisites||[])d(m);r.push({key:a,label:i.label,description:i.description||"",keySteps:i.keySteps||[],seeAlso:i.seeAlso||[],url:i.url,tier:i.tier,subsystem:i.subsystem,readTimeMinutes:i.readTimeMinutes||10,matchScore:c.get(a)??0,source:"epic_docs"})}}for(const a of o)d(a.key);return r.slice(0,s)}const Ke={prerequisite:0,core:1,troubleshooting:2,supplemental:3};function tn(t){return t.estimated_minutes?t.estimated_minutes:t.total_duration_seconds?Math.round(t.total_duration_seconds/60):(t.videos?.length||1)*10}function He(t,s){if(s.size===0)return 0;const n=new Set([...t.canonical_tags||[],...t.gemini_system_tags||[],...t.transcript_tags||[]].map(c=>typeof c=="string"?c.toLowerCase():""));if(n.size===0)return 0;let o=0;for(const c of n)(s.has(c)||s.has(c.split(".").pop()))&&o++;return o/n.size}function sn(t,s){const n=[...t.canonical_tags||[],...t.gemini_system_tags||[]].map(d=>typeof d=="string"?d.toLowerCase():""),o=new Set(s.map(d=>d.toLowerCase()));let c=!1;for(const d of n)if(o.has(d)||o.has(d.split(".").pop())){c=!0;break}const l=n.some(d=>{const a=re.getTag(d);return a?.tag_type==="symptom"||a?.tag_type==="error_code"});let r=!1;for(const d of n){const a=re.edgesBySource?.get(d)||[];for(const i of a)if(i.relation==="subtopic"&&o.has(i.target)){r=!0;break}if(r)break}return r?"prerequisite":l?"troubleshooting":c?"core":"supplemental"}function Ze(t,s,n={}){const{timeBudgetMinutes:o=1/0,maxItems:c=8,preferTroubleshooting:l=!1,diversity:r=!0}=n;if(!t||t.length===0)return{path:[],metadata:{totalMinutes:0,tagCoverage:0,diversityScore:1,itemCount:0}};const d=t.map(h=>({course:h,role:sn(h,s),estimatedMinutes:tn(h),score:h._relevanceScore||0}));d.sort((h,_)=>{const b=Ke[h.role]-Ke[_.role];return b!==0?b:_.score-h.score}),l&&d.sort((h,_)=>{const b=h.role==="troubleshooting"?0:1,E=_.role==="troubleshooting"?0:1;return b!==E?b-E:_.score-h.score});const a=[],i=new Set;let m=0;for(const h of d){if(a.length>=c)break;if(m+h.estimatedMinutes>o||r&&a.length>0&&He(h.course,i)>.7)continue;const _=nn(h,s);a.push({course:h.course,role:h.role,reason:_,estimatedMinutes:h.estimatedMinutes}),m+=h.estimatedMinutes,[...h.course.canonical_tags||[],...h.course.gemini_system_tags||[]].map(E=>typeof E=="string"?E.toLowerCase():"").forEach(E=>{i.add(E),i.add(E.split(".").pop())})}const p=new Set(s.map(h=>h.toLowerCase()));let v=0;for(const h of p)(i.has(h)||i.has(h.split(".").pop()))&&v++;const y=p.size>0?v/p.size:0;let x=1;if(a.length>1){let h=0;const _=new Set;for(const b of a)h+=He(b.course,_),[...b.course.canonical_tags||[]].map(M=>M?.toLowerCase?.()||"").forEach(M=>_.add(M));x=1-h/a.length}return{path:a,metadata:{totalMinutes:m,tagCoverage:Math.round(y*100)/100,diversityScore:Math.round(x*100)/100,itemCount:a.length}}}function nn(t,s){const{course:n,role:o}=t,c=[...n.canonical_tags||[],...n.gemini_system_tags||[]].map(d=>typeof d=="string"?d.toLowerCase():""),l=new Set(s.map(d=>d.toLowerCase())),r=c.filter(d=>l.has(d)||l.has(d.split(".").pop()));switch(o){case"prerequisite":return`Foundation course â€” covers prerequisite concepts for ${r.slice(0,2).join(", ")}`;case"core":return`Directly covers: ${r.slice(0,3).join(", ")}`;case"troubleshooting":return"Troubleshooting guide â€” addresses symptoms related to your query";case"supplemental":return"Related content â€” expands on topics connected to your query";default:return"Relevant to your search"}}let ne=null;async function yt(){if(ne!=null)return ne;try{const t=await ae(()=>import("./data-courses-Deba-lkK.js").then(s=>s.y),[]);return ne=t.default||t,ne}catch{return ne={channels:{},resources:[]},ne}}const ge={beginner:0,intermediate:1,advanced:2};async function vt(t,{maxTier:s="advanced",limit:n=5}={}){if(!t?.length)return[];const o=await yt();if(!o?.resources?.length)return[];const c=ge[s]??2,l=new Set(t.map(a=>a.toLowerCase())),r=[];for(const a of o.resources){if((ge[a.tier]??1)>c)continue;const m=(a.topics||[]).map(y=>y.toLowerCase()),p=(a.tag_ids||[]).map(y=>y.toLowerCase());let v=0;for(const y of m){l.has(y)&&(v+=5);for(const x of l)(y.includes(x)||x.includes(y))&&(v+=2)}for(const y of p){l.has(y)&&(v+=5);const x=y.split(".");for(const h of x)l.has(h)&&(v+=3)}if(v>0){const y=o.channels?.[a.channelKey];r.push({id:a.id,title:a.title,url:a.url,channelName:y?.name||"Unreal Engine",channelTrust:"official",tier:a.tier,durationMinutes:a.durationMinutes,topics:a.topics,tag_ids:a.tag_ids||[],description:a.description||"",keyTakeaways:a.keyTakeaways||[],chapters:a.chapters||[],source:"epic_youtube",_score:v})}}const d=/\b(ue\s*5|unreal\s*engine\s*5|5\.\d)/i;for(const a of r)a._isUE5=d.test(a.title)||(a.topics||[]).some(i=>d.test(i));return r.sort((a,i)=>a._isUE5!==i._isUE5?a._isUE5?-1:1:i._score!==a._score?i._score-a._score:(ge[a.tier]??1)-(ge[i.tier]??1)),r.slice(0,n).map(({_score:a,_isUE5:i,...m})=>m)}async function rn(t,{limit:s=5}={}){if(!t?.length)return[];const n=await yt();if(!n?.resources?.length)return[];const o=new Set(t.map(l=>l.toLowerCase())),c=[];for(const l of n.resources){const r=(l.tag_ids||[]).map(a=>a.toLowerCase());let d=0;for(const a of r)o.has(a)&&(d+=5);if(d>0){const a=n.channels?.[l.channelKey];c.push({id:l.id,title:l.title,url:l.url,channelName:a?.name||"Unreal Engine",channelTrust:"official",tier:l.tier,durationMinutes:l.durationMinutes,topics:l.topics,tag_ids:l.tag_ids||[],description:l.description||"",keyTakeaways:l.keyTakeaways||[],chapters:l.chapters||[],source:"epic_youtube",_score:d})}}return c.sort((l,r)=>r._score-l._score),c.slice(0,s).map(({_score:l,...r})=>r)}async function an(t,s=[]){if(!t?.length)return{topics:[],firstPartyVideos:0,docsArticles:0,youtubeResources:0,coverageScore:0,gaps:[]};const n=await xt(t,{limit:10}),o=await vt(t,{limit:10}),c={};for(const a of t){const i=a.toLowerCase(),m=s.filter(x=>{const h=(x.tags||[]).map(b=>b.toLowerCase()),_=(x.title||"").toLowerCase();return h.some(b=>b.includes(i))||_.includes(i)}).length,p=n.filter(x=>x.key?.toLowerCase().includes(i)||x.subsystem?.toLowerCase()===i||x.label?.toLowerCase().includes(i)).length,v=o.filter(x=>{const h=(x.topics||[]).some(b=>b.toLowerCase().includes(i)),_=(x.tag_ids||[]).some(b=>b.toLowerCase().includes(i));return h||_}).length,y=m+p+v;c[a]={firstPartyVideos:m,docsArticles:p,youtubeResources:v,total:y,covered:y>0}}const l=Object.values(c).filter(a=>a.covered).length,r=t.length>0?l/t.length:0,d=Object.entries(c).filter(([,a])=>!a.covered).map(([a])=>a);return{topics:t,topicCoverage:c,firstPartyVideos:s.length,docsArticles:n.length,youtubeResources:o.length,coverageScore:r,gaps:d}}async function on(t,s=[],{maxDocs:n=5,maxYoutube:o=3}={}){if(!t?.length)return{docs:[],youtube:[],totalTimeMinutes:0,coverageScore:0};const c=await en(t,{limit:n}),l=await vt(t,{limit:o}),r=await rn(t,{limit:o}),d=new Set(l.map(y=>y.id)),a=[...l];for(const y of r)d.has(y.id)||(a.push(y),d.add(y.id));const i=s.reduce((y,x)=>y+(x.durationMinutes||10),0),m=c.reduce((y,x)=>y+(x.readTimeMinutes||10),0),p=a.reduce((y,x)=>y+(x.durationMinutes||15),0),v=await an(t,s);return{docs:c,youtube:a,totalTimeMinutes:i+m+p,coverageScore:v.coverageScore,gaps:v.gaps,externalEnabled:!0}}const De={QUERY_SUBMITTED:"query_submitted",DIAGNOSIS_GENERATED:"diagnosis_generated",LEARNING_PATH_GENERATED:"learning_path_generated"};let Ie=null;function cn(){return Ie||(Ie=`session_${Date.now()}_${Math.random().toString(36).substring(2,9)}`),Ie}async function Oe(t,s={}){try{const n=Xe(),o={event:t,session_id:cn(),...s,timestamp:Ct(),client_timestamp:new Date().toISOString()};await St(kt(n,"analytics_events"),o)}catch(n){ee("[Analytics] Failed to track event:",t,n.message)}}function ln(t,s=[],n=null){return Oe(De.QUERY_SUBMITTED,{query_length:t?.length||0,query_preview:t?.substring(0,100),detected_tag_count:s.length,detected_tags:s.slice(0,5),persona_id:n})}function dn(t){return Oe(De.DIAGNOSIS_GENERATED,{diagnosis_id:t?.diagnosis_id,root_causes_count:t?.root_causes?.length||0,signals_count:t?.signals_to_watch_for?.length||0,generalization_scope:t?.generalization_scope?.slice(0,3)})}function un(t,s,n=!0){return Oe(De.LEARNING_PATH_GENERATED,{fix_specific_count:t?.fix_specific?.length||0,transferable_count:t?.transferable?.length||0,course_count:s?.length||0,passed_validation:n})}const B={INPUT:"input",LOADING:"loading",DIAGNOSIS:"diagnosis",GUIDED:"guided",ERROR:"error"};function wn(){const[t,s]=j.useState(B.INPUT),[n,o]=j.useState(null),[c,l]=j.useState(null),[r,d]=j.useState(null),[a,i]=j.useState([]),{cart:m,addToCart:p,removeFromCart:v,clearCart:y,isInCart:x}=Ms(),h=Je(),_=j.useMemo(()=>h?.courses||[],[h?.courses]),b=j.useCallback(()=>{try{const u=localStorage.getItem("detected_persona");return u?JSON.parse(u):null}catch{return null}},[]),E=j.useCallback(async u=>{y(),s(B.LOADING),l(null),u.pastedImage&&W("[ProblemFirst] Screenshot attached (base64 length):",u.pastedImage.length),u.errorLog&&W("[ProblemFirst] Error log attached:",u.errorLog.slice(0,200));try{if(u.cachedCartId){W(`[Cache] Checking Firestore for cart: ${u.cachedCartId}`);try{const N=ze(),T=Xe(N),g=Tt(T,"adaptive_carts",u.cachedCartId),C=await It(g);if(C.exists()){const w=C.data(),$=w.cached_at?.toDate?.()||new Date(w.created_at||0),q=Date.now()-$.getTime(),U=1440*60*1e3;if(q<U){W(`[Cache Hit] Cart is ${Math.round(q/6e4)}min old â€” using cached result`);const O={...w,userQuery:u.query,retrievedPassages:[]},I=await We(O,_,u.selectedTagIds||[],u.errorLog||"",[]);O.matchedCourses=I;const Y=[...O.diagnosis?.matched_tag_ids||[],...u.detectedTagIds||[],...u.selectedTagIds||[]],le=Ze(I,Y,{preferTroubleshooting:!0,diversity:!0}),H={};for(const se of le.path)H[se.course.code]={role:se.role,reason:se.reason,estimatedMinutes:se.estimatedMinutes};const de=await Ye(I,u.query,H);if(de.length>0){i(de),o(O),s(B.DIAGNOSIS),W(`[Cache] Loaded ${de.length} videos from cached cart â€” 0 Gemini calls`);return}ee("[Cache] Cached cart produced 0 videos â€” falling through to fresh diagnosis")}else W(`[Cache Expired] Cart is ${Math.round(q/36e5)}h old â€” refreshing`)}else W(`[Cache Miss] Cart ${u.cachedCartId} not found in Firestore`)}catch(N){ee("[Cache Error] Falling through to fresh diagnosis:",N.message)}}await ln(u.query,u.detectedTagIds,b()?.id);const S=ze(),k=Et(S,"us-central1");let L=null,R=[],G=[];try{const T=await Fe(k,"embedQuery")({query:u.query});if(T.data?.success&&T.data?.embedding){L=T.data.embedding,R=await qs(L,8,.35);try{const C=(await Us(L,6,.35)).map($=>({text:$.previewText,courseCode:$.courseCode,videoTitle:$.videoTitle,timestamp:$.timestamp,similarity:$.similarity,source:"transcript"}));let w=[];try{w=(await Xs(L,6,.35)).map(q=>({text:q.previewText,url:q.url,title:q.title,section:q.section,similarity:q.similarity,source:"epic_docs"}))}catch($){ee("âš ï¸ Docs semantic search skipped:",$.message)}G=[...C,...w],W(`[RAG] Retrieved ${C.length} transcript + ${w.length} doc passages`)}catch(g){ee("âš ï¸ Segment semantic search skipped:",g.message)}}}catch(N){ee("âš ï¸ Semantic search skipped:",N.message)}let D,Z=!0;try{const T=await Fe(k,"queryLearningPath")({query:u.query,mode:"problem-first",detectedTagIds:u.detectedTagIds,personaHint:u.personaHint,retrievedContext:G.slice(0,5)});if(!T.data.success)throw new Error(T.data.message||"Failed to process query");D=T.data.cart}catch(N){const T=N.message?.includes("429")||N.code==="resource-exhausted";ee(`âš ï¸ Gemini ${T?"rate limited (429)":"error"}: ${N.message}. Falling back to local matching.`),Z=!1,D={diagnosis:{problem_summary:u.query,matched_tag_ids:u.detectedTagIds||[]},objectives:[],intent:{systems:[]}}}D.userQuery=u.query,D.retrievedPassages=G,D._localFallback=!Z;const V=await We(D,_,u.selectedTagIds||[],u.errorLog||"",R);D.matchedCourses=V;const X=[...D.diagnosis?.matched_tag_ids||[],...u.detectedTagIds||[],...u.selectedTagIds||[]],Q=Ze(V,X,{preferTroubleshooting:!0,diversity:!0}),K={};for(const N of Q.path)K[N.course.code]={role:N.role,reason:N.reason,estimatedMinutes:N.estimatedMinutes};const J=await Ye(V,u.query,K);if(J.length===0){l(`We couldn't find UE5 content matching your query. Try describing a specific Unreal Engine problem, for example:
â€¢ "Blueprint compile error LNK2019"
â€¢ "Lumen reflections flickering in indoor scene"
â€¢ "Niagara particle system not spawning"
â€¢ "UMG widget not rendering"`),s(B.ERROR);return}i(J),o(D);try{const T=[...D.diagnosis?.matched_tag_ids||[],...u.detectedTagIds||[]].flatMap(w=>w.split(/[._]/).filter($=>$.length>2&&$!=="unreal"&&$!=="engine")),g=(u.query||"").toLowerCase().split(/\s+/).filter(w=>w.length>3),C=[...new Set([...T,...g])].slice(0,12);if(C.length>0){const w=await on(C,J,{maxDocs:5,maxYoutube:3});d(w),W(`[Blended] ${w.docs.length} docs, ${w.youtube.length} YT, coverage: ${(w.coverageScore*100).toFixed(0)}%`)}}catch(N){ee("âš ï¸ Blended path skipped:",N.message)}s(B.DIAGNOSIS),u.updateCartIdForQuery&&D.cart_id&&(u.updateCartIdForQuery(u.query,D.cart_id),W(`[Cache] Saved cart_id ${D.cart_id} to history for: "${u.query.substring(0,40)}..."`)),await dn(D.diagnosis),await un(D.objectives,V,D.validation?.approved)}catch(S){console.error("[ProblemFirst] Error:",S),l(S.message||"An unexpected error occurred"),s(B.ERROR)}},[_,b,y]),M=j.useCallback(()=>s(B.INPUT),[]),P=j.useCallback(()=>{s(B.INPUT),o(null),i([]),l(null),d(null)},[]),z=j.useCallback(u=>{x(u.driveId)?v(u.driveId):p(u)},[x,p,v]),A=j.useCallback(()=>{m.length>0&&s(B.GUIDED)},[m]);return e.jsxs("div",{className:"problem-first-page",children:[e.jsxs("header",{className:"page-header",children:[e.jsx("h1",{children:"ðŸ”§ Fix a Problem"}),e.jsx("p",{children:"Describe your issue. We'll find the right videos to help you solve it."})]}),(t===B.INPUT||t===B.LOADING)&&e.jsx(Re,{onSubmit:E,detectedPersona:b(),isLoading:t===B.LOADING}),t===B.ERROR&&e.jsxs("div",{className:"error-state",children:[e.jsx("div",{className:"error-icon",children:"âš ï¸"}),e.jsx("h3",{children:"Something went wrong"}),e.jsx("p",{children:c}),e.jsx("button",{className:"retry-btn",onClick:P,children:"Try Again"})]}),t===B.DIAGNOSIS&&n&&e.jsxs("div",{className:"shopping-layout",children:[e.jsxs("div",{className:"results-column",children:[e.jsxs("div",{className:"tldr-diagnosis",children:[e.jsxs("div",{className:"tldr-user-query",children:[e.jsx("span",{className:"tldr-query-label",children:"ðŸ” You asked:"}),e.jsx("p",{className:"tldr-query-text",children:n.userQuery})]}),n._localFallback&&e.jsxs("div",{className:"tldr-fallback-notice",style:{background:"rgba(255, 193, 7, 0.1)",border:"1px solid rgba(255, 193, 7, 0.3)",borderRadius:"8px",padding:"8px 14px",margin:"8px 0",fontSize:"0.85rem",color:"var(--text-muted, #aaa)"},children:["âš¡ ",e.jsx("strong",{children:"Fast results"})," â€” AI diagnosis unavailable (rate limit). Videos matched by tag taxonomy."]}),n.diagnosis?.problem_summary&&e.jsx("p",{className:"tldr-bridge",children:"Based on your question, we think these videos will help you:"})]}),e.jsxs("h2",{className:"results-title",children:["ðŸŽ¬ Videos for You (",a.length,")"]}),a.length===0&&e.jsx("div",{className:"no-results",children:e.jsx("p",{children:"No matching videos found. Try rephrasing your question."})}),(()=>{const u=[{key:"prerequisite",icon:"ðŸ”—",label:"Prerequisite",desc:"Build the foundation first â€” these cover concepts you'll need before tackling the main topic."},{key:"core",icon:"â­",label:"Core",desc:"These directly address your question and are the most important videos to watch."},{key:"troubleshooting",icon:"ðŸ”§",label:"Troubleshooting",desc:"Debugging helpers â€” watch these if you're hitting errors or unexpected behavior."},{key:"supplemental",icon:"ðŸ“š",label:"Supplemental",desc:"Go deeper â€” extra context and advanced techniques for when you're ready."}],S={};for(const k of u)S[k.key]=[];S._other=[];for(const k of a){const L=k.role||"_other";(S[L]||S._other).push(k)}return u.filter(k=>S[k.key].length>0).map(k=>e.jsxs("div",{className:"role-section",children:[e.jsxs("div",{className:"role-section-header",children:[e.jsxs("h3",{className:"role-section-title",children:[k.icon," ",k.label,e.jsx("span",{className:"role-section-count",children:S[k.key].length})]}),e.jsx("p",{className:"role-section-desc",children:k.desc})]}),e.jsx("div",{className:"video-results-grid",children:S[k.key].map(L=>e.jsx("div",{className:"video-result-wrapper",id:`video-${L.driveId}`,children:e.jsx(Me,{video:L,isAdded:x(L.driveId),onToggle:z,userQuery:n?.userQuery||""})},L.driveId))})]},k.key)).concat(S._other.length>0?[e.jsxs("div",{className:"role-section",children:[e.jsxs("div",{className:"role-section-header",children:[e.jsxs("h3",{className:"role-section-title",children:["ðŸ“Ž Related ",e.jsx("span",{className:"role-section-count",children:S._other.length})]}),e.jsx("p",{className:"role-section-desc",children:"Additional videos that may be relevant to your query."})]}),e.jsx("div",{className:"video-results-grid",children:S._other.map(k=>e.jsx("div",{className:"video-result-wrapper",id:`video-${k.driveId}`,children:e.jsx(Me,{video:k,isAdded:x(k.driveId),onToggle:z,userQuery:n?.userQuery||""})},k.driveId))})]},"_other")]:[])})(),r?.docs?.length>0&&e.jsxs("div",{className:"blended-section",children:[e.jsxs("div",{className:"blended-section-header",children:[e.jsx("h2",{className:"blended-section-title",children:"ðŸ“š Recommended Reading"}),e.jsxs("p",{className:"blended-section-desc",children:["Official Unreal Engine documentation to deepen your understanding.",r.docs.reduce((u,S)=>u+(S.readTimeMinutes||10),0)>0&&` (~${r.docs.reduce((u,S)=>u+(S.readTimeMinutes||10),0)} min total read time)`]})]}),e.jsx("div",{className:"doc-cards-grid",children:r.docs.map((u,S)=>{const k=`doc_${u.key||S}`,L=x(k);return e.jsxs("div",{className:`doc-card ${L?"doc-card-added":""}`,children:[e.jsxs("a",{href:u.url,target:"_blank",rel:"noopener noreferrer",className:"doc-card-link",onClick:R=>R.stopPropagation(),children:[e.jsxs("div",{className:"doc-card-header",children:[u.matchScore!=null&&(()=>{const R=u.matchScore>=90?"best":u.matchScore>=60?"strong":u.matchScore>=30?"good":"related",G=u.matchScore>=90?"Best Match":u.matchScore>=60?"Strong":u.matchScore>=30?"Good":"Related";return e.jsxs("span",{className:`doc-match-badge doc-match-${R}`,title:`${u.matchScore}% relevancy`,children:[e.jsx("span",{className:"doc-match-dot"}),G]})})(),e.jsx("span",{className:`tier-badge tier-${u.tier||"intermediate"}`,children:u.tier||"intermediate"}),u.subsystem&&e.jsx("span",{className:"subsystem-tag",children:u.subsystem})]}),e.jsx("h4",{className:"doc-card-title",children:u.label}),u.description&&e.jsx("p",{className:"doc-card-desc",children:u.description}),e.jsxs("div",{className:"doc-card-footer",children:[e.jsx("span",{className:"doc-source-badge",children:"ðŸ“„ Epic Docs"}),e.jsxs("span",{className:"doc-read-time",children:[u.readTimeMinutes||10," min read"]})]})]}),e.jsx("button",{className:`doc-add-btn ${L?"doc-added":""}`,onClick:()=>{L?v(k):p({type:"doc",itemId:k,title:u.label,description:u.description||"",keySteps:u.keySteps||[],seeAlso:u.seeAlso||[],url:u.url,tier:u.tier||"intermediate",subsystem:u.subsystem,readTimeMinutes:u.readTimeMinutes||10})},title:L?"Remove from path":"Add to learning path",children:L?"âœ“ Added":"âž• Add"})]},u.key||S)})})]}),r?.youtube?.length>0&&e.jsxs("div",{className:"blended-section",children:[e.jsxs("div",{className:"blended-section-header",children:[e.jsx("h2",{className:"blended-section-title",children:"ðŸ“º Official Epic YouTube"}),e.jsx("p",{className:"blended-section-desc",children:"Official Unreal Engine tutorials from Epic Games."})]}),e.jsx("div",{className:"doc-cards-grid",children:r.youtube.map(u=>{const S=u.id||`yt_${u.url}`,k=x(S);return e.jsxs("div",{className:`doc-card ${k?"doc-card-added":""}`,children:[e.jsxs("a",{href:u.url,target:"_blank",rel:"noopener noreferrer",className:"doc-card-link",onClick:L=>L.stopPropagation(),children:[e.jsxs("div",{className:"doc-card-header",children:[e.jsx("span",{className:`tier-badge tier-${u.tier||"intermediate"}`,children:u.tier||"intermediate"}),e.jsx("span",{className:"external-badge",children:"Official â€¢ YouTube"})]}),e.jsx("h4",{className:"doc-card-title",children:u.title}),e.jsxs("div",{className:"doc-card-footer",children:[e.jsxs("span",{className:"doc-source-badge",children:["ðŸ“º ",u.channelName]}),e.jsxs("span",{className:"doc-read-time",children:[u.durationMinutes," min"]})]})]}),e.jsx("button",{className:`doc-add-btn ${k?"doc-added":""}`,onClick:()=>{k?v(S):p({type:"youtube",itemId:S,title:u.title,description:u.description||"",keyTakeaways:u.keyTakeaways||[],chapters:u.chapters||[],topics:u.topics||[],url:u.url,channelName:u.channelName,channelTrust:u.channelTrust,tier:u.tier||"intermediate",durationMinutes:u.durationMinutes||15})},title:k?"Remove from path":"Add to learning path",children:k?"âœ“ Added":"âž• Add"})]},u.id)})})]}),e.jsxs("div",{className:"results-actions-bottom",children:[e.jsx("button",{className:"back-btn",onClick:P,children:"â† Start Over"}),e.jsx("button",{className:"ask-again-btn",onClick:M,children:"+ Ask Another Question"})]})]}),e.jsx("div",{className:"cart-column",children:e.jsx(pt,{cart:m,onRemove:v,onClear:y,onWatchPath:A})})]}),t===B.GUIDED&&e.jsx(qe,{courses:m.map(u=>{const S=u.type||"video";if(S==="doc"||S==="youtube")return{code:u.itemId||`${S}_${u.url}`,title:u.title,_readingStep:!0,_resourceType:S,_description:u.description||"",_keySteps:u.keyTakeaways||u.keySteps||[],_seeAlso:u.seeAlso||[],_url:u.url,_tier:u.tier,_channel:u.channel||u.channelName,_channelTrust:u.channelTrust,_subsystem:u.subsystem,_topics:u.topics||[],_chapters:u.chapters||[],_readTimeMinutes:u.readTimeMinutes||u.durationMinutes||10,videos:[]};const k=_.find(L=>L.code===u.courseCode);return k?{...k,videos:[{drive_id:u.driveId,title:u.title,duration_seconds:u.duration}]}:{code:u.courseCode,title:u.courseName,videos:[{drive_id:u.driveId,title:u.title,duration_seconds:u.duration}]}}),diagnosis:n?.diagnosis,problemSummary:n?.diagnosis?.problem_summary,pathSummary:n?.pathSummary,microLesson:n?.microLesson,onComplete:()=>{},onExit:()=>s(B.DIAGNOSIS)})]})}function jt({diagnosis:t}){if(!t)return null;const s=t.root_causes?.length||0,n=t.signals_to_watch_for?.length||0,o=t.variables_that_matter?.length||0,c=t.variables_that_do_not?.length||0;return e.jsxs("div",{className:"diagnosis-card",children:[e.jsxs("div",{className:"diagnosis-header",children:[e.jsx("h3",{children:"ðŸ”¬ Diagnosis"}),e.jsxs("span",{className:"diagnosis-id",children:["ID: ",t.diagnosis_id?.slice(-8)||"N/A"]})]}),e.jsx("p",{className:"problem-summary",children:t.problem_summary}),e.jsxs("div",{className:"diagnosis-sections",children:[e.jsxs("details",{className:"diagnosis-section root-causes",children:[e.jsxs("summary",{children:[e.jsx("span",{className:"icon",children:"ðŸŽ¯"}),"Root Causes",e.jsxs("span",{className:"count",children:["(",s,")"]})]}),e.jsx("ul",{children:(t.root_causes||[]).map((l,r)=>e.jsx("li",{children:l},r))})]}),e.jsxs("details",{className:"diagnosis-section signals",children:[e.jsxs("summary",{children:[e.jsx("span",{className:"icon",children:"ðŸ‘ï¸"}),"Signals to Watch For",e.jsxs("span",{className:"count",children:["(",n,")"]})]}),e.jsx("ul",{children:(t.signals_to_watch_for||[]).map((l,r)=>e.jsx("li",{children:l},r))})]}),e.jsxs("details",{className:"diagnosis-section variables-matter",children:[e.jsxs("summary",{children:[e.jsx("span",{className:"icon",children:"âœ…"}),"Variables That Matter",e.jsxs("span",{className:"count",children:["(",o,")"]})]}),e.jsx("ul",{children:(t.variables_that_matter||[]).map((l,r)=>e.jsx("li",{children:l},r))})]}),e.jsxs("details",{className:"diagnosis-section variables-dont-matter",children:[e.jsxs("summary",{children:[e.jsx("span",{className:"icon",children:"âŒ"}),"Variables That Don't",e.jsxs("span",{className:"count",children:["(",c,")"]})]}),e.jsx("ul",{children:(t.variables_that_do_not||[]).map((l,r)=>e.jsx("li",{children:l},r))})]}),t.generalization_scope?.length>0&&e.jsxs("details",{className:"diagnosis-section generalization",open:!0,children:[e.jsxs("summary",{children:[e.jsx("span",{className:"icon",children:"ðŸ”„"}),"Where Else This Applies",e.jsxs("span",{className:"count",children:["(",t.generalization_scope.length,")"]})]}),e.jsx("div",{className:"scope-chips",children:t.generalization_scope.map((l,r)=>e.jsx("span",{className:"scope-chip",children:l},r))})]})]})]})}jt.propTypes={diagnosis:f.shape({diagnosis_id:f.string,problem_summary:f.string,root_causes:f.arrayOf(f.string),signals_to_watch_for:f.arrayOf(f.string),variables_that_matter:f.arrayOf(f.string),variables_that_do_not:f.arrayOf(f.string),generalization_scope:f.arrayOf(f.string)})};jt.defaultProps={diagnosis:null};function bt({objectives:t,courses:s,validation:n,onCourseClick:o,onAddToCart:c,isCourseInCart:l}){const{fixCourses:r,learnCourses:d}=j.useMemo(()=>{if(!s||s.length===0)return{fixCourses:[],learnCourses:[]};const i=Math.ceil(s.length/2);return{fixCourses:s.slice(0,i),learnCourses:s.slice(i)}},[s]),a=j.useMemo(()=>n?{approved:n.approved,reason:n.reason,hasIssues:n.issues?.length>0}:null,[n]);return e.jsxs("div",{className:"adaptive-cart",children:[a&&!a.approved&&e.jsxs("div",{className:"validation-warning",children:[e.jsx("span",{className:"icon",children:"âš ï¸"}),e.jsxs("div",{className:"content",children:[e.jsx("strong",{children:"Quality Check:"})," ",a.reason,n.suggestions?.length>0&&e.jsx("ul",{className:"suggestions",children:n.suggestions.map((i,m)=>e.jsx("li",{children:i},m))})]})]}),e.jsxs("section",{className:"cart-section fix-now",children:[e.jsxs("div",{className:"section-header",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"icon",children:"ðŸ”§"}),"Fix Now"]}),e.jsx("p",{className:"description",children:"These solve your immediate problem:"})]}),e.jsx("div",{className:"objectives-list",children:(t?.fix_specific||[]).map((i,m)=>e.jsxs("div",{className:"objective-item fix",children:[e.jsx("span",{className:"number",children:m+1}),e.jsx("span",{className:"text",children:i})]},m))}),r.length>0&&e.jsx("div",{className:"course-list",children:r.map(i=>e.jsx(xe,{course:i,type:"fix",onClick:()=>o?.(i),onAddToCart:c,isInCart:l?.(i)},i.id||i.code))})]}),e.jsxs("section",{className:"cart-section learn-forever",children:[e.jsxs("div",{className:"section-header",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"icon",children:"ðŸŽ“"}),"Learn Forever"]}),e.jsx("p",{className:"description",children:"These help you diagnose similar issues in the future:"})]}),e.jsx("div",{className:"objectives-list transferable",children:(t?.transferable||[]).map((i,m)=>e.jsxs("div",{className:"objective-item transferable",children:[e.jsx("span",{className:"number",children:m+1}),e.jsx("span",{className:"text",children:i}),e.jsx("span",{className:"badge",children:"Transferable"})]},m))}),t?.transferable?.length===0&&e.jsx("div",{className:"empty-warning",children:"âš ï¸ No transferable objectives generated. This path may not teach reusable skills."}),d.length>0&&e.jsx("div",{className:"course-list",children:d.map(i=>e.jsx(xe,{course:i,type:"learn",onClick:()=>o?.(i),onAddToCart:c,isInCart:l?.(i)},i.id||i.code))})]}),e.jsxs("div",{className:"cart-summary",children:[e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"value",children:t?.fix_specific?.length||0}),e.jsx("span",{className:"label",children:"Fix Objectives"})]}),e.jsxs("div",{className:"stat highlight",children:[e.jsx("span",{className:"value",children:t?.transferable?.length||0}),e.jsx("span",{className:"label",children:"Transferable Skills"})]}),e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"value",children:s?.length||0}),e.jsx("span",{className:"label",children:"Recommended Courses"})]})]})]})}function xe({course:t,type:s,onClick:n,onAddToCart:o,isInCart:c}){const[l,r]=j.useState(!1),d=j.useMemo(()=>{if(t.duration)return t.duration;if(t.duration_minutes)return`${t.duration_minutes} min`;if(t.durationMinutes)return`${t.durationMinutes} min`;if(t.videos?.length){const v=t.videos.reduce((y,x)=>y+(x.duration_seconds||0),0);return v>0?Ns(v):null}return null},[t]),a=j.useMemo(()=>typeof t.difficulty=="string"?t.difficulty:typeof t.difficulty=="number"?["Beginner","Beginner","Intermediate","Intermediate","Advanced","Expert"][t.difficulty]||"Intermediate":t.gemini_skill_level?t.gemini_skill_level:null,[t]),i=j.useMemo(()=>_s(t),[t]),m=t.video_count||t.videos?.length||null,p=v=>{v.stopPropagation(),o?.(t)};return e.jsxs("div",{className:`course-card ${s} ${c?"in-cart":""}`,onClick:n,role:"button",tabIndex:0,onKeyDown:v=>v.key==="Enter"&&n?.(),children:[i&&!l&&e.jsx("div",{className:"course-thumbnail",children:e.jsx("img",{src:i,alt:t.title,loading:"lazy",onError:()=>r(!0)})}),e.jsxs("div",{className:"course-info",children:[e.jsx("h4",{className:"title",children:t.title||t.name}),t.gemini_outcomes?.[0]&&e.jsxs("p",{className:"description",children:[t.gemini_outcomes[0].slice(0,100),"..."]}),e.jsxs("div",{className:"meta",children:[d&&e.jsxs("span",{className:"duration",children:["â±ï¸ ",d]}),m&&e.jsxs("span",{className:"video-count",children:["ðŸŽ¬ ",m," videos"]}),a&&e.jsx("span",{className:`difficulty ${a.toLowerCase()}`,children:a})]})]}),e.jsx("div",{className:"course-action",children:o?e.jsx("button",{className:`add-btn ${c?"added":""}`,onClick:p,"aria-label":c?"Added to path":"Add to path",children:c?"âœ“ Added":"+ Add"}):e.jsx("span",{className:"arrow",children:"â†’"})})]})}xe.propTypes={course:f.shape({id:f.string,code:f.string,title:f.string,name:f.string,description:f.string,duration:f.string,durationMinutes:f.number,difficulty:f.string}).isRequired,type:f.oneOf(["fix","learn"]),onClick:f.func};xe.defaultProps={type:"fix",onClick:null};bt.propTypes={objectives:f.shape({fix_specific:f.arrayOf(f.string),transferable:f.arrayOf(f.string)}),courses:f.arrayOf(f.object),validation:f.shape({approved:f.bool,reason:f.string,issues:f.arrayOf(f.string),suggestions:f.arrayOf(f.string)}),onCourseClick:f.func};bt.defaultProps={objectives:null,courses:[],validation:null,onCourseClick:null};export{bt as AdaptiveLearningCart,jt as DiagnosisCard,wn as ProblemFirst,Re as ProblemInput};

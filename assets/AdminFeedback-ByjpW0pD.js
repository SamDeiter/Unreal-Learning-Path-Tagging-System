import{j as t,g as v}from"./index-Dt-tvART.js";import{a as c}from"./vendor-cytoscape-hdah7_Xt.js";import{getAdminFeedbackList as w}from"./feedbackService-DRFBX0pK.js";import{c as A,j as F,u as S}from"./vendor-firebase-BEnYNivV.js";import"./data-courses-Cfgu6N5t.js";import"./logger-CCt-ETDk.js";const u=["new","reviewed","resolved"];function L(){const[s,d]=c.useState([]),[m,o]=c.useState(!0),[n,p]=c.useState("all"),[j,h]=c.useState(null),l=c.useCallback(async()=>{o(!0);try{const e=await w();d(e)}catch(e){console.error("[AdminFeedback] Failed to load:",e)}finally{o(!1)}},[]);c.useEffect(()=>{l()},[l]);const x=async(e,a)=>{h(e);try{const r=A(v()),y=F(r,"feedback",e);await S(y,{status:a,updatedAt:new Date().toISOString()}),d(k=>k.map(i=>i.id===e?{...i,status:a}:i))}catch(r){console.error("[AdminFeedback] Status update failed:",r)}finally{h(null)}},f=n==="all"?s:s.filter(e=>e.status===n),b={all:s.length,new:s.filter(e=>e.status==="new").length,reviewed:s.filter(e=>e.status==="reviewed").length,resolved:s.filter(e=>e.status==="resolved").length},g={bug:"ğŸ›",feature:"ğŸ’¡",general:"ğŸ’¬",content:"ğŸ“"},N=e=>{if(!e)return"â€”";try{return new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return e}};return t.jsxs("div",{className:"admin-feedback",children:[t.jsxs("div",{className:"af-header",children:[t.jsx("h2",{className:"af-title",children:"ğŸ“‹ Feedback Triage"}),t.jsx("button",{className:"af-refresh",onClick:l,title:"Refresh",children:"ğŸ”„ Refresh"})]}),t.jsx("div",{className:"af-filters",children:["all",...u].map(e=>t.jsxs("button",{className:`af-filter-btn ${n===e?"active":""} af-status-${e}`,onClick:()=>p(e),children:[e.charAt(0).toUpperCase()+e.slice(1)," ",t.jsx("span",{className:"af-count",children:b[e]})]},e))}),m?t.jsx("div",{className:"af-loading",children:"Loading feedback..."}):f.length===0?t.jsx("div",{className:"af-empty",children:n==="all"?"No feedback submissions yet.":`No ${n} feedback.`}):t.jsx("div",{className:"af-table-wrap",children:t.jsxs("table",{className:"af-table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"Type"}),t.jsx("th",{children:"Description"}),t.jsx("th",{children:"User"}),t.jsx("th",{children:"Date"}),t.jsx("th",{children:"Status"}),t.jsx("th",{children:"Action"})]})}),t.jsx("tbody",{children:f.map(e=>t.jsxs("tr",{className:`af-row af-row-${e.status}`,children:[t.jsxs("td",{className:"af-type",children:[g[e.type]||"â“"," ",e.type]}),t.jsxs("td",{className:"af-desc",children:[e.description||t.jsx("em",{className:"af-no-desc",children:"No description"}),e.attachments?.length>0&&t.jsxs("span",{className:"af-attach",title:`${e.attachments.length} attachment(s)`,children:["ğŸ“ ",e.attachments.length]})]}),t.jsx("td",{className:"af-user",children:e.userEmail||"Anonymous"}),t.jsx("td",{className:"af-date",children:N(e.createdAt)}),t.jsx("td",{children:t.jsx("span",{className:`af-status-badge af-status-${e.status}`,children:e.status})}),t.jsx("td",{className:"af-actions",children:u.filter(a=>a!==e.status).map(a=>t.jsxs("button",{className:`af-action-btn af-action-${a}`,onClick:()=>x(e.id,a),disabled:j===e.id,children:[a==="reviewed"?"ğŸ‘€":a==="resolved"?"âœ…":"ğŸ”„"," ",a.charAt(0).toUpperCase()+a.slice(1)]},a))})]},e.id))})]})})]})}export{L as default};

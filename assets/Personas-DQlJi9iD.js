import{g as xe,a as Ie,j as e}from"./index-DuD93t7K.js";import{a as z}from"./vendor-cytoscape-hdah7_Xt.js";import{g as Me,a as oe,p as Te}from"./PersonaService-C3UxAABM.js";import{s as Pe,u as Re,B as Le,A as ae,G as ze,C as Ge,b as le,a as ce,V as de}from"./segmentSearchService-CrgwJjDq.js";import{n as be,m as je}from"./vendor-firebase-DXZ8tGTv.js";import{d as F,a as ne}from"./logger-CDyjTpW_.js";import{c as S}from"./createLucideIcon-YhyuTmrv.js";import{C as $e,S as ie}from"./sparkles-DyMeu0iU.js";import{C as Oe}from"./check-eCXpKYRG.js";import{M as qe}from"./message-square-B9rM_FIo.js";import"./data-courses-5fEGG3Qt.js";import"./feedbackService-Clim8Keh.js";import"./x-HbUnH9yy.js";import"./plus-mlfspTQG.js";const Ee=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Be=S("arrow-left",Ee);const De=[["path",{d:"M17 10c.7-.7 1.69 0 2.5 0a2.5 2.5 0 1 0 0-5 .5.5 0 0 1-.5-.5 2.5 2.5 0 1 0-5 0c0 .81.7 1.8 0 2.5l-7 7c-.7.7-1.69 0-2.5 0a2.5 2.5 0 0 0 0 5c.28 0 .5.22.5.5a2.5 2.5 0 1 0 5 0c0-.81-.7-1.8 0-2.5Z",key:"w610uw"}]],He=S("bone",De);const Fe=[["path",{d:"m18 16 4-4-4-4",key:"1inbqp"}],["path",{d:"m6 8-4 4 4 4",key:"15zrgr"}],["path",{d:"m14.5 4-5 16",key:"e7oirm"}]],We=S("code-xml",Fe);const Ue=[["path",{d:"M2.7 10.3a2.41 2.41 0 0 0 0 3.41l7.59 7.59a2.41 2.41 0 0 0 3.41 0l7.59-7.59a2.41 2.41 0 0 0 0-3.41l-7.59-7.59a2.41 2.41 0 0 0-3.41 0Z",key:"1f1r0c"}]],Ve=S("diamond",Ue);const Ye=[["line",{x1:"6",x2:"10",y1:"11",y2:"11",key:"1gktln"}],["line",{x1:"8",x2:"8",y1:"9",y2:"13",key:"qnk9ow"}],["line",{x1:"15",x2:"15.01",y1:"12",y2:"12",key:"krot7o"}],["line",{x1:"18",x2:"18.01",y1:"10",y2:"10",key:"1lcuu1"}],["path",{d:"M17.32 5H6.68a4 4 0 0 0-3.978 3.59c-.006.052-.01.101-.017.152C2.604 9.416 2 14.456 2 16a3 3 0 0 0 3 3c1 0 1.5-.5 2-1l1.414-1.414A2 2 0 0 1 9.828 16h4.344a2 2 0 0 1 1.414.586L17 18c.5.5 1 1 2 1a3 3 0 0 0 3-3c0-1.545-.604-6.584-.685-7.258-.007-.05-.011-.1-.017-.151A4 4 0 0 0 17.32 5z",key:"mfqc10"}]],Ke=S("gamepad-2",Ye);const Qe=[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]],Ze=S("loader",Qe);const Je=[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]],Xe=S("map",Je);const et=[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]],tt=S("palette",et);const st=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],ue=S("refresh-cw",st);const at=[["path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z",key:"m3kijz"}],["path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z",key:"1fmvmk"}],["path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0",key:"1f8sc4"}],["path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5",key:"qeys4"}]],me=S("rocket",at);const nt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],it=S("target",nt);const rt=[["path",{d:"M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978",key:"1n3hpd"}],["path",{d:"M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978",key:"rfe1zi"}],["path",{d:"M18 9h1.5a1 1 0 0 0 0-5H18",key:"7xy6bh"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z",key:"1mhfuq"}],["path",{d:"M6 9H4.5a1 1 0 0 1 0-5H6",key:"tex48p"}]],ot=S("trophy",rt);const lt=[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]],ct=S("wand-sparkles",lt);const dt=[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z",key:"1ngwbx"}]],ut=S("wrench",dt);async function re(f){try{const p=xe(),_=be(p);await je(_,"logTelemetry")({type:"onboarding_rag",...f}),F("[OnboardingTelemetry] Logged:",f.outcome,f)}catch(p){ne("[OnboardingTelemetry] Failed to log:",p.message)}}const se="idle",pe="planning",he="searching",ge="assembling",fe="done",ye="error";function mt(){const[f,p]=z.useState(se),[_,c]=z.useState(null),[a,y]=z.useState(null),h=z.useCallback(async o=>{p(pe),c(null),y(null);const k=xe(),v=be(k),x=je(v,"queryLearningPath"),K=Date.now();try{F("[OnboardingRAG] Step 1 â€” Calling Planner CF...");const W=(await x({persona:o,mode:"onboarding",onboardingStep:"plan"})).data;if(!W?.success)throw new Error(W?.error||"Planner failed");const{searchQueries:m=[],archetype:Q="unknown"}=W;F("[OnboardingRAG] Planner returned:",{searchQueries:m,archetype:Q}),p(he),F("[OnboardingRAG] Step 2 â€” Running local segment search...");let G=[];for(const T of m.slice(0,5))try{const U=(await Pe(T,null,[],4)).map(P=>({videoTitle:P.videoTitle||P.courseTitle||"Unknown",courseCode:P.courseCode||"unknown",videoId:P.videoKey||P.videoId||"",timestamp:P.timestamp||"0:00",text:P.topSegments?.[0]?.preview||P.text||""}));G.push(...U)}catch(q){ne(`[OnboardingRAG] Search failed for "${T}":`,q.message)}const J=new Set;G=G.filter(T=>{const q=`${T.courseCode}::${T.videoId}`;return J.has(q)?!1:(J.add(q),!0)}),F(`[OnboardingRAG] Retrieved ${G.length} unique passages`),p(ge),F("[OnboardingRAG] Step 3 â€” Calling Assembler CF...");const I=(await x({persona:o,mode:"onboarding",onboardingStep:"assemble",archetype:Q,passages:G.slice(0,15)})).data;if(!I?.success)throw new Error(I?.error||"Assembler failed");return F("[OnboardingRAG] Curriculum ready:",I.curriculum?.title),re({outcome:"rag_success",archetype:Q,passagesFound:G.length,modulesReturned:(I.curriculum?.modules||[]).length,searchQueries:m.length,pipelineDurationMs:Date.now()-K}),c({...I,passages:G}),p(fe),{...I,passages:G}}catch(w){return ne("[OnboardingRAG] Pipeline error:",w.message),re({outcome:"rag_fallback",errorMessage:w.message||"Unknown error",pipelineDurationMs:Date.now()-K}),y(w.message||"Something went wrong"),p(ye),null}},[]),N=z.useCallback(()=>{p(se),c(null),y(null)},[]);return{generateRAGPath:h,resetRAG:N,ragState:f,ragResult:_,ragError:a,RAG_STATES:{IDLE:se,PLANNING:pe,SEARCHING:he,ASSEMBLING:ge,DONE:fe,ERROR:ye}}}function pt({docs:f,isInCart:p,addToCart:_,removeFromCart:c}){return f?.length?e.jsxs("div",{className:"blended-section",children:[e.jsxs("div",{className:"blended-section-header",children:[e.jsx("h2",{className:"blended-section-title",children:"ðŸ“š Recommended Reading"}),e.jsx("p",{className:"blended-section-desc",children:"Official Unreal Engine documentation related to your learning path."})]}),e.jsx("div",{className:"doc-cards-grid",children:f.map((a,y)=>{const h=`doc_${a.key||y}`,N=p(h);return e.jsxs("div",{className:`doc-card ${N?"doc-card-added":""}`,children:[e.jsxs("a",{href:a.url,target:"_blank",rel:"noopener noreferrer",className:"doc-card-link",onClick:o=>o.stopPropagation(),children:[e.jsxs("div",{className:"doc-card-header",children:[e.jsx("span",{className:`tier-badge tier-${a.tier||"intermediate"}`,children:a.tier||"intermediate"}),a.subsystem&&e.jsx("span",{className:"subsystem-tag",children:a.subsystem})]}),e.jsx("h4",{className:"doc-card-title",children:a.label}),a.description&&e.jsx("p",{className:"doc-card-desc",children:a.description}),e.jsxs("div",{className:"doc-card-footer",children:[e.jsx("span",{className:"doc-source-badge",children:"ðŸ“„ Epic Docs"}),e.jsxs("span",{className:"doc-read-time",children:[a.readTimeMinutes||10," min read"]})]})]}),e.jsx("button",{className:`doc-add-btn ${N?"doc-added":""}`,onClick:()=>{N?c(h):_({type:"doc",itemId:h,title:a.label,description:a.description||"",keySteps:a.keySteps||[],seeAlso:a.seeAlso||[],sections:a.sections||[],url:a.url,tier:a.tier||"intermediate",subsystem:a.subsystem,readTimeMinutes:a.readTimeMinutes||10})},title:N?"Remove from path":"Add to learning path",children:N?"âœ“ Added":"âž• Add"})]},a.key||y)})})]}):null}function ht({youtube:f,isInCart:p,addToCart:_,removeFromCart:c}){return f?.length?e.jsxs("div",{className:"blended-section",children:[e.jsxs("div",{className:"blended-section-header",children:[e.jsx("h2",{className:"blended-section-title",children:"ðŸ“º Official Epic YouTube"}),e.jsx("p",{className:"blended-section-desc",children:"Official Unreal Engine tutorials from Epic Games."})]}),e.jsx("div",{className:"doc-cards-grid",children:f.map(a=>{const y=a.id||`yt_${a.url}`,h=p(y),N=a.url?.match(/[?&]v=([^&]+)/),o=N?N[1]:null;return e.jsxs("div",{className:`doc-card yt-card-with-thumb ${h?"doc-card-added":""}`,children:[e.jsxs("a",{href:a.url,target:"_blank",rel:"noopener noreferrer",className:"doc-card-link",onClick:k=>k.stopPropagation(),children:[o&&e.jsxs("div",{className:"yt-thumb-wrapper",children:[e.jsx("img",{className:"yt-thumb-img",src:`https://img.youtube.com/vi/${o}/mqdefault.jpg`,alt:a.title,loading:"lazy"}),e.jsxs("span",{className:"yt-thumb-duration",children:[a.durationMinutes," min"]}),e.jsx("span",{className:"yt-thumb-play",children:"â–¶"})]}),e.jsxs("div",{className:"doc-card-header",children:[e.jsx("span",{className:`tier-badge tier-${a.tier||"intermediate"}`,children:a.tier||"intermediate"}),e.jsx("span",{className:"external-badge",children:"Official â€¢ YouTube"})]}),e.jsx("h4",{className:"doc-card-title",children:a.title}),e.jsxs("div",{className:"doc-card-footer",children:[e.jsxs("span",{className:"doc-source-badge",children:["ðŸ“º ",a.channelName]}),e.jsxs("span",{className:"doc-read-time",children:[a.durationMinutes," min"]})]})]}),e.jsx("button",{className:`doc-add-btn ${h?"doc-added":""}`,onClick:()=>{h?c(y):_({type:"youtube",itemId:y,title:a.title,description:a.description||"",keyTakeaways:a.keyTakeaways||[],chapters:a.chapters||[],topics:a.topics||[],url:a.url,channelName:a.channelName,channelTrust:a.channelTrust,tier:a.tier||"intermediate",durationMinutes:a.durationMinutes||15})},title:h?"Remove from path":"Add to learning path",children:h?"âœ“ Added":"âž• Add"})]},a.id)})})]}):null}const ve=[{key:"prerequisite",icon:"ðŸ”—",label:"Prerequisite",desc:"Build the foundation first â€” these cover concepts you'll need before tackling the main topic."},{key:"core",icon:"â­",label:"Core",desc:"These directly address your learning goals and are the most important courses to watch."},{key:"supplemental",icon:"ðŸ“š",label:"Supplemental",desc:"Go deeper â€” extra context and advanced techniques for when you're ready."}];function gt({courses:f,isInCart:p,addToCart:_,removeFromCart:c,userQuery:a}){const y=f.map(o=>{const k=(o.title||o.name||"").replace(/_/g," "),v=k.toLowerCase(),x=o.videos?.[0]?.drive_id||o.driveId||o.code||`course-${o.order}`,w=o.code?.startsWith("100")||v.includes("quickstart")||v.includes("introduction")||v.includes("intro ")||v.includes("getting started")||v.includes("your first")?"prerequisite":o.quickWin?"core":"supplemental";return{course:o,video:{title:k,duration:(o.duration||45)*60,driveId:x,courseCode:o.code,role:w,reason:o.learningOutcome||"",matchPercent:o.matchScore||75,matchedTags:o.matchedTags||[]}}}),h={};for(const o of ve)h[o.key]=[];h._other=[];for(const o of y){const k=o.video.role||"_other";(h[k]||h._other).push(o)}const N=y.length;return e.jsxs(e.Fragment,{children:[e.jsxs("h2",{className:"results-title",children:["ðŸŽ¬ Videos for You (",N,")"]}),ve.filter(o=>h[o.key].length>0).map(o=>e.jsxs("div",{className:"role-section",children:[e.jsxs("div",{className:"role-section-header",children:[e.jsxs("h3",{className:"role-section-title",children:[o.icon," ",o.label,e.jsx("span",{className:"role-section-count",children:h[o.key].length})]}),e.jsx("p",{className:"role-section-desc",children:o.desc})]}),e.jsx("div",{className:"video-results-grid",children:h[o.key].map(({course:k,video:v})=>e.jsx("div",{className:"video-result-wrapper",id:`video-${v.driveId}`,children:e.jsx(de,{video:v,isAdded:p(v.driveId),onToggle:x=>{p(x.driveId)?c(x.driveId):_({...k,driveId:x.driveId,itemId:x.driveId,title:x.title,duration:x.duration,type:"video"})},userQuery:a})},v.driveId))})]},o.key)),h._other.length>0&&e.jsxs("div",{className:"role-section",children:[e.jsxs("div",{className:"role-section-header",children:[e.jsxs("h3",{className:"role-section-title",children:["ðŸ“Ž Related ",e.jsx("span",{className:"role-section-count",children:h._other.length})]}),e.jsx("p",{className:"role-section-desc",children:"Additional videos that may be relevant to your learning goals."})]}),e.jsx("div",{className:"video-results-grid",children:h._other.map(({course:o,video:k})=>e.jsx("div",{className:"video-result-wrapper",id:`video-${k.driveId}`,children:e.jsx(de,{video:k,isAdded:p(k.driveId),onToggle:v=>{p(v.driveId)?c(v.driveId):_({...o,driveId:v.driveId,itemId:v.driveId,title:v.title,duration:v.duration,type:"video"})},userQuery:a})},k.driveId))})]})]})}const O=[{id:"startPrompt",question:"What do you want to learn in UE5?",subtitle:"Describe in your own words (optional â€” helps personalize your path)",type:"freetext",placeholder:"e.g. I want to make a small RPG with inventory and combat..."},{id:"role",question:"Which best describes your role?",subtitle:"This determines your learning persona",type:"choice",options:[{value:"indie_isaac",label:"Indie Game Dev",description:"Solo/small-team â€” prototype fast, ship it",icon:Ke},{value:"logic_liam",label:"Games Programmer",description:"Architecture, systems, performance",icon:We},{value:"animator_alex",label:"Animator / Film Artist",description:"Cinematics, sequencer, real-time previews",icon:$e},{value:"rigger_regina",label:"Rigger / Character TD",description:"Control Rig, deformation, retargeting",icon:He},{value:"designer_cpg",label:"Designer (Retail/CPG)",description:"Product viz, lighting, stunning visuals",icon:Ve}]},{id:"experience",question:"How many years of 3D / game engine experience do you have?",type:"choice",options:[{value:"beginner",label:"0â€“1 years",description:"Brand new to 3D or engines",icon:ie},{value:"junior",label:"2â€“5 years",description:"Used Maya, Blender, or another engine",icon:tt},{value:"mid",label:"5â€“10 years",description:"Professional with shipped work",icon:ct},{value:"senior",label:"10+ years",description:"Senior / lead level",icon:ut}]},{id:"goal",question:"What do you want to achieve in your first 10 hours?",type:"choice",options:[{value:"explore",label:"Explore and understand UE5",icon:Xe},{value:"project",label:"Start a specific project",icon:it},{value:"skill",label:"Learn a specific skill",icon:Le},{value:"portfolio",label:"Build a portfolio piece",icon:ot},{value:"transition",label:"Transition from another tool",icon:ae}]}];function Mt(){const{courses:f}=Ie(),[p,_]=z.useState(0),[c,a]=z.useState({startPrompt:"",role:null,experience:null,goal:null}),[y,h]=z.useState(null),[N,o]=z.useState(null),{generateRAGPath:k,resetRAG:v,ragState:x,ragError:K,RAG_STATES:w}=mt(),W=[w.PLANNING,w.SEARCHING,w.ASSEMBLING].includes(x),m=z.useMemo(()=>c.role?Me(c.role):null,[c.role]),Q=()=>{const i=O[1].options.find(C=>C.value===c.role),b=O[2].options.find(C=>C.value===c.experience),j=O[3].options.find(C=>C.value===c.goal);return[c.startPrompt?`Goal: ${c.startPrompt}.`:"",`Role: ${i?.label||c.role}.`,`Experience: ${b?.label||c.experience}.`,`Objective: ${j?.label||c.goal}.`].filter(Boolean).join(" ")},G=async()=>{m&&localStorage.setItem("detected_persona",JSON.stringify(m));const i=Q(),b=m?`${m.name} â€” ${m.industry}`:"General",j=await k(i,b);if(j?.curriculum?.modules?.length>0){const D=j.passages||[],C={};D.forEach(t=>{t.videoTitle&&(C[t.videoTitle.toLowerCase()]=t),t.videoId&&(C[t.videoId.toLowerCase()]=t)});const V=t=>{if(!f||!t)return null;const r=t.toLowerCase();return f.find(d=>d.videos?.some(s=>{const l=(s.title||s.name||"").toLowerCase();return l===r||l.includes(r)||r.includes(l)}))},Y=(t,r)=>{const d=new Set(["the","and","for","are","with","from","this","that","your","into","how","can","will","has","was","been","have","what","when","not","unreal","engine","ue5","learn","using","about","getting","started","introduction","overview","course","module","lesson","video"]),s=(t||"").toLowerCase().split(/[\s\-_/()]+/).filter(g=>g.length>2&&!d.has(g)),l=(r||"").toLowerCase().split(/[\s\-_/()]+/).filter(g=>g.length>2&&!d.has(g));if(s.length===0||l.length===0)return 0;let u=0;for(const g of s)for(const M of l){if(g===M){u++;break}if(g.length>4&&M.length>4&&(g.includes(M)||M.includes(g))){u+=.5;break}}return u/Math.max(s.length,l.length)},R=new Set,$=(j.curriculum.modules||[]).map(t=>{let r=null;if(t.videoId&&f&&(r=f.find(s=>!R.has(s.title)&&s.videos?.some(l=>l.drive_id&&(l.title===t.videoId||l.name===t.videoId||l.drive_id===t.videoId)))),!r){const s=(t.videoId||"").toLowerCase(),l=C[s];l?.videoTitle&&(r=V(l.videoTitle),r&&R.has(r.title)&&(r=null))}if(!r&&f){let s=0,l=null;for(const u of D){if(!u.videoTitle)continue;const g=V(u.videoTitle);if(!g||R.has(g.title))continue;const M=Y(t.title+" "+(t.description||""),u.videoTitle);M>s&&M>=.15&&(s=M,l=g)}r=l}if(!r&&f){let s=0,l=null;for(const u of f){if(R.has(u.title)||!u.videos?.length||!u.videos[0]?.drive_id)continue;const g=Y(t.title+" "+(t.description||""),u.title||u.name||"");g>s&&g>=.15&&(s=g,l=u)}r=l}return r&&R.add(r.title),r?{...r,ragTitle:t.title,ragDescription:t.description,enriched:!0}:{title:t.title,name:t.title,description:t.description,code:`rag-${t.title.replace(/\s+/g,"-").toLowerCase().slice(0,30)}`,videos:[],enriched:!1}}),A=$.filter(t=>t.enriched&&t.videos?.length>0&&t.videos[0]?.drive_id),Z={indie_isaac:"games",logic_liam:"games",animator_alex:"animation",rigger_regina:"animation",designer_cpg:"visualization",architect_amy:"architecture",simulation_sam:"simulation",vfx_victor:"vfx",automotive_andy:"automotive"}[m?.id]||"general",n=A.filter(t=>{const r=(t.tags?.industry||"general").toLowerCase(),d=(t.title||t.name||"").toLowerCase();if(r!=="general"&&r!==Z)return!1;const s=[{match:["automotive","vehicle design","configurator","car paint","vred"],allow:["automotive"]},{match:["archviz","architectural","twinmotion","for architecture","aeco"],allow:["architecture","visualization"]},{match:["legacy production","virtual production","broadcast","icvfx","ndisplay"],allow:["animation","vfx","film","media"]}];for(const l of s)if(l.match.some(u=>d.includes(u))&&!l.allow.includes(Z))return!1;return!0});if(re({outcome:"enrichment",totalModules:$.length,enrichedCount:n.length,enrichmentRate:$.length>0?Math.round(n.length/$.length*100):0}),n.length>=3){let t=0;const r=n.slice(0,8).map((d,s)=>{const l=d.duration||45;t+=l;const u=le(d.videos,d.ai_tags);return{...d,order:s+1,cumulativeTime:t,milestone:t>=120&&t<180?"2hr":t>=300&&t<360?"5hr":t>=600?"10hr":null,quickWin:s<2,learningOutcome:u}});h({persona:m,courses:r,totalTime:t,messaging:oe(m),source:"rag"});try{const d=r.flatMap(s=>[...s.ai_tags?.topics||[],...(s.tag_ids||[]).flatMap(l=>l.split(".")),...s.tags?.subsystem?[s.tags.subsystem]:[],...s.tags?.feature?[s.tags.feature]:[],...Object.values(s.tags||{}).filter(l=>typeof l=="string"&&l.length>2),...(s.title||s.name||"").split(/[\s_-]+/).filter(l=>l.length>3)]).map(s=>s.toLowerCase()).filter((s,l,u)=>u.indexOf(s)===l&&!["introduction","unreal","engine","workshop","first","project","games","your","quickstart"].includes(s)).slice(0,15);if(d.length>0){const s=await ce(d,[],{maxDocs:5,maxYoutube:3});o(s)}}catch(d){console.warn("[Personas] Blended path fetch failed:",d.message)}return}}await J()},J=async()=>{if(!m||!f)return;const i=Te[m.id]||{boostKeywords:m.keywords||[],penaltyKeywords:[],requiredTopics:[]},b=c.experience||"beginner",j={beginner:["beginner","","general"],junior:["beginner","","general","intermediate"],mid:["beginner","","general","intermediate"],senior:["beginner","","general","intermediate","advanced"]},D=j[b]||j.beginner,C=f.filter(n=>{const t=(n.tags?.level||"").toLowerCase();return D.includes(t)}).filter(n=>n.videos?.length>0&&n.videos[0]?.drive_id),V=b==="junior",R=C.map(n=>{let t=0;const r=[...Array.isArray(n.ai_tags)?n.ai_tags:[],...Array.isArray(n.canonical_tags)?n.canonical_tags:[]];n.tags?.topic&&r.push(n.tags.topic),n.tags?.industry&&r.push(n.tags.industry);const d=r.map(L=>typeof L=="string"?L.toLowerCase():""),s=(n.title||n.name||"").toLowerCase(),l=`${s} ${d.join(" ")}`;for(const L of i.boostKeywords){const H=L.toLowerCase();s.includes(H)&&(t+=5),d.some(te=>te.includes(H))&&(t+=3)}for(const L of i.penaltyKeywords){const H=L.toLowerCase();l.includes(H)&&(t-=10)}const u=(n.tags?.industry||"general").toLowerCase(),M={indie_isaac:"games",logic_liam:"games",animator_alex:"animation",rigger_regina:"animation",designer_cpg:"visualization",architect_amy:"architecture",simulation_sam:"simulation",vfx_victor:"vfx",automotive_andy:"automotive"}[m.id]||"general";u!=="general"&&u!==M&&(t-=200),u===M&&u!=="general"&&(t+=15);const Ae=[{match:["legacy production","virtual production","broadcast","live action","compositing","stage operator","icvfx","ndisplay","cinematography","film production","in-camera","on-set"],allowPersonas:["animation","vfx","film","media"]},{match:["for automotive","automotive","vehicle design","configurator","car paint","vred"],allowPersonas:["automotive"]},{match:["archviz","architectural","twinmotion","for architecture","for design","aeco"],allowPersonas:["architecture","design"]},{match:["digital twin","crowd simulation"],allowPersonas:["simulation","enterprise"]},{match:["manufacturing","factory","assembly line"],allowPersonas:["manufacturing","enterprise"]}];for(const L of Ae)if(L.match.some(te=>s.includes(te))&&!L.allowPersonas.includes(M)){t-=200;break}if((s.includes("executive")||s.includes("leadership")||s.includes("management overview"))&&(t-=30),b==="beginner"){const L=["multiplayer","networking","dedicated server","optimization","profiling","c++ programming","source control","packaging","deployment"];for(const H of L)l.includes(H)&&(t-=15)}n.code?.startsWith("100")&&(t+=40),s.includes("introduction")&&(t+=50),s.includes("intro")&&!s.includes("introduction")&&(t+=40),(s.includes("quickstart")||s.includes("your first"))&&(t+=35),s.includes("getting started")&&(t+=30),s.includes("fundamental")&&t>=0&&(t+=10);const Se=le(n.videos,n.ai_tags);return{...n,relevanceScore:t,learningOutcome:Se}}).sort((n,t)=>t.relevanceScore-n.relevanceScore),$=new Set;let A=R.filter(n=>{const t=(n.title||n.name||"").toLowerCase().replace(/\s+for\s+(games|automotive|aec|architecture|simulation|film).*$/i,"").replace(/[^a-z0-9]/g,"").replace(/\d+$/g,"");return $.has(t)?!1:($.add(t),!0)});if(V){let n=0;const t=3;A=A.filter(r=>{if((r.tags?.level||"").toLowerCase()==="intermediate"){if(n>=t)return!1;n++}return!0})}if(A=A.filter(n=>n.videos?.length>0&&n.videos.some(t=>t.drive_id)),A=A.slice(0,8),i.requiredTopics&&i.requiredTopics.length>0){for(const n of i.requiredTopics){const t=n.toLowerCase();if(!A.some(d=>{const s=(d.title||d.name||"").toLowerCase(),l=[...Array.isArray(d.ai_tags)?d.ai_tags:[],...Array.isArray(d.canonical_tags)?d.canonical_tags:[]].map(u=>typeof u=="string"?u.toLowerCase():"").join(" ");return s.includes(t)||l.includes(t)})){const d=R.find(s=>{if(A.some(g=>g.code===s.code))return!1;const l=(s.title||s.name||"").toLowerCase(),u=[...Array.isArray(s.ai_tags)?s.ai_tags:[],...Array.isArray(s.canonical_tags)?s.canonical_tags:[]].map(g=>typeof g=="string"?g.toLowerCase():"").join(" ");return l.includes(t)||u.includes(t)});d&&A.length>=8?A[A.length-1]=d:d&&A.push(d)}}A.sort((n,t)=>(t.relevanceScore||0)-(n.relevanceScore||0))}let E=0;const Z=A.map((n,t)=>{const r=n.duration||45;return E+=r,{...n,order:t+1,cumulativeTime:E,milestone:E>=120&&E<180?"2hr":E>=300&&E<360?"5hr":E>=600?"10hr":null,quickWin:t<2}});h({persona:m,courses:Z,totalTime:E,messaging:oe(m),source:"local"});try{const n=Z.flatMap(t=>[...t.ai_tags?.topics||[],...(t.tag_ids||[]).flatMap(r=>r.split(".")),...t.tags?.subsystem?[t.tags.subsystem]:[],...t.tags?.feature?[t.tags.feature]:[],...Object.values(t.tags||{}).filter(r=>typeof r=="string"&&r.length>2),...(t.title||t.name||"").split(/[\s_-]+/).filter(r=>r.length>3)]).map(t=>t.toLowerCase()).filter((t,r,d)=>d.indexOf(t)===r&&!["introduction","unreal","engine","workshop","first","project","games","your","quickstart"].includes(t)).slice(0,15);if(n.length>0){const t=await ce(n,[],{maxDocs:5,maxYoutube:3});o(t)}}catch(n){console.warn("[Personas] Blended path fetch failed:",n.message)}},[X,I]=z.useState(null),{cart:T,addToCart:q,removeFromCart:U,clearCart:P,isInCart:ee}=Re(),we=(i,b)=>{a(j=>({...j,[i]:b})),O[p].type==="choice"&&p<O.length-1&&_(j=>j+1)},Ne=()=>{p<O.length-1&&_(i=>i+1)},ke=()=>{_(0),a({startPrompt:"",role:null,experience:null,goal:null}),h(null),o(null),I(null),P(),v(),localStorage.removeItem("detected_persona")},_e=()=>{_(1),a(i=>({...i,role:null,experience:null,goal:null})),h(null),I(null),v(),localStorage.removeItem("detected_persona")},Ce=c.role&&c.experience&&c.goal,B=O[p];return e.jsxs("div",{className:"personas-page",children:[e.jsxs("header",{className:"personas-header",children:[e.jsxs("h1",{children:[e.jsx(me,{size:24,className:"icon-inline"})," New to UE5? Let's Get You Started"]}),e.jsx("p",{className:"personas-subtitle",children:"Answer a few quick questions and we'll create your personalized first 10-hour learning path"})]}),W?e.jsx("section",{className:"quiz-section rag-loading",children:e.jsxs("div",{className:"rag-loader",children:[e.jsx(Ze,{size:40,className:"spin-icon"}),e.jsxs("h2",{children:[x===w.PLANNING&&"Analyzing your profile...",x===w.SEARCHING&&"Searching course library...",x===w.ASSEMBLING&&"Building your curriculum..."]}),e.jsxs("p",{className:"rag-loader-sub",children:[x===w.PLANNING&&"Our AI is understanding your learning goals",x===w.SEARCHING&&"Finding the most relevant video segments",x===w.ASSEMBLING&&"Crafting a personalized learning path"]}),e.jsx("div",{className:"rag-progress-bar",children:e.jsx("div",{className:"rag-progress-fill",style:{width:x===w.PLANNING?"33%":x===w.SEARCHING?"66%":"90%"}})})]})}):y?X?e.jsx("div",{className:"guided-player-breakout",children:e.jsx(ze,{courses:(()=>{const i=j=>{if(!j?.videos?.length)return j;const D=[...j.videos].sort((C,V)=>{const Y=R=>{const $=(R.title||R.name||"").match(/part\s*(\d+)/i);return $?parseInt($[1],10):999};return Y(C)-Y(V)});return{...j,videos:D}};return(T.length>0?T.map(j=>y?.courses?.find(C=>C.code===j.code||C.title===j.title)||j):[X]).map(i)})(),problemSummary:`New to UE5 â€” ${m?.name||"General"}, ${O[2].options.find(i=>i.value===c.experience)?.label||""}, wants to ${O[3].options.find(i=>i.value===c.goal)?.label||"explore"}`,pathSummary:{path_summary:`A personalized learning path for ${y.persona.name}. This path covers foundational UE5 skills tailored to your background, starting with the essentials and building toward hands-on projects.`,topics_covered:y.courses.map(i=>i.title||i.name)},onComplete:()=>I(null),onExit:()=>I(null)})}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"shopping-layout",children:[e.jsxs("div",{className:"results-column",children:[e.jsxs("div",{className:"path-header",children:[e.jsx("span",{className:"path-icon",children:e.jsx(me,{size:40})}),e.jsxs("div",{children:[e.jsx("h2",{children:"Your Personalized Learning Path"}),e.jsxs("p",{children:["Optimized for ",y.persona.name," â€” pick the courses you want to watch"]})]}),e.jsxs("div",{className:"path-actions",children:[e.jsxs("button",{className:"switch-persona-btn",onClick:_e,children:[e.jsx(ue,{size:14})," Switch Persona"]}),e.jsxs("button",{className:"reset-btn",onClick:ke,children:[e.jsx(ue,{size:16})," Start Over"]})]})]}),m&&e.jsx("div",{className:"persona-result-card",children:e.jsxs("div",{className:"persona-result-header",children:[m.emoji&&e.jsx("span",{className:"persona-emoji",children:m.emoji}),e.jsxs("div",{children:[e.jsx("h3",{children:m.name}),e.jsx("p",{children:m.description})]})]})}),e.jsx("div",{className:"motivation-messages",children:y.messaging.map((i,b)=>e.jsx("div",{className:"motivation-card",children:i},b))}),e.jsx(gt,{courses:y.courses,isInCart:ee,addToCart:q,removeFromCart:U,userQuery:c.startPrompt||""}),N?.docs?.length>0&&e.jsx(pt,{docs:N.docs,isInCart:ee,addToCart:q,removeFromCart:U}),N?.youtube?.length>0&&e.jsx(ht,{youtube:N.youtube,isInCart:ee,addToCart:q,removeFromCart:U}),e.jsx("div",{className:"path-summary",children:e.jsxs("p",{children:["Total time:"," ",e.jsxs("strong",{children:[Math.round(y.totalTime/60*10)/10," hours"]})]})})]}),e.jsx("div",{className:"cart-column",children:e.jsx(Ge,{cart:T,onRemove:U,onClear:P,onWatchPath:()=>{T.length>0&&I(T[0])}})})]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"quiz-progress",children:O.map((i,b)=>e.jsx("div",{className:`progress-step ${b<=p?"active":""} ${i.type==="freetext"?c[i.id]||b<p?"completed":"":c[i.id]?"completed":""}`,children:(i.type==="freetext"?b<p:c[i.id])?e.jsx(Oe,{size:16}):b+1},i.id))}),K&&e.jsx("div",{className:"rag-error-banner",children:"âš ï¸ AI personalization unavailable â€” using local recommendations instead."}),e.jsxs("section",{className:"quiz-section",children:[e.jsx("h2",{children:B.question}),B.subtitle&&e.jsx("p",{className:"quiz-subtitle",children:B.subtitle}),B.type==="freetext"?e.jsxs("div",{className:"freetext-input",children:[e.jsxs("div",{className:"freetext-wrapper",children:[e.jsx(qe,{size:18,className:"freetext-icon"}),e.jsx("textarea",{value:c.startPrompt,onChange:i=>a(b=>({...b,startPrompt:i.target.value})),placeholder:B.placeholder,rows:3,className:"freetext-textarea"})]}),e.jsxs("button",{className:"freetext-next",onClick:Ne,children:[c.startPrompt?"Next":"Skip"," ",e.jsx(ae,{size:16})]})]}):e.jsx("div",{className:"quiz-options",children:B.options.map(i=>{const b=i.icon||ie;return e.jsxs("button",{className:`quiz-option ${c[B.id]===i.value?"selected":""}`,onClick:()=>we(B.id,i.value),children:[e.jsx("span",{className:"option-icon-wrapper",children:e.jsx(b,{size:18})}),e.jsxs("span",{className:"option-content",children:[e.jsx("span",{className:"option-label",children:i.label}),i.description&&e.jsx("span",{className:"option-description",children:i.description})]})]},i.value)})}),e.jsxs("div",{className:"quiz-nav",children:[p>0&&e.jsxs("button",{className:"quiz-back",onClick:()=>_(i=>i-1),children:[e.jsx(Be,{size:16})," Back"]}),Ce&&e.jsxs("button",{className:"quiz-generate",onClick:G,disabled:W,children:["Generate My Path ",e.jsx(ae,{size:16})]})]})]}),m&&e.jsxs("div",{className:"persona-preview",children:[e.jsx("span",{className:"preview-icon",children:m.emoji?e.jsx("span",{style:{fontSize:"32px"},children:m.emoji}):e.jsx(ie,{size:32})}),e.jsxs("div",{className:"preview-text",children:[e.jsx("strong",{children:m.name}),e.jsx("p",{children:m.description})]})]})]})]})}export{Mt as default};

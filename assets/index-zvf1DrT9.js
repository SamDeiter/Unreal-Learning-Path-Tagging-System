import{j as e,_ as be,a as Ls,g as Oe}from"./index-DGdJLxWe.js";import{a as j,P as h}from"./vendor-cytoscape-hdah7_Xt.js";import{c as js,p as $s,r as As,d as Ps,j as Os,k as qs,n as Ds,m as Ce,a as Fs}from"./vendor-firebase-BQvzIQYL.js";import{t as fe}from"./TagGraphService-B-wiM6gr.js";import{S as Us,P as Ws}from"./search-Blpc5bje.js";import{c as je}from"./createLucideIcon-YhyuTmrv.js";import{c as Ee,S as Le,G as Bs}from"./GuidedPlayer-BaIB1Fhw.js";import{getFeedbackStatus as Vs,recordUpvote as zs,recordDownvote as Gs,applyFeedbackMultiplier as Ks,getBoostMap as Hs}from"./feedbackService-CzFBdtB9.js";import{b as Qs,l as Ys,c as Js,s as Xs}from"./data-courses-Y_tFOtPD.js";import{C as Zs}from"./check-eCXpKYRG.js";import{d as ne,a as G}from"./logger-HX1K3TKu.js";import"./x-HbUnH9yy.js";const et=[["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],st=je("circle-play",et);const tt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],ls=je("circle-x",tt);const nt=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],rt=je("image",nt);const at=[["path",{d:"M13.172 2a2 2 0 0 1 1.414.586l6.71 6.71a2.4 2.4 0 0 1 0 3.408l-4.592 4.592a2.4 2.4 0 0 1-3.408 0l-6.71-6.71A2 2 0 0 1 6 9.172V3a1 1 0 0 1 1-1z",key:"16rjxf"}],["path",{d:"M2 7v6.172a2 2 0 0 0 .586 1.414l6.71 6.71a2.4 2.4 0 0 0 3.191.193",key:"178nd4"}],["circle",{cx:"10.5",cy:"6.5",r:".5",fill:"currentColor",key:"12ikhr"}]],it=je("tags",at);const ot=[["path",{d:"M12 19h8",key:"baeox8"}],["path",{d:"m4 17 6-6-6-6",key:"1yngyt"}]],ct=je("terminal",ot);const lt=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],dt=je("user",lt),ut=/(?:[A-Za-z]:\\[\w\\. -]+|\/(?:Users|home|tmp|var|opt|etc)\/[\w/. -]+)/g;function ds(s){return s.replace(ut,"[LOCAL_PATH]")}function Ye({onSubmit:s,detectedPersona:n,isLoading:a}){const[i,u]=j.useState(""),[l,r]=j.useState([]),[o,c]=j.useState(null),[t,d]=j.useState(""),[f,x]=j.useState(!1),y=j.useRef(null),[v,b]=j.useState(()=>{try{const _=JSON.parse(localStorage.getItem("fix-problem-history")||"[]"),S=_.map(N=>typeof N=="string"?{query:N,cartId:null}:N);return _.length>0&&typeof _[0]=="string"&&localStorage.setItem("fix-problem-history",JSON.stringify(S)),S}catch{return[]}}),O=j.useCallback(_=>{const S=ds(_.target.value);if(u(S),S.length>15){const N=fe.matchErrorSignature(S),W=fe.extractTagsFromText(S),B=N.map(J=>({tag:J.tag,confidence:J.confidence})),H=W.matches.map(J=>({tag:J.tag,confidence:J.confidence})),ee=[...B,...H],ce=new Set,oe=ee.filter(J=>ce.has(J.tag.tag_id)?!1:(ce.add(J.tag.tag_id),!0));r(oe.slice(0,5))}else r([])},[]),m=j.useCallback(_=>{const S=_.clipboardData?.items;if(S){for(const N of S)if(N.type.startsWith("image/")){_.preventDefault();const W=N.getAsFile(),B=new FileReader;B.onload=H=>c(H.target.result),B.readAsDataURL(W);return}}},[]),k=j.useCallback(_=>{_.preventDefault(),_.stopPropagation(),x(!0)},[]),I=j.useCallback(_=>{_.preventDefault(),_.stopPropagation(),x(!1)},[]),R=j.useCallback(_=>{_.preventDefault(),_.stopPropagation(),x(!1);const S=_.dataTransfer?.files;if(!S||S.length===0)return;const N=S[0];if(N.type.startsWith("image/")){const W=new FileReader;W.onload=B=>c(B.target.result),W.readAsDataURL(N)}},[]),$=j.useCallback((_,S)=>{b(N=>{const W=N.map(B=>B.query===_?{...B,cartId:S}:B);return localStorage.setItem("fix-problem-history",JSON.stringify(W)),W})},[]),A=j.useCallback((_=null,S=null)=>{const N=(S||i).trim();N.length<10||(b(W=>{const B=W.filter(ee=>ee.query!==N),H=[{query:N,cartId:_},...B].slice(0,6);return localStorage.setItem("fix-problem-history",JSON.stringify(H)),H}),s({query:N,detectedTagIds:l.map(W=>W.tag.tag_id),selectedTagIds:[],personaHint:n?.name,pastedImage:o,errorLog:t.trim()||null,cachedCartId:_||null,updateCartIdForQuery:$}))},[i,l,n,s,o,t,$]),X=j.useCallback(_=>{_.key==="Enter"&&_.ctrlKey&&A()},[A]),ie=j.useMemo(()=>['My Blueprint Cast is giving me "Accessed None" error when trying to...',"Lumen is too noisy in my interior scene and I've tried increasing quality...","My character animation stutters when blending between states...","Nanite is causing Z-fighting on overlapping meshes...","Material instances aren't updating at runtime when I change parameters..."],[])[0];return e.jsxs("div",{className:"problem-input-container",onPaste:m,children:[e.jsxs("div",{className:"problem-input-header",children:[e.jsxs("h2",{children:[e.jsx(Us,{size:22,className:"icon-inline"})," What's the problem?"]}),e.jsx("p",{className:"subtitle",children:"Describe your UE5 issue in plain English. We'll diagnose the root cause and teach you to fix it."})]}),e.jsxs("div",{className:"problem-input-field",children:[e.jsx("textarea",{value:i,onChange:O,onKeyDown:X,placeholder:ie,rows:5,disabled:a,"aria-label":"Problem description"}),e.jsxs("div",{className:"char-count",children:[i.length," characters",i.length<10&&i.length>0&&e.jsx("span",{className:"warning",children:" (minimum 10)"})]})]}),l.length>0&&e.jsxs("div",{className:"detected-tags",children:[e.jsxs("span",{className:"label",children:[e.jsx(it,{size:14,className:"icon-inline"})," Detected:"]}),e.jsx("div",{className:"tag-list",children:l.map(_=>e.jsxs("span",{className:"tag-chip",title:_.tag.description||_.tag.display_name,children:[_.tag.display_name,e.jsxs("span",{className:"confidence",children:[Math.round(_.confidence*100),"%"]})]},_.tag.tag_id))})]}),e.jsxs("div",{className:`screenshot-zone ${t.trim()?"has-image":""}`,onClick:()=>{t.trim()||document.getElementById("error-log-input")?.focus()},children:[t.trim()?e.jsxs("div",{className:"pasted-preview error-log-preview",children:[e.jsx("pre",{className:"error-log-display",children:t}),e.jsx("button",{type:"button",className:"clear-error-log",onClick:_=>{_.stopPropagation(),d("")},"aria-label":"Remove error log",title:"Clear error log",children:e.jsx(ls,{size:20})})]}):e.jsxs("div",{className:"drop-prompt",children:[e.jsx(ct,{size:20}),e.jsxs("span",{children:["Paste (",e.jsx("kbd",{children:"Ctrl+V"}),") an error log or build output"]})]}),e.jsx("textarea",{id:"error-log-input",className:"error-log-hidden-input",value:t,onChange:_=>d(_.target.value),onPaste:_=>{const S=_.clipboardData?.getData("text");S&&(_.preventDefault(),d(ds(S)))},rows:1})]}),e.jsx("div",{ref:y,className:`screenshot-zone ${f?"drag-over":""} ${o?"has-image":""}`,onDragOver:k,onDragLeave:I,onDrop:R,children:o?e.jsxs("div",{className:"pasted-preview",children:[e.jsx("img",{src:o,alt:"Pasted screenshot"}),e.jsx("button",{type:"button",className:"clear-error-log",onClick:()=>c(null),"aria-label":"Remove screenshot",title:"Remove screenshot",children:e.jsx(ls,{size:20})})]}):e.jsxs("div",{className:"drop-prompt",children:[e.jsx(rt,{size:20}),e.jsxs("span",{children:["Paste (",e.jsx("kbd",{children:"Ctrl+V"}),") or drag a screenshot here"]})]})}),n&&e.jsxs("div",{className:"persona-context",children:[e.jsxs("span",{className:"label",children:[e.jsx(dt,{size:14,className:"icon-inline"})," Context:"]}),e.jsx("span",{className:"persona-chip",children:n.name}),e.jsx("span",{className:"hint",children:"Recommendations will be tailored for you"})]}),e.jsxs("div",{className:"problem-input-actions",children:[e.jsx("button",{className:"submit-btn primary",onClick:()=>A(),disabled:i.trim().length<10||a,children:a?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner"})," Diagnosing..."]}):e.jsx(e.Fragment,{children:"Get Diagnosis ‚Üí"})}),e.jsxs("span",{className:"hint",children:["Press ",e.jsx("kbd",{children:"Ctrl"})," + ",e.jsx("kbd",{children:"Enter"})," to submit"]})]}),v.length>0&&e.jsxs("div",{className:"query-history",children:[e.jsx("span",{className:"history-label",children:"üïò Recent questions:"}),e.jsx("div",{className:"history-chips",children:v.map((_,S)=>{const N=_.query||_,W=_.cartId||null,B=!!W;return e.jsxs("div",{className:"history-chip-row",children:[e.jsxs("button",{type:"button",className:`history-chip ${B?"cached":""}`,onClick:()=>{u(N),O({target:{value:N}}),B&&!a&&setTimeout(()=>A(W,N),50)},title:B?`${N} (cached ‚Äî instant load)`:N,disabled:a,children:[B&&e.jsx("span",{className:"cache-indicator",children:"‚ö°"}),N.length>50?N.slice(0,50)+"‚Ä¶":N]}),e.jsx("button",{type:"button",className:"history-delete",onClick:()=>{b(H=>{const ee=H.filter((ce,oe)=>oe!==S);return localStorage.setItem("fix-problem-history",JSON.stringify(ee)),ee})},title:"Remove",children:"√ó"})]},S)})})]})]})}Ye.propTypes={onSubmit:h.func.isRequired,detectedPersona:h.shape({id:h.string,name:h.string,emoji:h.string}),isLoading:h.bool};Ye.defaultProps={detectedPersona:null,isLoading:!1};const _s={},ws={};(Ys.courses||[]).forEach(s=>{_s[s.code]=s.title,ws[s.code]=s.versions||[]});function ht(s){const n=ws[s];return!n||n.length===0?!1:n.every(a=>{const i=String(a).replace(/^V/i,"");return i.startsWith("4")&&!i.startsWith("4.")?/^4\d{1,2}$/.test(i):i.startsWith("4.")})}function mt(s){if(!s||s<=0)return"";const n=Math.round(s/60);return n<1?"<1 min":`${n} min`}function Qe({video:s,isAdded:n,onToggle:a,userQuery:i}){const{title:u,duration:l,driveId:r,courseCode:o,_curatedMatch:c,role:t,reason:d,matchPercent:f,matchReason:x,watchHint:y}=s,v=f>=100?"best":f>=70?"strong":f>=40?"good":"related",b=f>=100?"Best Match":f>=70?"Strong Match":f>=40?"Good Match":"Related",O=u?.replace(/\s+(?:Part\s+[A-Z]|PT\s*\d+)$/i,"").trim()||u,m=o?Qs[o]:null,k=m?.prereqs||[],[I,R]=j.useState(()=>Vs(r)),[$,A]=j.useState(!1),X=j.useRef(null),Q=j.useRef(null);j.useEffect(()=>{if(!$)return;const N=W=>{X.current&&!X.current.contains(W.target)&&A(!1)};return document.addEventListener("mousedown",N),()=>document.removeEventListener("mousedown",N)},[$]);const ie=N=>{N.stopPropagation(),zs(r,i||""),R("up")},_=N=>{N.stopPropagation(),Gs(r,i||""),R("down")},S=r?`https://drive.google.com/thumbnail?id=${r}&sz=w320`:null;return e.jsx("div",{ref:Q,className:`video-result-card ${n?"added":""} ${c?"curated":""} ${I==="down"?"demoted":""}`,role:"button",tabIndex:0,children:e.jsxs("div",{className:"vrc-compact",children:[e.jsxs("div",{className:"vrc-thumbnail",children:[S?e.jsx("img",{src:S,alt:O,onError:N=>{N.target.style.display="none",N.target.nextSibling.style.display="flex"}}):null,e.jsx("div",{className:"vrc-thumb-fallback",style:{display:S?"none":"flex"},children:e.jsx("span",{className:"vrc-play-icon",children:e.jsx(st,{size:24})})}),l>0&&e.jsx("span",{className:"vrc-duration",children:mt(l)})]}),e.jsxs("div",{className:"vrc-badge-row",children:[f!=null&&e.jsxs("span",{className:`vrc-match-badge vrc-match-${v}`,title:`${f}% match`,children:[e.jsx("span",{className:"vrc-match-dot"}),b]}),c&&e.jsx("span",{className:"vrc-curated-badge",children:"‚úì Solution"}),t&&t!=="core"&&e.jsxs("div",{className:"vrc-role-wrapper",ref:t==="prerequisite"?X:null,children:[e.jsxs("button",{className:`vrc-role-badge vrc-role-${t} ${t==="prerequisite"?"vrc-role-clickable":""}`,onClick:N=>{N.stopPropagation(),t==="prerequisite"&&A(W=>!W)},title:t==="prerequisite"?"Click to see why this is a prerequisite":void 0,children:[t==="prerequisite"&&"üîó Prerequisite",t==="troubleshooting"&&"üîß Troubleshooting",t==="supplemental"&&"üìö Supplemental"]}),$&&t==="prerequisite"&&e.jsxs("div",{className:"vrc-prereq-tooltip",children:[e.jsx("strong",{children:"Prerequisite Course"}),k.length>0?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"Watch these first:"}),e.jsx("ul",{className:"vrc-prereq-list",children:k.map(N=>e.jsxs("li",{children:["üìò ",_s[N]||N,m?.reasons?.[N]&&e.jsxs("span",{className:"vrc-prereq-why",children:[" ‚Äî ",m.reasons[N]]})]},N))})]}):e.jsx("p",{children:"Watch this first ‚Äî it covers foundational concepts needed before advancing."}),d&&e.jsx("p",{className:"vrc-tip-reason",children:d})]})]}),o&&ht(o)&&e.jsx("span",{className:"vrc-ue4-badge",title:"This content was created for Unreal Engine 4 ‚Äî some details may differ in UE5",children:"‚ö†Ô∏è UE4"})]}),e.jsxs("div",{className:"vrc-info",children:[e.jsx("h4",{className:"vrc-title",children:O}),y&&y!=="‚ñ∂ Watch full video"&&e.jsx("p",{className:"vrc-timestamp-hint",children:y}),x&&e.jsx("p",{className:"vrc-match-reason",children:x})]}),e.jsxs("div",{className:"vrc-actions",children:[e.jsxs("div",{className:"vrc-feedback",children:[e.jsx("button",{className:`vrc-fb-btn ${I==="up"?"active-up":""}`,onClick:ie,"aria-label":"Helpful",title:"This was helpful",children:e.jsx("span",{className:"vrc-fb-emoji",children:"üëç"})}),e.jsx("button",{className:`vrc-fb-btn ${I==="down"?"active-down":""}`,onClick:_,"aria-label":"Not helpful",title:"Not relevant",children:e.jsx("span",{className:"vrc-fb-emoji",children:"üëé"})})]}),e.jsx("button",{className:`vrc-add-btn ${n?"vrc-added":""}`,onClick:N=>{N.stopPropagation(),a(s)},"aria-label":n?"Remove from playlist":"Add to playlist",children:n?e.jsxs(e.Fragment,{children:[e.jsx(Zs,{size:14})," Added"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ws,{size:14})," Add"]})})]})]})})}Qe.propTypes={video:h.shape({driveId:h.string,title:h.string.isRequired,courseName:h.string,duration:h.number,matchedTags:h.arrayOf(h.string),courseCode:h.string,topSegments:h.array,docLinks:h.array,_curatedMatch:h.bool,role:h.oneOf(["prerequisite","core","troubleshooting","supplemental"]),reason:h.string,estimatedMinutes:h.number}).isRequired,isAdded:h.bool,onToggle:h.func.isRequired,userQuery:h.string};function us(s){const n=Math.round(s/60);if(n<1)return"<1 min";if(n>=60){const a=Math.floor(n/60),i=n%60;return i>0?`${a}h ${i}m`:`${a}h`}return`${n} min`}const pt={video:"üì∫",doc:"üìñ",youtube:"‚ñ∂Ô∏è"};function Ns({cart:s,onRemove:n,onClear:a,onWatchPath:i}){const u=s.reduce((t,d)=>t+(d.duration||(d.readTimeMinutes||d.durationMinutes||0)*60),0),l=s.filter(t=>(t.type||"video")==="video").length,r=s.filter(t=>t.type==="doc").length,o=s.filter(t=>t.type==="youtube").length,c=[];return l>0&&c.push(`${l} video${l!==1?"s":""}`),r>0&&c.push(`${r} doc${r!==1?"s":""}`),o>0&&c.push(`${o} YT`),e.jsxs("div",{className:"cart-panel",children:[e.jsxs("div",{className:"cart-header",children:[e.jsx("h3",{className:"cart-title",children:"üõí My Learning Path"}),s.length>0&&e.jsx("button",{className:"cart-clear-btn",onClick:a,title:"Clear all",children:"Clear"})]}),s.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cart-stats",children:[e.jsx("span",{className:"cart-stat-count",children:c.join(" ¬∑ ")}),e.jsx("span",{className:"cart-stat-dot",children:"¬∑"}),e.jsx("span",{className:"cart-stat-time",children:us(u)})]}),u>28800&&e.jsx("div",{className:"cart-warning",children:"‚ö†Ô∏è That's over 8 hours of content ‚Äî consider narrowing your focus to the most relevant items."}),e.jsx("div",{className:"cart-items",children:s.map((t,d)=>{const f=t.itemId||t.driveId||d,x=t.type||"video",y=pt[x]||"üì∫",v=x==="video"?Ee(t.title):t.title,b=t.duration>0?us(t.duration):t.readTimeMinutes?`${t.readTimeMinutes} min read`:t.durationMinutes?`${t.durationMinutes} min`:null;return e.jsxs("div",{className:`cart-item cart-item-${x}`,children:[e.jsx("span",{className:"cart-item-num",children:d+1}),e.jsx("span",{className:"cart-item-icon",title:x,children:y}),e.jsxs("div",{className:"cart-item-info",children:[e.jsx("span",{className:"cart-item-title",children:v}),b&&e.jsx("span",{className:"cart-item-dur",children:b})]}),e.jsx("button",{className:"cart-item-remove",onClick:()=>n(f),"aria-label":`Remove ${t.title}`,children:"√ó"})]},f)})}),e.jsx("button",{className:"cart-watch-btn",onClick:i,children:"‚ñ∂ Watch Path"})]}):e.jsxs("div",{className:"cart-empty",children:[e.jsx("span",{className:"cart-empty-icon",children:"üì∫"}),e.jsx("p",{children:"Add videos, docs, and resources to build your learning path"})]})]})}Ns.propTypes={cart:h.arrayOf(h.shape({itemId:h.string,driveId:h.string,type:h.oneOf(["video","doc","youtube"]),title:h.string.isRequired,duration:h.number,readTimeMinutes:h.number,durationMinutes:h.number})).isRequired,onRemove:h.func.isRequired,onClear:h.func.isRequired,onWatchPath:h.func.isRequired};const Ss="ue5_video_cart";function gt(){try{const s=localStorage.getItem(Ss);return s?JSON.parse(s):[]}catch{return[]}}function qe(s){try{localStorage.setItem(Ss,JSON.stringify(s))}catch{}}function Te(s){return s.itemId||s.driveId||s.id||`${s.type}_${s.url}`}function ft(){const[s,n]=j.useState(gt),a=j.useCallback(t=>{n(d=>{const f=Te(t);if(d.some(v=>Te(v)===f))return d;const x={...t,itemId:f,type:t.type||"video"},y=[...d,x];return qe(y),y})},[]),i=j.useCallback(t=>{n(d=>{const f=d.filter(x=>Te(x)!==t&&x.driveId!==t);return qe(f),f})},[]),u=j.useCallback(()=>{n([]),qe([])},[]),l=j.useCallback(t=>s.some(d=>Te(d)===t||d.driveId===t),[s]),r=s.filter(t=>(t.type||"video")==="video").length,o=j.useMemo(()=>s.reduce((t,d)=>t+(d.duration||(d.readTimeMinutes||d.durationMinutes||0)*60),0),[s]),c=j.useMemo(()=>{const t={video:[],doc:[],youtube:[]};for(const d of s){const f=d.type||"video";(t[f]||t.video).push(d)}return t},[s]);return{cart:s,addToCart:a,removeFromCart:i,clearCart:u,isInCart:l,videoCount:r,totalDuration:o,itemsByType:c}}let De=null;async function xt(){if(!De){const s=await be(()=>import("./data-embeddings-EsTyY_EC.js"),[]);De=s.default||s}return De}function Je(s,n){if(!s||!n||s.length!==n.length)return 0;let a=0,i=0,u=0;for(let r=0;r<s.length;r++)a+=s[r]*n[r],i+=s[r]*s[r],u+=n[r]*n[r];const l=Math.sqrt(i)*Math.sqrt(u);return l===0?0:a/l}async function yt(s,n=5,a=.3){const i=await xt();if(!s||!i?.courses)return[];const u=[];for(const[l,r]of Object.entries(i.courses)){const o=Je(s,r.embedding);o>=a&&u.push({code:l,title:r.title,similarity:o})}return u.sort((l,r)=>r.similarity-l.similarity),u.slice(0,n)}let Fe=null,Ue=null;async function vt(){if(!Fe){const s=await be(()=>import("./data-search-SjqZFhcO.js").then(n=>n.s),[]);Fe=s.default||s}return Fe}async function Xe(){if(!Ue){const s=await be(()=>import("./data-search-SjqZFhcO.js").then(n=>n.a),[]);Ue=s.default||s}return Ue}let We=null,ye=null;function bt(s,n=768){const a=atob(s),i=new Uint8Array(a.length);for(let r=0;r<a.length;r++)i[r]=a.charCodeAt(r);const u=new DataView(i.buffer),l=new Float32Array(n);for(let r=0;r<n;r++){const o=u.getUint16(r*2,!0);l[r]=jt(o)}return l}function jt(s){const n=s>>15&1,a=s>>10&31,i=s&1023;return a===0?(n?-1:1)*Math.pow(2,-14)*(i/1024):a===31?i?NaN:n?-1/0:1/0:(n?-1:1)*Math.pow(2,a-15)*(1+i/1024)}async function _t(){if(ye)return ye;if(!We)try{const n=await fetch(new URL("../data/segment_embeddings.json",import.meta.url));if(!n.ok)throw new Error(`HTTP ${n.status}`);We=await n.json()}catch(n){return ne("‚ö†Ô∏è segment_embeddings.json not available:",n.message),null}const s=We?.segments;if(!s)return null;ye=new Map;for(const[n,a]of Object.entries(s))ye.set(n,{vector:bt(a.embedding),courseCode:a.course_code,videoKey:a.video_key,videoTitle:a.video_title,startTimestamp:a.start_timestamp,endTimestamp:a.end_timestamp,startSeconds:a.start_seconds,text:a.text,tokenEstimate:a.token_estimate});return G(`[SegmentSearch] Decoded ${ye.size} segment embeddings`),ye}async function Cs(s,n=[]){if(!s||s.length<3)return[];const a=s.toLowerCase().split(/\s+/).filter(r=>r.length>2&&!Le.has(r));if(a.length===0)return[];const i=await vt(),u=[],l=i?.course_words||{};for(const[r,o]of Object.entries(l)){let c=0;const t=[];for(const d of a)if(o[d]&&(c+=o[d]*10,t.push(d)),d.length>=4)for(const[f,x]of Object.entries(o))f!==d&&f.length>=4&&(f.startsWith(d)||d.startsWith(f))&&(c+=x*3,t.includes(f)||t.push(f));if(c>=30&&t.length>0){const d=n.find(x=>x.code===r),f=await wt(r,t);u.push({courseCode:r,courseTitle:d?.title||r,score:c,matchedKeywords:t,topSegments:f,estimatedSegment:f.length>0?f[0]:null,videoCount:d?.video_count||0,duration:d?.duration_formatted||"Unknown"})}}return u.sort((r,o)=>o.score-r.score).slice(0,5)}async function wt(s,n){const i=(await Xe())[s];if(!i||!i.videos)return[];const u=[];for(const[l,r]of Object.entries(i.videos))if(r.segments)for(const o of r.segments){const c=o.text.toLowerCase();let t=0;const d=[];for(const f of n){const x=f.toLowerCase(),y=new RegExp(x.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi"),v=c.match(y);v&&(t+=v.length*10,d.push(f)),c.includes(x)&&(t+=5,d.includes(f)||d.push(f))}if(t>0){let f=o.text;if(f.length>120){const x=d[0]||"",y=f.toLowerCase().indexOf(x.toLowerCase());y>40&&(f="..."+f.substring(y-30)),f.length>120&&(f=f.substring(0,117)+"...")}u.push({videoKey:l,videoTitle:r.title,timestamp:o.start,startSeconds:o.start_seconds,endTimestamp:o.end,previewText:f,matchedKeywords:d,score:t})}}return u.sort((l,r)=>r.score-l.score).slice(0,3)}async function Nt(s,n=10,a=.35){if(!s)return[];const i=await _t();if(!i)return[];const u=[];for(const[r,o]of i){const c=Je(s,o.vector);c>=a&&u.push({id:r,courseCode:o.courseCode,videoKey:o.videoKey,videoTitle:o.videoTitle,timestamp:o.startTimestamp,endTimestamp:o.endTimestamp,startSeconds:o.startSeconds,previewText:o.text,similarity:c,source:"transcript"})}u.sort((r,o)=>o.similarity-r.similarity);const l=u.slice(0,n);if(l.length>0){const r=new Map;for(const[o,c]of i){const t=`${c.courseCode}:${c.videoKey}`;r.has(t)||r.set(t,[]),r.get(t).push({id:o,text:c.text,startSeconds:c.startSeconds})}for(const o of r.values())o.sort((c,t)=>c.startSeconds-t.startSeconds);for(const o of l){const c=`${o.courseCode}:${o.videoKey}`,t=r.get(c);if(!t)continue;const d=t.findIndex(y=>y.id===o.id);if(d===-1)continue;let f="";if(d>0){const v=(t[d-1].text||"").split(/[.!?]+\s*/);f=v[v.length-1]?.trim()||""}let x="";if(d<t.length-1&&(x=(t[d+1].text||"").split(/[.!?]+\s*/)[0]?.trim()||""),f||x){const y=[];f&&y.push("..."+f),y.push(o.previewText),x&&y.push(x+"..."),o.previewText=y.join(" ")}}}return l}async function hs(s,n,a=[],i=8){const u=await Cs(s,a);let l=[];n&&(l=await Nt(n,i,.35));const r=new Set,o=[];for(const c of l){const t=`${c.courseCode}:${c.videoKey}:${c.timestamp}`;r.has(t)||(r.add(t),o.push({...c,searchType:"semantic",score:Math.round(c.similarity*100)}))}for(const c of u)for(const t of c.topSegments||[]){const d=`${c.courseCode}:${t.videoKey}:${t.timestamp}`;r.has(d)||(r.add(d),o.push({id:`kw_${c.courseCode}_${t.videoKey}`,courseCode:c.courseCode,videoKey:t.videoKey,videoTitle:t.videoTitle,timestamp:t.timestamp,startSeconds:t.startSeconds,previewText:t.previewText,similarity:0,score:t.score,searchType:"keyword",source:"transcript"}))}return o.slice(0,i)}const St=60,Ct=new Set(["rendering.lumen","rendering.nanite","rendering.virtualShadowMaps","rendering.substrate","worldbuilding.worldPartition"]);function Ne(s){return!!(s.videos?.length&&s.videos[0]?.drive_id||s.source==="youtube"&&s.youtube_url||s.source==="epic_docs")}function Tt(s){const n=(s||"").toLowerCase();return/\bue\s*5\b|\bunreal\s*engine\s*5\b|\b5\.\d\b/.test(n)?5:/\bue\s*4\b|\bunreal\s*engine\s*4\b|\b4\.\d{1,2}\b/.test(n)?4:null}async function ms(s,n,a=[],i="",u=[],l=null){if(!n||n.length===0)return[];const r=s?.userQuery||"",o=r.toLowerCase();for(const g of Js)if(g.patterns.some(T=>o.includes(T))){const T=g.courses.map(D=>{const Y=n.find(w=>w.code===D);return!Y||!Ne(Y)?null:{...Y,_relevanceScore:200,_curatedMatch:!0,_curatedExplanation:g.explanation}}).filter(Boolean);if(T.length>0)return G("‚úÖ Curated solution match:",g.explanation),T}const c=`${r} ${i}`.trim(),t=fe.matchErrorSignature(c),d=t.map(g=>g.tag.tag_id),f=[...new Set([...a,...d])];t.length>0&&G("üîç Error signatures detected:",t.map(g=>`${g.tag.display_name} (${g.matchedSignature}, ${g.confidence})`));const x=fe.extractTagsFromText(r),y=x.matchedTagIds||[];if(y.length>0){G("üè∑Ô∏è Tag taxonomy matches:",x.matches.map(g=>`${g.tagId} (via "${g.matchedTerm}", ${g.matchType})`));for(const g of y)f.includes(g)||f.push(g)}const v=i.toLowerCase().split(/[\s\n:;,()[\]{}]+/).filter(g=>g.length>3&&!/^[0-9]+$/.test(g)).slice(0,10),b=r.toLowerCase().split(/\s+/).filter(g=>g.length>2&&!Le.has(g)),O=new Set(b),m=r.toLowerCase();for(const[g,C]of Object.entries(Xs))if(m.includes(g))for(const T of C)T.split(/\s+/).forEach(D=>{D.length>2&&!Le.has(D)&&O.add(D)});const k=[...O],I=async g=>!g||g.length<5?[]:(await Cs(g,n)).map(T=>{const D=n.find(Y=>Y.code===T.courseCode);return!D||!Ne(D)?null:{...D,_relevanceScore:T.score,_matchedKeywords:T.matchedKeywords}}).filter(Boolean),R=g=>g.length===0?[]:n.filter(Ne).map(T=>{const D=(T.title||"").toLowerCase(),Y=(T.description||"").toLowerCase(),w=[...T.canonical_tags||[],...T.gemini_system_tags||[],...T.extracted_tags||[],...T.ai_tags||[]].map(V=>typeof V=="string"?V.toLowerCase():"").join(" ");let L=0;const P=[];for(const V of g)D.includes(V)?(L+=50,P.push(V)):w.includes(V)?(L+=30,P.push(V)):Y.includes(V)&&(L+=10,P.push(V));if(y.length>0){const V=(T.canonical_tags||[]).map(he=>he.toLowerCase());y.some(he=>V.some(Ae=>Ae.includes(he.split(".").pop())))&&(L*=3)}const Z=new Set(P).size;Z>=2&&(L*=1+Z*.3);const re=g.length>0?Z/g.length:1;return g.length>=2&&re<.5?L*=.3:re>=1&&(L*=2),L===0?null:{...T,_relevanceScore:L,_matchedKeywords:P}}).filter(Boolean).sort((T,D)=>D._relevanceScore-T._relevanceScore),$=g=>f.length===0?g:g.map(C=>{const T=C.extracted_tags||C.tags||[],w=(Array.isArray(T)?T:Object.values(T)).map(L=>typeof L=="string"?L:L.tag_id||L.name||"").filter(Boolean).some(L=>f.some(P=>L.toLowerCase().includes(P.toLowerCase())||P.toLowerCase().includes(L.toLowerCase())));return{...C,_relevanceScore:w?C._relevanceScore*2:C._relevanceScore*.5}}).sort((C,T)=>T._relevanceScore-C._relevanceScore),A=v.length>0?`${r} ${v.join(" ")}`:r,X=await I(A),Q=v.length>0?[...k,...v]:k,ie=R(Q),_=new Set,S=[];for(const g of X)_.has(g.code)||(S.push(g),_.add(g.code));for(const g of ie)if(!_.has(g.code))S.push(g),_.add(g.code);else{const C=S.find(T=>T.code===g.code);C&&(C._relevanceScore+=g._relevanceScore)}const W=(S.length>0?S[0]._relevanceScore:0)>=St;if(u.length>0){const g=W?60:100,C=W?20:40;for(const T of u)if(_.has(T.code)){const D=S.find(Y=>Y.code===T.code);D&&(D._relevanceScore+=T.similarity*C)}else{const D=n.find(Y=>Y.code===T.code);D&&Ne(D)&&(S.push({...D,_relevanceScore:T.similarity*g,_matchedKeywords:["semantic-match"],_semanticMatch:!0,_tier:W?2:1}),_.add(T.code))}}S.sort((g,C)=>C._relevanceScore-g._relevanceScore);const B=$(S);if(B.length>=3)return Be(Ve(B.slice(0,5),r),l);const ee=[A,s?.diagnosis?.problem_summary,...s?.intent?.systems||[]].filter(Boolean).join(" "),ce=ee.toLowerCase().split(/\s+/).filter(g=>g.length>2&&!Le.has(g)),oe=await I(ee),J=R(ce);for(const g of[...oe,...J])_.has(g.code)||(S.push(g),_.add(g.code));S.sort((g,C)=>C._relevanceScore-g._relevanceScore);const xe=$(S);if(xe.length>=3)return Be(Ve(xe.slice(0,5),r),l);const E=n.map(g=>{const C=fe.scoreCourseRelevance(g,Q);return{...g,_relevanceScore:C.score,_scoreBreakdown:C.breakdown,_topContributors:C.topContributors}}).filter(g=>g._relevanceScore>0&&Ne(g)).sort((g,C)=>C._relevanceScore-g._relevanceScore).slice(0,5);return Be(Ve($(E),r),l)}function Be(s,n){return!n||n.size===0?s:s.map(a=>{const i=n.get(a.code);return i?(G(`üìä Feedback boost: ${a.code} √ó ${i.toFixed(2)}`),{...a,_relevanceScore:a._relevanceScore*i}):a}).sort((a,i)=>i._relevanceScore-a._relevanceScore)}function Ve(s,n){const a=Tt(n);return a?s.map(i=>{const l=[...i.canonical_tags||[],...i.gemini_system_tags||[],...i.extracted_tags||[]].map(r=>typeof r=="string"?r.toLowerCase():"").some(r=>[...Ct].some(o=>r.includes(o.split(".").pop())));return a===4&&l?(G(`‚¨áÔ∏è UE4 demotion: ${i.code} (has UE5-only tags)`),{...i,_relevanceScore:i._relevanceScore*.2}):a===5&&l?{...i,_relevanceScore:i._relevanceScore*1.5}:i}).sort((i,u)=>u._relevanceScore-i._relevanceScore):s}let ze=null;async function kt(){if(!ze){const s=await be(()=>import("./data-courses-Y_tFOtPD.js").then(n=>n.j),[]);ze=s.default||s}return ze}const Ge=new Set(["help","helpful","helps","use","used","using","make","made","get","getting","look","going","come","know","thing","work","working","want","need","show","start","take","right","well"]);function ps(s){return s.replace(/ies$/i,"y").replace(/ves$/i,"f").replace(/(s|es|ing|ed|tion|ment)$/i,"").toLowerCase()}function It(s,n){const i=n.replace(/[-_]/g," ").split(/\s+/).filter(l=>l.length>2).map(ps);return s.map(ps).some(l=>i.some(r=>l.includes(r)||r.includes(l)))}async function gs(s,n,a={}){const i=[],u=(n||"").toLowerCase().split(/\s+/).filter(m=>m.length>2),l=await kt(),r=[],o=(n||"").toLowerCase(),c=o.split(/\s+/).filter(m=>m.length>2);for(const[m,k]of Object.entries(l))(o.includes(m)||It(c,m))&&r.push({label:k.label,url:k.url});for(const m of s){if(m.source==="youtube"&&m.youtube_url){const I=a[m.code]||{},R=(()=>{const $=(m._matchedKeywords||[]).filter(A=>A.length>3&&!Ge.has(A.toLowerCase())).slice(0,3);return $.length>0?$:[m.topic||m.tags?.topic||"UE5"].flat().slice(0,3)})();i.push({driveId:m.youtube_url,title:Ee(m.title||m.code),duration:m.duration_seconds||0,courseCode:m.code,courseName:m.title||m.code,matchedTags:R,videoIndex:0,relevanceScore:m._relevanceScore||0,titleRelevance:0,isIntro:!1,timestampHint:null,startSeconds:0,topSegments:[],watchHint:"‚ñ∂ Watch on YouTube",docLinks:r,_curatedMatch:m._curatedMatch||!1,_curatedExplanation:m._curatedExplanation||null,role:I.role||null,reason:I.reason||null,estimatedMinutes:I.estimatedMinutes||null,_source:"youtube",_externalUrl:m.youtube_url,type:"youtube",url:m.youtube_url,channel:m.channel_name||m.channel||null,channelTrust:m.channel_trust||null,topics:m.topics||[],description:m.description||"",durationMinutes:m.duration_seconds?Math.round(m.duration_seconds/60):10});continue}if(m.source==="epic_docs"){const I=m.url||m.youtube_url||"#",R=a[m.code]||{},$=(()=>{const A=(m._matchedKeywords||[]).filter(X=>X.length>3&&!Ge.has(X.toLowerCase())).slice(0,3);return A.length>0?A:[m.topic||m.tags?.topic||"UE5"].flat().slice(0,3)})();i.push({driveId:`doc_${m.code}`,title:Ee(m.title||m.code),duration:0,courseCode:m.code,courseName:m.title||m.code,matchedTags:$,videoIndex:0,relevanceScore:m._relevanceScore||0,titleRelevance:0,isIntro:!1,timestampHint:null,startSeconds:0,topSegments:[],watchHint:"üìñ Read Epic Docs",docLinks:[{label:m.title||"Epic Docs",url:I},...r],_curatedMatch:m._curatedMatch||!1,_curatedExplanation:m._curatedExplanation||null,role:R.role||null,reason:R.reason||null,estimatedMinutes:R.estimatedMinutes||null,_source:"epic_docs",_externalUrl:I,type:"doc",url:I,topics:m.topics||[],description:m.description||"",readTimeMinutes:10});continue}const k=m.videos||[];if(k.length!==0)for(let I=0;I<k.length;I++){const R=k[I];if(!R.drive_id)continue;const $=R.title||R.name||`Video ${I+1}`,A=$.toLowerCase(),X=Ee($),Q=u.filter(V=>A.includes(V)).length,ie=Q*50,_=await Rt(m.code,$,I),S=await Mt(m.code,_,u),N=A.includes("intro")||A.includes("introduction")||A.includes("wrap up")||A.includes("outro")||A.includes("overview")||A.includes("getting started")||A.includes("welcome")||A.includes("course intro")||A.includes("what you'll learn")||A.includes("what we'll cover")||A.includes("summary")||A.includes("objectives")||/\bpart\s*a\b/i.test($)&&I===0,W=N?.15:1,B=!N&&S.topSegments&&S.topSegments.length>0?15:0,H=R.duration_seconds||R.durationSeconds||0,ee=H/60,ce=ee<2?.4:ee<5?.7:ee>20?1.1:1,oe=new Set;for(const V of S.topSegments||[])for(const te of V.matchedKeywords||[])oe.add(te);const J=oe.size,xe=Q>=2||Q===1&&J>=1?1:J>=2?.8:J===1?.3:Q===1?.5:.15,p=(m._relevanceScore||0)*xe,E=(ie+S.score+B+p)*W*ce,C=Q===0&&S.score<30?Math.min(E,40):E,T=Ks(R.drive_id,C);let D="‚ñ∂ Watch full video";const w=(S.topSegments||[]).filter(V=>!H||V.startSeconds<=H)[0]||(S.bestSegment&&(!H||S.bestSegment.startSeconds<=H)?S.bestSegment:null);if(w){const V=w.timestamp||"0:00",te=w.previewText,he=te.length>60?te.substring(0,57)+"...":te;D=w.startSeconds<5?`üìç Start of video ‚Äî "${he}"`:`üìç Jump to ${V} ‚Äî "${he}"`}const L=a[m.code]||{},P=(()=>{const V=(m._matchedKeywords||[]).filter(te=>te.length>3&&!Ge.has(te.toLowerCase())).slice(0,3);return V.length>0?V:[m.topic||m.tags?.topic||"UE5"].flat().slice(0,3)})(),Z=S.bestSegment?.startSeconds||0,re=H&&Z>H?0:Z;i.push({driveId:R.drive_id,title:X,duration:R.duration_seconds||0,courseCode:m.code,courseName:m.title||m.code,matchedTags:P,videoIndex:I,relevanceScore:T,titleRelevance:Q,isIntro:N,timestampHint:re>0&&S.bestSegment?.timestamp||null,startSeconds:re,topSegments:S.topSegments||[],watchHint:D,docLinks:r,_curatedMatch:m._curatedMatch||!1,_curatedExplanation:m._curatedExplanation||null,role:L.role||null,reason:L.reason||null,estimatedMinutes:L.estimatedMinutes||null})}}const t=new Map;for(const m of i){const k=t.get(m.driveId);(!k||m.relevanceScore>k.relevanceScore)&&t.set(m.driveId,m)}const d=Array.from(t.values());d.sort((m,k)=>k.relevanceScore-m.relevanceScore);const f=new Map,x=2,y=d.filter(m=>{const k=f.get(m.courseCode)||0;return k>=x?!1:(f.set(m.courseCode,k+1),!0)}),v=new Set;for(const m of y)m.isIntro||v.add(m.courseCode);const b=y.filter(m=>!(m.isIntro&&v.has(m.courseCode)));if(b.length>3){const m=b.map($=>$.relevanceScore),k=m[Math.floor(m.length/2)],I=Math.max(k*.5,10),R=b.filter($=>$.relevanceScore>=I);if(R.length>=3){const $=R.slice(0,6);return fs($,u),$}}const O=b.slice(0,6);return fs(O,u),O}function fs(s,n){if(s.length===0)return;const a=Math.max(s[0].relevanceScore,1);for(const i of s){i.matchPercent=Math.min(100,Math.round(i.relevanceScore/a*100));const u=[];if(i._curatedMatch&&u.push("Known solution for this problem"),i.titleRelevance>0){const l=n.filter(r=>(i.title||"").toLowerCase().includes(r)).slice(0,3);l.length>0&&u.push(`Title matches: ${l.join(", ")}`)}if(i.topSegments.length>0){const l=new Set;for(const o of i.topSegments)for(const c of o.matchedKeywords||[])l.add(c);const r=[...l].slice(0,4);r.length>0&&u.push(`Transcript mentions: ${r.join(", ")}`)}i.matchedTags.length>0&&u.length<2&&u.push(`Tagged: ${i.matchedTags.slice(0,3).join(", ")}`),i.matchReason=u.length>0?u.join(" ¬∑ "):"Related to your query"}}async function Rt(s,n,a){const u=(await Xe())[s];if(!u?.videos)return null;const l=f=>(f||"").toLowerCase().replace(/\.mp4$/i,"").replace(/_/g," ").replace(/\s+/g," ").trim(),r=l(n),o=r.split(" ").filter(f=>f.length>2),c=Object.keys(u.videos);for(const f of c)if(l(u.videos[f].title||"")===r)return f;let t=null,d=0;for(const f of c){const x=l(u.videos[f].title||""),y=l(f),v=x+" "+y;let b=0;for(const O of o)new RegExp(`(^|\\s|_)${O.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&")}(\\s|_|$)`,"i").test(v)&&b++;b>0&&b>d&&(d=b,t=f)}if(t&&d>=Math.max(1,o.length*.5))return t;for(const f of c){const x=l(u.videos[f].title||""),y=l(f);if(r.includes(x)||x.includes(r)||r.includes(y)||y.includes(r))return f}return a<c.length?c[a]:c[0]||null}async function Mt(s,n,a){const i={score:0,bestSegment:null,topSegments:[]},l=(await Xe())[s];if(!l?.videos||!n)return i;const r=l.videos[n];if(!r?.segments)return i;const o=[];for(const d of r.segments){const f=d.text.toLowerCase();let x=0;const y=[];for(const v of a)if(f.includes(v)){const b=f.split(v).length-1;x+=b*10,y.push(v)}if(x>0){let v=d.text;if(v.length>100){const b=v.toLowerCase().indexOf(y[0]||"");b>30&&(v="..."+v.substring(b-20)),v.length>100&&(v=v.substring(0,97)+"...")}o.push({timestamp:d.start,startSeconds:d.start_seconds,previewText:v,matchedKeywords:y,score:x})}}o.sort((d,f)=>f.score-d.score);const c=o.slice(0,3);return{score:o.reduce((d,f)=>d+f.score,0),bestSegment:c[0]||null,topSegments:c}}let Ke=null,ve=null;function Et(s,n=768){const a=atob(s),i=new Uint8Array(a.length);for(let r=0;r<a.length;r++)i[r]=a.charCodeAt(r);const u=new DataView(i.buffer),l=new Float32Array(n);for(let r=0;r<n;r++){const o=u.getUint16(r*2,!0);l[r]=Lt(o)}return l}function Lt(s){const n=s>>15&1,a=s>>10&31,i=s&1023;return a===0?(n?-1:1)*Math.pow(2,-14)*(i/1024):a===31?i?NaN:n?-1/0:1/0:(n?-1:1)*Math.pow(2,a-15)*(1+i/1024)}async function $t(){if(ve)return ve;if(!Ke)try{const n=await fetch(new URL("../data/docs_embeddings.json",import.meta.url));if(!n.ok)throw new Error(`HTTP ${n.status}`);Ke=await n.json()}catch(n){return ne("‚ö†Ô∏è docs_embeddings.json not available:",n.message),null}const s=Ke?.docs;if(!s)return null;ve=new Map;for(const[n,a]of Object.entries(s)){let i;if(typeof a.embedding=="string")i=Et(a.embedding);else if(Array.isArray(a.embedding))i=new Float32Array(a.embedding);else{ne(`[DocsSearch] Skipping doc ${n}: unknown embedding format (${typeof a.embedding})`);continue}ve.set(n,{vector:i,slug:a.slug,url:a.url,title:a.title,section:a.section,text:a.text,tokenEstimate:a.token_estimate})}return G(`[DocsSearch] Decoded ${ve.size} doc embeddings`),ve}async function At(s,n=5,a=.35){if(!s)return[];const i=await $t();if(!i)return[];const u=[];for(const[l,r]of i){const o=Je(s,r.vector);o>=a&&u.push({id:l,slug:r.slug,url:r.url,title:r.title,section:r.section,previewText:r.text,similarity:o,source:"epic_docs"})}return u.sort((l,r)=>r.similarity-l.similarity),u.slice(0,n)}let ke=null;async function Ts(){if(ke)return ke;try{const s=await be(()=>import("./data-courses-Y_tFOtPD.js").then(n=>n.j),[]);return ke=s.default||s,ke}catch(s){return ne("‚ö†Ô∏è doc_links.json not available:",s.message),{}}}const Ie={beginner:0,intermediate:1,advanced:2};function xs(s){return s.replace(/ies$/i,"y").replace(/ves$/i,"f").replace(/(es|s|ing|ed|tion|ment)$/i,"").toLowerCase()}function Re(s,n){const a=s.split(/[\s_-]+/).filter(u=>u.length>2).map(xs),i=n.split(/[\s_-]+/).filter(u=>u.length>2).map(xs);return a.some(u=>i.some(l=>u===l||u.includes(l)||l.includes(u)))}async function ks(s,{maxTier:n="advanced",limit:a=10}={}){const i=await Ts();if(!i||!s?.length)return[];const u=Ie[n]??2,l=s.map(t=>t.toLowerCase()),r=[];for(const[t,d]of Object.entries(i)){if((Ie[d.tier]??1)>u)continue;let x=0;const y=t.toLowerCase(),v=(d.label||"").toLowerCase(),b=(d.url||"").split("/").pop().replace(/-/g," ").toLowerCase(),O=(d.tags||[]).map(I=>I.toLowerCase()),m=(d.description||"").toLowerCase();let k=0;for(const I of l){let R=!1;y===I?(x+=15,R=!0):y.includes(I)?(x+=8,R=!0):I.includes(y)?(x+=6,R=!0):d.subsystem===I?(x+=5,R=!0):v.includes(I)?(x+=6,R=!0):O.includes(I)?(x+=2,R=!0):O.some($=>$.includes(I)||I.includes($))?(x+=1,R=!0):b.includes(I)?(x+=2,R=!0):m.includes(I)?(x+=1,R=!0):Re(I,y)?(x+=4,R=!0):Re(I,v)?(x+=3,R=!0):(O.some($=>Re(I,$))||Re(I,m))&&(x+=1,R=!0),R&&k++}k>=2&&(x+=k*5),x>0&&r.push({key:t,label:d.label,description:d.description||"",url:d.url,tier:d.tier,subsystem:d.subsystem,readTimeMinutes:d.readTimeMinutes||10,prerequisites:d.prerequisites||[],sections:d.sections||[],keySteps:d.keySteps||[],seeAlso:d.seeAlso||[],_score:x,source:"epic_docs"})}r.sort((t,d)=>d._score!==t._score?d._score-t._score:(Ie[t.tier]??1)-(Ie[d.tier]??1));const o=[];for(const t of r){const d=new Set(t.key.split(/[-_]+/).filter(x=>x.length>2));o.some(x=>{const y=new Set(x.key.split(/[-_]+/).filter(b=>b.length>2));return[...d].filter(b=>y.has(b)).length/Math.min(d.size,y.size)>.6})||o.push(t)}const c=o.length>0?o[0]._score:1;return o.slice(0,a).map(({_score:t,...d})=>({...d,_rawScore:t,matchScore:Math.round(t/Math.max(c,1)*100)}))}async function Pt(s,{limit:n=8}={}){const a=await Ts();if(!a)return[];const i=await ks(s,{limit:n*2});if(!i.length)return[];const u=new Map(i.map(t=>[t.key,t.matchScore??0])),l=new Map(i.map(t=>[t.key,t._rawScore??0])),r=new Set,o=[];function c(t){if(r.has(t))return;r.add(t);const d=a[t];if(d){for(const f of d.prerequisites||[])c(f);o.push({key:t,label:d.label,description:d.description||"",keySteps:d.keySteps||[],seeAlso:d.seeAlso||[],url:d.url,tier:d.tier,subsystem:d.subsystem,readTimeMinutes:d.readTimeMinutes||10,matchScore:u.get(t)??0,_rawScore:l.get(t)??0,source:"epic_docs"})}}for(const t of i)c(t.key);return o.sort((t,d)=>(d._rawScore??0)-(t._rawScore??0)),o.slice(0,n)}const ys={prerequisite:0,core:1,troubleshooting:2,supplemental:3};function Ot(s){return s.estimated_minutes?s.estimated_minutes:s.total_duration_seconds?Math.round(s.total_duration_seconds/60):(s.videos?.length||1)*10}function vs(s,n){if(n.size===0)return 0;const a=new Set([...s.canonical_tags||[],...s.gemini_system_tags||[],...s.transcript_tags||[]].map(u=>typeof u=="string"?u.toLowerCase():""));if(a.size===0)return 0;let i=0;for(const u of a)(n.has(u)||n.has(u.split(".").pop()))&&i++;return i/a.size}function qt(s,n){const a=[...s.canonical_tags||[],...s.gemini_system_tags||[]].map(o=>typeof o=="string"?o.toLowerCase():""),i=new Set(n.map(o=>o.toLowerCase()));let u=!1;for(const o of a)if(i.has(o)||i.has(o.split(".").pop())){u=!0;break}const l=a.some(o=>{const c=fe.getTag(o);return c?.tag_type==="symptom"||c?.tag_type==="error_code"});let r=!1;for(const o of a){const c=fe.edgesBySource?.get(o)||[];for(const t of c)if(t.relation==="subtopic"&&i.has(t.target)){r=!0;break}if(r)break}return r?"prerequisite":l?"troubleshooting":u?"core":"supplemental"}function bs(s,n,a={}){const{timeBudgetMinutes:i=1/0,maxItems:u=8,preferTroubleshooting:l=!1,diversity:r=!0}=a;if(!s||s.length===0)return{path:[],metadata:{totalMinutes:0,tagCoverage:0,diversityScore:1,itemCount:0}};const o=s.map(b=>({course:b,role:qt(b,n),estimatedMinutes:Ot(b),score:b._relevanceScore||0}));o.sort((b,O)=>{const m=ys[b.role]-ys[O.role];return m!==0?m:O.score-b.score}),l&&o.sort((b,O)=>{const m=b.role==="troubleshooting"?0:1,k=O.role==="troubleshooting"?0:1;return m!==k?m-k:O.score-b.score});const c=[],t=new Set;let d=0;for(const b of o){if(c.length>=u)break;if(d+b.estimatedMinutes>i||r&&c.length>0&&vs(b.course,t)>.7)continue;const O=Dt(b,n);c.push({course:b.course,role:b.role,reason:O,estimatedMinutes:b.estimatedMinutes}),d+=b.estimatedMinutes,[...b.course.canonical_tags||[],...b.course.gemini_system_tags||[]].map(k=>typeof k=="string"?k.toLowerCase():"").forEach(k=>{t.add(k),t.add(k.split(".").pop())})}const f=new Set(n.map(b=>b.toLowerCase()));let x=0;for(const b of f)(t.has(b)||t.has(b.split(".").pop()))&&x++;const y=f.size>0?x/f.size:0;let v=1;if(c.length>1){let b=0;const O=new Set;for(const m of c)b+=vs(m.course,O),[...m.course.canonical_tags||[]].map(I=>I?.toLowerCase?.()||"").forEach(I=>O.add(I));v=1-b/c.length}return{path:c,metadata:{totalMinutes:d,tagCoverage:Math.round(y*100)/100,diversityScore:Math.round(v*100)/100,itemCount:c.length}}}function Dt(s,n){const{course:a,role:i}=s,u=[...a.canonical_tags||[],...a.gemini_system_tags||[]].map(o=>typeof o=="string"?o.toLowerCase():""),l=new Set(n.map(o=>o.toLowerCase())),r=u.filter(o=>l.has(o)||l.has(o.split(".").pop()));switch(i){case"prerequisite":return`Foundation course ‚Äî covers prerequisite concepts for ${r.slice(0,2).join(", ")}`;case"core":return`Directly covers: ${r.slice(0,3).join(", ")}`;case"troubleshooting":return"Troubleshooting guide ‚Äî addresses symptoms related to your query";case"supplemental":return"Related content ‚Äî expands on topics connected to your query";default:return"Relevant to your search"}}let ge=null;async function Is(){if(ge!=null)return ge;try{const s=await be(()=>import("./data-courses-Y_tFOtPD.js").then(n=>n.y),[]);return ge=s.default||s,ge}catch{return ge={channels:{},resources:[]},ge}}const Me={beginner:0,intermediate:1,advanced:2};async function Rs(s,{maxTier:n="advanced",limit:a=5}={}){if(!s?.length)return[];const i=await Is();if(!i?.resources?.length)return[];const u=Me[n]??2,l=new Set(s.map(c=>c.toLowerCase())),r=[];for(const c of i.resources){if((Me[c.tier]??1)>u)continue;const d=(c.topics||[]).map(y=>y.toLowerCase()),f=(c.tag_ids||[]).map(y=>y.toLowerCase());let x=0;for(const y of d){l.has(y)&&(x+=5);for(const v of l)(y.includes(v)||v.includes(y))&&(x+=2)}for(const y of f){l.has(y)&&(x+=5);const v=y.split(".");for(const b of v)l.has(b)&&(x+=3)}if(x>0){const y=i.channels?.[c.channelKey];r.push({id:c.id,title:c.title,url:c.url,channelName:y?.name||"Unreal Engine",channelTrust:"official",tier:c.tier,durationMinutes:c.durationMinutes,topics:c.topics,tag_ids:c.tag_ids||[],description:c.description||"",keyTakeaways:c.keyTakeaways||[],chapters:c.chapters||[],source:"epic_youtube",_score:x})}}const o=/\b(ue\s*5|unreal\s*engine\s*5|5\.\d)/i;for(const c of r)c._isUE5=o.test(c.title)||(c.topics||[]).some(t=>o.test(t));return r.sort((c,t)=>c._isUE5!==t._isUE5?c._isUE5?-1:1:t._score!==c._score?t._score-c._score:(Me[c.tier]??1)-(Me[t.tier]??1)),r.slice(0,a).map(({_score:c,_isUE5:t,...d})=>d)}async function Ft(s,{limit:n=5}={}){if(!s?.length)return[];const a=await Is();if(!a?.resources?.length)return[];const i=new Set(s.map(l=>l.toLowerCase())),u=[];for(const l of a.resources){const r=(l.tag_ids||[]).map(c=>c.toLowerCase());let o=0;for(const c of r)i.has(c)&&(o+=5);if(o>0){const c=a.channels?.[l.channelKey];u.push({id:l.id,title:l.title,url:l.url,channelName:c?.name||"Unreal Engine",channelTrust:"official",tier:l.tier,durationMinutes:l.durationMinutes,topics:l.topics,tag_ids:l.tag_ids||[],description:l.description||"",keyTakeaways:l.keyTakeaways||[],chapters:l.chapters||[],source:"epic_youtube",_score:o})}}return u.sort((l,r)=>r._score-l._score),u.slice(0,n).map(({_score:l,...r})=>r)}async function Ut(s,n=[]){if(!s?.length)return{topics:[],firstPartyVideos:0,docsArticles:0,youtubeResources:0,coverageScore:0,gaps:[]};const a=await ks(s,{limit:10}),i=await Rs(s,{limit:10}),u={};for(const c of s){const t=c.toLowerCase(),d=n.filter(v=>{const b=(v.tags||[]).map(m=>m.toLowerCase()),O=(v.title||"").toLowerCase();return b.some(m=>m.includes(t))||O.includes(t)}).length,f=a.filter(v=>v.key?.toLowerCase().includes(t)||v.subsystem?.toLowerCase()===t||v.label?.toLowerCase().includes(t)).length,x=i.filter(v=>{const b=(v.topics||[]).some(m=>m.toLowerCase().includes(t)),O=(v.tag_ids||[]).some(m=>m.toLowerCase().includes(t));return b||O}).length,y=d+f+x;u[c]={firstPartyVideos:d,docsArticles:f,youtubeResources:x,total:y,covered:y>0}}const l=Object.values(u).filter(c=>c.covered).length,r=s.length>0?l/s.length:0,o=Object.entries(u).filter(([,c])=>!c.covered).map(([c])=>c);return{topics:s,topicCoverage:u,firstPartyVideos:n.length,docsArticles:a.length,youtubeResources:i.length,coverageScore:r,gaps:o}}async function Wt(s,n=[],{maxDocs:a=5,maxYoutube:i=3}={}){if(!s?.length)return{docs:[],youtube:[],totalTimeMinutes:0,coverageScore:0};const u=await Pt(s,{limit:a}),l=await Rs(s,{limit:i}),r=await Ft(s,{limit:i}),o=new Set(l.map(y=>y.id)),c=[...l];for(const y of r)o.has(y.id)||(c.push(y),o.add(y.id));const t=n.reduce((y,v)=>y+(v.durationMinutes||10),0),d=u.reduce((y,v)=>y+(v.readTimeMinutes||10),0),f=c.reduce((y,v)=>y+(v.durationMinutes||15),0),x=await Ut(s,n);return{docs:u,youtube:c,totalTimeMinutes:t+d+f,coverageScore:x.coverageScore,gaps:x.gaps,externalEnabled:!0}}const Ze={QUERY_SUBMITTED:"query_submitted",DIAGNOSIS_GENERATED:"diagnosis_generated",LEARNING_PATH_GENERATED:"learning_path_generated"};let He=null;function Bt(){return He||(He=`session_${Date.now()}_${Math.random().toString(36).substring(2,9)}`),He}async function es(s,n={}){try{const a=js(),i={event:s,session_id:Bt(),...n,timestamp:$s(),client_timestamp:new Date().toISOString()};await As(Ps(a,"analytics_events"),i)}catch(a){ne("[Analytics] Failed to track event:",s,a.message)}}function Vt(s,n=[],a=null){return es(Ze.QUERY_SUBMITTED,{query_length:s?.length||0,query_preview:s?.substring(0,100),detected_tag_count:n.length,detected_tags:n.slice(0,5),persona_id:a})}function zt(s){return es(Ze.DIAGNOSIS_GENERATED,{diagnosis_id:s?.diagnosis_id,root_causes_count:s?.root_causes?.length||0,signals_count:s?.signals_to_watch_for?.length||0,generalization_scope:s?.generalization_scope?.slice(0,3)})}function Gt(s,n,a=!0){return es(Ze.LEARNING_PATH_GENERATED,{fix_specific_count:s?.fix_specific?.length||0,transferable_count:s?.transferable?.length||0,course_count:n?.length||0,passed_validation:a})}function ss({onUpdate:s,disabled:n}){const[a,i]=j.useState(!1),[u,l]=j.useState({engineVersion:"",platform:"",context:"",renderer:"",features:"",whatChangedRecently:"",goal:""}),r=j.useCallback((o,c)=>{const t={...u,[o]:c};l(t);const d={engineVersion:t.engineVersion.trim()||void 0,platform:t.platform.trim()||void 0,context:t.context.trim()||void 0,renderer:t.renderer.trim()||void 0,features:t.features?t.features.split(",").map(x=>x.trim()).filter(Boolean):[],whatChangedRecently:t.whatChangedRecently.trim()||void 0,goal:t.goal.trim()||void 0},f=Object.values(d).some(x=>x!==void 0&&(!Array.isArray(x)||x.length>0));s(f?d:null)},[u,s]);return e.jsxs("div",{className:"case-report-form",children:[e.jsxs("button",{type:"button",className:"case-report-toggle",onClick:()=>i(!a),disabled:n,children:[e.jsx("span",{className:"case-report-toggle-icon",children:a?"‚ñæ":"‚ñ∏"}),e.jsxs("span",{className:"case-report-toggle-label",children:["üîß Add Case Details",e.jsx("span",{className:"case-report-hint",children:"(improves diagnosis accuracy)"})]})]}),a&&e.jsxs("div",{className:"case-report-fields",children:[e.jsxs("div",{className:"case-report-row",children:[e.jsxs("div",{className:"case-report-field",children:[e.jsx("label",{children:"Engine Version"}),e.jsx("input",{type:"text",placeholder:"e.g. 5.4.1",value:u.engineVersion,onChange:o=>r("engineVersion",o.target.value),disabled:n,maxLength:20})]}),e.jsxs("div",{className:"case-report-field",children:[e.jsx("label",{children:"Platform"}),e.jsxs("select",{value:u.platform,onChange:o=>r("platform",o.target.value),disabled:n,children:[e.jsx("option",{value:"",children:"Select..."}),e.jsx("option",{value:"Windows",children:"Windows"}),e.jsx("option",{value:"macOS",children:"macOS"}),e.jsx("option",{value:"Linux",children:"Linux"}),e.jsx("option",{value:"Android",children:"Android"}),e.jsx("option",{value:"iOS",children:"iOS"}),e.jsx("option",{value:"Console",children:"Console"})]})]}),e.jsxs("div",{className:"case-report-field",children:[e.jsx("label",{children:"Renderer"}),e.jsxs("select",{value:u.renderer,onChange:o=>r("renderer",o.target.value),disabled:n,children:[e.jsx("option",{value:"",children:"Select..."}),e.jsx("option",{value:"Lumen",children:"Lumen"}),e.jsx("option",{value:"Nanite",children:"Nanite"}),e.jsx("option",{value:"Forward",children:"Forward Shading"}),e.jsx("option",{value:"Deferred",children:"Deferred"}),e.jsx("option",{value:"Mobile",children:"Mobile"}),e.jsx("option",{value:"PathTracing",children:"Path Tracing"})]})]})]}),e.jsxs("div",{className:"case-report-field case-report-full",children:[e.jsx("label",{children:"What changed recently?"}),e.jsx("input",{type:"text",placeholder:"e.g. Updated to 5.4, migrated project, changed lighting settings",value:u.whatChangedRecently,onChange:o=>r("whatChangedRecently",o.target.value),disabled:n,maxLength:300})]}),e.jsxs("div",{className:"case-report-field case-report-full",children:[e.jsx("label",{children:"What are you trying to achieve?"}),e.jsx("input",{type:"text",placeholder:"e.g. Realistic interior lighting, smooth character animation",value:u.goal,onChange:o=>r("goal",o.target.value),disabled:n,maxLength:200})]}),e.jsxs("div",{className:"case-report-field case-report-full",children:[e.jsx("label",{children:"Active Features (comma separated)"}),e.jsx("input",{type:"text",placeholder:"e.g. Lumen, Nanite, Virtual Shadow Maps, World Partition",value:u.features,onChange:o=>r("features",o.target.value),disabled:n,maxLength:200})]})]})]})}ss.propTypes={onUpdate:h.func.isRequired,disabled:h.bool};ss.defaultProps={disabled:!1};function ts({question:s,options:n,whyAsking:a,onAnswer:i,onSkip:u,isLoading:l}){return e.jsxs("div",{className:"clarify-step",children:[e.jsxs("div",{className:"clarify-header",children:[e.jsx("span",{className:"clarify-icon",children:"ü§î"}),e.jsx("h3",{children:"Quick question before we diagnose"})]}),e.jsx("p",{className:"clarify-question",children:s}),e.jsx("div",{className:"clarify-options",children:(n||[]).map((r,o)=>e.jsxs("button",{className:"clarify-option-btn",onClick:()=>i(r),disabled:l,children:[e.jsx("span",{className:"clarify-option-letter",children:String.fromCharCode(65+o)}),e.jsx("span",{className:"clarify-option-text",children:r})]},o))}),a&&e.jsxs("p",{className:"clarify-why",children:[e.jsx("span",{className:"clarify-why-label",children:"Why we're asking:"})," ",a]}),e.jsx("button",{className:"clarify-skip-btn",onClick:u,disabled:l,children:"Skip ‚Äî just give me the best answer you can"})]})}ts.propTypes={question:h.string.isRequired,options:h.arrayOf(h.string),whyAsking:h.string,onAnswer:h.func.isRequired,onSkip:h.func.isRequired,isLoading:h.bool};ts.defaultProps={options:[],whyAsking:"",isLoading:!1};function ns({evidence:s}){const[n,a]=j.useState(!1);return!s||s.length===0?null:e.jsxs("details",{className:"evidence-panel",open:n,onToggle:i=>a(i.target.open),children:[e.jsxs("summary",{className:"evidence-toggle",children:[e.jsx("span",{className:"evidence-icon",children:"üìé"}),"Sources (",s.length,")"]}),e.jsx("div",{className:"evidence-list",children:s.map((i,u)=>e.jsxs("div",{className:"evidence-item",children:[e.jsxs("div",{className:"evidence-item-header",children:[e.jsxs("span",{className:"evidence-ref",children:["[",u+1,"]"]}),e.jsx("span",{className:"evidence-source-badge",children:i.source==="transcript"?"üé¨ Transcript":"üìÑ Docs"}),i.videoTitle&&e.jsx("span",{className:"evidence-video-title",children:i.videoTitle}),i.timestamp&&e.jsxs("span",{className:"evidence-timestamp",children:["@ ",i.timestamp]})]}),e.jsx("p",{className:"evidence-text",children:i.text}),i.courseCode&&e.jsxs("span",{className:"evidence-course",children:["Course: ",i.courseCode]})]},u))})]})}ns.propTypes={evidence:h.arrayOf(h.shape({text:h.string,source:h.string,courseCode:h.string,videoTitle:h.string,timestamp:h.string}))};ns.defaultProps={evidence:[]};function rs({onFeedback:s,isRerunning:n}){const[a,i]=j.useState("ask"),[u,l]=j.useState(""),r=j.useCallback(()=>{i("thanks"),s({solved:!0})},[s]),o=j.useCallback(()=>{i("no-reason")},[]),c=j.useCallback(()=>{s({solved:!1,reason:u.trim()}),i("thanks")},[s,u]);return a==="thanks"?e.jsxs("div",{className:"feedback-panel feedback-thanks",children:[e.jsx("span",{className:"feedback-icon",children:"‚úÖ"}),e.jsx("span",{children:"Thanks for the feedback!"}),n&&e.jsx("span",{className:"feedback-rerunning",children:"Re-analyzing with your feedback..."})]}):a==="no-reason"?e.jsxs("div",{className:"feedback-panel feedback-reason",children:[e.jsx("p",{className:"feedback-question",children:"What didn't work?"}),e.jsx("textarea",{className:"feedback-textarea",value:u,onChange:t=>l(t.target.value),placeholder:"e.g. I already tried that, the setting doesn't exist in my version, the issue is different...",maxLength:300,rows:2,disabled:n}),e.jsx("button",{className:"feedback-submit-btn",onClick:c,disabled:u.trim().length<5||n,children:n?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner"})," Re-analyzing..."]}):"Try a different approach ‚Üí"})]}):e.jsxs("div",{className:"feedback-panel feedback-ask",children:[e.jsx("p",{className:"feedback-question",children:"Did this solve your problem?"}),e.jsxs("div",{className:"feedback-buttons",children:[e.jsx("button",{className:"feedback-btn feedback-yes",onClick:r,children:"üëç Yes"}),e.jsx("button",{className:"feedback-btn feedback-no",onClick:o,children:"üëé No"})]})]})}rs.propTypes={onFeedback:h.func.isRequired,isRerunning:h.bool};rs.defaultProps={isRerunning:!1};function as({answer:s,onFeedback:n,onBackToVideos:a,onStartOver:i,isRerunning:u}){const[l,r]=j.useState(!1);if(!s)return null;const o=s.confidence==="high"?"#10b981":s.confidence==="med"?"#f59e0b":"#ef4444";return e.jsxs("div",{className:"answer-view",children:[e.jsxs("div",{className:"answer-header",children:[e.jsxs("h2",{className:"answer-title",children:[e.jsx("span",{className:"answer-icon",children:"üéØ"})," Most Likely Cause"]}),e.jsxs("span",{className:"answer-confidence-badge",style:{background:`${o}22`,color:o,border:`1px solid ${o}44`},children:[s.confidence," confidence"]})]}),e.jsx("p",{className:"answer-cause",children:s.mostLikelyCause}),s.fastChecks?.length>0&&e.jsxs("div",{className:"answer-section answer-fast-checks",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"section-icon",children:"‚ö°"})," Quick Checks"]}),e.jsx("ul",{children:s.fastChecks.map((c,t)=>e.jsxs("li",{children:[e.jsx("span",{className:"check-number",children:t+1}),e.jsx("span",{children:c})]},t))})]}),s.fixSteps?.length>0&&e.jsxs("div",{className:"answer-section answer-fix-steps",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"section-icon",children:"üîß"})," Fix Steps"]}),e.jsx("ol",{children:s.fixSteps.map((c,t)=>e.jsx("li",{children:c},t))})]}),s.ifStillBrokenBranches?.length>0&&e.jsxs("div",{className:"answer-section answer-branches",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"section-icon",children:"üîÄ"})," If Still Broken"]}),e.jsx("div",{className:"branch-list",children:s.ifStillBrokenBranches.map((c,t)=>e.jsxs("div",{className:"branch-item",children:[e.jsxs("span",{className:"branch-condition",children:["If ",c.condition,":"]}),e.jsx("span",{className:"branch-action",children:c.action})]},t))})]}),s.learnPath&&e.jsxs("details",{className:"answer-section answer-learn-path",open:l,onToggle:c=>r(c.target.open),children:[e.jsxs("summary",{children:[e.jsx("span",{className:"section-icon",children:"üìö"})," Learn More",e.jsxs("span",{className:"learn-path-badge",children:[s.learnPath.topicsCovered?.length||0," topics"]})]}),e.jsxs("div",{className:"learn-path-content",children:[e.jsx("p",{className:"learn-path-summary",children:s.learnPath.pathSummary}),s.learnPath.objectives&&e.jsxs("div",{className:"learn-path-objectives",children:[s.learnPath.objectives.fixSpecific?.length>0&&e.jsxs("div",{children:[e.jsx("h4",{children:"üéØ Fix-Specific"}),e.jsx("ul",{children:s.learnPath.objectives.fixSpecific.map((c,t)=>e.jsx("li",{children:c},t))})]}),s.learnPath.objectives.transferable?.length>0&&e.jsxs("div",{children:[e.jsx("h4",{children:"üîÑ Transferable Skills"}),e.jsx("ul",{children:s.learnPath.objectives.transferable.map((c,t)=>e.jsx("li",{children:c},t))})]})]})]})]}),s.whyThisResult?.length>0&&e.jsxs("div",{className:"answer-section answer-reasoning",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"section-icon",children:"üí°"})," Why This Result"]}),e.jsx("ul",{className:"reasoning-list",children:s.whyThisResult.map((c,t)=>e.jsx("li",{children:c},t))})]}),e.jsx(ns,{evidence:s.evidence}),e.jsxs("div",{className:"answer-actions",children:[e.jsx("button",{className:"answer-action-btn primary",onClick:a,children:"üé¨ Browse Related Videos"}),e.jsx("button",{className:"answer-action-btn secondary",onClick:i,children:"‚Üê Ask Another Question"})]}),e.jsx(rs,{onFeedback:n,isRerunning:u})]})}as.propTypes={answer:h.shape({mostLikelyCause:h.string,confidence:h.oneOf(["high","med","low"]),fastChecks:h.arrayOf(h.string),fixSteps:h.arrayOf(h.string),ifStillBrokenBranches:h.arrayOf(h.shape({condition:h.string,action:h.string})),learnPath:h.shape({pathSummary:h.string,topicsCovered:h.arrayOf(h.string),objectives:h.shape({fixSpecific:h.arrayOf(h.string),transferable:h.arrayOf(h.string)})}),whyThisResult:h.arrayOf(h.string),evidence:h.array}),onFeedback:h.func.isRequired,onBackToVideos:h.func.isRequired,onStartOver:h.func.isRequired,isRerunning:h.bool};as.defaultProps={answer:null,isRerunning:!1};const z={INPUT:"input",LOADING:"loading",CLARIFYING:"clarifying",ANSWERED:"answered",DIAGNOSIS:"diagnosis",GUIDED:"guided",ERROR:"error"};function ln(){const[s,n]=j.useState(z.INPUT),[a,i]=j.useState(null),[u,l]=j.useState(null),[r,o]=j.useState(null),[c,t]=j.useState([]),[d,f]=j.useState(null),[x,y]=j.useState(null),[v,b]=j.useState(null),[O,m]=j.useState(!1),[k,I]=j.useState(null),{cart:R,addToCart:$,removeFromCart:A,clearCart:X,isInCart:Q}=ft(),ie=Ls(),_=j.useMemo(()=>ie?.courses||[],[ie?.courses]),S=j.useCallback(()=>{try{const p=localStorage.getItem("detected_persona");return p?JSON.parse(p):null}catch{return null}},[]),N=j.useCallback(async(p,E)=>{X(),n(z.LOADING),l(null),f(null),y(null),I(p);const g=E||v;p.pastedImage&&G("[ProblemFirst] Screenshot attached (base64 length):",p.pastedImage.length),p.errorLog&&G("[ProblemFirst] Error log attached:",p.errorLog.slice(0,200));try{if(p.cachedCartId){G(`[Cache] Checking Firestore for cart: ${p.cachedCartId}`);try{const F=Oe(),q=js(F),le=Os(q,"adaptive_carts",p.cachedCartId),me=await qs(le);if(me.exists()){const se=me.data(),ae=se.cached_at?.toDate?.()||new Date(se.created_at||0),de=Date.now()-ae.getTime(),K=1440*60*1e3;if(de<K){G(`[Cache Hit] Cart is ${Math.round(de/6e4)}min old ‚Äî using cached result`);const M={...se,userQuery:p.query,retrievedPassages:[]},U=await ms(M,_,p.selectedTagIds||[],p.errorLog||"",[],null);M.matchedCourses=U;const _e=[...M.diagnosis?.matched_tag_ids||[],...p.detectedTagIds||[],...p.selectedTagIds||[]],pe=bs(U,_e,{preferTroubleshooting:!0,diversity:!0,timeBudgetMinutes:300}),we={};for(const Se of pe.path)we[Se.course.code]={role:Se.role,reason:Se.reason,estimatedMinutes:Se.estimatedMinutes};const ue=await gs(U,p.query,we);if(ue.length>0){t(ue),i(M),n(z.DIAGNOSIS),G(`[Cache] Loaded ${ue.length} videos from cached cart ‚Äî 0 Gemini calls`);return}ne("[Cache] Cached cart produced 0 videos ‚Äî falling through to fresh diagnosis")}else G(`[Cache Expired] Cart is ${Math.round(de/36e5)}h old ‚Äî refreshing`)}else G(`[Cache Miss] Cart ${p.cachedCartId} not found in Firestore`)}catch(F){ne("[Cache Error] Falling through to fresh diagnosis:",F.message)}}await Vt(p.query,p.detectedTagIds,S()?.id);const C=Oe(),T=Ds(C,"us-central1");let D=null,Y=[],w=[],L=[];try{const F=Ce(T,"embedQuery"),q=Ce(T,"expandQuery"),[le,me]=await Promise.allSettled([F({query:p.query}),q({query:p.query})]);if(me.status==="fulfilled"&&me.value.data?.expansions&&(L=me.value.data.expansions,G(`[QueryExpansion] ${L.length} variants: ${L.join(" | ")}`)),le.status==="fulfilled"&&le.value.data?.success&&le.value.data?.embedding){D=le.value.data.embedding;const[se,ae,de]=await Promise.allSettled([yt(D,8,.35),hs(p.query,D,[],8),At(D,6,.35)]);if(se.status==="fulfilled"?Y=se.value:ne("‚ö†Ô∏è Course semantic search failed:",se.reason?.message),ae.status==="fulfilled"){const M=ae.value.map(U=>({text:U.previewText,courseCode:U.courseCode,videoTitle:U.videoTitle,timestamp:U.timestamp,similarity:U.similarity,source:"transcript"}));w.push(...M),G(`[RAG] ${M.length} transcript passages`)}else ne("‚ö†Ô∏è Segment search failed:",ae.reason?.message);if(de.status==="fulfilled"){const M=de.value.map(U=>({text:U.previewText,url:U.url,title:U.title,section:U.section,similarity:U.similarity,source:"epic_docs"}));w.push(...M),G(`[RAG] ${M.length} doc passages`)}else ne("‚ö†Ô∏è Docs search failed:",de.reason?.message);if(L.length>0){const M=L.map(pe=>hs(pe,null,[],4).catch(()=>[])),U=await Promise.allSettled(M);let _e=0;for(const pe of U)if(pe.status==="fulfilled"&&pe.value.length>0){const we=pe.value.map(ue=>({text:ue.previewText,courseCode:ue.courseCode,videoTitle:ue.videoTitle,timestamp:ue.timestamp,similarity:(ue.similarity||0)*.9,source:"transcript"}));w.push(...we),_e+=we.length}_e>0&&G(`[QueryExpansion] +${_e} passages from expanded queries`)}w.sort((M,U)=>(U.similarity||0)-(M.similarity||0));const K=new Set;w=w.filter(M=>{const U=(M.text||"").trim().toLowerCase().slice(0,120);return K.has(U)?!1:(K.add(U),!0)}),G(`[RAG] Total: ${w.length} passages after rank+dedup (with expansions)`)}}catch(F){ne("‚ö†Ô∏è Semantic search skipped:",F.message)}if(w.length>2)try{const q=await Ce(T,"rerankPassages")({query:p.query,passages:w.slice(0,20)});q.data?.success&&q.data?.reranked&&(w=q.data.reranked,q.data.fallback||G("[Rerank] Passages re-ranked by Gemini cross-encoder"))}catch(F){ne("‚ö†Ô∏è Re-ranking skipped:",F.message)}w=w.slice(0,8);let P,Z=!0;try{const q=await Ce(T,"queryLearningPath")({query:p.query,mode:"problem-first",detectedTagIds:p.detectedTagIds,personaHint:p.personaHint,retrievedContext:w.slice(0,8),caseReport:g||void 0});if(!q.data.success&&q.data.error==="off_topic"){l(q.data.message||"This doesn't appear to be a UE5 question. Please describe a specific Unreal Engine 5 issue."),n(z.ERROR);return}if(q.data.responseType==="NEEDS_CLARIFICATION"){y({question:q.data.question,options:q.data.options||[],whyAsking:q.data.whyAsking||"",query:q.data.query,caseReport:q.data.caseReport}),n(z.CLARIFYING);return}if(!q.data.success)throw new Error(q.data.message||"Failed to process query");q.data.responseType==="ANSWER"&&f({mostLikelyCause:q.data.mostLikelyCause,confidence:q.data.confidence,fastChecks:q.data.fastChecks||[],fixSteps:q.data.fixSteps||[],ifStillBrokenBranches:q.data.ifStillBrokenBranches||[],whyThisResult:q.data.whyThisResult||[],evidence:q.data.evidence||[],learnPath:q.data.learnPath}),P=q.data.cart}catch(F){const q=F.message?.includes("429")||F.code==="resource-exhausted";if(F.message?.includes("off_topic")||F.message?.includes("not a UE5")){l(`This doesn't appear to be a UE5 question. Try describing a specific Unreal Engine 5 issue, for example:
‚Ä¢ "Lumen reflections flickering"
‚Ä¢ "Blueprint compile error"
‚Ä¢ "Niagara particles not spawning"`),n(z.ERROR);return}ne(`‚ö†Ô∏è Gemini ${q?"rate limited (429)":"error"}: ${F.message}. Falling back to local matching.`),Z=!1,P={diagnosis:{problem_summary:p.query,matched_tag_ids:p.detectedTagIds||[]},objectives:[],intent:{systems:[]}}}P.userQuery=p.query,P.retrievedPassages=w,P._localFallback=!Z;const re=Fs(Oe()).currentUser,V=re?await Hs(re.uid):null,te=await ms(P,_,p.selectedTagIds||[],p.errorLog||"",Y,V);P.matchedCourses=te;const he=[...P.diagnosis?.matched_tag_ids||[],...p.detectedTagIds||[],...p.selectedTagIds||[]],Ae=bs(te,he,{preferTroubleshooting:!0,diversity:!0,timeBudgetMinutes:300}),is={};for(const F of Ae.path)is[F.course.code]={role:F.role,reason:F.reason,estimatedMinutes:F.estimatedMinutes};const Pe=await gs(te,p.query,is),os=Pe.filter(F=>!F.type||F.type==="video"),cs=Pe.filter(F=>F.type==="doc"||F.type==="youtube");if(Pe.length===0){l(`We couldn't find UE5 content matching your query. Try describing a specific Unreal Engine problem, for example:
‚Ä¢ "Blueprint compile error LNK2019"
‚Ä¢ "Lumen reflections flickering in indoor scene"
‚Ä¢ "Niagara particle system not spawning"
‚Ä¢ "UMG widget not rendering"`),n(z.ERROR);return}t(os),i(P);try{const q=[...P.diagnosis?.matched_tag_ids||[],...p.detectedTagIds||[]].flatMap(K=>K.split(/[._]/).filter(M=>M.length>2&&M!=="unreal"&&M!=="engine")),le=new Set(["the","and","for","are","but","not","you","all","can","has","her","was","one","our","out","its","how","why","with","from","they","been","have","this","that","what","when","your","into"]),me=(p.query||"").toLowerCase().split(/\s+/).filter(K=>K.length>2&&!le.has(K)),se=[...new Set(me)],ae=K=>se.some(M=>M.includes(K));ae("mesh")&&!ae("skeletal")&&se.push("static mesh","static meshes","import","importing"),(ae("size")||ae("scale")||ae("wrong"))&&se.push("scale","transform");const de=[...new Set([...q,...se])].slice(0,15);if(G(`[DocTopics] ${se.join(", ")}`),G(`[AllTopics] ${de.join(", ")}`),se.length>0){const K=await Wt(se,os,{maxDocs:5,maxYoutube:3});if(cs.length>0)for(const M of cs)M.type==="doc"&&!K.docs.some(U=>U.url===M._externalUrl)&&K.docs.push({label:M.title,url:M._externalUrl||M.url,description:M.description||"",readTimeMinutes:M.readTimeMinutes||10,tier:"intermediate"}),M.type==="youtube"&&!K.youtube.some(U=>U.url===M._externalUrl)&&K.youtube.push({title:M.title,url:M._externalUrl||M.url,channelName:M.channel||"YouTube",channelTrust:M.channelTrust||null,durationMinutes:M.durationMinutes||10,tier:"intermediate"});K.docs.sort((M,U)=>(U._rawScore??U.matchScore??0)-(M._rawScore??M.matchScore??0)),o(K),G(`[Blended] ${K.docs.length} docs, ${K.youtube.length} YT, coverage: ${(K.coverageScore*100).toFixed(0)}%`)}}catch(F){ne("‚ö†Ô∏è Blended path skipped:",F.message)}n(d?z.ANSWERED:z.DIAGNOSIS),p.updateCartIdForQuery&&P.cart_id&&(p.updateCartIdForQuery(p.query,P.cart_id),G(`[Cache] Saved cart_id ${P.cart_id} to history for: "${p.query.substring(0,40)}..."`)),await zt(P.diagnosis),await Gt(P.objectives,te,P.validation?.approved)}catch(C){console.error("[ProblemFirst] Error:",C),l(C.message||"An unexpected error occurred"),n(z.ERROR)}},[_,S,X,v,d]),W=j.useCallback(()=>n(z.INPUT),[]),B=j.useCallback(()=>{n(z.INPUT),i(null),t([]),l(null),o(null),f(null),y(null),b(null),m(!1)},[]),H=j.useCallback(p=>{if(!k)return;const E={...k,query:`${k.query} (${p})`};N(E,v)},[k,v,N]),ee=j.useCallback(()=>{k&&N(k,v)},[k,v,N]),ce=j.useCallback(p=>{if(p.solved||!k)return;m(!0);const E={...v||{},exclusions:[...(v||{}).exclusions||[],p.reason||"Previous solution did not work"]};b(E),N(k,E)},[k,v,N]),oe=j.useCallback(()=>{n(z.DIAGNOSIS)},[]),J=j.useCallback(p=>{Q(p.driveId)?A(p.driveId):$(p)},[Q,$,A]),xe=j.useCallback(()=>{R.length>0&&n(z.GUIDED)},[R]);return e.jsxs("div",{className:"problem-first-page",children:[e.jsxs("header",{className:"page-header",children:[e.jsx("h1",{children:"üîß Fix a Problem"}),e.jsx("p",{children:"Describe your issue. We'll diagnose it and show you how to fix it."})]}),(s===z.INPUT||s===z.LOADING)&&e.jsxs(e.Fragment,{children:[e.jsx(Ye,{onSubmit:N,detectedPersona:S(),isLoading:s===z.LOADING}),e.jsx(ss,{onUpdate:b,disabled:s===z.LOADING})]}),s===z.CLARIFYING&&x&&e.jsx(ts,{question:x.question,options:x.options,whyAsking:x.whyAsking,onAnswer:H,onSkip:ee,isLoading:!1}),s===z.ANSWERED&&d&&e.jsx(as,{answer:d,onFeedback:ce,onBackToVideos:oe,onStartOver:B,isRerunning:O}),s===z.ERROR&&e.jsxs("div",{className:"error-state",children:[e.jsx("div",{className:"error-icon",children:"‚ö†Ô∏è"}),e.jsx("h3",{children:"Something went wrong"}),e.jsx("p",{children:u}),e.jsx("button",{className:"retry-btn",onClick:B,children:"Try Again"})]}),s===z.DIAGNOSIS&&a&&e.jsxs("div",{className:"shopping-layout",children:[e.jsxs("div",{className:"results-column",children:[e.jsxs("div",{className:"tldr-diagnosis",children:[e.jsxs("div",{className:"tldr-user-query",children:[e.jsx("span",{className:"tldr-query-label",children:"üîç You asked:"}),e.jsx("p",{className:"tldr-query-text",children:a.userQuery})]}),a._localFallback&&e.jsxs("div",{className:"tldr-fallback-notice",style:{background:"rgba(255, 193, 7, 0.1)",border:"1px solid rgba(255, 193, 7, 0.3)",borderRadius:"8px",padding:"8px 14px",margin:"8px 0",fontSize:"0.85rem",color:"var(--text-muted, #aaa)"},children:["‚ö° ",e.jsx("strong",{children:"Fast results"})," ‚Äî AI diagnosis temporarily unavailable. Videos matched by tag taxonomy. Try again in a moment for AI-powered results."]}),a.diagnosis?.problem_summary&&e.jsx("p",{className:"tldr-bridge",children:"Based on your question, we think these videos will help you:"})]}),e.jsxs("h2",{className:"results-title",children:["üé¨ Videos for You (",c.length,")"]}),c.length===0&&e.jsx("div",{className:"no-results",children:e.jsx("p",{children:"No matching videos found. Try rephrasing your question."})}),(()=>{const p=[{key:"prerequisite",icon:"üîó",label:"Prerequisite",desc:"Build the foundation first ‚Äî these cover concepts you'll need before tackling the main topic."},{key:"core",icon:"‚≠ê",label:"Core",desc:"These directly address your question and are the most important videos to watch."},{key:"troubleshooting",icon:"üîß",label:"Troubleshooting",desc:"Debugging helpers ‚Äî watch these if you're hitting errors or unexpected behavior."},{key:"supplemental",icon:"üìö",label:"Supplemental",desc:"Go deeper ‚Äî extra context and advanced techniques for when you're ready."}],E={};for(const g of p)E[g.key]=[];E._other=[];for(const g of c){const C=g.role||"_other";(E[C]||E._other).push(g)}return p.filter(g=>E[g.key].length>0).map(g=>e.jsxs("div",{className:"role-section",children:[e.jsxs("div",{className:"role-section-header",children:[e.jsxs("h3",{className:"role-section-title",children:[g.icon," ",g.label,e.jsx("span",{className:"role-section-count",children:E[g.key].length})]}),e.jsx("p",{className:"role-section-desc",children:g.desc})]}),e.jsx("div",{className:"video-results-grid",children:E[g.key].map(C=>e.jsx("div",{className:"video-result-wrapper",id:`video-${C.driveId}`,children:e.jsx(Qe,{video:C,isAdded:Q(C.driveId),onToggle:J,userQuery:a?.userQuery||""})},C.driveId))})]},g.key)).concat(E._other.length>0?[e.jsxs("div",{className:"role-section",children:[e.jsxs("div",{className:"role-section-header",children:[e.jsxs("h3",{className:"role-section-title",children:["üìé Related"," ",e.jsx("span",{className:"role-section-count",children:E._other.length})]}),e.jsx("p",{className:"role-section-desc",children:"Additional videos that may be relevant to your query."})]}),e.jsx("div",{className:"video-results-grid",children:E._other.map(g=>e.jsx("div",{className:"video-result-wrapper",id:`video-${g.driveId}`,children:e.jsx(Qe,{video:g,isAdded:Q(g.driveId),onToggle:J,userQuery:a?.userQuery||""})},g.driveId))})]},"_other")]:[])})(),r?.docs?.length>0&&e.jsxs("div",{className:"blended-section",children:[e.jsxs("div",{className:"blended-section-header",children:[e.jsx("h2",{className:"blended-section-title",children:"üìö Recommended Reading"}),e.jsxs("p",{className:"blended-section-desc",children:["Official Unreal Engine documentation to deepen your understanding.",r.docs.reduce((p,E)=>p+(E.readTimeMinutes||10),0)>0&&` (~${r.docs.reduce((p,E)=>p+(E.readTimeMinutes||10),0)} min total read time)`]})]}),e.jsx("div",{className:"doc-cards-grid",children:r.docs.map((p,E)=>{const g=`doc_${p.key||E}`,C=Q(g);return e.jsxs("div",{className:`doc-card ${C?"doc-card-added":""}`,children:[e.jsxs("a",{href:p.url,target:"_blank",rel:"noopener noreferrer",className:"doc-card-link",onClick:T=>T.stopPropagation(),children:[e.jsxs("div",{className:"doc-card-header",children:[p.matchScore!=null&&(()=>{const T=p.matchScore>=90?"best":p.matchScore>=60?"strong":p.matchScore>=30?"good":"related",D=p.matchScore>=90?"Best Match":p.matchScore>=60?"Strong":p.matchScore>=30?"Good":"Related";return e.jsxs("span",{className:`doc-match-badge doc-match-${T}`,title:`${p.matchScore}% relevancy`,children:[e.jsx("span",{className:"doc-match-dot"}),D]})})(),e.jsx("span",{className:`tier-badge tier-${p.tier||"intermediate"}`,children:p.tier||"intermediate"}),p.subsystem&&e.jsx("span",{className:"subsystem-tag",children:p.subsystem})]}),e.jsx("h4",{className:"doc-card-title",children:p.label}),p.description&&e.jsx("p",{className:"doc-card-desc",children:p.description}),e.jsxs("div",{className:"doc-card-footer",children:[e.jsx("span",{className:"doc-source-badge",children:"üìÑ Epic Docs"}),e.jsxs("span",{className:"doc-read-time",children:[p.readTimeMinutes||10," min read"]})]})]}),e.jsx("button",{className:`doc-add-btn ${C?"doc-added":""}`,onClick:()=>{C?A(g):$({type:"doc",itemId:g,title:p.label,description:p.description||"",keySteps:p.keySteps||[],seeAlso:p.seeAlso||[],sections:p.sections||[],url:p.url,tier:p.tier||"intermediate",subsystem:p.subsystem,readTimeMinutes:p.readTimeMinutes||10})},title:C?"Remove from path":"Add to learning path",children:C?"‚úì Added":"‚ûï Add"})]},p.key||E)})})]}),r?.youtube?.length>0&&e.jsxs("div",{className:"blended-section",children:[e.jsxs("div",{className:"blended-section-header",children:[e.jsx("h2",{className:"blended-section-title",children:"üì∫ Official Epic YouTube"}),e.jsx("p",{className:"blended-section-desc",children:"Official Unreal Engine tutorials from Epic Games."})]}),e.jsx("div",{className:"doc-cards-grid",children:r.youtube.map(p=>{const E=p.id||`yt_${p.url}`,g=Q(E);return e.jsxs("div",{className:`doc-card yt-card-with-thumb ${g?"doc-card-added":""}`,children:[e.jsxs("a",{href:p.url,target:"_blank",rel:"noopener noreferrer",className:"doc-card-link",onClick:C=>C.stopPropagation(),children:[(()=>{const C=p.url?.match(/[?&]v=([^&]+)/),T=C?C[1]:null;return T?e.jsxs("div",{className:"yt-thumb-wrapper",children:[e.jsx("img",{className:"yt-thumb-img",src:`https://img.youtube.com/vi/${T}/mqdefault.jpg`,alt:p.title,loading:"lazy"}),e.jsxs("span",{className:"yt-thumb-duration",children:[p.durationMinutes," min"]}),e.jsx("span",{className:"yt-thumb-play",children:"‚ñ∂"})]}):null})(),e.jsxs("div",{className:"doc-card-header",children:[e.jsx("span",{className:`tier-badge tier-${p.tier||"intermediate"}`,children:p.tier||"intermediate"}),e.jsx("span",{className:"external-badge",children:"Official ‚Ä¢ YouTube"})]}),e.jsx("h4",{className:"doc-card-title",children:p.title}),e.jsxs("div",{className:"doc-card-footer",children:[e.jsxs("span",{className:"doc-source-badge",children:["üì∫ ",p.channelName]}),e.jsxs("span",{className:"doc-read-time",children:[p.durationMinutes," min"]})]})]}),e.jsx("button",{className:`doc-add-btn ${g?"doc-added":""}`,onClick:()=>{g?A(E):$({type:"youtube",itemId:E,title:p.title,description:p.description||"",keyTakeaways:p.keyTakeaways||[],chapters:p.chapters||[],topics:p.topics||[],url:p.url,channelName:p.channelName,channelTrust:p.channelTrust,tier:p.tier||"intermediate",durationMinutes:p.durationMinutes||15})},title:g?"Remove from path":"Add to learning path",children:g?"‚úì Added":"‚ûï Add"})]},p.id)})})]}),e.jsxs("div",{className:"results-actions-bottom",children:[e.jsx("button",{className:"back-btn",onClick:B,children:"‚Üê Start Over"}),e.jsx("button",{className:"ask-again-btn",onClick:W,children:"+ Ask Another Question"})]})]}),e.jsx("div",{className:"cart-column",children:e.jsx(Ns,{cart:R,onRemove:A,onClear:X,onWatchPath:xe})})]}),s===z.GUIDED&&(()=>{const p=a?.microLesson?.quick_fix?.steps;return e.jsx(Bs,{courses:(()=>{const E=new Map,g=[];for(const w of R){const L=w.type||"video";if(L==="doc"||L==="youtube"){const Z=g.filter(V=>V.startsWith("_doc_")).length===0,re=`_doc_${w.itemId||w.url||w.driveId}`;g.push(re),E.set(re,{course:{code:w.itemId||w.driveId||`${L}_${w.url}`,title:w.title,_readingStep:!0,_resourceType:L,_description:w.description||"",_keySteps:Z&&p?.length>0?p:w.keyTakeaways||w.keySteps||[],_seeAlso:w.seeAlso||[],_url:w.url,_tier:w.tier,_channel:w.channel||w.channelName,_channelTrust:w.channelTrust,_subsystem:w.subsystem,_topics:w.topics||[],_sections:w.sections||[],_chapters:w.chapters||[],_readTimeMinutes:w.readTimeMinutes||w.durationMinutes||10,videos:[]}});continue}const P=w.courseCode;if(!E.has(P)){const Z=_.find(re=>re.code===P);g.push(P),E.set(P,{course:Z?{...Z,videos:[]}:{code:P,title:w.courseName,videos:[]},videos:[]})}E.get(P).videos.push({drive_id:w.driveId,title:w.title,duration_seconds:w.duration,_videoIndex:w.videoIndex??999})}const C=g.map(w=>{const L=E.get(w);return L.videos?.length>0&&(L.videos.sort((P,Z)=>P._videoIndex-Z._videoIndex),L.course.videos=L.videos),L.course}),T=new Set(["100.01","100.02"]),D=C.filter(w=>T.has(w.code)),Y=C.filter(w=>!T.has(w.code));return[...D,...Y]})(),diagnosis:a?.diagnosis,problemSummary:a?.diagnosis?.problem_summary,pathSummary:a?.pathSummary,microLesson:a?.microLesson,onComplete:()=>{},onExit:()=>n(z.DIAGNOSIS)})})()]})}function Ms({diagnosis:s}){if(!s)return null;const n=s.root_causes?.length||0,a=s.signals_to_watch_for?.length||0,i=s.variables_that_matter?.length||0,u=s.variables_that_do_not?.length||0;return e.jsxs("div",{className:"diagnosis-card",children:[e.jsxs("div",{className:"diagnosis-header",children:[e.jsx("h3",{children:"üî¨ Diagnosis"}),e.jsxs("span",{className:"diagnosis-id",children:["ID: ",s.diagnosis_id?.slice(-8)||"N/A"]})]}),e.jsx("p",{className:"problem-summary",children:s.problem_summary}),e.jsxs("div",{className:"diagnosis-sections",children:[e.jsxs("details",{className:"diagnosis-section root-causes",children:[e.jsxs("summary",{children:[e.jsx("span",{className:"icon",children:"üéØ"}),"Root Causes",e.jsxs("span",{className:"count",children:["(",n,")"]})]}),e.jsx("ul",{children:(s.root_causes||[]).map((l,r)=>e.jsx("li",{children:l},r))})]}),e.jsxs("details",{className:"diagnosis-section signals",children:[e.jsxs("summary",{children:[e.jsx("span",{className:"icon",children:"üëÅÔ∏è"}),"Signals to Watch For",e.jsxs("span",{className:"count",children:["(",a,")"]})]}),e.jsx("ul",{children:(s.signals_to_watch_for||[]).map((l,r)=>e.jsx("li",{children:l},r))})]}),e.jsxs("details",{className:"diagnosis-section variables-matter",children:[e.jsxs("summary",{children:[e.jsx("span",{className:"icon",children:"‚úÖ"}),"Variables That Matter",e.jsxs("span",{className:"count",children:["(",i,")"]})]}),e.jsx("ul",{children:(s.variables_that_matter||[]).map((l,r)=>e.jsx("li",{children:l},r))})]}),e.jsxs("details",{className:"diagnosis-section variables-dont-matter",children:[e.jsxs("summary",{children:[e.jsx("span",{className:"icon",children:"‚ùå"}),"Variables That Don't",e.jsxs("span",{className:"count",children:["(",u,")"]})]}),e.jsx("ul",{children:(s.variables_that_do_not||[]).map((l,r)=>e.jsx("li",{children:l},r))})]}),s.generalization_scope?.length>0&&e.jsxs("details",{className:"diagnosis-section generalization",open:!0,children:[e.jsxs("summary",{children:[e.jsx("span",{className:"icon",children:"üîÑ"}),"Where Else This Applies",e.jsxs("span",{className:"count",children:["(",s.generalization_scope.length,")"]})]}),e.jsx("div",{className:"scope-chips",children:s.generalization_scope.map((l,r)=>e.jsx("span",{className:"scope-chip",children:l},r))})]})]})]})}Ms.propTypes={diagnosis:h.shape({diagnosis_id:h.string,problem_summary:h.string,root_causes:h.arrayOf(h.string),signals_to_watch_for:h.arrayOf(h.string),variables_that_matter:h.arrayOf(h.string),variables_that_do_not:h.arrayOf(h.string),generalization_scope:h.arrayOf(h.string)})};Ms.defaultProps={diagnosis:null};function Kt(s){if(!s||s<=0)return null;const n=Math.floor(s/3600),a=Math.floor(s%3600/60);return n>0?a>0?`${n} hr ${a} min`:`${n} hr`:`${a} min`}function Ht(s,n=320){const a=s?.drive_id||s?.driveId;return a?`https://drive.google.com/thumbnail?id=${a}&sz=w${n}`:null}function Qt(s,n=320){const a=s?.videos?.[0];return Ht(a,n)}function Es({objectives:s,courses:n,validation:a,onCourseClick:i,onAddToCart:u,isCourseInCart:l}){const{fixCourses:r,learnCourses:o}=j.useMemo(()=>{if(!n||n.length===0)return{fixCourses:[],learnCourses:[]};const t=Math.ceil(n.length/2);return{fixCourses:n.slice(0,t),learnCourses:n.slice(t)}},[n]),c=j.useMemo(()=>a?{approved:a.approved,reason:a.reason,hasIssues:a.issues?.length>0}:null,[a]);return e.jsxs("div",{className:"adaptive-cart",children:[c&&!c.approved&&e.jsxs("div",{className:"validation-warning",children:[e.jsx("span",{className:"icon",children:"‚ö†Ô∏è"}),e.jsxs("div",{className:"content",children:[e.jsx("strong",{children:"Quality Check:"})," ",c.reason,a.suggestions?.length>0&&e.jsx("ul",{className:"suggestions",children:a.suggestions.map((t,d)=>e.jsx("li",{children:t},d))})]})]}),e.jsxs("section",{className:"cart-section fix-now",children:[e.jsxs("div",{className:"section-header",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"icon",children:"üîß"}),"Fix Now"]}),e.jsx("p",{className:"description",children:"These solve your immediate problem:"})]}),e.jsx("div",{className:"objectives-list",children:(s?.fix_specific||[]).map((t,d)=>e.jsxs("div",{className:"objective-item fix",children:[e.jsx("span",{className:"number",children:d+1}),e.jsx("span",{className:"text",children:t})]},d))}),r.length>0&&e.jsx("div",{className:"course-list",children:r.map(t=>e.jsx($e,{course:t,type:"fix",onClick:()=>i?.(t),onAddToCart:u,isInCart:l?.(t)},t.id||t.code))})]}),e.jsxs("section",{className:"cart-section learn-forever",children:[e.jsxs("div",{className:"section-header",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"icon",children:"üéì"}),"Learn Forever"]}),e.jsx("p",{className:"description",children:"These help you diagnose similar issues in the future:"})]}),e.jsx("div",{className:"objectives-list transferable",children:(s?.transferable||[]).map((t,d)=>e.jsxs("div",{className:"objective-item transferable",children:[e.jsx("span",{className:"number",children:d+1}),e.jsx("span",{className:"text",children:t}),e.jsx("span",{className:"badge",children:"Transferable"})]},d))}),s?.transferable?.length===0&&e.jsx("div",{className:"empty-warning",children:"‚ö†Ô∏è No transferable objectives generated. This path may not teach reusable skills."}),o.length>0&&e.jsx("div",{className:"course-list",children:o.map(t=>e.jsx($e,{course:t,type:"learn",onClick:()=>i?.(t),onAddToCart:u,isInCart:l?.(t)},t.id||t.code))})]}),e.jsxs("div",{className:"cart-summary",children:[e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"value",children:s?.fix_specific?.length||0}),e.jsx("span",{className:"label",children:"Fix Objectives"})]}),e.jsxs("div",{className:"stat highlight",children:[e.jsx("span",{className:"value",children:s?.transferable?.length||0}),e.jsx("span",{className:"label",children:"Transferable Skills"})]}),e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"value",children:n?.length||0}),e.jsx("span",{className:"label",children:"Recommended Courses"})]})]})]})}function $e({course:s,type:n,onClick:a,onAddToCart:i,isInCart:u}){const[l,r]=j.useState(!1),o=j.useMemo(()=>{if(s.duration)return s.duration;if(s.duration_minutes)return`${s.duration_minutes} min`;if(s.durationMinutes)return`${s.durationMinutes} min`;if(s.videos?.length){const x=s.videos.reduce((y,v)=>y+(v.duration_seconds||0),0);return x>0?Kt(x):null}return null},[s]),c=j.useMemo(()=>typeof s.difficulty=="string"?s.difficulty:typeof s.difficulty=="number"?["Beginner","Beginner","Intermediate","Intermediate","Advanced","Expert"][s.difficulty]||"Intermediate":s.gemini_skill_level?s.gemini_skill_level:null,[s]),t=j.useMemo(()=>Qt(s),[s]),d=s.video_count||s.videos?.length||null,f=x=>{x.stopPropagation(),i?.(s)};return e.jsxs("div",{className:`course-card ${n} ${u?"in-cart":""}`,onClick:a,role:"button",tabIndex:0,onKeyDown:x=>x.key==="Enter"&&a?.(),children:[t&&!l&&e.jsx("div",{className:"course-thumbnail",children:e.jsx("img",{src:t,alt:s.title,loading:"lazy",onError:()=>r(!0)})}),e.jsxs("div",{className:"course-info",children:[e.jsx("h4",{className:"title",children:s.title||s.name}),s.gemini_outcomes?.[0]&&e.jsxs("p",{className:"description",children:[s.gemini_outcomes[0].slice(0,100),"..."]}),e.jsxs("div",{className:"meta",children:[o&&e.jsxs("span",{className:"duration",children:["‚è±Ô∏è ",o]}),d&&e.jsxs("span",{className:"video-count",children:["üé¨ ",d," videos"]}),c&&e.jsx("span",{className:`difficulty ${c.toLowerCase()}`,children:c})]})]}),e.jsx("div",{className:"course-action",children:i?e.jsx("button",{className:`add-btn ${u?"added":""}`,onClick:f,"aria-label":u?"Added to path":"Add to path",children:u?"‚úì Added":"+ Add"}):e.jsx("span",{className:"arrow",children:"‚Üí"})})]})}$e.propTypes={course:h.shape({id:h.string,code:h.string,title:h.string,name:h.string,description:h.string,duration:h.string,durationMinutes:h.number,difficulty:h.string}).isRequired,type:h.oneOf(["fix","learn"]),onClick:h.func};$e.defaultProps={type:"fix",onClick:null};Es.propTypes={objectives:h.shape({fix_specific:h.arrayOf(h.string),transferable:h.arrayOf(h.string)}),courses:h.arrayOf(h.object),validation:h.shape({approved:h.bool,reason:h.string,issues:h.arrayOf(h.string),suggestions:h.arrayOf(h.string)}),onCourseClick:h.func};Es.defaultProps={objectives:null,courses:[],validation:null,onCourseClick:null};export{Es as AdaptiveLearningCart,Ms as DiagnosisCard,ln as ProblemFirst,Ye as ProblemInput};

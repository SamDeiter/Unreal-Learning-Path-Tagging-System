import{j as e,o as Bs,s as Ys,_ as xe,a as Qs,g as ds}from"./index-D9f_0Ox1.js";import{a as b,P as h}from"./vendor-cytoscape-hdah7_Xt.js";import{c as _s,p as Ks,r as Hs,d as Zs,j as Js,k as Xs,n as et,m as us}from"./vendor-firebase-BQvzIQYL.js";import{t as fe}from"./TagGraphService-Cx8yAPvt.js";import{S as st,P as tt}from"./search-Blpc5bje.js";import{c as ue}from"./createLucideIcon-YhyuTmrv.js";import{c as Se,q as ws,b as Ss,d as nt,f as at,l as rt,g as it,s as ot}from"./data-courses-LtwEzJPI.js";import{d as re,L as ct,a as K}from"./logger-HX1K3TKu.js";import{B as lt,A as Me}from"./book-open-D4v9dAb-.js";import{C as Be}from"./check-eCXpKYRG.js";import{X as dt}from"./x-HbUnH9yy.js";import{getFeedbackStatus as ut,recordUpvote as ht,recordDownvote as mt,applyFeedbackMultiplier as pt}from"./feedbackService-CkyHLPU6.js";const gt=[["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],ft=ue("circle-play",gt);const xt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],hs=ue("circle-x",xt);const yt=[["path",{d:"M14 2v6a2 2 0 0 0 .245.96l5.51 10.08A2 2 0 0 1 18 22H6a2 2 0 0 1-1.755-2.96l5.51-10.08A2 2 0 0 0 10 8V2",key:"18mbvz"}],["path",{d:"M6.453 15h11.094",key:"3shlmq"}],["path",{d:"M8.5 2h7",key:"csnxdl"}]],vt=ue("flask-conical",yt);const jt=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],bt=ue("image",jt);const Nt=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],_t=ue("star",Nt);const wt=[["path",{d:"M13.172 2a2 2 0 0 1 1.414.586l6.71 6.71a2.4 2.4 0 0 1 0 3.408l-4.592 4.592a2.4 2.4 0 0 1-3.408 0l-6.71-6.71A2 2 0 0 1 6 9.172V3a1 1 0 0 1 1-1z",key:"16rjxf"}],["path",{d:"M2 7v6.172a2 2 0 0 0 .586 1.414l6.71 6.71a2.4 2.4 0 0 0 3.191.193",key:"178nd4"}],["circle",{cx:"10.5",cy:"6.5",r:".5",fill:"currentColor",key:"12ikhr"}]],St=ue("tags",wt);const kt=[["path",{d:"M12 19h8",key:"baeox8"}],["path",{d:"m4 17 6-6-6-6",key:"1yngyt"}]],Ct=ue("terminal",kt);const Tt=[["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}],["path",{d:"M7 10v12",key:"1qc93n"}]],It=ue("thumbs-up",Tt);const Lt=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],Rt=ue("user",Lt),Et=/(?:[A-Za-z]:\\[\w\\. -]+|\/(?:Users|home|tmp|var|opt|etc)\/[\w/. -]+)/g;function ms(s){return s.replace(Et,"[LOCAL_PATH]")}function He({onSubmit:s,detectedPersona:t,isLoading:n}){const[i,o]=b.useState(""),[l,r]=b.useState([]),[d,c]=b.useState(null),[a,u]=b.useState(""),[p,y]=b.useState(!1),x=b.useRef(null),[v,g]=b.useState(()=>{try{const _=JSON.parse(localStorage.getItem("fix-problem-history")||"[]"),E=_.map(T=>typeof T=="string"?{query:T,cartId:null}:T);return _.length>0&&typeof _[0]=="string"&&localStorage.setItem("fix-problem-history",JSON.stringify(E)),E}catch{return[]}}),N=b.useCallback(_=>{const E=ms(_.target.value);if(o(E),E.length>15){const T=fe.matchErrorSignature(E),P=fe.extractTagsFromText(E),z=T.map(Y=>({tag:Y.tag,confidence:Y.confidence})),V=P.matches.map(Y=>({tag:Y.tag,confidence:Y.confidence})),X=[...z,...V],oe=new Set,ie=X.filter(Y=>oe.has(Y.tag.tag_id)?!1:(oe.add(Y.tag.tag_id),!0));r(ie.slice(0,5))}else r([])},[]),m=b.useCallback(_=>{const E=_.clipboardData?.items;if(E){for(const T of E)if(T.type.startsWith("image/")){_.preventDefault();const P=T.getAsFile(),z=new FileReader;z.onload=V=>c(V.target.result),z.readAsDataURL(P);return}}},[]),C=b.useCallback(_=>{_.preventDefault(),_.stopPropagation(),y(!0)},[]),S=b.useCallback(_=>{_.preventDefault(),_.stopPropagation(),y(!1)},[]),k=b.useCallback(_=>{_.preventDefault(),_.stopPropagation(),y(!1);const E=_.dataTransfer?.files;if(!E||E.length===0)return;const T=E[0];if(T.type.startsWith("image/")){const P=new FileReader;P.onload=z=>c(z.target.result),P.readAsDataURL(T)}},[]),M=b.useCallback((_,E)=>{g(T=>{const P=T.map(z=>z.query===_?{...z,cartId:E}:z);return localStorage.setItem("fix-problem-history",JSON.stringify(P)),P})},[]),R=b.useCallback((_=null,E=null)=>{const T=(E||i).trim();T.length<10||(g(P=>{const z=P.filter(X=>X.query!==T),V=[{query:T,cartId:_},...z].slice(0,6);return localStorage.setItem("fix-problem-history",JSON.stringify(V)),V}),s({query:T,detectedTagIds:l.map(P=>P.tag.tag_id),selectedTagIds:[],personaHint:t?.name,pastedImage:d,errorLog:a.trim()||null,cachedCartId:_||null,updateCartIdForQuery:M}))},[i,l,t,s,d,a,M]),$=b.useCallback(_=>{_.key==="Enter"&&_.ctrlKey&&R()},[R]),W=b.useMemo(()=>['My Blueprint Cast is giving me "Accessed None" error when trying to...',"Lumen is too noisy in my interior scene and I've tried increasing quality...","My character animation stutters when blending between states...","Nanite is causing Z-fighting on overlapping meshes...","Material instances aren't updating at runtime when I change parameters..."],[])[0];return e.jsxs("div",{className:"problem-input-container",onPaste:m,children:[e.jsxs("div",{className:"problem-input-header",children:[e.jsxs("h2",{children:[e.jsx(st,{size:22,className:"icon-inline"})," What's the problem?"]}),e.jsx("p",{className:"subtitle",children:"Describe your UE5 issue in plain English. We'll diagnose the root cause and teach you to fix it."})]}),e.jsxs("div",{className:"problem-input-field",children:[e.jsx("textarea",{value:i,onChange:N,onKeyDown:$,placeholder:W,rows:5,disabled:n,"aria-label":"Problem description"}),e.jsxs("div",{className:"char-count",children:[i.length," characters",i.length<10&&i.length>0&&e.jsx("span",{className:"warning",children:" (minimum 10)"})]})]}),l.length>0&&e.jsxs("div",{className:"detected-tags",children:[e.jsxs("span",{className:"label",children:[e.jsx(St,{size:14,className:"icon-inline"})," Detected:"]}),e.jsx("div",{className:"tag-list",children:l.map(_=>e.jsxs("span",{className:"tag-chip",title:_.tag.description||_.tag.display_name,children:[_.tag.display_name,e.jsxs("span",{className:"confidence",children:[Math.round(_.confidence*100),"%"]})]},_.tag.tag_id))})]}),e.jsxs("div",{className:`screenshot-zone ${a.trim()?"has-image":""}`,onClick:()=>{a.trim()||document.getElementById("error-log-input")?.focus()},children:[a.trim()?e.jsxs("div",{className:"pasted-preview error-log-preview",children:[e.jsx("pre",{className:"error-log-display",children:a}),e.jsx("button",{type:"button",className:"clear-error-log",onClick:_=>{_.stopPropagation(),u("")},"aria-label":"Remove error log",title:"Clear error log",children:e.jsx(hs,{size:20})})]}):e.jsxs("div",{className:"drop-prompt",children:[e.jsx(Ct,{size:20}),e.jsxs("span",{children:["Paste (",e.jsx("kbd",{children:"Ctrl+V"}),") an error log or build output"]})]}),e.jsx("textarea",{id:"error-log-input",className:"error-log-hidden-input",value:a,onChange:_=>u(_.target.value),onPaste:_=>{const E=_.clipboardData?.getData("text");E&&(_.preventDefault(),u(ms(E)))},rows:1})]}),e.jsx("div",{ref:x,className:`screenshot-zone ${p?"drag-over":""} ${d?"has-image":""}`,onDragOver:C,onDragLeave:S,onDrop:k,children:d?e.jsxs("div",{className:"pasted-preview",children:[e.jsx("img",{src:d,alt:"Pasted screenshot"}),e.jsx("button",{type:"button",className:"clear-error-log",onClick:()=>c(null),"aria-label":"Remove screenshot",title:"Remove screenshot",children:e.jsx(hs,{size:20})})]}):e.jsxs("div",{className:"drop-prompt",children:[e.jsx(bt,{size:20}),e.jsxs("span",{children:["Paste (",e.jsx("kbd",{children:"Ctrl+V"}),") or drag a screenshot here"]})]})}),t&&e.jsxs("div",{className:"persona-context",children:[e.jsxs("span",{className:"label",children:[e.jsx(Rt,{size:14,className:"icon-inline"})," Context:"]}),e.jsx("span",{className:"persona-chip",children:t.name}),e.jsx("span",{className:"hint",children:"Recommendations will be tailored for you"})]}),e.jsxs("div",{className:"problem-input-actions",children:[e.jsx("button",{className:"submit-btn primary",onClick:()=>R(),disabled:i.trim().length<10||n,children:n?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner"})," Diagnosing..."]}):e.jsx(e.Fragment,{children:"Get Diagnosis ‚Üí"})}),e.jsxs("span",{className:"hint",children:["Press ",e.jsx("kbd",{children:"Ctrl"})," + ",e.jsx("kbd",{children:"Enter"})," to submit"]})]}),v.length>0&&e.jsxs("div",{className:"query-history",children:[e.jsx("span",{className:"history-label",children:"üïò Recent questions:"}),e.jsx("div",{className:"history-chips",children:v.map((_,E)=>{const T=_.query||_,P=_.cartId||null,z=!!P;return e.jsxs("div",{className:"history-chip-row",children:[e.jsxs("button",{type:"button",className:`history-chip ${z?"cached":""}`,onClick:()=>{o(T),N({target:{value:T}}),z&&!n&&setTimeout(()=>R(P,T),50)},title:z?`${T} (cached ‚Äî instant load)`:T,disabled:n,children:[z&&e.jsx("span",{className:"cache-indicator",children:"‚ö°"}),T.length>50?T.slice(0,50)+"‚Ä¶":T]}),e.jsx("button",{type:"button",className:"history-delete",onClick:()=>{g(V=>{const X=V.filter((oe,ie)=>ie!==E);return localStorage.setItem("fix-problem-history",JSON.stringify(X)),X})},title:"Remove",children:"√ó"})]},E)})})]})]})}He.propTypes={onSubmit:h.func.isRequired,detectedPersona:h.shape({id:h.string,name:h.string,emoji:h.string}),isLoading:h.bool};He.defaultProps={detectedPersona:null,isLoading:!1};function Mt({problemSummary:s,courses:t,diagnosis:n}){if(!t||t.length===0)return{title:"Your Learning Path",intro:"Let's solve your problem step by step.",instructors:[],totalDuration:null};const i=At(t),o=Pt(t),l=Ft({instructors:i,courseCount:t.length,totalDuration:o,rootCauses:n?.root_causes||[]});return{title:`Your Path: ${Dt(s)}`,intro:l,instructors:i,totalDuration:o,courseCount:t.length,rootCauses:n?.root_causes||[]}}function $t(s,t,n){if(!t)return{type:"completion",text:"üéâ Congratulations! You've completed your learning path.",subtext:"You now have the skills to solve this problem and similar ones in the future."};const i=Ye(s),o=Ye(t),l=t.title||t.name||"the next lesson";return i&&o&&i!==o?{type:"transition",text:`Now let's hear from ${o}`,subtext:`${o} will cover: ${n||l}`,instructor:o}:{type:"continuation",text:`Next up: ${l}`,subtext:n||null,instructor:o}}function At(s){const t=new Set,n=[];return s.forEach(i=>{const o=Ye(i);if(o&&!t.has(o))t.add(o),n.push({name:o,courses:[i.title||i.name],totalDuration:Qe(i)});else if(o){const l=n.find(r=>r.name===o);l&&(l.courses.push(i.title||i.name),l.totalDuration+=Qe(i))}}),n}function Ye(s){return s&&(s.instructor||s.author||s.creator||s.teacher||qt(s.title||s.name))||null}function qt(s){if(!s)return null;const t=s.match(/\bby\s+([A-Z][a-zA-Z]+(?:\s+[A-Z][a-zA-Z]+)?)/i);if(t)return t[1];const n=s.match(/\bwith\s+([A-Z][a-zA-Z]+(?:\s+[A-Z][a-zA-Z]+)?)/i);return n?n[1]:null}function Pt(s){const t=s.reduce((n,i)=>n+Qe(i),0);return Ot(t)}function Qe(s){return s?s.duration_seconds?s.duration_seconds:s.duration_minutes?s.duration_minutes*60:s.videos?.length?s.videos.reduce((t,n)=>t+(n.duration_seconds||0),0):0:0}function Ot(s){if(!s||s<=0)return null;const t=Math.floor(s/3600),n=Math.floor(s%3600/60);return t>0?n>0?`${t} hr ${n} min`:`${t} hr`:`${n} min`}function Dt(s){if(!s)return"Learning Path";if(s.length<=80)return s;const t=s.slice(0,80),n=t.lastIndexOf(" ");return(n>30?t.slice(0,n):t)+"‚Ä¶"}function Ft({instructors:s,courseCount:t,totalDuration:n,rootCauses:i}){const o=[];if(i.length>0&&o.push(`We've identified ${i.length} root cause${i.length>1?"s":""} for your issue:`),s.length===1)o.push(`${s[0].name} will guide you through ${t} lesson${t>1?"s":""}.`);else if(s.length>1){const l=s.map(d=>d.name),r=l.pop();o.push(`You'll learn from ${l.join(", ")} and ${r}.`)}else o.push(`You have ${t} lesson${t>1?"s":""} to complete.`);return n&&o.push(`Total time: ${n}.`),o.join(" ")}function zt(s,t){const n=Math.round((s+1)/t*100);return{text:`Video ${s+1} of ${t}`,percent:n,isComplete:s+1>=t}}function Ut(s,t,n,i=0){const l=[...s?.canonical_tags||[],...s?.gemini_system_tags||[],...s?.transcript_tags||[],...s?.extracted_tags||[],...Array.isArray(s?.tags)?s.tags:[]].map(g=>typeof g=="string"?g.split(".").pop():g.name||g.display_name||"").filter(Boolean).filter((g,N,m)=>m.indexOf(g)===N),r=s?.gemini_skill_level||"Intermediate",d=(t||"").toLowerCase(),c=[],a=new Set,u=g=>{for(const N of g)a.has(N.task)||(a.add(N.task),c.push(N))};if(d){const g=Object.keys(Se).sort((N,m)=>m.length-N.length);for(const N of g)d.includes(N)&&u(Se[N])}const p=[...l].sort((g,N)=>{const m=d.includes(g.toLowerCase())?1:0;return(d.includes(N.toLowerCase())?1:0)-m});for(const g of p){const N=g.toLowerCase();Se[N]&&u(Se[N])}if(c.length>0){const g=c[i%c.length];return{task:g.task,hint:g.hint,expectedResult:g.expectedResult,docsUrl:g.docsUrl||null,difficulty:r}}const y=l[0]||(n?n.split(/\s+/).slice(0,3).join(" "):"this concept"),x=n?`"${n}"`:"this lesson",v=s?.gemini_outcomes?.[0]||"";return{task:t?`Open UE5 and apply the technique from ${x} to address "${t}". In the Details panel, identify which ${y} settings you changed and note the before/after values.`:`Open UE5, create a test Actor, and set up ${y} from scratch following the approach from ${x}. Document which panels and properties you used.`,hint:v?`Focus on: ${v}. Check Details panel and World Settings for relevant options.`:`Look for ${y} options in the Details panel, Modes panel, or Project Settings ‚Üí Engine.`,expectedResult:t?`Your original issue ("${t}") should be resolved or visibly improved in the viewport. Compare before/after values in the Details panel to confirm the change took effect.`:`You should see ${y} applied correctly in the viewport or preview. The Details panel should reflect the new settings, and the editor should show no warnings related to your changes.`,difficulty:r}}const ks="ue5_learning_progress";function Cs(){try{const s=localStorage.getItem(ks);return s?{...$e(),...JSON.parse(s)}:$e()}catch{return $e()}}function $e(){return{completedPaths:[],tagsEncountered:{},totalVideosWatched:0,reflections:[],streak:{lastDate:null,count:0}}}function Vt(s){try{localStorage.setItem(ks,JSON.stringify(s))}catch(t){re("[LearningProgress] Failed to save:",t.message)}}function Gt(s,t,n){const i=Cs(),o=new Date().toISOString().split("T")[0];i.completedPaths.includes(s)||i.completedPaths.push(s);for(const l of t){const r=l.extracted_tags||l.tags||[];for(const d of r){const c=typeof d=="string"?d:d.name||d.display_name;c&&(i.tagsEncountered[c]=(i.tagsEncountered[c]||0)+1)}}if(i.totalVideosWatched+=t.length,i.streak.lastDate!==o){const l=new Date;l.setDate(l.getDate()-1);const r=l.toISOString().split("T")[0];i.streak.lastDate===r?i.streak.count+=1:i.streak.count=1,i.streak.lastDate=o}return n&&n.trim().length>0&&i.reflections.push({date:o,pathId:s,text:n.trim()}),Vt(i),i}function Wt(){const s=Cs(),t=new Date().toISOString().split("T")[0],n=new Date;n.setDate(n.getDate()-1);const i=n.toISOString().split("T")[0],o=s.streak.lastDate===t||s.streak.lastDate===i;return{count:o?s.streak.count:0,isActive:o}}const B={INTRO:"intro",PLAYING:"playing",QUIZ:"quiz",CHALLENGE:"challenge",BRIDGE:"bridge",COMPLETE:"complete"};function Bt({courses:s,diagnosis:t,problemSummary:n,pathSummary:i,onComplete:o,onExit:l}){const[r,d]=b.useState(B.INTRO),[c,a]=b.useState(0),[u,p]=b.useState(0),[y,x]=b.useState(""),[v,g]=b.useState(null),[N,m]=b.useState(!0);b.useEffect(()=>Bs(H=>{g(H),m(!1)}),[]);const C=b.useCallback(async()=>{m(!0);const{error:I}=await Ys();I&&console.error("[GuidedPlayer] Sign in failed:",I),m(!1)},[]),S=s[c]||null,k=s[c+1]||null,M=S?.videos||[],R=M[u]||M[0]||null,$=u<M.length-1,A=u>0||c>0,W=$||!!k,_=M.length,E=b.useMemo(()=>Mt({problemSummary:n,courses:s,diagnosis:t}),[n,s,t]),T=b.useMemo(()=>Wt(),[]),P=b.useMemo(()=>s.reduce((I,H)=>I+(H.videos?.length||1),0),[s]),z=b.useMemo(()=>{let I=0;for(let H=0;H<c;H++)I+=s[H]?.videos?.length||1;return I+u},[s,c,u]),V=b.useMemo(()=>zt(z,P),[z,P]),X=b.useMemo(()=>{if(r!==B.BRIDGE)return null;const I=S?.gemini_outcomes?.[0]||null;return $t(S,k,I)},[r,S,k]),oe=b.useMemo(()=>r!==B.CHALLENGE?null:Ut(S,n,R?.title,c),[r,S,n,R,c]),ie=b.useCallback(()=>{d(B.PLAYING)},[]),Y=b.useCallback(()=>{if(S?._readingStep){k?(a(I=>I+1),p(0),d(B.PLAYING)):(d(B.COMPLETE),o?.());return}if($)p(I=>I+1);else{const I=ws[S?.code];I&&Object.keys(I).length>0?d(B.QUIZ):d(B.CHALLENGE)}},[$,S,k,o]),ye=b.useCallback(()=>{if(u>0)p(I=>I-1);else if(c>0){const I=s[c-1]?.videos||[];a(H=>H-1),p(Math.max(0,I.length-1))}},[u,c,s]),f=b.useCallback(()=>{$?p(I=>I+1):k&&(a(I=>I+1),p(0))},[$,k]),j=b.useCallback(()=>{a(0),p(0),d(B.PLAYING)},[]),w=b.useCallback(()=>{d(B.CHALLENGE)},[]),L=b.useCallback(()=>{k?(a(I=>I+1),p(0),d(B.PLAYING)):(d(B.COMPLETE),o?.())},[k,o]),F=b.useCallback(()=>{a(I=>I+1),p(0),d(B.PLAYING)},[]),Q=b.useCallback(I=>{a(I),p(0),d(B.PLAYING)},[]),ce=b.useCallback(()=>{const I=n?`path-${n.replace(/\s+/g,"-").toLowerCase().slice(0,40)}-${Date.now()}`:`path-${Date.now()}`;Gt(I,s,y),l?.()},[n,s,y,l]),O=y.trim().split(/\s+/).filter(Boolean).length;return{stage:r,currentIndex:c,videoIndex:u,reflectionText:y,setReflectionText:x,user:v,authLoading:N,currentCourse:S,nextCourse:k,currentVideos:M,currentVideo:R,hasMoreVideos:$,hasPreviousVideo:A,hasNextVideo:W,courseVideoCount:_,introContent:E,streak:T,progress:V,bridgeContent:X,challengeContent:oe,pathSummary:i,wordCount:O,courses:s,handleSignIn:C,handleStartLearning:ie,handleVideoComplete:Y,handlePreviousVideo:ye,handleNextVideo:f,handleBackToPath:j,handleQuizComplete:w,handleChallengeComplete:L,handleContinue:F,handleSkipTo:Q,handleFinish:ce,onExit:l}}function Ts({challengeContent:s,onComplete:t}){return e.jsxs("div",{className:"challenge-card",children:[e.jsx("div",{className:"challenge-icon",children:"üî®"}),e.jsx("h3",{children:"Try It Yourself"}),e.jsx("div",{className:"challenge-difficulty",children:e.jsx("span",{className:`difficulty-badge ${s.difficulty.toLowerCase()}`,children:s.difficulty})}),e.jsx("p",{className:"challenge-task",children:s.task}),s.expectedResult&&e.jsxs("div",{className:"challenge-expected",children:[e.jsx("span",{className:"expected-label",children:"üëÅÔ∏è What to look for:"})," ",s.expectedResult]}),e.jsxs("div",{className:"challenge-hint",children:[e.jsx("span",{className:"hint-label",children:"üí° Hint:"})," ",s.hint]}),s.docsUrl&&e.jsx("a",{className:"docs-link",href:s.docsUrl,target:"_blank",rel:"noopener noreferrer",children:"üìñ Read the official UE5 docs ‚Üí"}),e.jsx("button",{className:"challenge-done-btn",onClick:t,children:"I tried it ‚Üí"}),e.jsx("button",{className:"challenge-skip-btn",onClick:t,children:"Skip challenge"})]})}Ts.propTypes={challengeContent:h.shape({task:h.string.isRequired,hint:h.string.isRequired,expectedResult:h.string,docsUrl:h.string,difficulty:h.string.isRequired}).isRequired,onComplete:h.func.isRequired};h.shape({type:h.string.isRequired,text:h.string.isRequired,subtext:h.string}).isRequired,h.func.isRequired;function Yt(s){const t=new Set;for(const n of s)(n.ai_tags||[]).forEach(i=>t.add(i)),(n._matchedKeywords||[]).forEach(i=>t.add(i));return[...t].slice(0,8)}function Qt(s){return s.map(t=>{const n=t.gemini_outcomes||[];return{title:(t.title||t.name||t.videos?.[0]?.title||"Lesson").replace(/\s+Part\s+[A-Z]$/i,"").trim(),outcomes:n.slice(0,3),courseCode:t.code}}).filter(t=>t.outcomes.length>0)}function Is({courses:s,totalDuration:t,reflectionText:n,onReflectionChange:i,wordCount:o,onFinish:l,onBackToPath:r,problemSummary:d}){const[c,a]=b.useState(!1);b.useEffect(()=>{if(n.trim())try{localStorage.setItem("lp_reflection_draft",JSON.stringify({text:n,timestamp:Date.now(),courseCount:s.length}))}catch{}},[n,s.length]),b.useEffect(()=>{try{const v=JSON.parse(localStorage.getItem("lp_reflection_draft")||"null");v?.text&&!n&&i(v.text)}catch{}},[]);const u=Yt(s),p=Qt(s),y=c?p:p.slice(0,3),x=s.reduce((v,g)=>v+(g.videos?.length||1),0);return e.jsxs("div",{className:"complete-card",children:[e.jsx("div",{className:"complete-icon",children:"üéâ"}),e.jsx("h2",{children:"Path Complete!"}),d&&e.jsxs("p",{className:"complete-problem-context",children:["You explored: ",e.jsx("strong",{children:d})]}),e.jsx("p",{children:"You've learned the skills to solve this problem and similar ones in the future."}),e.jsxs("div",{className:"complete-stats-grid",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("span",{className:"stat-icon",children:"üìö"}),e.jsx("span",{className:"stat-value",children:s.length}),e.jsx("span",{className:"stat-label",children:"Lessons"})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("span",{className:"stat-icon",children:"üé¨"}),e.jsx("span",{className:"stat-value",children:x}),e.jsx("span",{className:"stat-label",children:"Videos"})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("span",{className:"stat-icon",children:"‚è±"}),e.jsx("span",{className:"stat-value",children:t||"‚Äî"}),e.jsx("span",{className:"stat-label",children:"Total Time"})]}),u.length>0&&e.jsxs("div",{className:"stat-card",children:[e.jsx("span",{className:"stat-icon",children:"üè∑Ô∏è"}),e.jsx("span",{className:"stat-value",children:u.length}),e.jsx("span",{className:"stat-label",children:"Topics"})]})]}),p.length>0&&e.jsxs("div",{className:"complete-takeaways",children:[e.jsx("h3",{children:"üéØ Key Takeaways"}),e.jsx("div",{className:"takeaway-list",children:y.map((v,g)=>e.jsxs("div",{className:"takeaway-card",children:[e.jsxs("h4",{className:"takeaway-title",children:[e.jsx("span",{className:"takeaway-number",children:g+1}),v.title]}),e.jsx("ul",{className:"takeaway-outcomes",children:v.outcomes.map((N,m)=>e.jsx("li",{children:N},m))})]},v.courseCode||g))}),p.length>3&&e.jsx("button",{className:"show-more-takeaways",onClick:()=>a(v=>!v),children:c?"Show less":`Show ${p.length-3} more`})]}),u.length>0&&e.jsxs("div",{className:"complete-topics",children:[e.jsx("h3",{children:"üè∑Ô∏è Topics Covered"}),e.jsx("div",{className:"topic-chips",children:u.map(v=>e.jsx("span",{className:"topic-chip",children:v.replace(/_/g," ")},v))})]}),e.jsxs("div",{className:"reflection-area",children:[e.jsx("h3",{children:"üìù What was your main takeaway?"}),e.jsx("p",{className:"reflection-subtitle",children:"Writing your reflection helps cement what you learned."}),e.jsx("textarea",{className:"reflection-input",placeholder:"I learned that...",value:n,onChange:v=>i(v.target.value),rows:4}),e.jsxs("div",{className:"reflection-meta",children:[o===0&&e.jsx("span",{className:"word-hint",children:"Try writing a few sentences"}),o>0&&o<10&&e.jsxs("span",{className:"word-hint",children:[o," words ‚Äî keep going!"]}),o>=10&&e.jsx("span",{className:"word-hint done",children:"Great reflection! ‚úì"})]})]}),e.jsxs("div",{className:"completion-actions",children:[e.jsx("button",{className:"finish-btn",onClick:()=>{l();try{localStorage.removeItem("lp_reflection_draft")}catch{}},children:n.trim()?"Save & Finish":"Back to Problems"}),r&&e.jsx("button",{className:"back-to-path-btn",onClick:r,children:"‚Üê Back to Learning Path"})]})]})}Is.propTypes={courses:h.array.isRequired,totalDuration:h.string,reflectionText:h.string.isRequired,onReflectionChange:h.func.isRequired,wordCount:h.number.isRequired,onFinish:h.func.isRequired,onBackToPath:h.func,problemSummary:h.string};function be(s){return s?s.replace(/\.mp4$/i,"").replace(/_/g," ").replace(/^[A-Z]{2,5}\s+\d[\d.]*\s*/gi,"").replace(/^\d+\.\d+\s*/g,"").replace(/^0*\d{1,3}\s+/g,"").replace(/^(\w+)[ _]\1[ _]/i,"").replace(/^(?:and|or)\s+/i,"").replace(/\s+\d{1,3}\s*(NEW|FINAL|EDIT|EDITED|OLD|DRAFT|v\d+)?\s*$/gi,"").replace(/\s+(NEW|FINAL|EDIT|EDITED|OLD|DRAFT|v\d+)\s*$/gi,"").replace(/([a-z])(\d{2})$/g,"$1").replace(/([a-z])([A-Z])/g,"$1 $2").replace(/([A-Z]+)([A-Z][a-z])/g,"$1 $2").replace(/\s+(?:5[0-5]|4[0-9])$/g,"").replace(/[-]+\s*$/g,"").replace(/^\s*[-]+/g,"").replace(/\s{2,}/g," ").trim()||s:"Untitled Video"}function Ls({courses:s,currentIndex:t,onSkipTo:n}){const i=s.map(o=>o.code);return e.jsxs("div",{className:"course-sidebar",children:[e.jsx("h4",{children:"Your Path"}),e.jsx("div",{className:"sidebar-courses",children:s.map((o,l)=>{const r=Ss[o.code],d=r?.prerequisites?.filter(c=>!i.includes(c))||[];return e.jsxs("button",{className:`sidebar-course ${l===t?"active":""} ${l<t?"completed":""}`,onClick:()=>n(l),title:be(o.videos?.[0]?.title||o.title||o.name),children:[e.jsx("span",{className:"index",children:l<t?"‚úì":l+1}),e.jsx("span",{className:"title",children:be(o.videos?.[0]?.title||o.title||o.name)}),r?.difficulty&&e.jsx("span",{className:`difficulty-tag ${r.difficulty}`,children:r.difficulty}),d.length>0&&e.jsx("span",{className:"prereq-warning",title:`Recommended: ${d.join(", ")} first`,children:"‚ö†Ô∏è"})]},o.code||l)})})]})}Ls.propTypes={courses:h.array.isRequired,currentIndex:h.number.isRequired,onSkipTo:h.func.isRequired};function Rs({courseCode:s,videoKey:t,onComplete:n,onSkip:i}){const[o,l]=b.useState(0),[r,d]=b.useState(null),[c,a]=b.useState(!1),[u,p]=b.useState(0),[y,x]=b.useState(!1),v=b.useMemo(()=>{if(!s||!t)return[];const R=ws[s];if(!R)return[];if(R[t])return R[t];const $=W=>(W||"").replace(/\.mp4$/i,"").replace(/^[\d._]+/,"").replace(/[\s_]+/g,"").toLowerCase(),A=$(t);for(const[W,_]of Object.entries(R)){const E=$(W);if(E===A||E.includes(A)||A.includes(E))return _}return[]},[s,t]);if(v.length===0)return null;const g=v[o],N=r===g?.correct,m=v.length,C=R=>{c||d(R)},S=()=>{r!==null&&(a(!0),r===g.correct&&p(R=>R+1))},k=()=>{o<m-1?(l(R=>R+1),d(null),a(!1)):x(!0)},M=()=>{n({score:u,total:m})};if(y){const R=Math.round(u/m*100),$=R>=80?_t:R>=50?It:lt,A=R>=80?"Excellent! You've got a strong grasp of this material.":R>=50?"Good effort! Consider rewatching for the topics you missed.":"You might want to re-watch this section before moving on.";return e.jsx("div",{className:"quiz-card",children:e.jsxs("div",{className:"quiz-score-summary",children:[e.jsx("div",{className:"score-icon-container",children:e.jsx($,{size:48,className:"score-icon"})}),e.jsxs("h3",{children:[u,"/",m," Correct"]}),e.jsx("div",{className:"score-bar",children:e.jsx("div",{className:"score-fill",style:{width:`${R}%`}})}),e.jsx("p",{className:"score-message",children:A}),e.jsxs("button",{className:"quiz-continue-btn",onClick:M,children:["Continue ",e.jsx(Me,{size:16})]})]})})}return e.jsxs("div",{className:"quiz-card",children:[e.jsxs("div",{className:"quiz-header",children:[e.jsx("span",{className:"quiz-icon",children:e.jsx(vt,{size:20})}),e.jsx("h3",{children:"Quick Check"}),e.jsxs("span",{className:"quiz-progress",children:[o+1," / ",m]})]}),e.jsx("p",{className:"quiz-question",children:g.question}),e.jsx("div",{className:"quiz-options",children:g.options.map((R,$)=>{let A="quiz-option";return r===$&&(A+=" selected"),c&&($===g.correct?A+=" correct":r===$&&(A+=" incorrect")),e.jsxs("button",{className:A,onClick:()=>C($),disabled:c,children:[e.jsx("span",{className:"option-letter",children:String.fromCharCode(65+$)}),e.jsx("span",{className:"option-text",children:R}),c&&$===g.correct&&e.jsx("span",{className:"option-icon",children:e.jsx(Be,{size:16})}),c&&r===$&&$!==g.correct&&e.jsx("span",{className:"option-icon",children:e.jsx(dt,{size:16})})]},$)})}),c&&g.explanation&&e.jsxs("div",{className:`quiz-explanation ${N?"correct":"incorrect"}`,children:[e.jsx("span",{className:"explanation-icon",children:N?e.jsx(Be,{size:16}):e.jsx(ct,{size:16})}),e.jsx("p",{children:g.explanation})]}),e.jsxs("div",{className:"quiz-actions",children:[c?e.jsx("button",{className:"quiz-next-btn",onClick:k,children:o<m-1?e.jsxs(e.Fragment,{children:["Next Question ",e.jsx(Me,{size:16})]}):e.jsxs(e.Fragment,{children:["See Results ",e.jsx(Me,{size:16})]})}):e.jsx("button",{className:"quiz-check-btn",onClick:S,disabled:r===null,children:"Check Answer"}),e.jsx("button",{className:"quiz-skip-btn",onClick:i,children:"Skip Quiz"})]})]})}Rs.propTypes={courseCode:h.string,videoKey:h.string,onComplete:h.func.isRequired,onSkip:h.func.isRequired};const _e=new Set(["the","and","for","with","this","that","are","was","has","have","not","can","into","from","how","you","your","will","would","also","just","like","more","very","some","want","need","make","use","used","using","help","helpful","helps","get","getting","let","look","going","come","here","there","know","thing","really","actually","basically","something","everything","slow","fast","leading","exhibiting","experiencing","causing","about","been","being","could","does","doing","done","each","even","every","first","give","good","great","kind","made","much","over","part","right","same","see","show","start","still","take","tell","than","them","then","these","they","those","through","time","took","turn","way","well","what","when","where","which","while","work","working","unreal","engine","introduction","quick"]),Kt=new Set(["gonna","going","really","actually","basically","right","thing","things","about","would","could","should","there","their","these","those","where","which","being","doing","using","other","first","second","third","after","before","every","still","again","already","engine","unreal","because","simply","called","allows","looking","provides"]);function Ae(s){return(s||"").replace(/\.mp4$/i,"").replace(/^[\d._]+/,"").replace(/[\s_]+/g,"").toLowerCase()}function Es({courseCode:s,videoTitle:t,problemSummary:n,matchedKeywords:i}){const[o,l]=b.useState(null);b.useEffect(()=>{let c=!1;return xe(()=>import("./data-transcripts-CYT280mV.js"),[]).then(a=>{c||l(a.default||a)}),()=>{c=!0}},[]);const r=b.useMemo(()=>{if(!s||!o)return[];const c=o[s];if(!c)return[];const a=Ae(t);let u=null;for(const[g,N]of Object.entries(c))if(Ae(g)===a){u=N;break}if(!u)for(const[g,N]of Object.entries(c)){const m=Ae(g);if(m.includes(a)||a.includes(m)){u=N;break}}if(!u||u.length===0)return[];const p=[];if(n&&p.push(...n.toLowerCase().split(/\s+/).filter(g=>g.length>3&&!_e.has(g))),i&&p.push(...i.map(g=>(typeof g=="string"?g:g.display_name||g.id||"").toLowerCase())),p.length===0){const g=u.filter(m=>m.start&&m.start!=="0:00");if(g.length===0)return[];const N=Math.max(1,Math.floor(g.length/3));return g.filter((m,C)=>C%N===0).slice(0,3).map(m=>({...m,score:0,isChapter:!0}))}const x=u.map(g=>{const N=g.text.toLowerCase();let m=0;const C=[];for(const S of p)N.includes(S)&&(m+=10,C.includes(S)||C.push(S));return{...g,score:m,hits:[...new Set(C)]}}).filter(g=>g.score>0).sort((g,N)=>N.score-g.score);if(x.length>0){const g=x.slice(0,3);return g.sort((N,m)=>{const C=S=>{const k=(S||"0:00").split(":").map(Number);return k.length===3?k[0]*3600+k[1]*60+k[2]:k[0]*60+(k[1]||0)};return C(N.start)-C(m.start)}),g}const v=Math.max(1,Math.floor(u.length/3));return u.filter((g,N)=>N%v===0).slice(0,3).map(g=>({...g,score:0,isChapter:!0}))},[s,t,n,i,o]),d=b.useCallback(c=>{if(c.summary)return c.summary;const u=(c.text||"").replace(/[.,;:!?'"()]/g,"").split(/\s+/).filter(x=>x.length>=5&&!Kt.has(x.toLowerCase())).map(x=>x.toLowerCase()),p={};for(const x of u)p[x]=(p[x]||0)+1;const y=Object.entries(p).sort((x,v)=>v[1]-x[1]).slice(0,3).map(([x])=>x.charAt(0).toUpperCase()+x.slice(1));return y.length>0?y.join(", "):"Overview"},[]);return r.length===0?null:e.jsx("div",{className:"video-info-cards",children:e.jsxs("div",{className:"info-card transcript-card",children:[e.jsx("h4",{children:r[0]?.isChapter?"üìã Video Chapters":`üéØ üé¨ Video Callouts: ${n||"your search"}`}),e.jsx("div",{className:"timestamp-list",children:r.map((c,a)=>e.jsxs("div",{className:`timestamp-item ${c.score>0?"relevant":""}`,children:[e.jsx("span",{className:"timestamp-badge",children:c.start}),e.jsx("span",{className:"timestamp-text",children:d(c)})]},a))})]})})}Es.propTypes={courseCode:h.string,videoTitle:h.string,problemSummary:h.string,matchedKeywords:h.array};function Ht(s){if(!s||typeof s!="string")return s;s=s.replace(/\s*\[\d+(?:[,\s]*\d+)*\]/g,"").trim();const t=[];let n=s,i=0;for(;n.length>0;){const o=[{re:/\*\*(.+?)\*\*/,wrap:c=>e.jsx("strong",{children:c},i++)},{re:/\*(.+?)\*/,wrap:c=>e.jsx("em",{children:c},i++)},{re:/`([^`]+)`/,wrap:c=>e.jsx("code",{className:"inline-code",children:c},i++)},{re:/\[([^\]]+)\]\(([^)]+)\)/,wrap:(c,a)=>{const u=/^https?:\/\//i.test(a)?a:"#";return e.jsx("a",{href:u,target:"_blank",rel:"noopener noreferrer",children:c},i++)}}];let l=null,r=n.length,d=null;for(const c of o){const a=n.match(c.re);a&&a.index<r&&(l=a,r=a.index,d=c)}if(!l){t.push(n);break}r>0&&t.push(n.slice(0,r)),t.push(d.wrap(l[1],l[2])),n=n.slice(r+l[0].length)}return t}function Ze(s){const t=Bt(s);return e.jsxs("div",{className:"guided-player",children:[e.jsxs("div",{className:"progress-bar",children:[e.jsx("div",{className:"progress-fill",style:{width:`${t.progress.percent}%`}}),e.jsx("span",{className:"progress-text",children:t.progress.text})]}),t.stage===B.INTRO&&e.jsx(Zt,{introContent:t.introContent,streak:t.streak,courses:t.courses,pathSummary:t.pathSummary,user:t.user,authLoading:t.authLoading,onSignIn:t.handleSignIn,onStart:t.handleStartLearning}),t.stage===B.PLAYING&&t.currentCourse&&!t.currentCourse._readingStep&&e.jsx(Jt,{course:t.currentCourse,currentVideos:t.currentVideos,currentVideo:t.currentVideo,videoIndex:t.videoIndex,hasMoreVideos:t.hasMoreVideos,microLesson:s.microLesson,courses:t.courses,onVideoComplete:t.handleVideoComplete,onExit:t.onExit}),t.stage===B.PLAYING&&t.currentCourse&&t.currentCourse._readingStep&&e.jsx(Ms,{course:t.currentCourse,stepNumber:t.currentIndex+1,totalSteps:t.courses.length,onComplete:t.handleVideoComplete,onExit:t.onExit}),t.stage===B.QUIZ&&e.jsx(Rs,{courseCode:t.currentCourse?.code,videoKey:t.currentVideo?.title||t.currentVideo?.name||"",onComplete:t.handleQuizComplete,onSkip:t.handleQuizComplete}),t.stage===B.CHALLENGE&&t.challengeContent&&e.jsx(Ts,{challengeContent:t.challengeContent,onComplete:t.handleChallengeComplete}),t.stage===B.COMPLETE&&e.jsx(Is,{courses:t.courses,totalDuration:t.introContent.totalDuration,reflectionText:t.reflectionText,onReflectionChange:t.setReflectionText,wordCount:t.wordCount,onFinish:t.handleFinish,onBackToPath:t.handleBackToPath,problemSummary:s.problemSummary}),t.stage!==B.INTRO&&t.stage!==B.COMPLETE&&e.jsxs("div",{className:"sidebar-column",children:[e.jsx(Ls,{courses:t.courses,currentIndex:t.currentIndex,onSkipTo:t.handleSkipTo}),t.stage===B.PLAYING&&t.currentCourse&&e.jsx(Es,{courseCode:t.currentCourse.code,videoTitle:t.currentVideo?.title||t.currentVideo?.name||"",problemSummary:s.problemSummary,matchedKeywords:t.currentCourse._matchedKeywords})]})]})}Ze.propTypes={courses:h.array.isRequired,diagnosis:h.object,problemSummary:h.string,microLesson:h.object,pathSummary:h.shape({path_summary:h.string,topics_covered:h.arrayOf(h.string)}),onComplete:h.func,onExit:h.func};Ze.defaultProps={diagnosis:null,problemSummary:"",microLesson:null,pathSummary:null,onComplete:()=>{},onExit:()=>{}};function Zt({introContent:s,streak:t,courses:n,pathSummary:i,user:o,authLoading:l,onSignIn:r,onStart:d}){return e.jsxs("div",{className:"intro-card",children:[e.jsx("h2",{children:s.title}),e.jsx("p",{className:"intro-text",children:s.intro}),s.rootCauses?.length>0&&e.jsx("ol",{className:"root-cause-list",children:s.rootCauses.map((c,a)=>e.jsx("li",{children:c.replace(/\s*\[\d+\]/g,"")},a))}),t.isActive&&t.count>1&&e.jsxs("div",{className:"streak-badge",children:["üî• ",t.count,"-day learning streak!"]}),e.jsxs("div",{className:"course-preview",children:[e.jsx("h3",{children:"üìö What You'll Learn"}),i?.path_summary&&!/unavailable/i.test(i.path_summary)&&e.jsx("div",{className:"path-summary-section",children:e.jsx("p",{className:"path-summary-text",children:i.path_summary})}),e.jsxs("div",{className:"course-list",children:[n.slice(0,5).map((c,a)=>{const u=nt[c.code]||[],p=c.videos?.[0]?.title||c.title||c.name;return e.jsxs("div",{className:"course-preview-item",children:[e.jsx("span",{className:"number",children:a+1}),e.jsxs("div",{className:"course-preview-details",children:[e.jsx("span",{className:"title",children:p?.replace(/\s+Part\s+[A-Z]$/i,"").trim()}),u.length>0&&e.jsx("ul",{className:"objective-list",children:u.slice(0,2).map((y,x)=>e.jsx("li",{children:y},x))})]})]},c.code||a)}),n.length>5&&e.jsxs("div",{className:"more-courses",children:["+",n.length-5," more"]})]})]}),e.jsx("div",{className:"auth-section",children:l?e.jsx("p",{className:"auth-loading",children:"Checking sign-in status..."}):o?e.jsxs("div",{className:"auth-signed-in",children:[e.jsxs("span",{className:"user-email",children:["‚úì Signed in as ",o.email]}),e.jsx("button",{className:"start-btn",onClick:d,children:"‚ñ∂ Start Learning"})]}):e.jsxs("div",{className:"auth-prompt",children:[e.jsx("p",{className:"signin-note",children:"Sign in with Google to watch videos from Google Drive"}),e.jsx("button",{className:"signin-btn",onClick:r,children:"üîê Sign in with Google"}),e.jsx("button",{className:"start-btn secondary",onClick:d,children:"Skip sign-in (videos may not load)"})]})})]})}function Jt({course:s,currentVideos:t,currentVideo:n,videoIndex:i,hasMoreVideos:o,microLesson:l,courses:r,onVideoComplete:d,onExit:c}){const a=n?.drive_id;return e.jsxs("div",{className:"video-stage",children:[e.jsxs("div",{className:"video-header",children:[e.jsx("h3",{children:s.title||s.name}),t.length>1&&e.jsxs("span",{className:"video-counter",children:["Video ",i+1," of ",t.length]}),s.gemini_outcomes?.[0]&&e.jsx("p",{className:"objective",children:s.gemini_outcomes[0]})]}),e.jsx("div",{className:"video-container",children:a?e.jsx("iframe",{src:`https://drive.google.com/file/d/${a}/preview`,title:n.title||s.title,allow:"autoplay",allowFullScreen:!0},a):e.jsxs("div",{className:"video-embed-error",children:[e.jsx("div",{className:"embed-error-icon",children:"üìπ"}),e.jsx("p",{className:"embed-error-title",children:"Video temporarily unavailable"}),e.jsx("p",{className:"embed-error-detail",children:"No video file is associated with this lesson."})]})}),a&&e.jsx("a",{href:`https://drive.google.com/file/d/${a}/view`,target:"_blank",rel:"noopener noreferrer",className:"drive-fallback-link",children:"üîó Video not loading? Open in Google Drive"}),l&&e.jsx(Xt,{microLesson:l,courses:r}),e.jsxs("div",{className:"video-controls",children:[e.jsx("button",{className:"complete-btn",onClick:d,children:o?"Mark Complete & Continue ‚Üí":"Complete & Try Exercise ‚Üí"}),e.jsx("button",{className:"exit-btn",onClick:c,children:"Exit Path"})]})]})}function Xt({microLesson:s,courses:t}){const[n,i]=b.useState(!1),[o,l]=b.useState("quick_fix"),r=s?.quick_fix,d=s?.why_it_works,c=s?.related_situations,a=p=>{l(y=>y===p?null:p)},u=p=>p?p.replace(/\s*\[\d+(?:[,\s]*\d+)*\]/g,"").trim():null;return e.jsxs("div",{className:`gp-ai-lesson ${n?"open":"collapsed"}`,children:[e.jsxs("button",{className:"gp-ai-lesson-toggle",onClick:()=>i(p=>!p),children:[e.jsx("span",{className:"gp-ai-badge",children:"‚ú® AI Guide"}),e.jsx("span",{className:"gp-ai-subtitle",children:"What to look for"}),e.jsx("span",{className:"gp-ai-chevron",children:n?"‚ñæ":"‚ñ∏"})]}),n&&e.jsxs("div",{className:"gp-ai-body",children:[r&&e.jsxs("div",{className:`gp-ai-section ${o==="quick_fix"?"expanded":""}`,children:[e.jsxs("button",{className:"gp-ai-section-toggle",onClick:()=>a("quick_fix"),children:[e.jsxs("span",{children:["‚ö° ",r.title||"Quick Fix"]}),e.jsx("span",{className:"gp-ai-section-chevron",children:o==="quick_fix"?"‚ñæ":"‚ñ∏"})]}),o==="quick_fix"&&r.steps&&e.jsx("ol",{className:"gp-ai-steps",children:r.steps.map((p,y)=>e.jsx("li",{children:u(p)},y))})]}),d&&e.jsxs("div",{className:`gp-ai-section ${o==="why"?"expanded":""}`,children:[e.jsxs("button",{className:"gp-ai-section-toggle",onClick:()=>a("why"),children:[e.jsx("span",{children:"üß† Why This Works"}),d.key_concept&&e.jsx("span",{className:"gp-ai-concept-tag",children:d.key_concept}),e.jsx("span",{className:"gp-ai-section-chevron",children:o==="why"?"‚ñæ":"‚ñ∏"})]}),o==="why"&&e.jsx("p",{className:"gp-ai-explanation",children:u(d.explanation)})]}),c&&c.length>0&&e.jsxs("div",{className:`gp-ai-section ${o==="related"?"expanded":""}`,children:[e.jsxs("button",{className:"gp-ai-section-toggle",onClick:()=>a("related"),children:[e.jsx("span",{children:"üîó Related Situations"}),e.jsx("span",{className:"gp-ai-count-tag",children:c.length}),e.jsx("span",{className:"gp-ai-section-chevron",children:o==="related"?"‚ñæ":"‚ñ∏"})]}),o==="related"&&e.jsx("div",{className:"gp-ai-scenarios",children:c.map((p,y)=>e.jsxs("div",{className:"gp-ai-scenario",children:[e.jsxs("strong",{children:["üí° ",p.scenario]}),e.jsx("p",{children:u(p.connection)})]},y))})]})]})]})}function Ms({course:s,stepNumber:t,totalSteps:n,onComplete:i,onExit:o}){const[l,r]=b.useState(!1),d=s._resourceType==="doc"?"üìñ":"‚ñ∂Ô∏è",c=s._resourceType==="doc"?"Documentation":"YouTube Video",a=s._resourceType==="doc"?"Epic Docs":s._channel||"YouTube",u=s._resourceType!=="doc",p=(()=>{if(!u||!s._url)return null;try{const x=new URL(s._url);if(x.hostname.includes("youtube.com"))return x.searchParams.get("v");if(x.hostname.includes("youtu.be"))return x.pathname.slice(1)}catch{}return null})(),y=x=>{const v=Math.floor(x/60),g=x%60;return`${v}:${g.toString().padStart(2,"0")}`};return e.jsxs("div",{className:"reading-step",children:[e.jsxs("div",{className:"reading-step-header",children:[e.jsxs("span",{className:"reading-step-badge",children:[d," ",c]}),e.jsxs("span",{className:"reading-step-progress",children:["Step ",t," of ",n]})]}),e.jsx("h2",{className:"reading-step-title",children:s.title}),e.jsxs("div",{className:"reading-step-meta",children:[s._tier&&e.jsx("span",{className:`tier-badge tier-${s._tier}`,children:s._tier}),s._channelTrust&&e.jsx("span",{className:`channel-trust-badge trust-${s._channelTrust}`,children:s._channelTrust==="official"?"‚úì Official":"‚≠ê Expert"}),e.jsxs("span",{className:"reading-step-time",children:["‚è± ",s._readTimeMinutes," min ",u?"watch":"read"]})]}),s._topics&&s._topics.length>0&&e.jsx("div",{className:"reading-step-topics",children:s._topics.map((x,v)=>e.jsx("span",{className:"topic-chip",children:x.replace(/_/g," ")},v))}),s._description&&e.jsx("p",{className:"reading-step-description",children:s._description}),p&&e.jsx("div",{className:"reading-step-player",children:e.jsx("iframe",{src:`https://www.youtube-nocookie.com/embed/${p}?rel=0&modestbranding=1`,title:s.title,allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,className:"reading-step-iframe"})}),s._keySteps&&s._keySteps.length>0?e.jsxs("div",{className:"key-steps-section",children:[e.jsx("h3",{className:"key-steps-heading",children:"üéØ Key Takeaways"}),e.jsx("ol",{className:"key-steps-list",children:s._keySteps.map((x,v)=>e.jsx("li",{className:"key-step-item",children:Ht(x)},v))})]}):s._description?e.jsxs("div",{className:"key-steps-section key-steps-fallback",children:[e.jsx("h3",{className:"key-steps-heading",children:"üéØ What to Focus On"}),e.jsxs("ul",{className:"key-steps-list",children:[s._sections&&s._sections.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("li",{className:"key-step-item",children:["Read through the ",e.jsx("strong",{children:s.title})," page, focusing on these sections:"]}),s._sections.slice(0,5).map((x,v)=>e.jsxs("li",{className:"key-step-item",children:["üìñ Work through the ",e.jsx("strong",{children:x})," section"]},v))]}):e.jsxs(e.Fragment,{children:[e.jsxs("li",{className:"key-step-item",children:["Understand how ",e.jsx("strong",{children:s.title})," works in UE5"]}),s._topics&&s._topics.length>0&&s._topics.slice(0,2).map((x,v)=>e.jsxs("li",{className:"key-step-item",children:["Pay attention to ",e.jsx("strong",{children:x.replace(/_/g," ")})," concepts and workflows"]},v)),s._subsystem&&e.jsxs("li",{className:"key-step-item",children:["Note how ",e.jsx("strong",{children:s._subsystem})," integrates with the editor"]})]}),e.jsx("li",{className:"key-step-item",children:"Try applying these techniques in your own UE5 project"})]})]}):null,s._chapters&&s._chapters.length>0&&e.jsxs("div",{className:"chapters-section",children:[e.jsx("h3",{className:"chapters-heading",children:"üìë Chapters"}),e.jsx("div",{className:"chapters-list",children:s._chapters.map((x,v)=>e.jsxs("a",{href:p?`https://www.youtube.com/watch?v=${p}&t=${x.seconds}`:"#",target:"_blank",rel:"noopener noreferrer",className:"chapter-item",children:[e.jsx("span",{className:"chapter-time",children:y(x.seconds)}),e.jsx("span",{className:"chapter-label",children:x.label})]},v))})]}),s._seeAlso&&s._seeAlso.length>0&&e.jsxs("div",{className:"see-also-section",children:[e.jsx("h3",{className:"see-also-heading",children:"üîó See Also"}),e.jsx("div",{className:"see-also-links",children:s._seeAlso.map((x,v)=>{const g=at[x.docKey],N=g?g.url:"#";return e.jsxs("a",{href:N,target:"_blank",rel:"noopener noreferrer",className:"see-also-link",title:g?g.description:x.label,children:["‚Üí ",x.label]},v)})})]}),e.jsx("div",{className:"reading-step-source",children:e.jsxs("span",{className:"reading-step-source-label",children:["Source: ",a]})}),e.jsxs("a",{href:s._url,target:"_blank",rel:"noopener noreferrer",className:"reading-step-link",onClick:()=>r(!0),children:[s._resourceType==="doc"?"üìÑ Open Documentation":"‚ñ∂Ô∏è Watch on YouTube",e.jsx("span",{className:"reading-step-link-arrow",children:"‚Üó"})]}),e.jsxs("div",{className:"reading-step-actions",children:[e.jsx("button",{className:`reading-step-complete ${l?"ready":""}`,onClick:i,title:l?"Continue to next step":"Mark as read and continue",children:l?"‚úì Read ‚Äî Continue ‚Üí":"Mark as Read ‚Üí Continue"}),e.jsx("button",{className:"reading-step-exit",onClick:o,children:"‚úï Exit Path"})]})]})}Ms.propTypes={course:h.object.isRequired,stepNumber:h.number.isRequired,totalSteps:h.number.isRequired,onComplete:h.func.isRequired,onExit:h.func.isRequired};const $s={},As={};(rt.courses||[]).forEach(s=>{$s[s.code]=s.title,As[s.code]=s.versions||[]});function en(s){const t=As[s];return!t||t.length===0?!1:t.every(n=>{const i=String(n).replace(/^V/i,"");return i.startsWith("4")&&!i.startsWith("4.")?/^4\d{1,2}$/.test(i):i.startsWith("4.")})}function sn(s){if(!s||s<=0)return"";const t=Math.round(s/60);return t<1?"<1 min":`${t} min`}function Ke({video:s,isAdded:t,onToggle:n,userQuery:i}){const{title:o,duration:l,driveId:r,courseCode:d,_curatedMatch:c,role:a,reason:u,matchPercent:p,matchReason:y,watchHint:x}=s,v=p>=100?"best":p>=70?"strong":p>=40?"good":"related",g=p>=100?"Best Match":p>=70?"Strong Match":p>=40?"Good Match":"Related",N=o?.replace(/\s+(?:Part\s+[A-Z]|PT\s*\d+)$/i,"").trim()||o,m=d?Ss[d]:null,C=m?.prereqs||[],[S,k]=b.useState(()=>ut(r)),[M,R]=b.useState(!1),$=b.useRef(null),A=b.useRef(null);b.useEffect(()=>{if(!M)return;const T=P=>{$.current&&!$.current.contains(P.target)&&R(!1)};return document.addEventListener("mousedown",T),()=>document.removeEventListener("mousedown",T)},[M]);const W=T=>{T.stopPropagation(),ht(r,i||""),k("up")},_=T=>{T.stopPropagation(),mt(r,i||""),k("down")},E=r?`https://drive.google.com/thumbnail?id=${r}&sz=w320`:null;return e.jsx("div",{ref:A,className:`video-result-card ${t?"added":""} ${c?"curated":""} ${S==="down"?"demoted":""}`,role:"button",tabIndex:0,children:e.jsxs("div",{className:"vrc-compact",children:[e.jsxs("div",{className:"vrc-thumbnail",children:[E?e.jsx("img",{src:E,alt:N,onError:T=>{T.target.style.display="none",T.target.nextSibling.style.display="flex"}}):null,e.jsx("div",{className:"vrc-thumb-fallback",style:{display:E?"none":"flex"},children:e.jsx("span",{className:"vrc-play-icon",children:e.jsx(ft,{size:24})})}),l>0&&e.jsx("span",{className:"vrc-duration",children:sn(l)})]}),e.jsxs("div",{className:"vrc-badge-row",children:[p!=null&&e.jsxs("span",{className:`vrc-match-badge vrc-match-${v}`,title:`${p}% match`,children:[e.jsx("span",{className:"vrc-match-dot"}),g]}),c&&e.jsx("span",{className:"vrc-curated-badge",children:"‚úì Solution"}),a&&a!=="core"&&e.jsxs("div",{className:"vrc-role-wrapper",ref:a==="prerequisite"?$:null,children:[e.jsxs("button",{className:`vrc-role-badge vrc-role-${a} ${a==="prerequisite"?"vrc-role-clickable":""}`,onClick:T=>{T.stopPropagation(),a==="prerequisite"&&R(P=>!P)},title:a==="prerequisite"?"Click to see why this is a prerequisite":void 0,children:[a==="prerequisite"&&"üîó Prerequisite",a==="troubleshooting"&&"üîß Troubleshooting",a==="supplemental"&&"üìö Supplemental"]}),M&&a==="prerequisite"&&e.jsxs("div",{className:"vrc-prereq-tooltip",children:[e.jsx("strong",{children:"Prerequisite Course"}),C.length>0?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"Watch these first:"}),e.jsx("ul",{className:"vrc-prereq-list",children:C.map(T=>e.jsxs("li",{children:["üìò ",$s[T]||T,m?.reasons?.[T]&&e.jsxs("span",{className:"vrc-prereq-why",children:[" ‚Äî ",m.reasons[T]]})]},T))})]}):e.jsx("p",{children:"Watch this first ‚Äî it covers foundational concepts needed before advancing."}),u&&e.jsx("p",{className:"vrc-tip-reason",children:u})]})]}),d&&en(d)&&e.jsx("span",{className:"vrc-ue4-badge",title:"This content was created for Unreal Engine 4 ‚Äî some details may differ in UE5",children:"‚ö†Ô∏è UE4"})]}),e.jsxs("div",{className:"vrc-info",children:[e.jsx("h4",{className:"vrc-title",children:N}),x&&x!=="‚ñ∂ Watch full video"&&e.jsx("p",{className:"vrc-timestamp-hint",children:x}),y&&e.jsx("p",{className:"vrc-match-reason",children:y})]}),e.jsxs("div",{className:"vrc-actions",children:[e.jsxs("div",{className:"vrc-feedback",children:[e.jsx("button",{className:`vrc-fb-btn ${S==="up"?"active-up":""}`,onClick:W,"aria-label":"Helpful",title:"This was helpful",children:e.jsx("span",{className:"vrc-fb-emoji",children:"üëç"})}),e.jsx("button",{className:`vrc-fb-btn ${S==="down"?"active-down":""}`,onClick:_,"aria-label":"Not helpful",title:"Not relevant",children:e.jsx("span",{className:"vrc-fb-emoji",children:"üëé"})})]}),e.jsx("button",{className:`vrc-add-btn ${t?"vrc-added":""}`,onClick:T=>{T.stopPropagation(),n(s)},"aria-label":t?"Remove from playlist":"Add to playlist",children:t?e.jsxs(e.Fragment,{children:[e.jsx(Be,{size:14})," Added"]}):e.jsxs(e.Fragment,{children:[e.jsx(tt,{size:14})," Add"]})})]})]})})}Ke.propTypes={video:h.shape({driveId:h.string,title:h.string.isRequired,courseName:h.string,duration:h.number,matchedTags:h.arrayOf(h.string),courseCode:h.string,topSegments:h.array,docLinks:h.array,_curatedMatch:h.bool,role:h.oneOf(["prerequisite","core","troubleshooting","supplemental"]),reason:h.string,estimatedMinutes:h.number}).isRequired,isAdded:h.bool,onToggle:h.func.isRequired,userQuery:h.string};function ps(s){const t=Math.round(s/60);if(t<1)return"<1 min";if(t>=60){const n=Math.floor(t/60),i=t%60;return i>0?`${n}h ${i}m`:`${n}h`}return`${t} min`}const tn={video:"üì∫",doc:"üìñ",youtube:"‚ñ∂Ô∏è"};function qs({cart:s,onRemove:t,onClear:n,onWatchPath:i}){const o=s.reduce((a,u)=>a+(u.duration||(u.readTimeMinutes||u.durationMinutes||0)*60),0),l=s.filter(a=>(a.type||"video")==="video").length,r=s.filter(a=>a.type==="doc").length,d=s.filter(a=>a.type==="youtube").length,c=[];return l>0&&c.push(`${l} video${l!==1?"s":""}`),r>0&&c.push(`${r} doc${r!==1?"s":""}`),d>0&&c.push(`${d} YT`),e.jsxs("div",{className:"cart-panel",children:[e.jsxs("div",{className:"cart-header",children:[e.jsx("h3",{className:"cart-title",children:"üõí My Learning Path"}),s.length>0&&e.jsx("button",{className:"cart-clear-btn",onClick:n,title:"Clear all",children:"Clear"})]}),s.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cart-stats",children:[e.jsx("span",{className:"cart-stat-count",children:c.join(" ¬∑ ")}),e.jsx("span",{className:"cart-stat-dot",children:"¬∑"}),e.jsx("span",{className:"cart-stat-time",children:ps(o)})]}),o>28800&&e.jsx("div",{className:"cart-warning",children:"‚ö†Ô∏è That's over 8 hours of content ‚Äî consider narrowing your focus to the most relevant items."}),e.jsx("div",{className:"cart-items",children:s.map((a,u)=>{const p=a.itemId||a.driveId||u,y=a.type||"video",x=tn[y]||"üì∫",v=y==="video"?be(a.title):a.title,g=a.duration>0?ps(a.duration):a.readTimeMinutes?`${a.readTimeMinutes} min read`:a.durationMinutes?`${a.durationMinutes} min`:null;return e.jsxs("div",{className:`cart-item cart-item-${y}`,children:[e.jsx("span",{className:"cart-item-num",children:u+1}),e.jsx("span",{className:"cart-item-icon",title:y,children:x}),e.jsxs("div",{className:"cart-item-info",children:[e.jsx("span",{className:"cart-item-title",children:v}),g&&e.jsx("span",{className:"cart-item-dur",children:g})]}),e.jsx("button",{className:"cart-item-remove",onClick:()=>t(p),"aria-label":`Remove ${a.title}`,children:"√ó"})]},p)})}),e.jsx("button",{className:"cart-watch-btn",onClick:i,children:"‚ñ∂ Watch Path"})]}):e.jsxs("div",{className:"cart-empty",children:[e.jsx("span",{className:"cart-empty-icon",children:"üì∫"}),e.jsx("p",{children:"Add videos, docs, and resources to build your learning path"})]})]})}qs.propTypes={cart:h.arrayOf(h.shape({itemId:h.string,driveId:h.string,type:h.oneOf(["video","doc","youtube"]),title:h.string.isRequired,duration:h.number,readTimeMinutes:h.number,durationMinutes:h.number})).isRequired,onRemove:h.func.isRequired,onClear:h.func.isRequired,onWatchPath:h.func.isRequired};const Ps="ue5_video_cart";function nn(){try{const s=localStorage.getItem(Ps);return s?JSON.parse(s):[]}catch{return[]}}function qe(s){try{localStorage.setItem(Ps,JSON.stringify(s))}catch{}}function ke(s){return s.itemId||s.driveId||s.id||`${s.type}_${s.url}`}function an(){const[s,t]=b.useState(nn),n=b.useCallback(a=>{t(u=>{const p=ke(a);if(u.some(v=>ke(v)===p))return u;const y={...a,itemId:p,type:a.type||"video"},x=[...u,y];return qe(x),x})},[]),i=b.useCallback(a=>{t(u=>{const p=u.filter(y=>ke(y)!==a&&y.driveId!==a);return qe(p),p})},[]),o=b.useCallback(()=>{t([]),qe([])},[]),l=b.useCallback(a=>s.some(u=>ke(u)===a||u.driveId===a),[s]),r=s.filter(a=>(a.type||"video")==="video").length,d=b.useMemo(()=>s.reduce((a,u)=>a+(u.duration||(u.readTimeMinutes||u.durationMinutes||0)*60),0),[s]),c=b.useMemo(()=>{const a={video:[],doc:[],youtube:[]};for(const u of s){const p=u.type||"video";(a[p]||a.video).push(u)}return a},[s]);return{cart:s,addToCart:n,removeFromCart:i,clearCart:o,isInCart:l,videoCount:r,totalDuration:d,itemsByType:c}}let Pe=null;async function rn(){if(!Pe){const s=await xe(()=>import("./data-embeddings-EsTyY_EC.js"),[]);Pe=s.default||s}return Pe}function Je(s,t){if(!s||!t||s.length!==t.length)return 0;let n=0,i=0,o=0;for(let r=0;r<s.length;r++)n+=s[r]*t[r],i+=s[r]*s[r],o+=t[r]*t[r];const l=Math.sqrt(i)*Math.sqrt(o);return l===0?0:n/l}async function on(s,t=5,n=.3){const i=await rn();if(!s||!i?.courses)return[];const o=[];for(const[l,r]of Object.entries(i.courses)){const d=Je(s,r.embedding);d>=n&&o.push({code:l,title:r.title,similarity:d})}return o.sort((l,r)=>r.similarity-l.similarity),o.slice(0,t)}let Oe=null,De=null;async function cn(){if(!Oe){const s=await xe(()=>import("./data-search-SjqZFhcO.js").then(t=>t.s),[]);Oe=s.default||s}return Oe}async function Xe(){if(!De){const s=await xe(()=>import("./data-search-SjqZFhcO.js").then(t=>t.a),[]);De=s.default||s}return De}let Fe=null,ve=null;function ln(s,t=768){const n=atob(s),i=new Uint8Array(n.length);for(let r=0;r<n.length;r++)i[r]=n.charCodeAt(r);const o=new DataView(i.buffer),l=new Float32Array(t);for(let r=0;r<t;r++){const d=o.getUint16(r*2,!0);l[r]=dn(d)}return l}function dn(s){const t=s>>15&1,n=s>>10&31,i=s&1023;return n===0?(t?-1:1)*Math.pow(2,-14)*(i/1024):n===31?i?NaN:t?-1/0:1/0:(t?-1:1)*Math.pow(2,n-15)*(1+i/1024)}async function un(){if(ve)return ve;if(!Fe)try{const t=await fetch(new URL("../data/segment_embeddings.json",import.meta.url));if(!t.ok)throw new Error(`HTTP ${t.status}`);Fe=await t.json()}catch(t){return re("‚ö†Ô∏è segment_embeddings.json not available:",t.message),null}const s=Fe?.segments;if(!s)return null;ve=new Map;for(const[t,n]of Object.entries(s))ve.set(t,{vector:ln(n.embedding),courseCode:n.course_code,videoKey:n.video_key,videoTitle:n.video_title,startTimestamp:n.start_timestamp,endTimestamp:n.end_timestamp,startSeconds:n.start_seconds,text:n.text,tokenEstimate:n.token_estimate});return K(`[SegmentSearch] Decoded ${ve.size} segment embeddings`),ve}async function hn(s,t=[]){if(!s||s.length<3)return[];const n=s.toLowerCase().split(/\s+/).filter(r=>r.length>2&&!_e.has(r));if(n.length===0)return[];const i=await cn(),o=[],l=i?.course_words||{};for(const[r,d]of Object.entries(l)){let c=0;const a=[];for(const u of n)if(d[u]&&(c+=d[u]*10,a.push(u)),u.length>=4)for(const[p,y]of Object.entries(d))p!==u&&p.length>=4&&(p.startsWith(u)||u.startsWith(p))&&(c+=y*3,a.includes(p)||a.push(p));if(c>=30&&a.length>0){const u=t.find(y=>y.code===r),p=await mn(r,a);o.push({courseCode:r,courseTitle:u?.title||r,score:c,matchedKeywords:a,topSegments:p,estimatedSegment:p.length>0?p[0]:null,videoCount:u?.video_count||0,duration:u?.duration_formatted||"Unknown"})}}return o.sort((r,d)=>d.score-r.score).slice(0,5)}async function mn(s,t){const i=(await Xe())[s];if(!i||!i.videos)return[];const o=[];for(const[l,r]of Object.entries(i.videos))if(r.segments)for(const d of r.segments){const c=d.text.toLowerCase();let a=0;const u=[];for(const p of t){const y=p.toLowerCase(),x=new RegExp(y.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi"),v=c.match(x);v&&(a+=v.length*10,u.push(p)),c.includes(y)&&(a+=5,u.includes(p)||u.push(p))}if(a>0){let p=d.text;if(p.length>120){const y=u[0]||"",x=p.toLowerCase().indexOf(y.toLowerCase());x>40&&(p="..."+p.substring(x-30)),p.length>120&&(p=p.substring(0,117)+"...")}o.push({videoKey:l,videoTitle:r.title,timestamp:d.start,startSeconds:d.start_seconds,endTimestamp:d.end,previewText:p,matchedKeywords:u,score:a})}}return o.sort((l,r)=>r.score-l.score).slice(0,3)}async function pn(s,t=10,n=.35){if(!s)return[];const i=await un();if(!i)return[];const o=[];for(const[l,r]of i){const d=Je(s,r.vector);d>=n&&o.push({id:l,courseCode:r.courseCode,videoKey:r.videoKey,videoTitle:r.videoTitle,timestamp:r.startTimestamp,endTimestamp:r.endTimestamp,startSeconds:r.startSeconds,previewText:r.text,similarity:d,source:"transcript"})}return o.sort((l,r)=>r.similarity-l.similarity),o.slice(0,t)}const gn=60,fn=new Set(["rendering.lumen","rendering.nanite","rendering.virtualShadowMaps","rendering.substrate","worldbuilding.worldPartition"]);function Ne(s){return!!(s.videos?.length&&s.videos[0]?.drive_id||s.source==="youtube"&&s.youtube_url||s.source==="epic_docs")}function xn(s){const t=(s||"").toLowerCase();return/\bue\s*5\b|\bunreal\s*engine\s*5\b|\b5\.\d\b/.test(t)?5:/\bue\s*4\b|\bunreal\s*engine\s*4\b|\b4\.\d{1,2}\b/.test(t)?4:null}async function gs(s,t,n=[],i="",o=[]){if(!t||t.length===0)return[];const l=s?.userQuery||"",r=l.toLowerCase();for(const j of it)if(j.patterns.some(L=>r.includes(L))){const L=j.courses.map(F=>{const Q=t.find(ce=>ce.code===F);return!Q||!Ne(Q)?null:{...Q,_relevanceScore:200,_curatedMatch:!0,_curatedExplanation:j.explanation}}).filter(Boolean);if(L.length>0)return K("‚úÖ Curated solution match:",j.explanation),L}const d=`${l} ${i}`.trim(),c=fe.matchErrorSignature(d),a=c.map(j=>j.tag.tag_id),u=[...new Set([...n,...a])];c.length>0&&K("üîç Error signatures detected:",c.map(j=>`${j.tag.display_name} (${j.matchedSignature}, ${j.confidence})`));const p=fe.extractTagsFromText(l),y=p.matchedTagIds||[];if(y.length>0){K("üè∑Ô∏è Tag taxonomy matches:",p.matches.map(j=>`${j.tagId} (via "${j.matchedTerm}", ${j.matchType})`));for(const j of y)u.includes(j)||u.push(j)}const x=i.toLowerCase().split(/[\s\n:;,()[\]{}]+/).filter(j=>j.length>3&&!/^[0-9]+$/.test(j)).slice(0,10),v=l.toLowerCase().split(/\s+/).filter(j=>j.length>2&&!_e.has(j)),g=new Set(v),N=l.toLowerCase();for(const[j,w]of Object.entries(ot))if(N.includes(j))for(const L of w)L.split(/\s+/).forEach(F=>{F.length>2&&!_e.has(F)&&g.add(F)});const m=[...g],C=async j=>!j||j.length<5?[]:(await hn(j,t)).map(L=>{const F=t.find(Q=>Q.code===L.courseCode);return!F||!Ne(F)?null:{...F,_relevanceScore:L.score,_matchedKeywords:L.matchedKeywords}}).filter(Boolean),S=j=>j.length===0?[]:t.filter(Ne).map(L=>{const F=(L.title||"").toLowerCase(),Q=(L.description||"").toLowerCase(),ce=[...L.canonical_tags||[],...L.gemini_system_tags||[],...L.extracted_tags||[]].map(ee=>typeof ee=="string"?ee.toLowerCase():"").join(" ");let O=0;const I=[];for(const ee of j)F.includes(ee)?(O+=50,I.push(ee)):ce.includes(ee)?(O+=30,I.push(ee)):Q.includes(ee)&&(O+=10,I.push(ee));if(y.length>0){const ee=(L.canonical_tags||[]).map(se=>se.toLowerCase());y.some(se=>ee.some(he=>he.includes(se.split(".").pop())))&&(O*=3)}const H=new Set(I).size;H>=2&&(O*=1+H*.3);const le=j.length>0?H/j.length:1;return j.length>=2&&le<.5?O*=.3:le>=1&&(O*=2),O===0?null:{...L,_relevanceScore:O,_matchedKeywords:I}}).filter(Boolean).sort((L,F)=>F._relevanceScore-L._relevanceScore),k=j=>u.length===0?j:j.map(w=>{const L=w.extracted_tags||w.tags||[],ce=(Array.isArray(L)?L:Object.values(L)).map(O=>typeof O=="string"?O:O.tag_id||O.name||"").filter(Boolean).some(O=>u.some(I=>O.toLowerCase().includes(I.toLowerCase())||I.toLowerCase().includes(O.toLowerCase())));return{...w,_relevanceScore:ce?w._relevanceScore*2:w._relevanceScore*.5}}).sort((w,L)=>L._relevanceScore-w._relevanceScore),M=x.length>0?`${l} ${x.join(" ")}`:l,R=await C(M),$=x.length>0?[...m,...x]:m,A=S($),W=new Set,_=[];for(const j of R)W.has(j.code)||(_.push(j),W.add(j.code));for(const j of A)if(!W.has(j.code))_.push(j),W.add(j.code);else{const w=_.find(L=>L.code===j.code);w&&(w._relevanceScore+=j._relevanceScore)}const T=(_.length>0?_[0]._relevanceScore:0)>=gn;if(o.length>0&&!T)for(const j of o)if(W.has(j.code)){const w=_.find(L=>L.code===j.code);w&&(w._relevanceScore+=j.similarity*40)}else{const w=t.find(L=>L.code===j.code);w&&Ne(w)&&(_.push({...w,_relevanceScore:j.similarity*100,_matchedKeywords:["semantic-match"],_semanticMatch:!0,_tier:2}),W.add(j.code))}else o.length>0;_.sort((j,w)=>w._relevanceScore-j._relevanceScore);const P=k(_);if(P.length>=3)return ze(P.slice(0,5),l);const V=[M,s?.diagnosis?.problem_summary,...s?.intent?.systems||[]].filter(Boolean).join(" "),X=V.toLowerCase().split(/\s+/).filter(j=>j.length>2&&!_e.has(j)),oe=await C(V),ie=S(X);for(const j of[...oe,...ie])W.has(j.code)||(_.push(j),W.add(j.code));_.sort((j,w)=>w._relevanceScore-j._relevanceScore);const Y=k(_);if(Y.length>=3)return ze(Y.slice(0,5),l);const f=t.map(j=>{const w=fe.scoreCourseRelevance(j,$);return{...j,_relevanceScore:w.score,_scoreBreakdown:w.breakdown,_topContributors:w.topContributors}}).filter(j=>j._relevanceScore>0&&Ne(j)).sort((j,w)=>w._relevanceScore-j._relevanceScore).slice(0,5);return ze(k(f),l)}function ze(s,t){const n=xn(t);return n?s.map(i=>{const l=[...i.canonical_tags||[],...i.gemini_system_tags||[],...i.extracted_tags||[]].map(r=>typeof r=="string"?r.toLowerCase():"").some(r=>[...fn].some(d=>r.includes(d.split(".").pop())));return n===4&&l?(K(`‚¨áÔ∏è UE4 demotion: ${i.code} (has UE5-only tags)`),{...i,_relevanceScore:i._relevanceScore*.2}):n===5&&l?{...i,_relevanceScore:i._relevanceScore*1.5}:i}).sort((i,o)=>o._relevanceScore-i._relevanceScore):s}let Ue=null;async function yn(){if(!Ue){const s=await xe(()=>import("./data-courses-LtwEzJPI.js").then(t=>t.j),[]);Ue=s.default||s}return Ue}const Ve=new Set(["help","helpful","helps","use","used","using","make","made","get","getting","look","going","come","know","thing","work","working","want","need","show","start","take","right","well"]);function fs(s){return s.replace(/ies$/i,"y").replace(/ves$/i,"f").replace(/(s|es|ing|ed|tion|ment)$/i,"").toLowerCase()}function vn(s,t){const i=t.replace(/[-_]/g," ").split(/\s+/).filter(l=>l.length>2).map(fs);return s.map(fs).some(l=>i.some(r=>l.includes(r)||r.includes(l)))}async function xs(s,t,n={}){const i=[],o=(t||"").toLowerCase().split(/\s+/).filter(m=>m.length>2),l=await yn(),r=[],d=(t||"").toLowerCase(),c=d.split(/\s+/).filter(m=>m.length>2);for(const[m,C]of Object.entries(l))(d.includes(m)||vn(c,m))&&r.push({label:C.label,url:C.url});for(const m of s){if(m.source==="youtube"&&m.youtube_url){const S=n[m.code]||{},k=(()=>{const M=(m._matchedKeywords||[]).filter(R=>R.length>3&&!Ve.has(R.toLowerCase())).slice(0,3);return M.length>0?M:[m.topic||m.tags?.topic||"UE5"].flat().slice(0,3)})();i.push({driveId:m.youtube_url,title:be(m.title||m.code),duration:m.duration_seconds||0,courseCode:m.code,courseName:m.title||m.code,matchedTags:k,videoIndex:0,relevanceScore:m._relevanceScore||0,titleRelevance:0,isIntro:!1,timestampHint:null,startSeconds:0,topSegments:[],watchHint:"‚ñ∂ Watch on YouTube",docLinks:r,_curatedMatch:m._curatedMatch||!1,_curatedExplanation:m._curatedExplanation||null,role:S.role||null,reason:S.reason||null,estimatedMinutes:S.estimatedMinutes||null,_source:"youtube",_externalUrl:m.youtube_url,type:"youtube",url:m.youtube_url,channel:m.channel_name||m.channel||null,channelTrust:m.channel_trust||null,topics:m.topics||[],description:m.description||"",durationMinutes:m.duration_seconds?Math.round(m.duration_seconds/60):10});continue}if(m.source==="epic_docs"){const S=m.url||m.youtube_url||"#",k=n[m.code]||{},M=(()=>{const R=(m._matchedKeywords||[]).filter($=>$.length>3&&!Ve.has($.toLowerCase())).slice(0,3);return R.length>0?R:[m.topic||m.tags?.topic||"UE5"].flat().slice(0,3)})();i.push({driveId:`doc_${m.code}`,title:be(m.title||m.code),duration:0,courseCode:m.code,courseName:m.title||m.code,matchedTags:M,videoIndex:0,relevanceScore:m._relevanceScore||0,titleRelevance:0,isIntro:!1,timestampHint:null,startSeconds:0,topSegments:[],watchHint:"üìñ Read Epic Docs",docLinks:[{label:m.title||"Epic Docs",url:S},...r],_curatedMatch:m._curatedMatch||!1,_curatedExplanation:m._curatedExplanation||null,role:k.role||null,reason:k.reason||null,estimatedMinutes:k.estimatedMinutes||null,_source:"epic_docs",_externalUrl:S,type:"doc",url:S,topics:m.topics||[],description:m.description||"",readTimeMinutes:10});continue}const C=m.videos||[];if(C.length!==0)for(let S=0;S<C.length;S++){const k=C[S];if(!k.drive_id)continue;const M=k.title||k.name||`Video ${S+1}`,R=M.toLowerCase(),$=be(M),A=o.filter(ne=>R.includes(ne)).length,W=A*50,_=await jn(m.code,M,S),E=await bn(m.code,_,o),T=R.includes("intro")||R.includes("introduction")||R.includes("wrap up")||R.includes("outro")||R.includes("overview")||R.includes("getting started")||R.includes("welcome")||R.includes("course intro")||R.includes("what you'll learn")||R.includes("what we'll cover")||R.includes("summary")||R.includes("objectives")||/\bpart\s*a\b/i.test(M)&&S===0,P=T?.15:1,z=!T&&E.topSegments&&E.topSegments.length>0?15:0,V=k.duration_seconds||k.durationSeconds||0,X=V/60,oe=X<2?.4:X<5?.7:X>20?1.1:1,ie=new Set;for(const ne of E.topSegments||[])for(const se of ne.matchedKeywords||[])ie.add(se);const Y=ie.size,ye=A>=2||A===1&&Y>=1?1:Y>=2?.8:Y===1?.3:A===1?.5:.15,f=(m._relevanceScore||0)*ye,j=(W+E.score+z+f)*P*oe,L=A===0&&E.score<30?Math.min(j,40):j,F=pt(k.drive_id,L);let Q="‚ñ∂ Watch full video";const O=(E.topSegments||[]).filter(ne=>!V||ne.startSeconds<=V)[0]||(E.bestSegment&&(!V||E.bestSegment.startSeconds<=V)?E.bestSegment:null);if(O){const ne=O.timestamp||"0:00",se=O.previewText,he=se.length>60?se.substring(0,57)+"...":se;Q=O.startSeconds<5?`üìç Start of video ‚Äî "${he}"`:`üìç Jump to ${ne} ‚Äî "${he}"`}const I=n[m.code]||{},H=(()=>{const ne=(m._matchedKeywords||[]).filter(se=>se.length>3&&!Ve.has(se.toLowerCase())).slice(0,3);return ne.length>0?ne:[m.topic||m.tags?.topic||"UE5"].flat().slice(0,3)})(),le=E.bestSegment?.startSeconds||0,ee=V&&le>V?0:le;i.push({driveId:k.drive_id,title:$,duration:k.duration_seconds||0,courseCode:m.code,courseName:m.title||m.code,matchedTags:H,videoIndex:S,relevanceScore:F,titleRelevance:A,isIntro:T,timestampHint:ee>0&&E.bestSegment?.timestamp||null,startSeconds:ee,topSegments:E.topSegments||[],watchHint:Q,docLinks:r,_curatedMatch:m._curatedMatch||!1,_curatedExplanation:m._curatedExplanation||null,role:I.role||null,reason:I.reason||null,estimatedMinutes:I.estimatedMinutes||null})}}const a=new Map;for(const m of i){const C=a.get(m.driveId);(!C||m.relevanceScore>C.relevanceScore)&&a.set(m.driveId,m)}const u=Array.from(a.values());u.sort((m,C)=>C.relevanceScore-m.relevanceScore);const p=new Map,y=2,x=u.filter(m=>{const C=p.get(m.courseCode)||0;return C>=y?!1:(p.set(m.courseCode,C+1),!0)}),v=new Set;for(const m of x)m.isIntro||v.add(m.courseCode);const g=x.filter(m=>!(m.isIntro&&v.has(m.courseCode)));if(g.length>3){const m=g.map(M=>M.relevanceScore),C=m[Math.floor(m.length/2)],S=Math.max(C*.5,10),k=g.filter(M=>M.relevanceScore>=S);if(k.length>=3){const M=k.slice(0,6);return ys(M,o),M}}const N=g.slice(0,6);return ys(N,o),N}function ys(s,t){if(s.length===0)return;const n=Math.max(s[0].relevanceScore,1);for(const i of s){i.matchPercent=Math.min(100,Math.round(i.relevanceScore/n*100));const o=[];if(i._curatedMatch&&o.push("Known solution for this problem"),i.titleRelevance>0){const l=t.filter(r=>(i.title||"").toLowerCase().includes(r)).slice(0,3);l.length>0&&o.push(`Title matches: ${l.join(", ")}`)}if(i.topSegments.length>0){const l=new Set;for(const d of i.topSegments)for(const c of d.matchedKeywords||[])l.add(c);const r=[...l].slice(0,4);r.length>0&&o.push(`Transcript mentions: ${r.join(", ")}`)}i.matchedTags.length>0&&o.length<2&&o.push(`Tagged: ${i.matchedTags.slice(0,3).join(", ")}`),i.matchReason=o.length>0?o.join(" ¬∑ "):"Related to your query"}}async function jn(s,t,n){const o=(await Xe())[s];if(!o?.videos)return null;const l=p=>(p||"").toLowerCase().replace(/\.mp4$/i,"").replace(/_/g," ").replace(/\s+/g," ").trim(),r=l(t),d=r.split(" ").filter(p=>p.length>2),c=Object.keys(o.videos);for(const p of c)if(l(o.videos[p].title||"")===r)return p;let a=null,u=0;for(const p of c){const y=l(o.videos[p].title||""),x=l(p),v=y+" "+x;let g=0;for(const N of d)new RegExp(`(^|\\s|_)${N.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&")}(\\s|_|$)`,"i").test(v)&&g++;g>0&&g>u&&(u=g,a=p)}if(a&&u>=Math.max(1,d.length*.5))return a;for(const p of c){const y=l(o.videos[p].title||""),x=l(p);if(r.includes(y)||y.includes(r)||r.includes(x)||x.includes(r))return p}return n<c.length?c[n]:c[0]||null}async function bn(s,t,n){const i={score:0,bestSegment:null,topSegments:[]},l=(await Xe())[s];if(!l?.videos||!t)return i;const r=l.videos[t];if(!r?.segments)return i;const d=[];for(const u of r.segments){const p=u.text.toLowerCase();let y=0;const x=[];for(const v of n)if(p.includes(v)){const g=p.split(v).length-1;y+=g*10,x.push(v)}if(y>0){let v=u.text;if(v.length>100){const g=v.toLowerCase().indexOf(x[0]||"");g>30&&(v="..."+v.substring(g-20)),v.length>100&&(v=v.substring(0,97)+"...")}d.push({timestamp:u.start,startSeconds:u.start_seconds,previewText:v,matchedKeywords:x,score:y})}}d.sort((u,p)=>p.score-u.score);const c=d.slice(0,3);return{score:d.reduce((u,p)=>u+p.score,0),bestSegment:c[0]||null,topSegments:c}}let Ge=null,je=null;function Nn(s,t=768){const n=atob(s),i=new Uint8Array(n.length);for(let r=0;r<n.length;r++)i[r]=n.charCodeAt(r);const o=new DataView(i.buffer),l=new Float32Array(t);for(let r=0;r<t;r++){const d=o.getUint16(r*2,!0);l[r]=_n(d)}return l}function _n(s){const t=s>>15&1,n=s>>10&31,i=s&1023;return n===0?(t?-1:1)*Math.pow(2,-14)*(i/1024):n===31?i?NaN:t?-1/0:1/0:(t?-1:1)*Math.pow(2,n-15)*(1+i/1024)}async function wn(){if(je)return je;if(!Ge)try{const t=await fetch(new URL("../data/docs_embeddings.json",import.meta.url));if(!t.ok)throw new Error(`HTTP ${t.status}`);Ge=await t.json()}catch(t){return re("‚ö†Ô∏è docs_embeddings.json not available:",t.message),null}const s=Ge?.docs;if(!s)return null;je=new Map;for(const[t,n]of Object.entries(s))je.set(t,{vector:Nn(n.embedding),slug:n.slug,url:n.url,title:n.title,section:n.section,text:n.text,tokenEstimate:n.token_estimate});return K(`[DocsSearch] Decoded ${je.size} doc embeddings`),je}async function Sn(s,t=5,n=.35){if(!s)return[];const i=await wn();if(!i)return[];const o=[];for(const[l,r]of i){const d=Je(s,r.vector);d>=n&&o.push({id:l,slug:r.slug,url:r.url,title:r.title,section:r.section,previewText:r.text,similarity:d,source:"epic_docs"})}return o.sort((l,r)=>r.similarity-l.similarity),o.slice(0,t)}let Ce=null;async function Os(){if(Ce)return Ce;try{const s=await xe(()=>import("./data-courses-LtwEzJPI.js").then(t=>t.j),[]);return Ce=s.default||s,Ce}catch(s){return re("‚ö†Ô∏è doc_links.json not available:",s.message),{}}}const Te={beginner:0,intermediate:1,advanced:2};function vs(s){return s.replace(/ies$/i,"y").replace(/ves$/i,"f").replace(/(es|s|ing|ed|tion|ment)$/i,"").toLowerCase()}function Ie(s,t){const n=s.split(/[\s_-]+/).filter(o=>o.length>2).map(vs),i=t.split(/[\s_-]+/).filter(o=>o.length>2).map(vs);return n.some(o=>i.some(l=>o===l||o.includes(l)||l.includes(o)))}async function Ds(s,{maxTier:t="advanced",limit:n=10}={}){const i=await Os();if(!i||!s?.length)return[];const o=Te[t]??2,l=s.map(a=>a.toLowerCase()),r=[];for(const[a,u]of Object.entries(i)){if((Te[u.tier]??1)>o)continue;let y=0;const x=a.toLowerCase(),v=(u.label||"").toLowerCase(),g=(u.url||"").split("/").pop().replace(/-/g," ").toLowerCase(),N=(u.tags||[]).map(S=>S.toLowerCase()),m=(u.description||"").toLowerCase();let C=0;for(const S of l){let k=!1;x===S?(y+=15,k=!0):x.includes(S)?(y+=8,k=!0):S.includes(x)?(y+=6,k=!0):u.subsystem===S?(y+=5,k=!0):v.includes(S)?(y+=6,k=!0):N.includes(S)?(y+=2,k=!0):N.some(M=>M.includes(S)||S.includes(M))?(y+=1,k=!0):g.includes(S)?(y+=2,k=!0):m.includes(S)?(y+=1,k=!0):Ie(S,x)?(y+=4,k=!0):Ie(S,v)?(y+=3,k=!0):(N.some(M=>Ie(S,M))||Ie(S,m))&&(y+=1,k=!0),k&&C++}C>=2&&(y+=C*5),y>0&&r.push({key:a,label:u.label,description:u.description||"",url:u.url,tier:u.tier,subsystem:u.subsystem,readTimeMinutes:u.readTimeMinutes||10,prerequisites:u.prerequisites||[],sections:u.sections||[],keySteps:u.keySteps||[],seeAlso:u.seeAlso||[],_score:y,source:"epic_docs"})}r.sort((a,u)=>u._score!==a._score?u._score-a._score:(Te[a.tier]??1)-(Te[u.tier]??1));const d=[];for(const a of r){const u=new Set(a.key.split(/[-_]+/).filter(y=>y.length>2));d.some(y=>{const x=new Set(y.key.split(/[-_]+/).filter(g=>g.length>2));return[...u].filter(g=>x.has(g)).length/Math.min(u.size,x.size)>.6})||d.push(a)}const c=d.length>0?d[0]._score:1;return d.slice(0,n).map(({_score:a,...u})=>({...u,_rawScore:a,matchScore:Math.round(a/Math.max(c,1)*100)}))}async function kn(s,{limit:t=8}={}){const n=await Os();if(!n)return[];const i=await Ds(s,{limit:t*2});if(!i.length)return[];const o=new Map(i.map(a=>[a.key,a.matchScore??0])),l=new Map(i.map(a=>[a.key,a._rawScore??0])),r=new Set,d=[];function c(a){if(r.has(a))return;r.add(a);const u=n[a];if(u){for(const p of u.prerequisites||[])c(p);d.push({key:a,label:u.label,description:u.description||"",keySteps:u.keySteps||[],seeAlso:u.seeAlso||[],url:u.url,tier:u.tier,subsystem:u.subsystem,readTimeMinutes:u.readTimeMinutes||10,matchScore:o.get(a)??0,_rawScore:l.get(a)??0,source:"epic_docs"})}}for(const a of i)c(a.key);return d.sort((a,u)=>(u._rawScore??0)-(a._rawScore??0)),d.slice(0,t)}const js={prerequisite:0,core:1,troubleshooting:2,supplemental:3};function Cn(s){return s.estimated_minutes?s.estimated_minutes:s.total_duration_seconds?Math.round(s.total_duration_seconds/60):(s.videos?.length||1)*10}function bs(s,t){if(t.size===0)return 0;const n=new Set([...s.canonical_tags||[],...s.gemini_system_tags||[],...s.transcript_tags||[]].map(o=>typeof o=="string"?o.toLowerCase():""));if(n.size===0)return 0;let i=0;for(const o of n)(t.has(o)||t.has(o.split(".").pop()))&&i++;return i/n.size}function Tn(s,t){const n=[...s.canonical_tags||[],...s.gemini_system_tags||[]].map(d=>typeof d=="string"?d.toLowerCase():""),i=new Set(t.map(d=>d.toLowerCase()));let o=!1;for(const d of n)if(i.has(d)||i.has(d.split(".").pop())){o=!0;break}const l=n.some(d=>{const c=fe.getTag(d);return c?.tag_type==="symptom"||c?.tag_type==="error_code"});let r=!1;for(const d of n){const c=fe.edgesBySource?.get(d)||[];for(const a of c)if(a.relation==="subtopic"&&i.has(a.target)){r=!0;break}if(r)break}return r?"prerequisite":l?"troubleshooting":o?"core":"supplemental"}function Ns(s,t,n={}){const{timeBudgetMinutes:i=1/0,maxItems:o=8,preferTroubleshooting:l=!1,diversity:r=!0}=n;if(!s||s.length===0)return{path:[],metadata:{totalMinutes:0,tagCoverage:0,diversityScore:1,itemCount:0}};const d=s.map(g=>({course:g,role:Tn(g,t),estimatedMinutes:Cn(g),score:g._relevanceScore||0}));d.sort((g,N)=>{const m=js[g.role]-js[N.role];return m!==0?m:N.score-g.score}),l&&d.sort((g,N)=>{const m=g.role==="troubleshooting"?0:1,C=N.role==="troubleshooting"?0:1;return m!==C?m-C:N.score-g.score});const c=[],a=new Set;let u=0;for(const g of d){if(c.length>=o)break;if(u+g.estimatedMinutes>i||r&&c.length>0&&bs(g.course,a)>.7)continue;const N=In(g,t);c.push({course:g.course,role:g.role,reason:N,estimatedMinutes:g.estimatedMinutes}),u+=g.estimatedMinutes,[...g.course.canonical_tags||[],...g.course.gemini_system_tags||[]].map(C=>typeof C=="string"?C.toLowerCase():"").forEach(C=>{a.add(C),a.add(C.split(".").pop())})}const p=new Set(t.map(g=>g.toLowerCase()));let y=0;for(const g of p)(a.has(g)||a.has(g.split(".").pop()))&&y++;const x=p.size>0?y/p.size:0;let v=1;if(c.length>1){let g=0;const N=new Set;for(const m of c)g+=bs(m.course,N),[...m.course.canonical_tags||[]].map(S=>S?.toLowerCase?.()||"").forEach(S=>N.add(S));v=1-g/c.length}return{path:c,metadata:{totalMinutes:u,tagCoverage:Math.round(x*100)/100,diversityScore:Math.round(v*100)/100,itemCount:c.length}}}function In(s,t){const{course:n,role:i}=s,o=[...n.canonical_tags||[],...n.gemini_system_tags||[]].map(d=>typeof d=="string"?d.toLowerCase():""),l=new Set(t.map(d=>d.toLowerCase())),r=o.filter(d=>l.has(d)||l.has(d.split(".").pop()));switch(i){case"prerequisite":return`Foundation course ‚Äî covers prerequisite concepts for ${r.slice(0,2).join(", ")}`;case"core":return`Directly covers: ${r.slice(0,3).join(", ")}`;case"troubleshooting":return"Troubleshooting guide ‚Äî addresses symptoms related to your query";case"supplemental":return"Related content ‚Äî expands on topics connected to your query";default:return"Relevant to your search"}}let ge=null;async function Fs(){if(ge!=null)return ge;try{const s=await xe(()=>import("./data-courses-LtwEzJPI.js").then(t=>t.y),[]);return ge=s.default||s,ge}catch{return ge={channels:{},resources:[]},ge}}const Le={beginner:0,intermediate:1,advanced:2};async function zs(s,{maxTier:t="advanced",limit:n=5}={}){if(!s?.length)return[];const i=await Fs();if(!i?.resources?.length)return[];const o=Le[t]??2,l=new Set(s.map(c=>c.toLowerCase())),r=[];for(const c of i.resources){if((Le[c.tier]??1)>o)continue;const u=(c.topics||[]).map(x=>x.toLowerCase()),p=(c.tag_ids||[]).map(x=>x.toLowerCase());let y=0;for(const x of u){l.has(x)&&(y+=5);for(const v of l)(x.includes(v)||v.includes(x))&&(y+=2)}for(const x of p){l.has(x)&&(y+=5);const v=x.split(".");for(const g of v)l.has(g)&&(y+=3)}if(y>0){const x=i.channels?.[c.channelKey];r.push({id:c.id,title:c.title,url:c.url,channelName:x?.name||"Unreal Engine",channelTrust:"official",tier:c.tier,durationMinutes:c.durationMinutes,topics:c.topics,tag_ids:c.tag_ids||[],description:c.description||"",keyTakeaways:c.keyTakeaways||[],chapters:c.chapters||[],source:"epic_youtube",_score:y})}}const d=/\b(ue\s*5|unreal\s*engine\s*5|5\.\d)/i;for(const c of r)c._isUE5=d.test(c.title)||(c.topics||[]).some(a=>d.test(a));return r.sort((c,a)=>c._isUE5!==a._isUE5?c._isUE5?-1:1:a._score!==c._score?a._score-c._score:(Le[c.tier]??1)-(Le[a.tier]??1)),r.slice(0,n).map(({_score:c,_isUE5:a,...u})=>u)}async function Ln(s,{limit:t=5}={}){if(!s?.length)return[];const n=await Fs();if(!n?.resources?.length)return[];const i=new Set(s.map(l=>l.toLowerCase())),o=[];for(const l of n.resources){const r=(l.tag_ids||[]).map(c=>c.toLowerCase());let d=0;for(const c of r)i.has(c)&&(d+=5);if(d>0){const c=n.channels?.[l.channelKey];o.push({id:l.id,title:l.title,url:l.url,channelName:c?.name||"Unreal Engine",channelTrust:"official",tier:l.tier,durationMinutes:l.durationMinutes,topics:l.topics,tag_ids:l.tag_ids||[],description:l.description||"",keyTakeaways:l.keyTakeaways||[],chapters:l.chapters||[],source:"epic_youtube",_score:d})}}return o.sort((l,r)=>r._score-l._score),o.slice(0,t).map(({_score:l,...r})=>r)}async function Rn(s,t=[]){if(!s?.length)return{topics:[],firstPartyVideos:0,docsArticles:0,youtubeResources:0,coverageScore:0,gaps:[]};const n=await Ds(s,{limit:10}),i=await zs(s,{limit:10}),o={};for(const c of s){const a=c.toLowerCase(),u=t.filter(v=>{const g=(v.tags||[]).map(m=>m.toLowerCase()),N=(v.title||"").toLowerCase();return g.some(m=>m.includes(a))||N.includes(a)}).length,p=n.filter(v=>v.key?.toLowerCase().includes(a)||v.subsystem?.toLowerCase()===a||v.label?.toLowerCase().includes(a)).length,y=i.filter(v=>{const g=(v.topics||[]).some(m=>m.toLowerCase().includes(a)),N=(v.tag_ids||[]).some(m=>m.toLowerCase().includes(a));return g||N}).length,x=u+p+y;o[c]={firstPartyVideos:u,docsArticles:p,youtubeResources:y,total:x,covered:x>0}}const l=Object.values(o).filter(c=>c.covered).length,r=s.length>0?l/s.length:0,d=Object.entries(o).filter(([,c])=>!c.covered).map(([c])=>c);return{topics:s,topicCoverage:o,firstPartyVideos:t.length,docsArticles:n.length,youtubeResources:i.length,coverageScore:r,gaps:d}}async function En(s,t=[],{maxDocs:n=5,maxYoutube:i=3}={}){if(!s?.length)return{docs:[],youtube:[],totalTimeMinutes:0,coverageScore:0};const o=await kn(s,{limit:n}),l=await zs(s,{limit:i}),r=await Ln(s,{limit:i}),d=new Set(l.map(x=>x.id)),c=[...l];for(const x of r)d.has(x.id)||(c.push(x),d.add(x.id));const a=t.reduce((x,v)=>x+(v.durationMinutes||10),0),u=o.reduce((x,v)=>x+(v.readTimeMinutes||10),0),p=c.reduce((x,v)=>x+(v.durationMinutes||15),0),y=await Rn(s,t);return{docs:o,youtube:c,totalTimeMinutes:a+u+p,coverageScore:y.coverageScore,gaps:y.gaps,externalEnabled:!0}}const es={QUERY_SUBMITTED:"query_submitted",DIAGNOSIS_GENERATED:"diagnosis_generated",LEARNING_PATH_GENERATED:"learning_path_generated"};let We=null;function Mn(){return We||(We=`session_${Date.now()}_${Math.random().toString(36).substring(2,9)}`),We}async function ss(s,t={}){try{const n=_s(),i={event:s,session_id:Mn(),...t,timestamp:Ks(),client_timestamp:new Date().toISOString()};await Hs(Zs(n,"analytics_events"),i)}catch(n){re("[Analytics] Failed to track event:",s,n.message)}}function $n(s,t=[],n=null){return ss(es.QUERY_SUBMITTED,{query_length:s?.length||0,query_preview:s?.substring(0,100),detected_tag_count:t.length,detected_tags:t.slice(0,5),persona_id:n})}function An(s){return ss(es.DIAGNOSIS_GENERATED,{diagnosis_id:s?.diagnosis_id,root_causes_count:s?.root_causes?.length||0,signals_count:s?.signals_to_watch_for?.length||0,generalization_scope:s?.generalization_scope?.slice(0,3)})}function qn(s,t,n=!0){return ss(es.LEARNING_PATH_GENERATED,{fix_specific_count:s?.fix_specific?.length||0,transferable_count:s?.transferable?.length||0,course_count:t?.length||0,passed_validation:n})}function ts({onUpdate:s,disabled:t}){const[n,i]=b.useState(!1),[o,l]=b.useState({engineVersion:"",platform:"",context:"",renderer:"",features:"",whatChangedRecently:"",goal:""}),r=b.useCallback((d,c)=>{const a={...o,[d]:c};l(a);const u={engineVersion:a.engineVersion.trim()||void 0,platform:a.platform.trim()||void 0,context:a.context.trim()||void 0,renderer:a.renderer.trim()||void 0,features:a.features?a.features.split(",").map(y=>y.trim()).filter(Boolean):[],whatChangedRecently:a.whatChangedRecently.trim()||void 0,goal:a.goal.trim()||void 0},p=Object.values(u).some(y=>y!==void 0&&(!Array.isArray(y)||y.length>0));s(p?u:null)},[o,s]);return e.jsxs("div",{className:"case-report-form",children:[e.jsxs("button",{type:"button",className:"case-report-toggle",onClick:()=>i(!n),disabled:t,children:[e.jsx("span",{className:"case-report-toggle-icon",children:n?"‚ñæ":"‚ñ∏"}),e.jsxs("span",{className:"case-report-toggle-label",children:["üîß Add Case Details",e.jsx("span",{className:"case-report-hint",children:"(improves diagnosis accuracy)"})]})]}),n&&e.jsxs("div",{className:"case-report-fields",children:[e.jsxs("div",{className:"case-report-row",children:[e.jsxs("div",{className:"case-report-field",children:[e.jsx("label",{children:"Engine Version"}),e.jsx("input",{type:"text",placeholder:"e.g. 5.4.1",value:o.engineVersion,onChange:d=>r("engineVersion",d.target.value),disabled:t,maxLength:20})]}),e.jsxs("div",{className:"case-report-field",children:[e.jsx("label",{children:"Platform"}),e.jsxs("select",{value:o.platform,onChange:d=>r("platform",d.target.value),disabled:t,children:[e.jsx("option",{value:"",children:"Select..."}),e.jsx("option",{value:"Windows",children:"Windows"}),e.jsx("option",{value:"macOS",children:"macOS"}),e.jsx("option",{value:"Linux",children:"Linux"}),e.jsx("option",{value:"Android",children:"Android"}),e.jsx("option",{value:"iOS",children:"iOS"}),e.jsx("option",{value:"Console",children:"Console"})]})]}),e.jsxs("div",{className:"case-report-field",children:[e.jsx("label",{children:"Renderer"}),e.jsxs("select",{value:o.renderer,onChange:d=>r("renderer",d.target.value),disabled:t,children:[e.jsx("option",{value:"",children:"Select..."}),e.jsx("option",{value:"Lumen",children:"Lumen"}),e.jsx("option",{value:"Nanite",children:"Nanite"}),e.jsx("option",{value:"Forward",children:"Forward Shading"}),e.jsx("option",{value:"Deferred",children:"Deferred"}),e.jsx("option",{value:"Mobile",children:"Mobile"}),e.jsx("option",{value:"PathTracing",children:"Path Tracing"})]})]})]}),e.jsxs("div",{className:"case-report-field case-report-full",children:[e.jsx("label",{children:"What changed recently?"}),e.jsx("input",{type:"text",placeholder:"e.g. Updated to 5.4, migrated project, changed lighting settings",value:o.whatChangedRecently,onChange:d=>r("whatChangedRecently",d.target.value),disabled:t,maxLength:300})]}),e.jsxs("div",{className:"case-report-field case-report-full",children:[e.jsx("label",{children:"What are you trying to achieve?"}),e.jsx("input",{type:"text",placeholder:"e.g. Realistic interior lighting, smooth character animation",value:o.goal,onChange:d=>r("goal",d.target.value),disabled:t,maxLength:200})]}),e.jsxs("div",{className:"case-report-field case-report-full",children:[e.jsx("label",{children:"Active Features (comma separated)"}),e.jsx("input",{type:"text",placeholder:"e.g. Lumen, Nanite, Virtual Shadow Maps, World Partition",value:o.features,onChange:d=>r("features",d.target.value),disabled:t,maxLength:200})]})]})]})}ts.propTypes={onUpdate:h.func.isRequired,disabled:h.bool};ts.defaultProps={disabled:!1};function ns({question:s,options:t,whyAsking:n,onAnswer:i,onSkip:o,isLoading:l}){return e.jsxs("div",{className:"clarify-step",children:[e.jsxs("div",{className:"clarify-header",children:[e.jsx("span",{className:"clarify-icon",children:"ü§î"}),e.jsx("h3",{children:"Quick question before we diagnose"})]}),e.jsx("p",{className:"clarify-question",children:s}),e.jsx("div",{className:"clarify-options",children:(t||[]).map((r,d)=>e.jsxs("button",{className:"clarify-option-btn",onClick:()=>i(r),disabled:l,children:[e.jsx("span",{className:"clarify-option-letter",children:String.fromCharCode(65+d)}),e.jsx("span",{className:"clarify-option-text",children:r})]},d))}),n&&e.jsxs("p",{className:"clarify-why",children:[e.jsx("span",{className:"clarify-why-label",children:"Why we're asking:"})," ",n]}),e.jsx("button",{className:"clarify-skip-btn",onClick:o,disabled:l,children:"Skip ‚Äî just give me the best answer you can"})]})}ns.propTypes={question:h.string.isRequired,options:h.arrayOf(h.string),whyAsking:h.string,onAnswer:h.func.isRequired,onSkip:h.func.isRequired,isLoading:h.bool};ns.defaultProps={options:[],whyAsking:"",isLoading:!1};function as({evidence:s}){const[t,n]=b.useState(!1);return!s||s.length===0?null:e.jsxs("details",{className:"evidence-panel",open:t,onToggle:i=>n(i.target.open),children:[e.jsxs("summary",{className:"evidence-toggle",children:[e.jsx("span",{className:"evidence-icon",children:"üìé"}),"Sources (",s.length,")"]}),e.jsx("div",{className:"evidence-list",children:s.map((i,o)=>e.jsxs("div",{className:"evidence-item",children:[e.jsxs("div",{className:"evidence-item-header",children:[e.jsxs("span",{className:"evidence-ref",children:["[",o+1,"]"]}),e.jsx("span",{className:"evidence-source-badge",children:i.source==="transcript"?"üé¨ Transcript":"üìÑ Docs"}),i.videoTitle&&e.jsx("span",{className:"evidence-video-title",children:i.videoTitle}),i.timestamp&&e.jsxs("span",{className:"evidence-timestamp",children:["@ ",i.timestamp]})]}),e.jsx("p",{className:"evidence-text",children:i.text}),i.courseCode&&e.jsxs("span",{className:"evidence-course",children:["Course: ",i.courseCode]})]},o))})]})}as.propTypes={evidence:h.arrayOf(h.shape({text:h.string,source:h.string,courseCode:h.string,videoTitle:h.string,timestamp:h.string}))};as.defaultProps={evidence:[]};function rs({onFeedback:s,isRerunning:t}){const[n,i]=b.useState("ask"),[o,l]=b.useState(""),r=b.useCallback(()=>{i("thanks"),s({solved:!0})},[s]),d=b.useCallback(()=>{i("no-reason")},[]),c=b.useCallback(()=>{s({solved:!1,reason:o.trim()}),i("thanks")},[s,o]);return n==="thanks"?e.jsxs("div",{className:"feedback-panel feedback-thanks",children:[e.jsx("span",{className:"feedback-icon",children:"‚úÖ"}),e.jsx("span",{children:"Thanks for the feedback!"}),t&&e.jsx("span",{className:"feedback-rerunning",children:"Re-analyzing with your feedback..."})]}):n==="no-reason"?e.jsxs("div",{className:"feedback-panel feedback-reason",children:[e.jsx("p",{className:"feedback-question",children:"What didn't work?"}),e.jsx("textarea",{className:"feedback-textarea",value:o,onChange:a=>l(a.target.value),placeholder:"e.g. I already tried that, the setting doesn't exist in my version, the issue is different...",maxLength:300,rows:2,disabled:t}),e.jsx("button",{className:"feedback-submit-btn",onClick:c,disabled:o.trim().length<5||t,children:t?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner"})," Re-analyzing..."]}):"Try a different approach ‚Üí"})]}):e.jsxs("div",{className:"feedback-panel feedback-ask",children:[e.jsx("p",{className:"feedback-question",children:"Did this solve your problem?"}),e.jsxs("div",{className:"feedback-buttons",children:[e.jsx("button",{className:"feedback-btn feedback-yes",onClick:r,children:"üëç Yes"}),e.jsx("button",{className:"feedback-btn feedback-no",onClick:d,children:"üëé No"})]})]})}rs.propTypes={onFeedback:h.func.isRequired,isRerunning:h.bool};rs.defaultProps={isRerunning:!1};function is({answer:s,onFeedback:t,onBackToVideos:n,onStartOver:i,isRerunning:o}){const[l,r]=b.useState(!1);if(!s)return null;const d=s.confidence==="high"?"#10b981":s.confidence==="med"?"#f59e0b":"#ef4444";return e.jsxs("div",{className:"answer-view",children:[e.jsxs("div",{className:"answer-header",children:[e.jsxs("h2",{className:"answer-title",children:[e.jsx("span",{className:"answer-icon",children:"üéØ"})," Most Likely Cause"]}),e.jsxs("span",{className:"answer-confidence-badge",style:{background:`${d}22`,color:d,border:`1px solid ${d}44`},children:[s.confidence," confidence"]})]}),e.jsx("p",{className:"answer-cause",children:s.mostLikelyCause}),s.fastChecks?.length>0&&e.jsxs("div",{className:"answer-section answer-fast-checks",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"section-icon",children:"‚ö°"})," Quick Checks"]}),e.jsx("ul",{children:s.fastChecks.map((c,a)=>e.jsxs("li",{children:[e.jsx("span",{className:"check-number",children:a+1}),e.jsx("span",{children:c})]},a))})]}),s.fixSteps?.length>0&&e.jsxs("div",{className:"answer-section answer-fix-steps",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"section-icon",children:"üîß"})," Fix Steps"]}),e.jsx("ol",{children:s.fixSteps.map((c,a)=>e.jsx("li",{children:c},a))})]}),s.ifStillBrokenBranches?.length>0&&e.jsxs("div",{className:"answer-section answer-branches",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"section-icon",children:"üîÄ"})," If Still Broken"]}),e.jsx("div",{className:"branch-list",children:s.ifStillBrokenBranches.map((c,a)=>e.jsxs("div",{className:"branch-item",children:[e.jsxs("span",{className:"branch-condition",children:["If ",c.condition,":"]}),e.jsx("span",{className:"branch-action",children:c.action})]},a))})]}),s.learnPath&&e.jsxs("details",{className:"answer-section answer-learn-path",open:l,onToggle:c=>r(c.target.open),children:[e.jsxs("summary",{children:[e.jsx("span",{className:"section-icon",children:"üìö"})," Learn More",e.jsxs("span",{className:"learn-path-badge",children:[s.learnPath.topicsCovered?.length||0," topics"]})]}),e.jsxs("div",{className:"learn-path-content",children:[e.jsx("p",{className:"learn-path-summary",children:s.learnPath.pathSummary}),s.learnPath.objectives&&e.jsxs("div",{className:"learn-path-objectives",children:[s.learnPath.objectives.fixSpecific?.length>0&&e.jsxs("div",{children:[e.jsx("h4",{children:"üéØ Fix-Specific"}),e.jsx("ul",{children:s.learnPath.objectives.fixSpecific.map((c,a)=>e.jsx("li",{children:c},a))})]}),s.learnPath.objectives.transferable?.length>0&&e.jsxs("div",{children:[e.jsx("h4",{children:"üîÑ Transferable Skills"}),e.jsx("ul",{children:s.learnPath.objectives.transferable.map((c,a)=>e.jsx("li",{children:c},a))})]})]})]})]}),s.whyThisResult?.length>0&&e.jsxs("div",{className:"answer-section answer-reasoning",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"section-icon",children:"üí°"})," Why This Result"]}),e.jsx("ul",{className:"reasoning-list",children:s.whyThisResult.map((c,a)=>e.jsx("li",{children:c},a))})]}),e.jsx(as,{evidence:s.evidence}),e.jsxs("div",{className:"answer-actions",children:[e.jsx("button",{className:"answer-action-btn primary",onClick:n,children:"üé¨ Browse Related Videos"}),e.jsx("button",{className:"answer-action-btn secondary",onClick:i,children:"‚Üê Ask Another Question"})]}),e.jsx(rs,{onFeedback:t,isRerunning:o})]})}is.propTypes={answer:h.shape({mostLikelyCause:h.string,confidence:h.oneOf(["high","med","low"]),fastChecks:h.arrayOf(h.string),fixSteps:h.arrayOf(h.string),ifStillBrokenBranches:h.arrayOf(h.shape({condition:h.string,action:h.string})),learnPath:h.shape({pathSummary:h.string,topicsCovered:h.arrayOf(h.string),objectives:h.shape({fixSpecific:h.arrayOf(h.string),transferable:h.arrayOf(h.string)})}),whyThisResult:h.arrayOf(h.string),evidence:h.array}),onFeedback:h.func.isRequired,onBackToVideos:h.func.isRequired,onStartOver:h.func.isRequired,isRerunning:h.bool};is.defaultProps={answer:null,isRerunning:!1};const G={INPUT:"input",LOADING:"loading",CLARIFYING:"clarifying",ANSWERED:"answered",DIAGNOSIS:"diagnosis",GUIDED:"guided",ERROR:"error"};function Jn(){const[s,t]=b.useState(G.INPUT),[n,i]=b.useState(null),[o,l]=b.useState(null),[r,d]=b.useState(null),[c,a]=b.useState([]),[u,p]=b.useState(null),[y,x]=b.useState(null),[v,g]=b.useState(null),[N,m]=b.useState(!1),[C,S]=b.useState(null),{cart:k,addToCart:M,removeFromCart:R,clearCart:$,isInCart:A}=an(),W=Qs(),_=b.useMemo(()=>W?.courses||[],[W?.courses]),E=b.useCallback(()=>{try{const f=localStorage.getItem("detected_persona");return f?JSON.parse(f):null}catch{return null}},[]),T=b.useCallback(async(f,j)=>{$(),t(G.LOADING),l(null),p(null),x(null),S(f);const w=j||v;f.pastedImage&&K("[ProblemFirst] Screenshot attached (base64 length):",f.pastedImage.length),f.errorLog&&K("[ProblemFirst] Error log attached:",f.errorLog.slice(0,200));try{if(f.cachedCartId){K(`[Cache] Checking Firestore for cart: ${f.cachedCartId}`);try{const U=ds(),q=_s(U),me=Js(q,"adaptive_carts",f.cachedCartId),pe=await Xs(me);if(pe.exists()){const te=pe.data(),ae=te.cached_at?.toDate?.()||new Date(te.created_at||0),J=Date.now()-ae.getTime(),Z=1440*60*1e3;if(J<Z){K(`[Cache Hit] Cart is ${Math.round(J/6e4)}min old ‚Äî using cached result`);const D={...te,userQuery:f.query,retrievedPassages:[]},de=await gs(D,_,f.selectedTagIds||[],f.errorLog||"",[]);D.matchedCourses=de;const Gs=[...D.diagnosis?.matched_tag_ids||[],...f.detectedTagIds||[],...f.selectedTagIds||[]],Ws=Ns(de,Gs,{preferTroubleshooting:!0,diversity:!0}),ls={};for(const we of Ws.path)ls[we.course.code]={role:we.role,reason:we.reason,estimatedMinutes:we.estimatedMinutes};const Ee=await xs(de,f.query,ls);if(Ee.length>0){a(Ee),i(D),t(G.DIAGNOSIS),K(`[Cache] Loaded ${Ee.length} videos from cached cart ‚Äî 0 Gemini calls`);return}re("[Cache] Cached cart produced 0 videos ‚Äî falling through to fresh diagnosis")}else K(`[Cache Expired] Cart is ${Math.round(J/36e5)}h old ‚Äî refreshing`)}else K(`[Cache Miss] Cart ${f.cachedCartId} not found in Firestore`)}catch(U){re("[Cache Error] Falling through to fresh diagnosis:",U.message)}}await $n(f.query,f.detectedTagIds,E()?.id);const L=ds(),F=et(L,"us-central1");let Q=null,ce=[],O=[];try{const q=await us(F,"embedQuery")({query:f.query});if(q.data?.success&&q.data?.embedding){Q=q.data.embedding;const[me,pe,te]=await Promise.allSettled([on(Q,8,.35),pn(Q,6,.35),Sn(Q,6,.35)]);if(me.status==="fulfilled"?ce=me.value:re("‚ö†Ô∏è Course semantic search failed:",me.reason?.message),pe.status==="fulfilled"){const ae=pe.value.map(J=>({text:J.previewText,courseCode:J.courseCode,videoTitle:J.videoTitle,timestamp:J.timestamp,similarity:J.similarity,source:"transcript"}));O.push(...ae),K(`[RAG] ${ae.length} transcript passages`)}else re("‚ö†Ô∏è Segment search failed:",pe.reason?.message);if(te.status==="fulfilled"){const ae=te.value.map(J=>({text:J.previewText,url:J.url,title:J.title,section:J.section,similarity:J.similarity,source:"epic_docs"}));O.push(...ae),K(`[RAG] ${ae.length} doc passages`)}else re("‚ö†Ô∏è Docs search failed:",te.reason?.message);K(`[RAG] Total: ${O.length} passages retrieved (parallel)`)}}catch(U){re("‚ö†Ô∏è Semantic search skipped:",U.message)}let I,H=!0;try{const q=await us(F,"queryLearningPath")({query:f.query,mode:"problem-first",detectedTagIds:f.detectedTagIds,personaHint:f.personaHint,retrievedContext:O.slice(0,5),caseReport:w||void 0});if(!q.data.success&&q.data.error==="off_topic"){l(q.data.message||"This doesn't appear to be a UE5 question. Please describe a specific Unreal Engine 5 issue."),t(G.ERROR);return}if(q.data.responseType==="NEEDS_CLARIFICATION"){x({question:q.data.question,options:q.data.options||[],whyAsking:q.data.whyAsking||"",query:q.data.query,caseReport:q.data.caseReport}),t(G.CLARIFYING);return}if(!q.data.success)throw new Error(q.data.message||"Failed to process query");q.data.responseType==="ANSWER"&&p({mostLikelyCause:q.data.mostLikelyCause,confidence:q.data.confidence,fastChecks:q.data.fastChecks||[],fixSteps:q.data.fixSteps||[],ifStillBrokenBranches:q.data.ifStillBrokenBranches||[],whyThisResult:q.data.whyThisResult||[],evidence:q.data.evidence||[],learnPath:q.data.learnPath}),I=q.data.cart}catch(U){const q=U.message?.includes("429")||U.code==="resource-exhausted";if(U.message?.includes("off_topic")||U.message?.includes("not a UE5")){l(`This doesn't appear to be a UE5 question. Try describing a specific Unreal Engine 5 issue, for example:
‚Ä¢ "Lumen reflections flickering"
‚Ä¢ "Blueprint compile error"
‚Ä¢ "Niagara particles not spawning"`),t(G.ERROR);return}re(`‚ö†Ô∏è Gemini ${q?"rate limited (429)":"error"}: ${U.message}. Falling back to local matching.`),H=!1,I={diagnosis:{problem_summary:f.query,matched_tag_ids:f.detectedTagIds||[]},objectives:[],intent:{systems:[]}}}I.userQuery=f.query,I.retrievedPassages=O,I._localFallback=!H;const le=await gs(I,_,f.selectedTagIds||[],f.errorLog||"",ce);I.matchedCourses=le;const ee=[...I.diagnosis?.matched_tag_ids||[],...f.detectedTagIds||[],...f.selectedTagIds||[]],ne=Ns(le,ee,{preferTroubleshooting:!0,diversity:!0}),se={};for(const U of ne.path)se[U.course.code]={role:U.role,reason:U.reason,estimatedMinutes:U.estimatedMinutes};const he=await xs(le,f.query,se),os=he.filter(U=>!U.type||U.type==="video"),cs=he.filter(U=>U.type==="doc"||U.type==="youtube");if(he.length===0){l(`We couldn't find UE5 content matching your query. Try describing a specific Unreal Engine problem, for example:
‚Ä¢ "Blueprint compile error LNK2019"
‚Ä¢ "Lumen reflections flickering in indoor scene"
‚Ä¢ "Niagara particle system not spawning"
‚Ä¢ "UMG widget not rendering"`),t(G.ERROR);return}a(os),i(I);try{const q=[...I.diagnosis?.matched_tag_ids||[],...f.detectedTagIds||[]].flatMap(Z=>Z.split(/[._]/).filter(D=>D.length>2&&D!=="unreal"&&D!=="engine")),me=new Set(["the","and","for","are","but","not","you","all","can","has","her","was","one","our","out","its","how","why","with","from","they","been","have","this","that","what","when","your","into"]),pe=(f.query||"").toLowerCase().split(/\s+/).filter(Z=>Z.length>2&&!me.has(Z)),te=[...new Set(pe)],ae=Z=>te.some(D=>D.includes(Z));ae("mesh")&&!ae("skeletal")&&te.push("static mesh","static meshes","import","importing"),(ae("size")||ae("scale")||ae("wrong"))&&te.push("scale","transform");const J=[...new Set([...q,...te])].slice(0,15);if(K(`[DocTopics] ${te.join(", ")}`),K(`[AllTopics] ${J.join(", ")}`),te.length>0){const Z=await En(te,os,{maxDocs:5,maxYoutube:3});if(cs.length>0)for(const D of cs)D.type==="doc"&&!Z.docs.some(de=>de.url===D._externalUrl)&&Z.docs.push({label:D.title,url:D._externalUrl||D.url,description:D.description||"",readTimeMinutes:D.readTimeMinutes||10,tier:"intermediate"}),D.type==="youtube"&&!Z.youtube.some(de=>de.url===D._externalUrl)&&Z.youtube.push({title:D.title,url:D._externalUrl||D.url,channelName:D.channel||"YouTube",channelTrust:D.channelTrust||null,durationMinutes:D.durationMinutes||10,tier:"intermediate"});Z.docs.sort((D,de)=>(de._rawScore??de.matchScore??0)-(D._rawScore??D.matchScore??0)),d(Z),K(`[Blended] ${Z.docs.length} docs, ${Z.youtube.length} YT, coverage: ${(Z.coverageScore*100).toFixed(0)}%`)}}catch(U){re("‚ö†Ô∏è Blended path skipped:",U.message)}t(u?G.ANSWERED:G.DIAGNOSIS),f.updateCartIdForQuery&&I.cart_id&&(f.updateCartIdForQuery(f.query,I.cart_id),K(`[Cache] Saved cart_id ${I.cart_id} to history for: "${f.query.substring(0,40)}..."`)),await An(I.diagnosis),await qn(I.objectives,le,I.validation?.approved)}catch(L){console.error("[ProblemFirst] Error:",L),l(L.message||"An unexpected error occurred"),t(G.ERROR)}},[_,E,$,v,u]),P=b.useCallback(()=>t(G.INPUT),[]),z=b.useCallback(()=>{t(G.INPUT),i(null),a([]),l(null),d(null),p(null),x(null),g(null),m(!1)},[]),V=b.useCallback(f=>{if(!C)return;const j={...C,query:`${C.query} (${f})`};T(j,v)},[C,v,T]),X=b.useCallback(()=>{C&&T(C,v)},[C,v,T]),oe=b.useCallback(f=>{if(f.solved||!C)return;m(!0);const j={...v||{},exclusions:[...(v||{}).exclusions||[],f.reason||"Previous solution did not work"]};g(j),T(C,j)},[C,v,T]),ie=b.useCallback(()=>{t(G.DIAGNOSIS)},[]),Y=b.useCallback(f=>{A(f.driveId)?R(f.driveId):M(f)},[A,M,R]),ye=b.useCallback(()=>{k.length>0&&t(G.GUIDED)},[k]);return e.jsxs("div",{className:"problem-first-page",children:[e.jsxs("header",{className:"page-header",children:[e.jsx("h1",{children:"üîß Fix a Problem"}),e.jsx("p",{children:"Describe your issue. We'll diagnose it and show you how to fix it."})]}),(s===G.INPUT||s===G.LOADING)&&e.jsxs(e.Fragment,{children:[e.jsx(He,{onSubmit:T,detectedPersona:E(),isLoading:s===G.LOADING}),e.jsx(ts,{onUpdate:g,disabled:s===G.LOADING})]}),s===G.CLARIFYING&&y&&e.jsx(ns,{question:y.question,options:y.options,whyAsking:y.whyAsking,onAnswer:V,onSkip:X,isLoading:!1}),s===G.ANSWERED&&u&&e.jsx(is,{answer:u,onFeedback:oe,onBackToVideos:ie,onStartOver:z,isRerunning:N}),s===G.ERROR&&e.jsxs("div",{className:"error-state",children:[e.jsx("div",{className:"error-icon",children:"‚ö†Ô∏è"}),e.jsx("h3",{children:"Something went wrong"}),e.jsx("p",{children:o}),e.jsx("button",{className:"retry-btn",onClick:z,children:"Try Again"})]}),s===G.DIAGNOSIS&&n&&e.jsxs("div",{className:"shopping-layout",children:[e.jsxs("div",{className:"results-column",children:[e.jsxs("div",{className:"tldr-diagnosis",children:[e.jsxs("div",{className:"tldr-user-query",children:[e.jsx("span",{className:"tldr-query-label",children:"üîç You asked:"}),e.jsx("p",{className:"tldr-query-text",children:n.userQuery})]}),n._localFallback&&e.jsxs("div",{className:"tldr-fallback-notice",style:{background:"rgba(255, 193, 7, 0.1)",border:"1px solid rgba(255, 193, 7, 0.3)",borderRadius:"8px",padding:"8px 14px",margin:"8px 0",fontSize:"0.85rem",color:"var(--text-muted, #aaa)"},children:["‚ö° ",e.jsx("strong",{children:"Fast results"})," ‚Äî AI diagnosis temporarily unavailable. Videos matched by tag taxonomy. Try again in a moment for AI-powered results."]}),n.diagnosis?.problem_summary&&e.jsx("p",{className:"tldr-bridge",children:"Based on your question, we think these videos will help you:"})]}),e.jsxs("h2",{className:"results-title",children:["üé¨ Videos for You (",c.length,")"]}),c.length===0&&e.jsx("div",{className:"no-results",children:e.jsx("p",{children:"No matching videos found. Try rephrasing your question."})}),(()=>{const f=[{key:"prerequisite",icon:"üîó",label:"Prerequisite",desc:"Build the foundation first ‚Äî these cover concepts you'll need before tackling the main topic."},{key:"core",icon:"‚≠ê",label:"Core",desc:"These directly address your question and are the most important videos to watch."},{key:"troubleshooting",icon:"üîß",label:"Troubleshooting",desc:"Debugging helpers ‚Äî watch these if you're hitting errors or unexpected behavior."},{key:"supplemental",icon:"üìö",label:"Supplemental",desc:"Go deeper ‚Äî extra context and advanced techniques for when you're ready."}],j={};for(const w of f)j[w.key]=[];j._other=[];for(const w of c){const L=w.role||"_other";(j[L]||j._other).push(w)}return f.filter(w=>j[w.key].length>0).map(w=>e.jsxs("div",{className:"role-section",children:[e.jsxs("div",{className:"role-section-header",children:[e.jsxs("h3",{className:"role-section-title",children:[w.icon," ",w.label,e.jsx("span",{className:"role-section-count",children:j[w.key].length})]}),e.jsx("p",{className:"role-section-desc",children:w.desc})]}),e.jsx("div",{className:"video-results-grid",children:j[w.key].map(L=>e.jsx("div",{className:"video-result-wrapper",id:`video-${L.driveId}`,children:e.jsx(Ke,{video:L,isAdded:A(L.driveId),onToggle:Y,userQuery:n?.userQuery||""})},L.driveId))})]},w.key)).concat(j._other.length>0?[e.jsxs("div",{className:"role-section",children:[e.jsxs("div",{className:"role-section-header",children:[e.jsxs("h3",{className:"role-section-title",children:["üìé Related"," ",e.jsx("span",{className:"role-section-count",children:j._other.length})]}),e.jsx("p",{className:"role-section-desc",children:"Additional videos that may be relevant to your query."})]}),e.jsx("div",{className:"video-results-grid",children:j._other.map(w=>e.jsx("div",{className:"video-result-wrapper",id:`video-${w.driveId}`,children:e.jsx(Ke,{video:w,isAdded:A(w.driveId),onToggle:Y,userQuery:n?.userQuery||""})},w.driveId))})]},"_other")]:[])})(),r?.docs?.length>0&&e.jsxs("div",{className:"blended-section",children:[e.jsxs("div",{className:"blended-section-header",children:[e.jsx("h2",{className:"blended-section-title",children:"üìö Recommended Reading"}),e.jsxs("p",{className:"blended-section-desc",children:["Official Unreal Engine documentation to deepen your understanding.",r.docs.reduce((f,j)=>f+(j.readTimeMinutes||10),0)>0&&` (~${r.docs.reduce((f,j)=>f+(j.readTimeMinutes||10),0)} min total read time)`]})]}),e.jsx("div",{className:"doc-cards-grid",children:r.docs.map((f,j)=>{const w=`doc_${f.key||j}`,L=A(w);return e.jsxs("div",{className:`doc-card ${L?"doc-card-added":""}`,children:[e.jsxs("a",{href:f.url,target:"_blank",rel:"noopener noreferrer",className:"doc-card-link",onClick:F=>F.stopPropagation(),children:[e.jsxs("div",{className:"doc-card-header",children:[f.matchScore!=null&&(()=>{const F=f.matchScore>=90?"best":f.matchScore>=60?"strong":f.matchScore>=30?"good":"related",Q=f.matchScore>=90?"Best Match":f.matchScore>=60?"Strong":f.matchScore>=30?"Good":"Related";return e.jsxs("span",{className:`doc-match-badge doc-match-${F}`,title:`${f.matchScore}% relevancy`,children:[e.jsx("span",{className:"doc-match-dot"}),Q]})})(),e.jsx("span",{className:`tier-badge tier-${f.tier||"intermediate"}`,children:f.tier||"intermediate"}),f.subsystem&&e.jsx("span",{className:"subsystem-tag",children:f.subsystem})]}),e.jsx("h4",{className:"doc-card-title",children:f.label}),f.description&&e.jsx("p",{className:"doc-card-desc",children:f.description}),e.jsxs("div",{className:"doc-card-footer",children:[e.jsx("span",{className:"doc-source-badge",children:"üìÑ Epic Docs"}),e.jsxs("span",{className:"doc-read-time",children:[f.readTimeMinutes||10," min read"]})]})]}),e.jsx("button",{className:`doc-add-btn ${L?"doc-added":""}`,onClick:()=>{L?R(w):M({type:"doc",itemId:w,title:f.label,description:f.description||"",keySteps:f.keySteps||[],seeAlso:f.seeAlso||[],sections:f.sections||[],url:f.url,tier:f.tier||"intermediate",subsystem:f.subsystem,readTimeMinutes:f.readTimeMinutes||10})},title:L?"Remove from path":"Add to learning path",children:L?"‚úì Added":"‚ûï Add"})]},f.key||j)})})]}),r?.youtube?.length>0&&e.jsxs("div",{className:"blended-section",children:[e.jsxs("div",{className:"blended-section-header",children:[e.jsx("h2",{className:"blended-section-title",children:"üì∫ Official Epic YouTube"}),e.jsx("p",{className:"blended-section-desc",children:"Official Unreal Engine tutorials from Epic Games."})]}),e.jsx("div",{className:"doc-cards-grid",children:r.youtube.map(f=>{const j=f.id||`yt_${f.url}`,w=A(j);return e.jsxs("div",{className:`doc-card yt-card-with-thumb ${w?"doc-card-added":""}`,children:[e.jsxs("a",{href:f.url,target:"_blank",rel:"noopener noreferrer",className:"doc-card-link",onClick:L=>L.stopPropagation(),children:[(()=>{const L=f.url?.match(/[?&]v=([^&]+)/),F=L?L[1]:null;return F?e.jsxs("div",{className:"yt-thumb-wrapper",children:[e.jsx("img",{className:"yt-thumb-img",src:`https://img.youtube.com/vi/${F}/mqdefault.jpg`,alt:f.title,loading:"lazy"}),e.jsxs("span",{className:"yt-thumb-duration",children:[f.durationMinutes," min"]}),e.jsx("span",{className:"yt-thumb-play",children:"‚ñ∂"})]}):null})(),e.jsxs("div",{className:"doc-card-header",children:[e.jsx("span",{className:`tier-badge tier-${f.tier||"intermediate"}`,children:f.tier||"intermediate"}),e.jsx("span",{className:"external-badge",children:"Official ‚Ä¢ YouTube"})]}),e.jsx("h4",{className:"doc-card-title",children:f.title}),e.jsxs("div",{className:"doc-card-footer",children:[e.jsxs("span",{className:"doc-source-badge",children:["üì∫ ",f.channelName]}),e.jsxs("span",{className:"doc-read-time",children:[f.durationMinutes," min"]})]})]}),e.jsx("button",{className:`doc-add-btn ${w?"doc-added":""}`,onClick:()=>{w?R(j):M({type:"youtube",itemId:j,title:f.title,description:f.description||"",keyTakeaways:f.keyTakeaways||[],chapters:f.chapters||[],topics:f.topics||[],url:f.url,channelName:f.channelName,channelTrust:f.channelTrust,tier:f.tier||"intermediate",durationMinutes:f.durationMinutes||15})},title:w?"Remove from path":"Add to learning path",children:w?"‚úì Added":"‚ûï Add"})]},f.id)})})]}),e.jsxs("div",{className:"results-actions-bottom",children:[e.jsx("button",{className:"back-btn",onClick:z,children:"‚Üê Start Over"}),e.jsx("button",{className:"ask-again-btn",onClick:P,children:"+ Ask Another Question"})]})]}),e.jsx("div",{className:"cart-column",children:e.jsx(qs,{cart:k,onRemove:R,onClear:$,onWatchPath:ye})})]}),s===G.GUIDED&&e.jsx(Ze,{courses:k.map(f=>{const j=f.type||"video";if(j==="doc"||j==="youtube")return{code:f.itemId||f.driveId||`${j}_${f.url}`,title:f.title,_readingStep:!0,_resourceType:j,_description:f.description||"",_keySteps:f.keyTakeaways||f.keySteps||[],_seeAlso:f.seeAlso||[],_url:f.url,_tier:f.tier,_channel:f.channel||f.channelName,_channelTrust:f.channelTrust,_subsystem:f.subsystem,_topics:f.topics||[],_sections:f.sections||[],_chapters:f.chapters||[],_readTimeMinutes:f.readTimeMinutes||f.durationMinutes||10,videos:[]};const w=_.find(L=>L.code===f.courseCode);return w?{...w,videos:[{drive_id:f.driveId,title:f.title,duration_seconds:f.duration}]}:{code:f.courseCode,title:f.courseName,videos:[{drive_id:f.driveId,title:f.title,duration_seconds:f.duration}]}}),diagnosis:n?.diagnosis,problemSummary:n?.diagnosis?.problem_summary,pathSummary:n?.pathSummary,microLesson:n?.microLesson,onComplete:()=>{},onExit:()=>t(G.DIAGNOSIS)})]})}function Us({diagnosis:s}){if(!s)return null;const t=s.root_causes?.length||0,n=s.signals_to_watch_for?.length||0,i=s.variables_that_matter?.length||0,o=s.variables_that_do_not?.length||0;return e.jsxs("div",{className:"diagnosis-card",children:[e.jsxs("div",{className:"diagnosis-header",children:[e.jsx("h3",{children:"üî¨ Diagnosis"}),e.jsxs("span",{className:"diagnosis-id",children:["ID: ",s.diagnosis_id?.slice(-8)||"N/A"]})]}),e.jsx("p",{className:"problem-summary",children:s.problem_summary}),e.jsxs("div",{className:"diagnosis-sections",children:[e.jsxs("details",{className:"diagnosis-section root-causes",children:[e.jsxs("summary",{children:[e.jsx("span",{className:"icon",children:"üéØ"}),"Root Causes",e.jsxs("span",{className:"count",children:["(",t,")"]})]}),e.jsx("ul",{children:(s.root_causes||[]).map((l,r)=>e.jsx("li",{children:l},r))})]}),e.jsxs("details",{className:"diagnosis-section signals",children:[e.jsxs("summary",{children:[e.jsx("span",{className:"icon",children:"üëÅÔ∏è"}),"Signals to Watch For",e.jsxs("span",{className:"count",children:["(",n,")"]})]}),e.jsx("ul",{children:(s.signals_to_watch_for||[]).map((l,r)=>e.jsx("li",{children:l},r))})]}),e.jsxs("details",{className:"diagnosis-section variables-matter",children:[e.jsxs("summary",{children:[e.jsx("span",{className:"icon",children:"‚úÖ"}),"Variables That Matter",e.jsxs("span",{className:"count",children:["(",i,")"]})]}),e.jsx("ul",{children:(s.variables_that_matter||[]).map((l,r)=>e.jsx("li",{children:l},r))})]}),e.jsxs("details",{className:"diagnosis-section variables-dont-matter",children:[e.jsxs("summary",{children:[e.jsx("span",{className:"icon",children:"‚ùå"}),"Variables That Don't",e.jsxs("span",{className:"count",children:["(",o,")"]})]}),e.jsx("ul",{children:(s.variables_that_do_not||[]).map((l,r)=>e.jsx("li",{children:l},r))})]}),s.generalization_scope?.length>0&&e.jsxs("details",{className:"diagnosis-section generalization",open:!0,children:[e.jsxs("summary",{children:[e.jsx("span",{className:"icon",children:"üîÑ"}),"Where Else This Applies",e.jsxs("span",{className:"count",children:["(",s.generalization_scope.length,")"]})]}),e.jsx("div",{className:"scope-chips",children:s.generalization_scope.map((l,r)=>e.jsx("span",{className:"scope-chip",children:l},r))})]})]})]})}Us.propTypes={diagnosis:h.shape({diagnosis_id:h.string,problem_summary:h.string,root_causes:h.arrayOf(h.string),signals_to_watch_for:h.arrayOf(h.string),variables_that_matter:h.arrayOf(h.string),variables_that_do_not:h.arrayOf(h.string),generalization_scope:h.arrayOf(h.string)})};Us.defaultProps={diagnosis:null};function Pn(s){if(!s||s<=0)return null;const t=Math.floor(s/3600),n=Math.floor(s%3600/60);return t>0?n>0?`${t} hr ${n} min`:`${t} hr`:`${n} min`}function On(s,t=320){const n=s?.drive_id||s?.driveId;return n?`https://drive.google.com/thumbnail?id=${n}&sz=w${t}`:null}function Dn(s,t=320){const n=s?.videos?.[0];return On(n,t)}function Vs({objectives:s,courses:t,validation:n,onCourseClick:i,onAddToCart:o,isCourseInCart:l}){const{fixCourses:r,learnCourses:d}=b.useMemo(()=>{if(!t||t.length===0)return{fixCourses:[],learnCourses:[]};const a=Math.ceil(t.length/2);return{fixCourses:t.slice(0,a),learnCourses:t.slice(a)}},[t]),c=b.useMemo(()=>n?{approved:n.approved,reason:n.reason,hasIssues:n.issues?.length>0}:null,[n]);return e.jsxs("div",{className:"adaptive-cart",children:[c&&!c.approved&&e.jsxs("div",{className:"validation-warning",children:[e.jsx("span",{className:"icon",children:"‚ö†Ô∏è"}),e.jsxs("div",{className:"content",children:[e.jsx("strong",{children:"Quality Check:"})," ",c.reason,n.suggestions?.length>0&&e.jsx("ul",{className:"suggestions",children:n.suggestions.map((a,u)=>e.jsx("li",{children:a},u))})]})]}),e.jsxs("section",{className:"cart-section fix-now",children:[e.jsxs("div",{className:"section-header",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"icon",children:"üîß"}),"Fix Now"]}),e.jsx("p",{className:"description",children:"These solve your immediate problem:"})]}),e.jsx("div",{className:"objectives-list",children:(s?.fix_specific||[]).map((a,u)=>e.jsxs("div",{className:"objective-item fix",children:[e.jsx("span",{className:"number",children:u+1}),e.jsx("span",{className:"text",children:a})]},u))}),r.length>0&&e.jsx("div",{className:"course-list",children:r.map(a=>e.jsx(Re,{course:a,type:"fix",onClick:()=>i?.(a),onAddToCart:o,isInCart:l?.(a)},a.id||a.code))})]}),e.jsxs("section",{className:"cart-section learn-forever",children:[e.jsxs("div",{className:"section-header",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"icon",children:"üéì"}),"Learn Forever"]}),e.jsx("p",{className:"description",children:"These help you diagnose similar issues in the future:"})]}),e.jsx("div",{className:"objectives-list transferable",children:(s?.transferable||[]).map((a,u)=>e.jsxs("div",{className:"objective-item transferable",children:[e.jsx("span",{className:"number",children:u+1}),e.jsx("span",{className:"text",children:a}),e.jsx("span",{className:"badge",children:"Transferable"})]},u))}),s?.transferable?.length===0&&e.jsx("div",{className:"empty-warning",children:"‚ö†Ô∏è No transferable objectives generated. This path may not teach reusable skills."}),d.length>0&&e.jsx("div",{className:"course-list",children:d.map(a=>e.jsx(Re,{course:a,type:"learn",onClick:()=>i?.(a),onAddToCart:o,isInCart:l?.(a)},a.id||a.code))})]}),e.jsxs("div",{className:"cart-summary",children:[e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"value",children:s?.fix_specific?.length||0}),e.jsx("span",{className:"label",children:"Fix Objectives"})]}),e.jsxs("div",{className:"stat highlight",children:[e.jsx("span",{className:"value",children:s?.transferable?.length||0}),e.jsx("span",{className:"label",children:"Transferable Skills"})]}),e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"value",children:t?.length||0}),e.jsx("span",{className:"label",children:"Recommended Courses"})]})]})]})}function Re({course:s,type:t,onClick:n,onAddToCart:i,isInCart:o}){const[l,r]=b.useState(!1),d=b.useMemo(()=>{if(s.duration)return s.duration;if(s.duration_minutes)return`${s.duration_minutes} min`;if(s.durationMinutes)return`${s.durationMinutes} min`;if(s.videos?.length){const y=s.videos.reduce((x,v)=>x+(v.duration_seconds||0),0);return y>0?Pn(y):null}return null},[s]),c=b.useMemo(()=>typeof s.difficulty=="string"?s.difficulty:typeof s.difficulty=="number"?["Beginner","Beginner","Intermediate","Intermediate","Advanced","Expert"][s.difficulty]||"Intermediate":s.gemini_skill_level?s.gemini_skill_level:null,[s]),a=b.useMemo(()=>Dn(s),[s]),u=s.video_count||s.videos?.length||null,p=y=>{y.stopPropagation(),i?.(s)};return e.jsxs("div",{className:`course-card ${t} ${o?"in-cart":""}`,onClick:n,role:"button",tabIndex:0,onKeyDown:y=>y.key==="Enter"&&n?.(),children:[a&&!l&&e.jsx("div",{className:"course-thumbnail",children:e.jsx("img",{src:a,alt:s.title,loading:"lazy",onError:()=>r(!0)})}),e.jsxs("div",{className:"course-info",children:[e.jsx("h4",{className:"title",children:s.title||s.name}),s.gemini_outcomes?.[0]&&e.jsxs("p",{className:"description",children:[s.gemini_outcomes[0].slice(0,100),"..."]}),e.jsxs("div",{className:"meta",children:[d&&e.jsxs("span",{className:"duration",children:["‚è±Ô∏è ",d]}),u&&e.jsxs("span",{className:"video-count",children:["üé¨ ",u," videos"]}),c&&e.jsx("span",{className:`difficulty ${c.toLowerCase()}`,children:c})]})]}),e.jsx("div",{className:"course-action",children:i?e.jsx("button",{className:`add-btn ${o?"added":""}`,onClick:p,"aria-label":o?"Added to path":"Add to path",children:o?"‚úì Added":"+ Add"}):e.jsx("span",{className:"arrow",children:"‚Üí"})})]})}Re.propTypes={course:h.shape({id:h.string,code:h.string,title:h.string,name:h.string,description:h.string,duration:h.string,durationMinutes:h.number,difficulty:h.string}).isRequired,type:h.oneOf(["fix","learn"]),onClick:h.func};Re.defaultProps={type:"fix",onClick:null};Vs.propTypes={objectives:h.shape({fix_specific:h.arrayOf(h.string),transferable:h.arrayOf(h.string)}),courses:h.arrayOf(h.object),validation:h.shape({approved:h.bool,reason:h.string,issues:h.arrayOf(h.string),suggestions:h.arrayOf(h.string)}),onCourseClick:h.func};Vs.defaultProps={objectives:null,courses:[],validation:null,onCourseClick:null};export{Vs as AdaptiveLearningCart,Us as DiagnosisCard,Jn as ProblemFirst,He as ProblemInput};

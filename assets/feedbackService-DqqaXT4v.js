import{d as f,a as d}from"./logger-CDyjTpW_.js";import{c as l,j as b,h,p as S,d as k,f as F}from"./vendor-firebase-DNc0QRT5.js";import{g as m}from"./index-Bczksya8.js";import"./createLucideIcon-YhyuTmrv.js";import"./vendor-cytoscape-hdah7_Xt.js";import"./data-courses-CecwKQwF.js";const g="feedback_v1",y=.3,M=1.3;function u(){try{const e=localStorage.getItem(g);return e?JSON.parse(e):{}}catch{return{}}}function w(e){try{localStorage.setItem(g,JSON.stringify(e))}catch{}}function L(e,a){const t=u();t[e]||(t[e]={up:0,down:0}),t[e].up+=1,t[e].down=Math.max(0,t[e].down-1),t[e].lastQuery=a,t[e].lastUpdated=new Date().toISOString(),w(t)}function N(e,a){const t=u();t[e]||(t[e]={up:0,down:0}),t[e].down+=1,t[e].up=Math.max(0,t[e].up-1),t[e].lastQuery=a,t[e].lastUpdated=new Date().toISOString(),w(t)}function O(e){const t=u()[e];return t?t.up>t.down?"up":t.down>t.up?"down":null:null}function U(e,a){const t=O(e);return t==="down"?Math.round(a*y):t==="up"?Math.round(a*M):a}function J(e,a,t=[]){const r="feedback_submissions_v1",c={id:`fb_${Date.now()}_${Math.random().toString(36).slice(2,8)}`,type:e,description:a,fileNames:t,timestamp:new Date().toISOString()};try{const o=localStorage.getItem(r),n=o?JSON.parse(o):[];n.push(c),n.length>50&&n.splice(0,n.length-50),localStorage.setItem(r,JSON.stringify(n))}catch{}return{id:c.id,timestamp:c.timestamp}}async function x(e,a,t,r,c=""){if(!(!e||e==="anonymous"))try{const o=l(m()),n=`${a}_${t}_${Date.now()}`,s=b(o,"userFeedback",e,"videoSignals",n);await h(s,{courseCode:a,videoKey:t,signal:r,query:String(c).slice(0,200),timestamp:S()}),f(`[Feedback] ${r} signal for ${a}/${t}`)}catch(o){d("[Feedback] Failed to log signal:",o.message)}}async function B(e){const a=new Map;if(!e||e==="anonymous")return a;try{const t=l(m()),r=k(t,"userFeedback",e,"videoSignals"),c=await F(r);if(c.empty)return a;const o=new Map;for(const n of c.docs){const s=n.data(),i=s.courseCode;if(!i)continue;o.has(i)||o.set(i,{watched:0,skipped:0});const p=o.get(i);s.signal==="watched"?p.watched++:s.signal==="skipped"&&p.skipped++}for(const[n,s]of o){const i=s.watched+s.skipped;if(i<2)continue;const p=s.watched/i;a.set(n,.7+p*.5)}return f(`[Feedback] Boost map: ${a.size} courses with signals`),a}catch(t){return d("[Feedback] Failed to build boost map:",t.message),a}}export{U as applyFeedbackMultiplier,B as getBoostMap,O as getFeedbackStatus,x as logVideoFeedback,N as recordDownvote,J as recordFormFeedback,L as recordUpvote};

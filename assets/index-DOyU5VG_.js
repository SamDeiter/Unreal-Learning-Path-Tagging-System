import{j as e,o as jt,s as _t,_ as ae,a as Nt,g as Ue}from"./index-BLawJHoX.js";import{a as j,P as f}from"./vendor-cytoscape-hdah7_Xt.js";import{c as Je,p as wt,r as St,d as Ct,j as kt,k as Tt,n as It,m as Ge}from"./vendor-firebase-BQvzIQYL.js";import{t as re}from"./TagGraphService-0j340ozK.js";import{S as Et,P as Lt}from"./search-Blpc5bje.js";import{c as te}from"./createLucideIcon-YhyuTmrv.js";import{c as me,q as Xe,b as et,d as $t,f as Mt,l as Rt,g as qt,s as Pt}from"./data-courses-Dhl1VM8P.js";import{d as X,L as At,a as K}from"./logger-HX1K3TKu.js";import{B as Dt,A as ve}from"./book-open-D4v9dAb-.js";import{C as $e}from"./check-eCXpKYRG.js";import{X as Ot}from"./x-HbUnH9yy.js";import{getFeedbackStatus as zt,recordUpvote as Ft,recordDownvote as Ut,applyFeedbackMultiplier as Gt}from"./feedbackService-CkyHLPU6.js";const Vt=[["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Wt=te("circle-play",Vt);const Yt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],Ve=te("circle-x",Yt);const Qt=[["path",{d:"M14 2v6a2 2 0 0 0 .245.96l5.51 10.08A2 2 0 0 1 18 22H6a2 2 0 0 1-1.755-2.96l5.51-10.08A2 2 0 0 0 10 8V2",key:"18mbvz"}],["path",{d:"M6.453 15h11.094",key:"3shlmq"}],["path",{d:"M8.5 2h7",key:"csnxdl"}]],Bt=te("flask-conical",Qt);const Kt=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],Ht=te("image",Kt);const Zt=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],Jt=te("star",Zt);const Xt=[["path",{d:"M13.172 2a2 2 0 0 1 1.414.586l6.71 6.71a2.4 2.4 0 0 1 0 3.408l-4.592 4.592a2.4 2.4 0 0 1-3.408 0l-6.71-6.71A2 2 0 0 1 6 9.172V3a1 1 0 0 1 1-1z",key:"16rjxf"}],["path",{d:"M2 7v6.172a2 2 0 0 0 .586 1.414l6.71 6.71a2.4 2.4 0 0 0 3.191.193",key:"178nd4"}],["circle",{cx:"10.5",cy:"6.5",r:".5",fill:"currentColor",key:"12ikhr"}]],es=te("tags",Xt);const ts=[["path",{d:"M12 19h8",key:"baeox8"}],["path",{d:"m4 17 6-6-6-6",key:"1yngyt"}]],ss=te("terminal",ts);const ns=[["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}],["path",{d:"M7 10v12",key:"1qc93n"}]],rs=te("thumbs-up",ns);const as=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],is=te("user",as);function Pe({onSubmit:t,detectedPersona:s,isLoading:n}){const[o,c]=j.useState(""),[l,a]=j.useState([]),[u,i]=j.useState(null),[r,p]=j.useState(""),[g,y]=j.useState(!1),x=j.useRef(null),[d,m]=j.useState(()=>{try{const v=JSON.parse(localStorage.getItem("fix-problem-history")||"[]"),w=v.map(L=>typeof L=="string"?{query:L,cartId:null}:L);return v.length>0&&typeof v[0]=="string"&&localStorage.setItem("fix-problem-history",JSON.stringify(w)),w}catch{return[]}}),_=j.useCallback(v=>{const w=v.target.value;if(c(w),w.length>15){const L=re.matchErrorSignature(w),M=re.extractTagsFromText(w),A=L.map(G=>({tag:G.tag,confidence:G.confidence})),O=M.matches.map(G=>({tag:G.tag,confidence:G.confidence})),Z=[...A,...O],Q=new Set,W=Z.filter(G=>Q.has(G.tag.tag_id)?!1:(Q.add(G.tag.tag_id),!0));a(W.slice(0,5))}else a([])},[]),b=j.useCallback(v=>{const w=v.clipboardData?.items;if(w){for(const L of w)if(L.type.startsWith("image/")){v.preventDefault();const M=L.getAsFile(),A=new FileReader;A.onload=O=>i(O.target.result),A.readAsDataURL(M);return}}},[]),k=j.useCallback(v=>{v.preventDefault(),v.stopPropagation(),y(!0)},[]),E=j.useCallback(v=>{v.preventDefault(),v.stopPropagation(),y(!1)},[]),R=j.useCallback(v=>{v.preventDefault(),v.stopPropagation(),y(!1);const w=v.dataTransfer?.files;if(!w||w.length===0)return;const L=w[0];if(L.type.startsWith("image/")){const M=new FileReader;M.onload=A=>i(A.target.result),M.readAsDataURL(L)}},[]),F=j.useCallback((v,w)=>{m(L=>{const M=L.map(A=>A.query===v?{...A,cartId:w}:A);return localStorage.setItem("fix-problem-history",JSON.stringify(M)),M})},[]),q=j.useCallback((v=null,w=null)=>{const L=(w||o).trim();L.length<10||(m(M=>{const A=M.filter(Z=>Z.query!==L),O=[{query:L,cartId:v},...A].slice(0,6);return localStorage.setItem("fix-problem-history",JSON.stringify(O)),O}),t({query:L,detectedTagIds:l.map(M=>M.tag.tag_id),selectedTagIds:[],personaHint:s?.name,pastedImage:u,errorLog:r.trim()||null,cachedCartId:v||null,updateCartIdForQuery:F}))},[o,l,s,t,u,r,F]),h=j.useCallback(v=>{v.key==="Enter"&&v.ctrlKey&&q()},[q]),C=j.useMemo(()=>['My Blueprint Cast is giving me "Accessed None" error when trying to...',"Lumen is too noisy in my interior scene and I've tried increasing quality...","My character animation stutters when blending between states...","Nanite is causing Z-fighting on overlapping meshes...","Material instances aren't updating at runtime when I change parameters..."],[])[0];return e.jsxs("div",{className:"problem-input-container",onPaste:b,children:[e.jsxs("div",{className:"problem-input-header",children:[e.jsxs("h2",{children:[e.jsx(Et,{size:22,className:"icon-inline"})," What's the problem?"]}),e.jsx("p",{className:"subtitle",children:"Describe your UE5 issue in plain English. We'll diagnose the root cause and teach you to fix it."})]}),e.jsxs("div",{className:"problem-input-field",children:[e.jsx("textarea",{value:o,onChange:_,onKeyDown:h,placeholder:C,rows:5,disabled:n,"aria-label":"Problem description"}),e.jsxs("div",{className:"char-count",children:[o.length," characters",o.length<10&&o.length>0&&e.jsx("span",{className:"warning",children:" (minimum 10)"})]})]}),l.length>0&&e.jsxs("div",{className:"detected-tags",children:[e.jsxs("span",{className:"label",children:[e.jsx(es,{size:14,className:"icon-inline"})," Detected:"]}),e.jsx("div",{className:"tag-list",children:l.map(v=>e.jsxs("span",{className:"tag-chip",title:v.tag.description||v.tag.display_name,children:[v.tag.display_name,e.jsxs("span",{className:"confidence",children:[Math.round(v.confidence*100),"%"]})]},v.tag.tag_id))})]}),e.jsxs("div",{className:`screenshot-zone ${r.trim()?"has-image":""}`,onClick:()=>{r.trim()||document.getElementById("error-log-input")?.focus()},children:[r.trim()?e.jsxs("div",{className:"pasted-preview error-log-preview",children:[e.jsx("pre",{className:"error-log-display",children:r}),e.jsx("button",{type:"button",className:"clear-error-log",onClick:v=>{v.stopPropagation(),p("")},"aria-label":"Remove error log",title:"Clear error log",children:e.jsx(Ve,{size:20})})]}):e.jsxs("div",{className:"drop-prompt",children:[e.jsx(ss,{size:20}),e.jsxs("span",{children:["Paste (",e.jsx("kbd",{children:"Ctrl+V"}),") an error log or build output"]})]}),e.jsx("textarea",{id:"error-log-input",className:"error-log-hidden-input",value:r,onChange:v=>p(v.target.value),onPaste:v=>{const w=v.clipboardData?.getData("text");w&&(v.preventDefault(),p(w))},rows:1})]}),e.jsx("div",{ref:x,className:`screenshot-zone ${g?"drag-over":""} ${u?"has-image":""}`,onDragOver:k,onDragLeave:E,onDrop:R,children:u?e.jsxs("div",{className:"pasted-preview",children:[e.jsx("img",{src:u,alt:"Pasted screenshot"}),e.jsx("button",{type:"button",className:"clear-error-log",onClick:()=>i(null),"aria-label":"Remove screenshot",title:"Remove screenshot",children:e.jsx(Ve,{size:20})})]}):e.jsxs("div",{className:"drop-prompt",children:[e.jsx(Ht,{size:20}),e.jsxs("span",{children:["Paste (",e.jsx("kbd",{children:"Ctrl+V"}),") or drag a screenshot here"]})]})}),s&&e.jsxs("div",{className:"persona-context",children:[e.jsxs("span",{className:"label",children:[e.jsx(is,{size:14,className:"icon-inline"})," Context:"]}),e.jsx("span",{className:"persona-chip",children:s.name}),e.jsx("span",{className:"hint",children:"Recommendations will be tailored for you"})]}),e.jsxs("div",{className:"problem-input-actions",children:[e.jsx("button",{className:"submit-btn primary",onClick:()=>q(),disabled:o.trim().length<10||n,children:n?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner"})," Diagnosing..."]}):e.jsx(e.Fragment,{children:"Get Diagnosis â†’"})}),e.jsxs("span",{className:"hint",children:["Press ",e.jsx("kbd",{children:"Ctrl"})," + ",e.jsx("kbd",{children:"Enter"})," to submit"]})]}),d.length>0&&e.jsxs("div",{className:"query-history",children:[e.jsx("span",{className:"history-label",children:"ðŸ•˜ Recent questions:"}),e.jsx("div",{className:"history-chips",children:d.map((v,w)=>{const L=v.query||v,M=v.cartId||null,A=!!M;return e.jsxs("div",{className:"history-chip-row",children:[e.jsxs("button",{type:"button",className:`history-chip ${A?"cached":""}`,onClick:()=>{c(L),_({target:{value:L}}),A&&!n&&setTimeout(()=>q(M,L),50)},title:A?`${L} (cached â€” instant load)`:L,disabled:n,children:[A&&e.jsx("span",{className:"cache-indicator",children:"âš¡"}),L.length>50?L.slice(0,50)+"â€¦":L]}),e.jsx("button",{type:"button",className:"history-delete",onClick:()=>{m(O=>{const Z=O.filter((Q,W)=>W!==w);return localStorage.setItem("fix-problem-history",JSON.stringify(Z)),Z})},title:"Remove",children:"Ã—"})]},w)})})]})]})}Pe.propTypes={onSubmit:f.func.isRequired,detectedPersona:f.shape({id:f.string,name:f.string,emoji:f.string}),isLoading:f.bool};Pe.defaultProps={detectedPersona:null,isLoading:!1};function os({problemSummary:t,courses:s,diagnosis:n}){if(!s||s.length===0)return{title:"Your Learning Path",intro:"Let's solve your problem step by step.",instructors:[],totalDuration:null};const o=ls(s),c=us(s),l=ps({instructors:o,courseCount:s.length,totalDuration:c,rootCauses:n?.root_causes||[]});return{title:`Your Path: ${ms(t)}`,intro:l,instructors:o,totalDuration:c,courseCount:s.length,rootCauses:n?.root_causes||[]}}function cs(t,s,n){if(!s)return{type:"completion",text:"ðŸŽ‰ Congratulations! You've completed your learning path.",subtext:"You now have the skills to solve this problem and similar ones in the future."};const o=Me(t),c=Me(s),l=s.title||s.name||"the next lesson";return o&&c&&o!==c?{type:"transition",text:`Now let's hear from ${c}`,subtext:`${c} will cover: ${n||l}`,instructor:c}:{type:"continuation",text:`Next up: ${l}`,subtext:n||null,instructor:c}}function ls(t){const s=new Set,n=[];return t.forEach(o=>{const c=Me(o);if(c&&!s.has(c))s.add(c),n.push({name:c,courses:[o.title||o.name],totalDuration:Re(o)});else if(c){const l=n.find(a=>a.name===c);l&&(l.courses.push(o.title||o.name),l.totalDuration+=Re(o))}}),n}function Me(t){return t&&(t.instructor||t.author||t.creator||t.teacher||ds(t.title||t.name))||null}function ds(t){if(!t)return null;const s=t.match(/\bby\s+([A-Z][a-zA-Z]+(?:\s+[A-Z][a-zA-Z]+)?)/i);if(s)return s[1];const n=t.match(/\bwith\s+([A-Z][a-zA-Z]+(?:\s+[A-Z][a-zA-Z]+)?)/i);return n?n[1]:null}function us(t){const s=t.reduce((n,o)=>n+Re(o),0);return hs(s)}function Re(t){return t?t.duration_seconds?t.duration_seconds:t.duration_minutes?t.duration_minutes*60:t.videos?.length?t.videos.reduce((s,n)=>s+(n.duration_seconds||0),0):0:0}function hs(t){if(!t||t<=0)return null;const s=Math.floor(t/3600),n=Math.floor(t%3600/60);return s>0?n>0?`${s} hr ${n} min`:`${s} hr`:`${n} min`}function ms(t){if(!t)return"Learning Path";if(t.length<=80)return t;const s=t.slice(0,80),n=s.lastIndexOf(" ");return(n>30?s.slice(0,n):s)+"â€¦"}function ps({instructors:t,courseCount:s,totalDuration:n,rootCauses:o}){const c=[];if(o.length>0&&c.push(`We've identified ${o.length} root cause${o.length>1?"s":""} for your issue:`),t.length===1)c.push(`${t[0].name} will guide you through ${s} lesson${s>1?"s":""}.`);else if(t.length>1){const l=t.map(u=>u.name),a=l.pop();c.push(`You'll learn from ${l.join(", ")} and ${a}.`)}else c.push(`You have ${s} lesson${s>1?"s":""} to complete.`);return n&&c.push(`Total time: ${n}.`),c.join(" ")}function gs(t,s){const n=Math.round((t+1)/s*100);return{text:`Video ${t+1} of ${s}`,percent:n,isComplete:t+1>=s}}function fs(t,s,n,o=0){const l=[...t?.canonical_tags||[],...t?.gemini_system_tags||[],...t?.transcript_tags||[],...t?.extracted_tags||[],...Array.isArray(t?.tags)?t.tags:[]].map(m=>typeof m=="string"?m.split(".").pop():m.name||m.display_name||"").filter(Boolean).filter((m,_,b)=>b.indexOf(m)===_),a=t?.gemini_skill_level||"Intermediate",u=(s||"").toLowerCase(),i=[],r=new Set,p=m=>{for(const _ of m)r.has(_.task)||(r.add(_.task),i.push(_))};if(u){const m=Object.keys(me).sort((_,b)=>b.length-_.length);for(const _ of m)u.includes(_)&&p(me[_])}const g=[...l].sort((m,_)=>{const b=u.includes(m.toLowerCase())?1:0;return(u.includes(_.toLowerCase())?1:0)-b});for(const m of g){const _=m.toLowerCase();me[_]&&p(me[_])}if(i.length>0){const m=i[o%i.length];return{task:m.task,hint:m.hint,expectedResult:m.expectedResult,docsUrl:m.docsUrl||null,difficulty:a}}const y=l[0]||(n?n.split(/\s+/).slice(0,3).join(" "):"this concept"),x=n?`"${n}"`:"this lesson",d=t?.gemini_outcomes?.[0]||"";return{task:s?`Open UE5 and apply the technique from ${x} to address "${s}". In the Details panel, identify which ${y} settings you changed and note the before/after values.`:`Open UE5, create a test Actor, and set up ${y} from scratch following the approach from ${x}. Document which panels and properties you used.`,hint:d?`Focus on: ${d}. Check Details panel and World Settings for relevant options.`:`Look for ${y} options in the Details panel, Modes panel, or Project Settings â†’ Engine.`,expectedResult:s?`Your original issue ("${s}") should be resolved or visibly improved in the viewport. Compare before/after values in the Details panel to confirm the change took effect.`:`You should see ${y} applied correctly in the viewport or preview. The Details panel should reflect the new settings, and the editor should show no warnings related to your changes.`,difficulty:a}}const tt="ue5_learning_progress";function st(){try{const t=localStorage.getItem(tt);return t?{...be(),...JSON.parse(t)}:be()}catch{return be()}}function be(){return{completedPaths:[],tagsEncountered:{},totalVideosWatched:0,reflections:[],streak:{lastDate:null,count:0}}}function xs(t){try{localStorage.setItem(tt,JSON.stringify(t))}catch(s){X("[LearningProgress] Failed to save:",s.message)}}function ys(t,s,n){const o=st(),c=new Date().toISOString().split("T")[0];o.completedPaths.includes(t)||o.completedPaths.push(t);for(const l of s){const a=l.extracted_tags||l.tags||[];for(const u of a){const i=typeof u=="string"?u:u.name||u.display_name;i&&(o.tagsEncountered[i]=(o.tagsEncountered[i]||0)+1)}}if(o.totalVideosWatched+=s.length,o.streak.lastDate!==c){const l=new Date;l.setDate(l.getDate()-1);const a=l.toISOString().split("T")[0];o.streak.lastDate===a?o.streak.count+=1:o.streak.count=1,o.streak.lastDate=c}return n&&n.trim().length>0&&o.reflections.push({date:c,pathId:t,text:n.trim()}),xs(o),o}function vs(){const t=st(),s=new Date().toISOString().split("T")[0],n=new Date;n.setDate(n.getDate()-1);const o=n.toISOString().split("T")[0],c=t.streak.lastDate===s||t.streak.lastDate===o;return{count:c?t.streak.count:0,isActive:c}}const z={INTRO:"intro",PLAYING:"playing",QUIZ:"quiz",CHALLENGE:"challenge",BRIDGE:"bridge",COMPLETE:"complete"};function bs({courses:t,diagnosis:s,problemSummary:n,pathSummary:o,onComplete:c,onExit:l}){const[a,u]=j.useState(z.INTRO),[i,r]=j.useState(0),[p,g]=j.useState(0),[y,x]=j.useState(""),[d,m]=j.useState(null),[_,b]=j.useState(!0);j.useEffect(()=>jt(H=>{m(H),b(!1)}),[]);const k=j.useCallback(async()=>{b(!0);const{error:I}=await _t();I&&console.error("[GuidedPlayer] Sign in failed:",I),b(!1)},[]),E=t[i]||null,R=t[i+1]||null,F=E?.videos||[],q=F[p]||F[0]||null,h=p<F.length-1,S=p>0||i>0,C=h||!!R,v=F.length,w=j.useMemo(()=>os({problemSummary:n,courses:t,diagnosis:s}),[n,t,s]),L=j.useMemo(()=>vs(),[]),M=j.useMemo(()=>t.reduce((I,H)=>I+(H.videos?.length||1),0),[t]),A=j.useMemo(()=>{let I=0;for(let H=0;H<i;H++)I+=t[H]?.videos?.length||1;return I+p},[t,i,p]),O=j.useMemo(()=>gs(A,M),[A,M]),Z=j.useMemo(()=>{if(a!==z.BRIDGE)return null;const I=E?.gemini_outcomes?.[0]||null;return cs(E,R,I)},[a,E,R]),Q=j.useMemo(()=>a!==z.CHALLENGE?null:fs(E,n,q?.title,i),[a,E,n,q,i]),W=j.useCallback(()=>{u(z.PLAYING)},[]),G=j.useCallback(()=>{if(E?._readingStep){R?(r(I=>I+1),g(0),u(z.PLAYING)):(u(z.COMPLETE),c?.());return}if(h)g(I=>I+1);else{const I=Xe[E?.code];I&&Object.keys(I).length>0?u(z.QUIZ):u(z.CHALLENGE)}},[h,E,R,c]),U=j.useCallback(()=>{if(p>0)g(I=>I-1);else if(i>0){const I=t[i-1]?.videos||[];r(H=>H-1),g(Math.max(0,I.length-1))}},[p,i,t]),Y=j.useCallback(()=>{h?g(I=>I+1):R&&(r(I=>I+1),g(0))},[h,R]),N=j.useCallback(()=>{r(0),g(0),u(z.PLAYING)},[]),$=j.useCallback(()=>{u(z.CHALLENGE)},[]),T=j.useCallback(()=>{R?(r(I=>I+1),g(0),u(z.PLAYING)):(u(z.COMPLETE),c?.())},[R,c]),P=j.useCallback(()=>{r(I=>I+1),g(0),u(z.PLAYING)},[]),V=j.useCallback(I=>{r(I),g(0),u(z.PLAYING)},[]),ee=j.useCallback(()=>{const I=n?`path-${n.replace(/\s+/g,"-").toLowerCase().slice(0,40)}-${Date.now()}`:`path-${Date.now()}`;ys(I,t,y),l?.()},[n,t,y,l]),D=y.trim().split(/\s+/).filter(Boolean).length;return{stage:a,currentIndex:i,videoIndex:p,reflectionText:y,setReflectionText:x,user:d,authLoading:_,currentCourse:E,nextCourse:R,currentVideos:F,currentVideo:q,hasMoreVideos:h,hasPreviousVideo:S,hasNextVideo:C,courseVideoCount:v,introContent:w,streak:L,progress:O,bridgeContent:Z,challengeContent:Q,pathSummary:o,wordCount:D,courses:t,handleSignIn:k,handleStartLearning:W,handleVideoComplete:G,handlePreviousVideo:U,handleNextVideo:Y,handleBackToPath:N,handleQuizComplete:$,handleChallengeComplete:T,handleContinue:P,handleSkipTo:V,handleFinish:ee,onExit:l}}function js(t){if(!t||t<=0)return null;const s=Math.floor(t/3600),n=Math.floor(t%3600/60);return s>0?n>0?`${s} hr ${n} min`:`${s} hr`:`${n} min`}function nt(t,s=320){const n=t?.drive_id||t?.driveId;return n?`https://drive.google.com/thumbnail?id=${n}&sz=w${s}`:null}function _s(t,s=320){const n=t?.videos?.[0];return nt(n,s)}function rt({challengeContent:t,onComplete:s}){return e.jsxs("div",{className:"challenge-card",children:[e.jsx("div",{className:"challenge-icon",children:"ðŸ”¨"}),e.jsx("h3",{children:"Try It Yourself"}),e.jsx("div",{className:"challenge-difficulty",children:e.jsx("span",{className:`difficulty-badge ${t.difficulty.toLowerCase()}`,children:t.difficulty})}),e.jsx("p",{className:"challenge-task",children:t.task}),t.expectedResult&&e.jsxs("div",{className:"challenge-expected",children:[e.jsx("span",{className:"expected-label",children:"ðŸ‘ï¸ What to look for:"})," ",t.expectedResult]}),e.jsxs("div",{className:"challenge-hint",children:[e.jsx("span",{className:"hint-label",children:"ðŸ’¡ Hint:"})," ",t.hint]}),t.docsUrl&&e.jsx("a",{className:"docs-link",href:t.docsUrl,target:"_blank",rel:"noopener noreferrer",children:"ðŸ“– Read the official UE5 docs â†’"}),e.jsx("button",{className:"challenge-done-btn",onClick:s,children:"I tried it â†’"}),e.jsx("button",{className:"challenge-skip-btn",onClick:s,children:"Skip challenge"})]})}rt.propTypes={challengeContent:f.shape({task:f.string.isRequired,hint:f.string.isRequired,expectedResult:f.string,docsUrl:f.string,difficulty:f.string.isRequired}).isRequired,onComplete:f.func.isRequired};f.shape({type:f.string.isRequired,text:f.string.isRequired,subtext:f.string}).isRequired,f.func.isRequired;function at({courses:t,totalDuration:s,reflectionText:n,onReflectionChange:o,wordCount:c,onFinish:l,onBackToPath:a}){return j.useEffect(()=>{if(n.trim())try{localStorage.setItem("lp_reflection_draft",JSON.stringify({text:n,timestamp:Date.now(),courseCount:t.length}))}catch{}},[n,t.length]),j.useEffect(()=>{try{const u=JSON.parse(localStorage.getItem("lp_reflection_draft")||"null");u?.text&&!n&&o(u.text)}catch{}},[]),e.jsxs("div",{className:"complete-card",children:[e.jsx("div",{className:"complete-icon",children:"ðŸŽ‰"}),e.jsx("h2",{children:"Path Complete!"}),e.jsx("p",{children:"You've learned the skills to solve this problem and similar ones in the future."}),e.jsxs("div",{className:"reflection-area",children:[e.jsx("h3",{children:"ðŸ“ What was your main takeaway?"}),e.jsx("p",{className:"reflection-subtitle",children:"Writing your reflection helps cement what you learned."}),e.jsx("textarea",{className:"reflection-input",placeholder:"I learned that...",value:n,onChange:u=>o(u.target.value),rows:4}),e.jsxs("div",{className:"reflection-meta",children:[c===0&&e.jsx("span",{className:"word-hint",children:"Try writing a few sentences"}),c>0&&c<10&&e.jsxs("span",{className:"word-hint",children:[c," words â€” keep going!"]}),c>=10&&e.jsx("span",{className:"word-hint done",children:"Great reflection! âœ“"})]})]}),e.jsxs("div",{className:"stats",children:[e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"value",children:t.length}),e.jsx("span",{className:"label",children:"Lessons"})]}),e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"value",children:s||"â€”"}),e.jsx("span",{className:"label",children:"Total Time"})]})]}),e.jsxs("div",{className:"completion-actions",children:[e.jsx("button",{className:"finish-btn",onClick:()=>{l();try{localStorage.removeItem("lp_reflection_draft")}catch{}},children:n.trim()?"Save & Finish":"Back to Problems"}),a&&e.jsx("button",{className:"back-to-path-btn",onClick:a,children:"â† Back to Learning Path"})]})]})}at.propTypes={courses:f.array.isRequired,totalDuration:f.string,reflectionText:f.string.isRequired,onReflectionChange:f.func.isRequired,wordCount:f.number.isRequired,onFinish:f.func.isRequired};function ce(t){return t?t.replace(/\.mp4$/i,"").replace(/_/g," ").replace(/^[A-Z]{2,5}\s+\d[\d.]*\s*/gi,"").replace(/^\d+\.\d+\s*/g,"").replace(/^0*\d{1,3}\s+/g,"").replace(/^(\w+)[ _]\1[ _]/i,"").replace(/^(?:and|or)\s+/i,"").replace(/\s+\d{1,3}\s*(NEW|FINAL|EDIT|EDITED|OLD|DRAFT|v\d+)?\s*$/gi,"").replace(/\s+(NEW|FINAL|EDIT|EDITED|OLD|DRAFT|v\d+)\s*$/gi,"").replace(/([a-z])(\d{2})$/g,"$1").replace(/([a-z])([A-Z])/g,"$1 $2").replace(/([A-Z]+)([A-Z][a-z])/g,"$1 $2").replace(/\s+(?:5[0-5]|4[0-9])$/g,"").replace(/[-]+\s*$/g,"").replace(/^\s*[-]+/g,"").replace(/\s{2,}/g," ").trim()||t:"Untitled Video"}function it({courses:t,currentIndex:s,onSkipTo:n}){const o=t.map(c=>c.code);return e.jsxs("div",{className:"course-sidebar",children:[e.jsx("h4",{children:"Your Path"}),e.jsx("div",{className:"sidebar-courses",children:t.map((c,l)=>{const a=et[c.code],u=a?.prerequisites?.filter(i=>!o.includes(i))||[];return e.jsxs("button",{className:`sidebar-course ${l===s?"active":""} ${l<s?"completed":""}`,onClick:()=>n(l),title:ce(c.videos?.[0]?.title||c.title||c.name),children:[e.jsx("span",{className:"index",children:l<s?"âœ“":l+1}),e.jsx("span",{className:"title",children:ce(c.videos?.[0]?.title||c.title||c.name)}),a?.difficulty&&e.jsx("span",{className:`difficulty-tag ${a.difficulty}`,children:a.difficulty}),u.length>0&&e.jsx("span",{className:"prereq-warning",title:`Recommended: ${u.join(", ")} first`,children:"âš ï¸"})]},c.code||l)})})]})}it.propTypes={courses:f.array.isRequired,currentIndex:f.number.isRequired,onSkipTo:f.func.isRequired};function ot({courseCode:t,videoKey:s,onComplete:n,onSkip:o}){const[c,l]=j.useState(0),[a,u]=j.useState(null),[i,r]=j.useState(!1),[p,g]=j.useState(0),[y,x]=j.useState(!1),d=j.useMemo(()=>{if(!t||!s)return[];const q=Xe[t];if(!q)return[];if(q[s])return q[s];const h=C=>(C||"").replace(/\.mp4$/i,"").replace(/^[\d._]+/,"").replace(/[\s_]+/g,"").toLowerCase(),S=h(s);for(const[C,v]of Object.entries(q)){const w=h(C);if(w===S||w.includes(S)||S.includes(w))return v}return[]},[t,s]);if(d.length===0)return null;const m=d[c],_=a===m?.correct,b=d.length,k=q=>{i||u(q)},E=()=>{a!==null&&(r(!0),a===m.correct&&g(q=>q+1))},R=()=>{c<b-1?(l(q=>q+1),u(null),r(!1)):x(!0)},F=()=>{n({score:p,total:b})};if(y){const q=Math.round(p/b*100),h=q>=80?Jt:q>=50?rs:Dt,S=q>=80?"Excellent! You've got a strong grasp of this material.":q>=50?"Good effort! Consider rewatching for the topics you missed.":"You might want to re-watch this section before moving on.";return e.jsx("div",{className:"quiz-card",children:e.jsxs("div",{className:"quiz-score-summary",children:[e.jsx("div",{className:"score-icon-container",children:e.jsx(h,{size:48,className:"score-icon"})}),e.jsxs("h3",{children:[p,"/",b," Correct"]}),e.jsx("div",{className:"score-bar",children:e.jsx("div",{className:"score-fill",style:{width:`${q}%`}})}),e.jsx("p",{className:"score-message",children:S}),e.jsxs("button",{className:"quiz-continue-btn",onClick:F,children:["Continue ",e.jsx(ve,{size:16})]})]})})}return e.jsxs("div",{className:"quiz-card",children:[e.jsxs("div",{className:"quiz-header",children:[e.jsx("span",{className:"quiz-icon",children:e.jsx(Bt,{size:20})}),e.jsx("h3",{children:"Quick Check"}),e.jsxs("span",{className:"quiz-progress",children:[c+1," / ",b]})]}),e.jsx("p",{className:"quiz-question",children:m.question}),e.jsx("div",{className:"quiz-options",children:m.options.map((q,h)=>{let S="quiz-option";return a===h&&(S+=" selected"),i&&(h===m.correct?S+=" correct":a===h&&(S+=" incorrect")),e.jsxs("button",{className:S,onClick:()=>k(h),disabled:i,children:[e.jsx("span",{className:"option-letter",children:String.fromCharCode(65+h)}),e.jsx("span",{className:"option-text",children:q}),i&&h===m.correct&&e.jsx("span",{className:"option-icon",children:e.jsx($e,{size:16})}),i&&a===h&&h!==m.correct&&e.jsx("span",{className:"option-icon",children:e.jsx(Ot,{size:16})})]},h)})}),i&&m.explanation&&e.jsxs("div",{className:`quiz-explanation ${_?"correct":"incorrect"}`,children:[e.jsx("span",{className:"explanation-icon",children:_?e.jsx($e,{size:16}):e.jsx(At,{size:16})}),e.jsx("p",{children:m.explanation})]}),e.jsxs("div",{className:"quiz-actions",children:[i?e.jsx("button",{className:"quiz-next-btn",onClick:R,children:c<b-1?e.jsxs(e.Fragment,{children:["Next Question ",e.jsx(ve,{size:16})]}):e.jsxs(e.Fragment,{children:["See Results ",e.jsx(ve,{size:16})]})}):e.jsx("button",{className:"quiz-check-btn",onClick:E,disabled:a===null,children:"Check Answer"}),e.jsx("button",{className:"quiz-skip-btn",onClick:o,children:"Skip Quiz"})]})]})}ot.propTypes={courseCode:f.string,videoKey:f.string,onComplete:f.func.isRequired,onSkip:f.func.isRequired};const de=new Set(["the","and","for","with","this","that","are","was","has","have","not","can","into","from","how","you","your","will","would","also","just","like","more","very","some","want","need","make","use","used","using","help","helpful","helps","get","getting","let","look","going","come","here","there","know","thing","really","actually","basically","something","everything","slow","fast","leading","exhibiting","experiencing","causing","about","been","being","could","does","doing","done","each","even","every","first","give","good","great","kind","made","much","over","part","right","same","see","show","start","still","take","tell","than","them","then","these","they","those","through","time","took","turn","way","well","what","when","where","which","while","work","working","unreal","engine","introduction","quick"]),Ns=new Set(["gonna","going","really","actually","basically","right","thing","things","about","would","could","should","there","their","these","those","where","which","being","doing","using","other","first","second","third","after","before","every","still","again","already","engine","unreal","because","simply","called","allows","looking","provides"]);function je(t){return(t||"").replace(/\.mp4$/i,"").replace(/^[\d._]+/,"").replace(/[\s_]+/g,"").toLowerCase()}function ct({courseCode:t,videoTitle:s,problemSummary:n,matchedKeywords:o}){const[c,l]=j.useState(null);j.useEffect(()=>{let i=!1;return ae(()=>import("./data-transcripts-CYT280mV.js"),[]).then(r=>{i||l(r.default||r)}),()=>{i=!0}},[]);const a=j.useMemo(()=>{if(!t||!c)return[];const i=c[t];if(!i)return[];const r=je(s);let p=null;for(const[m,_]of Object.entries(i))if(je(m)===r){p=_;break}if(!p)for(const[m,_]of Object.entries(i)){const b=je(m);if(b.includes(r)||r.includes(b)){p=_;break}}if(!p||p.length===0)return[];const g=[];if(n&&g.push(...n.toLowerCase().split(/\s+/).filter(m=>m.length>3&&!de.has(m))),o&&g.push(...o.map(m=>(typeof m=="string"?m:m.display_name||m.id||"").toLowerCase())),g.length===0){const m=p.filter(b=>b.start&&b.start!=="0:00");if(m.length===0)return[];const _=Math.max(1,Math.floor(m.length/3));return m.filter((b,k)=>k%_===0).slice(0,3).map(b=>({...b,score:0,isChapter:!0}))}const x=p.map(m=>{const _=m.text.toLowerCase();let b=0;const k=[];for(const E of g)_.includes(E)&&(b+=10,k.includes(E)||k.push(E));return{...m,score:b,hits:[...new Set(k)]}}).filter(m=>m.score>0).sort((m,_)=>_.score-m.score);if(x.length>0){const m=x.slice(0,3);return m.sort((_,b)=>{const k=E=>{const R=(E||"0:00").split(":").map(Number);return R.length===3?R[0]*3600+R[1]*60+R[2]:R[0]*60+(R[1]||0)};return k(_.start)-k(b.start)}),m}const d=Math.max(1,Math.floor(p.length/3));return p.filter((m,_)=>_%d===0).slice(0,3).map(m=>({...m,score:0,isChapter:!0}))},[t,s,n,o,c]),u=j.useCallback(i=>{if(i.summary)return i.summary;const p=(i.text||"").replace(/[.,;:!?'"()]/g,"").split(/\s+/).filter(x=>x.length>=5&&!Ns.has(x.toLowerCase())).map(x=>x.toLowerCase()),g={};for(const x of p)g[x]=(g[x]||0)+1;const y=Object.entries(g).sort((x,d)=>d[1]-x[1]).slice(0,3).map(([x])=>x.charAt(0).toUpperCase()+x.slice(1));return y.length>0?y.join(", "):"Overview"},[]);return a.length===0?null:e.jsx("div",{className:"video-info-cards",children:e.jsxs("div",{className:"info-card transcript-card",children:[e.jsx("h4",{children:a[0]?.isChapter?"ðŸ“‹ Video Chapters":`ðŸŽ¯ ðŸŽ¬ Video Callouts: ${n||"your search"}`}),e.jsx("div",{className:"timestamp-list",children:a.map((i,r)=>e.jsxs("div",{className:`timestamp-item ${i.score>0?"relevant":""}`,children:[e.jsx("span",{className:"timestamp-badge",children:i.start}),e.jsx("span",{className:"timestamp-text",children:u(i)})]},r))})]})})}ct.propTypes={courseCode:f.string,videoTitle:f.string,problemSummary:f.string,matchedKeywords:f.array};function ws(t){if(!t||typeof t!="string")return t;t=t.replace(/\s*\[\d+(?:[,\s]*\d+)*\]/g,"").trim();const s=[];let n=t,o=0;for(;n.length>0;){const c=[{re:/\*\*(.+?)\*\*/,wrap:i=>e.jsx("strong",{children:i},o++)},{re:/\*(.+?)\*/,wrap:i=>e.jsx("em",{children:i},o++)},{re:/`([^`]+)`/,wrap:i=>e.jsx("code",{className:"inline-code",children:i},o++)},{re:/\[([^\]]+)\]\(([^)]+)\)/,wrap:(i,r)=>{const p=/^https?:\/\//i.test(r)?r:"#";return e.jsx("a",{href:p,target:"_blank",rel:"noopener noreferrer",children:i},o++)}}];let l=null,a=n.length,u=null;for(const i of c){const r=n.match(i.re);r&&r.index<a&&(l=r,a=r.index,u=i)}if(!l){s.push(n);break}a>0&&s.push(n.slice(0,a)),s.push(u.wrap(l[1],l[2])),n=n.slice(a+l[0].length)}return s}function Ae(t){const s=bs(t);return e.jsxs("div",{className:"guided-player",children:[e.jsxs("div",{className:"progress-bar",children:[e.jsx("div",{className:"progress-fill",style:{width:`${s.progress.percent}%`}}),e.jsx("span",{className:"progress-text",children:s.progress.text})]}),s.stage===z.INTRO&&e.jsx(Ss,{introContent:s.introContent,streak:s.streak,courses:s.courses,pathSummary:s.pathSummary,user:s.user,authLoading:s.authLoading,onSignIn:s.handleSignIn,onStart:s.handleStartLearning}),s.stage===z.PLAYING&&s.currentCourse&&!s.currentCourse._readingStep&&e.jsx(Cs,{course:s.currentCourse,currentVideos:s.currentVideos,currentVideo:s.currentVideo,videoIndex:s.videoIndex,hasMoreVideos:s.hasMoreVideos,microLesson:t.microLesson,courses:s.courses,onVideoComplete:s.handleVideoComplete,onExit:s.onExit}),s.stage===z.PLAYING&&s.currentCourse&&s.currentCourse._readingStep&&e.jsx(lt,{course:s.currentCourse,stepNumber:s.currentIndex+1,totalSteps:s.courses.length,onComplete:s.handleVideoComplete,onExit:s.onExit}),s.stage===z.QUIZ&&e.jsx(ot,{courseCode:s.currentCourse?.code,videoKey:s.currentVideo?.title||s.currentVideo?.name||"",onComplete:s.handleQuizComplete,onSkip:s.handleQuizComplete}),s.stage===z.CHALLENGE&&s.challengeContent&&e.jsx(rt,{challengeContent:s.challengeContent,onComplete:s.handleChallengeComplete}),s.stage===z.COMPLETE&&e.jsx(at,{courses:s.courses,totalDuration:s.introContent.totalDuration,reflectionText:s.reflectionText,onReflectionChange:s.setReflectionText,wordCount:s.wordCount,onFinish:s.handleFinish,onBackToPath:s.handleBackToPath}),s.stage!==z.INTRO&&s.stage!==z.COMPLETE&&e.jsxs("div",{className:"sidebar-column",children:[e.jsx(it,{courses:s.courses,currentIndex:s.currentIndex,onSkipTo:s.handleSkipTo}),s.stage===z.PLAYING&&s.currentCourse&&e.jsx(ct,{courseCode:s.currentCourse.code,videoTitle:s.currentVideo?.title||s.currentVideo?.name||"",problemSummary:t.problemSummary,matchedKeywords:s.currentCourse._matchedKeywords})]})]})}Ae.propTypes={courses:f.array.isRequired,diagnosis:f.object,problemSummary:f.string,microLesson:f.object,pathSummary:f.shape({path_summary:f.string,topics_covered:f.arrayOf(f.string)}),onComplete:f.func,onExit:f.func};Ae.defaultProps={diagnosis:null,problemSummary:"",microLesson:null,pathSummary:null,onComplete:()=>{},onExit:()=>{}};function Ss({introContent:t,streak:s,courses:n,pathSummary:o,user:c,authLoading:l,onSignIn:a,onStart:u}){return e.jsxs("div",{className:"intro-card",children:[e.jsx("h2",{children:t.title}),e.jsx("p",{className:"intro-text",children:t.intro}),t.rootCauses?.length>0&&e.jsx("ol",{className:"root-cause-list",children:t.rootCauses.map((i,r)=>e.jsx("li",{children:i.replace(/\s*\[\d+\]/g,"")},r))}),s.isActive&&s.count>1&&e.jsxs("div",{className:"streak-badge",children:["ðŸ”¥ ",s.count,"-day learning streak!"]}),e.jsxs("div",{className:"course-preview",children:[e.jsx("h3",{children:"ðŸ“š What You'll Learn"}),o?.path_summary&&!/unavailable/i.test(o.path_summary)&&e.jsx("div",{className:"path-summary-section",children:e.jsx("p",{className:"path-summary-text",children:o.path_summary})}),e.jsxs("div",{className:"course-list",children:[n.slice(0,5).map((i,r)=>{const p=$t[i.code]||[],g=i.videos?.[0]?.title||i.title||i.name;return e.jsxs("div",{className:"course-preview-item",children:[e.jsx("span",{className:"number",children:r+1}),e.jsxs("div",{className:"course-preview-details",children:[e.jsx("span",{className:"title",children:g?.replace(/\s+Part\s+[A-Z]$/i,"").trim()}),p.length>0&&e.jsx("ul",{className:"objective-list",children:p.slice(0,2).map((y,x)=>e.jsx("li",{children:y},x))})]})]},i.code||r)}),n.length>5&&e.jsxs("div",{className:"more-courses",children:["+",n.length-5," more"]})]})]}),e.jsx("div",{className:"auth-section",children:l?e.jsx("p",{className:"auth-loading",children:"Checking sign-in status..."}):c?e.jsxs("div",{className:"auth-signed-in",children:[e.jsxs("span",{className:"user-email",children:["âœ“ Signed in as ",c.email]}),e.jsx("button",{className:"start-btn",onClick:u,children:"â–¶ Start Learning"})]}):e.jsxs("div",{className:"auth-prompt",children:[e.jsx("p",{className:"signin-note",children:"Sign in with Google to watch videos from Google Drive"}),e.jsx("button",{className:"signin-btn",onClick:a,children:"ðŸ” Sign in with Google"}),e.jsx("button",{className:"start-btn secondary",onClick:u,children:"Skip sign-in (videos may not load)"})]})})]})}function Cs({course:t,currentVideos:s,currentVideo:n,videoIndex:o,hasMoreVideos:c,microLesson:l,courses:a,onVideoComplete:u,onExit:i}){const r=n?.drive_id,[p,g]=j.useState({id:null,failed:!1});j.useEffect(()=>{if(!r)return;const x=new Image;x.onload=()=>g({id:r,failed:!1}),x.onerror=()=>g({id:r,failed:!0}),x.src=`https://drive.google.com/thumbnail?id=${r}&sz=w64`},[r]);const y=p.id===r&&p.failed;return e.jsxs("div",{className:"video-stage",children:[e.jsxs("div",{className:"video-header",children:[e.jsx("h3",{children:t.title||t.name}),s.length>1&&e.jsxs("span",{className:"video-counter",children:["Video ",o+1," of ",s.length]}),t.gemini_outcomes?.[0]&&e.jsx("p",{className:"objective",children:t.gemini_outcomes[0]})]}),e.jsx("div",{className:"video-container",children:n?.drive_id&&!y?e.jsx("iframe",{src:`https://drive.google.com/file/d/${n.drive_id}/preview`,title:n.title||t.title,allow:"autoplay",allowFullScreen:!0},n.drive_id):y?e.jsxs("div",{className:"video-embed-error",children:[e.jsx("div",{className:"embed-error-icon",children:"ðŸ“¹"}),e.jsx("p",{className:"embed-error-title",children:"Video temporarily unavailable"}),e.jsx("p",{className:"embed-error-detail",children:"This video file may have been moved or is being updated."}),n?.drive_id&&e.jsx("a",{href:`https://drive.google.com/file/d/${n.drive_id}/view`,target:"_blank",rel:"noopener noreferrer",className:"embed-error-link",children:"ðŸ”— Try opening in Google Drive"})]}):e.jsxs("div",{className:"video-placeholder",children:[e.jsx("img",{src:nt(n),alt:t.title}),e.jsx("div",{className:"play-overlay",children:"â–¶"})]})}),n?.drive_id&&!y&&e.jsx("a",{href:`https://drive.google.com/file/d/${n.drive_id}/view`,target:"_blank",rel:"noopener noreferrer",className:"drive-fallback-link",children:"ðŸ”— Video not loading? Open in Google Drive"}),l&&e.jsx(ks,{microLesson:l,courses:a}),e.jsxs("div",{className:"video-controls",children:[e.jsx("button",{className:"complete-btn",onClick:u,children:c?"Mark Complete & Continue â†’":"Complete & Try Exercise â†’"}),e.jsx("button",{className:"exit-btn",onClick:i,children:"Exit Path"})]})]})}function ks({microLesson:t,courses:s}){const[n,o]=j.useState(!1),[c,l]=j.useState("quick_fix"),a=t?.quick_fix,u=t?.why_it_works,i=t?.related_situations,r=g=>{l(y=>y===g?null:g)},p=g=>g?g.replace(/\s*\[\d+(?:[,\s]*\d+)*\]/g,"").trim():null;return e.jsxs("div",{className:`gp-ai-lesson ${n?"open":"collapsed"}`,children:[e.jsxs("button",{className:"gp-ai-lesson-toggle",onClick:()=>o(g=>!g),children:[e.jsx("span",{className:"gp-ai-badge",children:"âœ¨ AI Guide"}),e.jsx("span",{className:"gp-ai-subtitle",children:"What to look for"}),e.jsx("span",{className:"gp-ai-chevron",children:n?"â–¾":"â–¸"})]}),n&&e.jsxs("div",{className:"gp-ai-body",children:[a&&e.jsxs("div",{className:`gp-ai-section ${c==="quick_fix"?"expanded":""}`,children:[e.jsxs("button",{className:"gp-ai-section-toggle",onClick:()=>r("quick_fix"),children:[e.jsxs("span",{children:["âš¡ ",a.title||"Quick Fix"]}),e.jsx("span",{className:"gp-ai-section-chevron",children:c==="quick_fix"?"â–¾":"â–¸"})]}),c==="quick_fix"&&a.steps&&e.jsx("ol",{className:"gp-ai-steps",children:a.steps.map((g,y)=>e.jsx("li",{children:p(g)},y))})]}),u&&e.jsxs("div",{className:`gp-ai-section ${c==="why"?"expanded":""}`,children:[e.jsxs("button",{className:"gp-ai-section-toggle",onClick:()=>r("why"),children:[e.jsx("span",{children:"ðŸ§  Why This Works"}),u.key_concept&&e.jsx("span",{className:"gp-ai-concept-tag",children:u.key_concept}),e.jsx("span",{className:"gp-ai-section-chevron",children:c==="why"?"â–¾":"â–¸"})]}),c==="why"&&e.jsx("p",{className:"gp-ai-explanation",children:p(u.explanation)})]}),i&&i.length>0&&e.jsxs("div",{className:`gp-ai-section ${c==="related"?"expanded":""}`,children:[e.jsxs("button",{className:"gp-ai-section-toggle",onClick:()=>r("related"),children:[e.jsx("span",{children:"ðŸ”— Related Situations"}),e.jsx("span",{className:"gp-ai-count-tag",children:i.length}),e.jsx("span",{className:"gp-ai-section-chevron",children:c==="related"?"â–¾":"â–¸"})]}),c==="related"&&e.jsx("div",{className:"gp-ai-scenarios",children:i.map((g,y)=>e.jsxs("div",{className:"gp-ai-scenario",children:[e.jsxs("strong",{children:["ðŸ’¡ ",g.scenario]}),e.jsx("p",{children:p(g.connection)})]},y))})]})]})]})}function lt({course:t,stepNumber:s,totalSteps:n,onComplete:o,onExit:c}){const[l,a]=j.useState(!1),u=t._resourceType==="doc"?"ðŸ“–":"â–¶ï¸",i=t._resourceType==="doc"?"Documentation":"YouTube Video",r=t._resourceType==="doc"?"Epic Docs":t._channel||"YouTube",p=t._resourceType!=="doc",g=(()=>{if(!p||!t._url)return null;try{const x=new URL(t._url);if(x.hostname.includes("youtube.com"))return x.searchParams.get("v");if(x.hostname.includes("youtu.be"))return x.pathname.slice(1)}catch{}return null})(),y=x=>{const d=Math.floor(x/60),m=x%60;return`${d}:${m.toString().padStart(2,"0")}`};return e.jsxs("div",{className:"reading-step",children:[e.jsxs("div",{className:"reading-step-header",children:[e.jsxs("span",{className:"reading-step-badge",children:[u," ",i]}),e.jsxs("span",{className:"reading-step-progress",children:["Step ",s," of ",n]})]}),e.jsx("h2",{className:"reading-step-title",children:t.title}),e.jsxs("div",{className:"reading-step-meta",children:[t._tier&&e.jsx("span",{className:`tier-badge tier-${t._tier}`,children:t._tier}),t._channelTrust&&e.jsx("span",{className:`channel-trust-badge trust-${t._channelTrust}`,children:t._channelTrust==="official"?"âœ“ Official":"â­ Expert"}),e.jsxs("span",{className:"reading-step-time",children:["â± ",t._readTimeMinutes," min ",p?"watch":"read"]})]}),t._topics&&t._topics.length>0&&e.jsx("div",{className:"reading-step-topics",children:t._topics.map((x,d)=>e.jsx("span",{className:"topic-chip",children:x.replace(/_/g," ")},d))}),t._description&&e.jsx("p",{className:"reading-step-description",children:t._description}),g&&e.jsx("div",{className:"reading-step-player",children:e.jsx("iframe",{src:`https://www.youtube-nocookie.com/embed/${g}?rel=0&modestbranding=1`,title:t.title,allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,className:"reading-step-iframe"})}),t._keySteps&&t._keySteps.length>0?e.jsxs("div",{className:"key-steps-section",children:[e.jsx("h3",{className:"key-steps-heading",children:"ðŸŽ¯ Key Takeaways"}),e.jsx("ol",{className:"key-steps-list",children:t._keySteps.map((x,d)=>e.jsx("li",{className:"key-step-item",children:ws(x)},d))})]}):t._description?e.jsxs("div",{className:"key-steps-section key-steps-fallback",children:[e.jsx("h3",{className:"key-steps-heading",children:"ðŸŽ¯ What to Focus On"}),e.jsxs("ul",{className:"key-steps-list",children:[t._sections&&t._sections.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("li",{className:"key-step-item",children:["Read through the ",e.jsx("strong",{children:t.title})," page, focusing on these sections:"]}),t._sections.slice(0,5).map((x,d)=>e.jsxs("li",{className:"key-step-item",children:["ðŸ“– Work through the ",e.jsx("strong",{children:x})," section"]},d))]}):e.jsxs(e.Fragment,{children:[e.jsxs("li",{className:"key-step-item",children:["Understand how ",e.jsx("strong",{children:t.title})," works in UE5"]}),t._topics&&t._topics.length>0&&t._topics.slice(0,2).map((x,d)=>e.jsxs("li",{className:"key-step-item",children:["Pay attention to ",e.jsx("strong",{children:x.replace(/_/g," ")})," concepts and workflows"]},d)),t._subsystem&&e.jsxs("li",{className:"key-step-item",children:["Note how ",e.jsx("strong",{children:t._subsystem})," integrates with the editor"]})]}),e.jsx("li",{className:"key-step-item",children:"Try applying these techniques in your own UE5 project"})]})]}):null,t._chapters&&t._chapters.length>0&&e.jsxs("div",{className:"chapters-section",children:[e.jsx("h3",{className:"chapters-heading",children:"ðŸ“‘ Chapters"}),e.jsx("div",{className:"chapters-list",children:t._chapters.map((x,d)=>e.jsxs("a",{href:g?`https://www.youtube.com/watch?v=${g}&t=${x.seconds}`:"#",target:"_blank",rel:"noopener noreferrer",className:"chapter-item",children:[e.jsx("span",{className:"chapter-time",children:y(x.seconds)}),e.jsx("span",{className:"chapter-label",children:x.label})]},d))})]}),t._seeAlso&&t._seeAlso.length>0&&e.jsxs("div",{className:"see-also-section",children:[e.jsx("h3",{className:"see-also-heading",children:"ðŸ”— See Also"}),e.jsx("div",{className:"see-also-links",children:t._seeAlso.map((x,d)=>{const m=Mt[x.docKey],_=m?m.url:"#";return e.jsxs("a",{href:_,target:"_blank",rel:"noopener noreferrer",className:"see-also-link",title:m?m.description:x.label,children:["â†’ ",x.label]},d)})})]}),e.jsx("div",{className:"reading-step-source",children:e.jsxs("span",{className:"reading-step-source-label",children:["Source: ",r]})}),e.jsxs("a",{href:t._url,target:"_blank",rel:"noopener noreferrer",className:"reading-step-link",onClick:()=>a(!0),children:[t._resourceType==="doc"?"ðŸ“„ Open Documentation":"â–¶ï¸ Watch on YouTube",e.jsx("span",{className:"reading-step-link-arrow",children:"â†—"})]}),e.jsxs("div",{className:"reading-step-actions",children:[e.jsx("button",{className:`reading-step-complete ${l?"ready":""}`,onClick:o,title:l?"Continue to next step":"Mark as read and continue",children:l?"âœ“ Read â€” Continue â†’":"Mark as Read â†’ Continue"}),e.jsx("button",{className:"reading-step-exit",onClick:c,children:"âœ• Exit Path"})]})]})}lt.propTypes={course:f.object.isRequired,stepNumber:f.number.isRequired,totalSteps:f.number.isRequired,onComplete:f.func.isRequired,onExit:f.func.isRequired};const dt={},ut={};(Rt.courses||[]).forEach(t=>{dt[t.code]=t.title,ut[t.code]=t.versions||[]});function Ts(t){const s=ut[t];return!s||s.length===0?!1:s.every(n=>{const o=String(n).replace(/^V/i,"");return o.startsWith("4")&&!o.startsWith("4.")?/^4\d{1,2}$/.test(o):o.startsWith("4.")})}function Is(t){if(!t||t<=0)return"";const s=Math.round(t/60);return s<1?"<1 min":`${s} min`}function qe({video:t,isAdded:s,onToggle:n,userQuery:o}){const{title:c,duration:l,driveId:a,courseCode:u,_curatedMatch:i,role:r,reason:p,matchPercent:g,matchReason:y}=t,x=g>=100?"best":g>=70?"strong":g>=40?"good":"related",d=g>=100?"Best Match":g>=70?"Strong Match":g>=40?"Good Match":"Related",m=c?.replace(/\s+(?:Part\s+[A-Z]|PT\s*\d+)$/i,"").trim()||c,_=u?et[u]:null,b=_?.prereqs||[],[k,E]=j.useState(()=>zt(a)),[R,F]=j.useState(!1),q=j.useRef(null),h=j.useRef(null);j.useEffect(()=>{if(!R)return;const w=L=>{q.current&&!q.current.contains(L.target)&&F(!1)};return document.addEventListener("mousedown",w),()=>document.removeEventListener("mousedown",w)},[R]);const S=w=>{w.stopPropagation(),Ft(a,o||""),E("up")},C=w=>{w.stopPropagation(),Ut(a,o||""),E("down")},v=a?`https://drive.google.com/thumbnail?id=${a}&sz=w320`:null;return e.jsx("div",{ref:h,className:`video-result-card ${s?"added":""} ${i?"curated":""} ${k==="down"?"demoted":""}`,role:"button",tabIndex:0,children:e.jsxs("div",{className:"vrc-compact",children:[e.jsxs("div",{className:"vrc-thumbnail",children:[v?e.jsx("img",{src:v,alt:m,onError:w=>{w.target.style.display="none",w.target.nextSibling.style.display="flex"}}):null,e.jsx("div",{className:"vrc-thumb-fallback",style:{display:v?"none":"flex"},children:e.jsx("span",{className:"vrc-play-icon",children:e.jsx(Wt,{size:24})})}),l>0&&e.jsx("span",{className:"vrc-duration",children:Is(l)})]}),e.jsxs("div",{className:"vrc-badge-row",children:[g!=null&&e.jsxs("span",{className:`vrc-match-badge vrc-match-${x}`,title:`${g}% match`,children:[e.jsx("span",{className:"vrc-match-dot"}),d]}),i&&e.jsx("span",{className:"vrc-curated-badge",children:"âœ“ Solution"}),r&&r!=="core"&&e.jsxs("div",{className:"vrc-role-wrapper",ref:r==="prerequisite"?q:null,children:[e.jsxs("button",{className:`vrc-role-badge vrc-role-${r} ${r==="prerequisite"?"vrc-role-clickable":""}`,onClick:w=>{w.stopPropagation(),r==="prerequisite"&&F(L=>!L)},title:r==="prerequisite"?"Click to see why this is a prerequisite":void 0,children:[r==="prerequisite"&&"ðŸ”— Prerequisite",r==="troubleshooting"&&"ðŸ”§ Troubleshooting",r==="supplemental"&&"ðŸ“š Supplemental"]}),R&&r==="prerequisite"&&e.jsxs("div",{className:"vrc-prereq-tooltip",children:[e.jsx("strong",{children:"Prerequisite Course"}),b.length>0?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"Watch these first:"}),e.jsx("ul",{className:"vrc-prereq-list",children:b.map(w=>e.jsxs("li",{children:["ðŸ“˜ ",dt[w]||w,_?.reasons?.[w]&&e.jsxs("span",{className:"vrc-prereq-why",children:[" â€” ",_.reasons[w]]})]},w))})]}):e.jsx("p",{children:"Watch this first â€” it covers foundational concepts needed before advancing."}),p&&e.jsx("p",{className:"vrc-tip-reason",children:p})]})]}),u&&Ts(u)&&e.jsx("span",{className:"vrc-ue4-badge",title:"This content was created for Unreal Engine 4 â€” some details may differ in UE5",children:"âš ï¸ UE4"})]}),e.jsxs("div",{className:"vrc-info",children:[e.jsx("h4",{className:"vrc-title",children:m}),y&&e.jsx("p",{className:"vrc-match-reason",children:y})]}),e.jsxs("div",{className:"vrc-actions",children:[e.jsxs("div",{className:"vrc-feedback",children:[e.jsx("button",{className:`vrc-fb-btn ${k==="up"?"active-up":""}`,onClick:S,"aria-label":"Helpful",title:"This was helpful",children:e.jsx("span",{className:"vrc-fb-emoji",children:"ðŸ‘"})}),e.jsx("button",{className:`vrc-fb-btn ${k==="down"?"active-down":""}`,onClick:C,"aria-label":"Not helpful",title:"Not relevant",children:e.jsx("span",{className:"vrc-fb-emoji",children:"ðŸ‘Ž"})})]}),e.jsx("button",{className:`vrc-add-btn ${s?"vrc-added":""}`,onClick:w=>{w.stopPropagation(),n(t)},"aria-label":s?"Remove from playlist":"Add to playlist",children:s?e.jsxs(e.Fragment,{children:[e.jsx($e,{size:14})," Added"]}):e.jsxs(e.Fragment,{children:[e.jsx(Lt,{size:14})," Add"]})})]})]})})}qe.propTypes={video:f.shape({driveId:f.string,title:f.string.isRequired,courseName:f.string,duration:f.number,matchedTags:f.arrayOf(f.string),courseCode:f.string,topSegments:f.array,docLinks:f.array,_curatedMatch:f.bool,role:f.oneOf(["prerequisite","core","troubleshooting","supplemental"]),reason:f.string,estimatedMinutes:f.number}).isRequired,isAdded:f.bool,onToggle:f.func.isRequired,userQuery:f.string};function We(t){const s=Math.round(t/60);if(s<1)return"<1 min";if(s>=60){const n=Math.floor(s/60),o=s%60;return o>0?`${n}h ${o}m`:`${n}h`}return`${s} min`}const Es={video:"ðŸ“º",doc:"ðŸ“–",youtube:"â–¶ï¸"};function ht({cart:t,onRemove:s,onClear:n,onWatchPath:o}){const c=t.reduce((r,p)=>r+(p.duration||(p.readTimeMinutes||p.durationMinutes||0)*60),0),l=t.filter(r=>(r.type||"video")==="video").length,a=t.filter(r=>r.type==="doc").length,u=t.filter(r=>r.type==="youtube").length,i=[];return l>0&&i.push(`${l} video${l!==1?"s":""}`),a>0&&i.push(`${a} doc${a!==1?"s":""}`),u>0&&i.push(`${u} YT`),e.jsxs("div",{className:"cart-panel",children:[e.jsxs("div",{className:"cart-header",children:[e.jsx("h3",{className:"cart-title",children:"ðŸ›’ My Learning Path"}),t.length>0&&e.jsx("button",{className:"cart-clear-btn",onClick:n,title:"Clear all",children:"Clear"})]}),t.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cart-stats",children:[e.jsx("span",{className:"cart-stat-count",children:i.join(" Â· ")}),e.jsx("span",{className:"cart-stat-dot",children:"Â·"}),e.jsx("span",{className:"cart-stat-time",children:We(c)})]}),c>28800&&e.jsx("div",{className:"cart-warning",children:"âš ï¸ That's over 8 hours of content â€” consider narrowing your focus to the most relevant items."}),e.jsx("div",{className:"cart-items",children:t.map((r,p)=>{const g=r.itemId||r.driveId||p,y=r.type||"video",x=Es[y]||"ðŸ“º",d=y==="video"?ce(r.title):r.title,m=r.duration>0?We(r.duration):r.readTimeMinutes?`${r.readTimeMinutes} min read`:r.durationMinutes?`${r.durationMinutes} min`:null;return e.jsxs("div",{className:`cart-item cart-item-${y}`,children:[e.jsx("span",{className:"cart-item-num",children:p+1}),e.jsx("span",{className:"cart-item-icon",title:y,children:x}),e.jsxs("div",{className:"cart-item-info",children:[e.jsx("span",{className:"cart-item-title",children:d}),m&&e.jsx("span",{className:"cart-item-dur",children:m})]}),e.jsx("button",{className:"cart-item-remove",onClick:()=>s(g),"aria-label":`Remove ${r.title}`,children:"Ã—"})]},g)})}),e.jsx("button",{className:"cart-watch-btn",onClick:o,children:"â–¶ Watch Path"})]}):e.jsxs("div",{className:"cart-empty",children:[e.jsx("span",{className:"cart-empty-icon",children:"ðŸ“º"}),e.jsx("p",{children:"Add videos, docs, and resources to build your learning path"})]})]})}ht.propTypes={cart:f.arrayOf(f.shape({itemId:f.string,driveId:f.string,type:f.oneOf(["video","doc","youtube"]),title:f.string.isRequired,duration:f.number,readTimeMinutes:f.number,durationMinutes:f.number})).isRequired,onRemove:f.func.isRequired,onClear:f.func.isRequired,onWatchPath:f.func.isRequired};const mt="ue5_video_cart";function Ls(){try{const t=localStorage.getItem(mt);return t?JSON.parse(t):[]}catch{return[]}}function _e(t){try{localStorage.setItem(mt,JSON.stringify(t))}catch{}}function pe(t){return t.itemId||t.driveId||t.id||`${t.type}_${t.url}`}function $s(){const[t,s]=j.useState(Ls),n=j.useCallback(r=>{s(p=>{const g=pe(r);if(p.some(d=>pe(d)===g))return p;const y={...r,itemId:g,type:r.type||"video"},x=[...p,y];return _e(x),x})},[]),o=j.useCallback(r=>{s(p=>{const g=p.filter(y=>pe(y)!==r&&y.driveId!==r);return _e(g),g})},[]),c=j.useCallback(()=>{s([]),_e([])},[]),l=j.useCallback(r=>t.some(p=>pe(p)===r||p.driveId===r),[t]),a=t.filter(r=>(r.type||"video")==="video").length,u=j.useMemo(()=>t.reduce((r,p)=>r+(p.duration||(p.readTimeMinutes||p.durationMinutes||0)*60),0),[t]),i=j.useMemo(()=>{const r={video:[],doc:[],youtube:[]};for(const p of t){const g=p.type||"video";(r[g]||r.video).push(p)}return r},[t]);return{cart:t,addToCart:n,removeFromCart:o,clearCart:c,isInCart:l,videoCount:a,totalDuration:u,itemsByType:i}}let Ne=null;async function Ms(){if(!Ne){const t=await ae(()=>import("./data-embeddings-EsTyY_EC.js"),[]);Ne=t.default||t}return Ne}function De(t,s){if(!t||!s||t.length!==s.length)return 0;let n=0,o=0,c=0;for(let a=0;a<t.length;a++)n+=t[a]*s[a],o+=t[a]*t[a],c+=s[a]*s[a];const l=Math.sqrt(o)*Math.sqrt(c);return l===0?0:n/l}async function Rs(t,s=5,n=.3){const o=await Ms();if(!t||!o?.courses)return[];const c=[];for(const[l,a]of Object.entries(o.courses)){const u=De(t,a.embedding);u>=n&&c.push({code:l,title:a.title,similarity:u})}return c.sort((l,a)=>a.similarity-l.similarity),c.slice(0,s)}let we=null,Se=null;async function qs(){if(!we){const t=await ae(()=>import("./data-search-SjqZFhcO.js").then(s=>s.s),[]);we=t.default||t}return we}async function Oe(){if(!Se){const t=await ae(()=>import("./data-search-SjqZFhcO.js").then(s=>s.a),[]);Se=t.default||t}return Se}let Ce=null,ie=null;function Ps(t,s=768){const n=atob(t),o=new Uint8Array(n.length);for(let a=0;a<n.length;a++)o[a]=n.charCodeAt(a);const c=new DataView(o.buffer),l=new Float32Array(s);for(let a=0;a<s;a++){const u=c.getUint16(a*2,!0);l[a]=As(u)}return l}function As(t){const s=t>>15&1,n=t>>10&31,o=t&1023;return n===0?(s?-1:1)*Math.pow(2,-14)*(o/1024):n===31?o?NaN:s?-1/0:1/0:(s?-1:1)*Math.pow(2,n-15)*(1+o/1024)}async function Ds(){if(ie)return ie;if(!Ce)try{const s=await fetch(new URL("../data/segment_embeddings.json",import.meta.url));if(!s.ok)throw new Error(`HTTP ${s.status}`);Ce=await s.json()}catch(s){return X("âš ï¸ segment_embeddings.json not available:",s.message),null}const t=Ce?.segments;if(!t)return null;ie=new Map;for(const[s,n]of Object.entries(t))ie.set(s,{vector:Ps(n.embedding),courseCode:n.course_code,videoKey:n.video_key,videoTitle:n.video_title,startTimestamp:n.start_timestamp,endTimestamp:n.end_timestamp,startSeconds:n.start_seconds,text:n.text,tokenEstimate:n.token_estimate});return K(`[SegmentSearch] Decoded ${ie.size} segment embeddings`),ie}async function Os(t,s=[]){if(!t||t.length<3)return[];const n=t.toLowerCase().split(/\s+/).filter(a=>a.length>2&&!de.has(a));if(n.length===0)return[];const o=await qs(),c=[],l=o?.course_words||{};for(const[a,u]of Object.entries(l)){let i=0;const r=[];for(const p of n)if(u[p]&&(i+=u[p]*10,r.push(p)),p.length>=4)for(const[g,y]of Object.entries(u))g!==p&&g.length>=4&&(g.startsWith(p)||p.startsWith(g))&&(i+=y*3,r.includes(g)||r.push(g));if(i>=30&&r.length>0){const p=s.find(y=>y.code===a),g=await zs(a,r);c.push({courseCode:a,courseTitle:p?.title||a,score:i,matchedKeywords:r,topSegments:g,estimatedSegment:g.length>0?g[0]:null,videoCount:p?.video_count||0,duration:p?.duration_formatted||"Unknown"})}}return c.sort((a,u)=>u.score-a.score).slice(0,5)}async function zs(t,s){const o=(await Oe())[t];if(!o||!o.videos)return[];const c=[];for(const[l,a]of Object.entries(o.videos))if(a.segments)for(const u of a.segments){const i=u.text.toLowerCase();let r=0;const p=[];for(const g of s){const y=g.toLowerCase(),x=new RegExp(y.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi"),d=i.match(x);d&&(r+=d.length*10,p.push(g)),i.includes(y)&&(r+=5,p.includes(g)||p.push(g))}if(r>0){let g=u.text;if(g.length>120){const y=p[0]||"",x=g.toLowerCase().indexOf(y.toLowerCase());x>40&&(g="..."+g.substring(x-30)),g.length>120&&(g=g.substring(0,117)+"...")}c.push({videoKey:l,videoTitle:a.title,timestamp:u.start,startSeconds:u.start_seconds,endTimestamp:u.end,previewText:g,matchedKeywords:p,score:r})}}return c.sort((l,a)=>a.score-l.score).slice(0,3)}async function Fs(t,s=10,n=.35){if(!t)return[];const o=await Ds();if(!o)return[];const c=[];for(const[l,a]of o){const u=De(t,a.vector);u>=n&&c.push({id:l,courseCode:a.courseCode,videoKey:a.videoKey,videoTitle:a.videoTitle,timestamp:a.startTimestamp,endTimestamp:a.endTimestamp,startSeconds:a.startSeconds,previewText:a.text,similarity:u,source:"transcript"})}return c.sort((l,a)=>a.similarity-l.similarity),c.slice(0,s)}const Us=60,Gs=new Set(["rendering.lumen","rendering.nanite","rendering.virtualShadowMaps","rendering.substrate","worldbuilding.worldPartition"]);function le(t){return!!(t.videos?.length&&t.videos[0]?.drive_id||t.source==="youtube"&&t.youtube_url||t.source==="epic_docs")}function Vs(t){const s=(t||"").toLowerCase();return/\bue\s*5\b|\bunreal\s*engine\s*5\b|\b5\.\d\b/.test(s)?5:/\bue\s*4\b|\bunreal\s*engine\s*4\b|\b4\.\d{1,2}\b/.test(s)?4:null}async function Ye(t,s,n=[],o="",c=[]){if(!s||s.length===0)return[];const l=t?.userQuery||"",a=l.toLowerCase();for(const N of qt)if(N.patterns.some(T=>a.includes(T))){const T=N.courses.map(P=>{const V=s.find(ee=>ee.code===P);return!V||!le(V)?null:{...V,_relevanceScore:200,_curatedMatch:!0,_curatedExplanation:N.explanation}}).filter(Boolean);if(T.length>0)return K("âœ… Curated solution match:",N.explanation),T}const u=`${l} ${o}`.trim(),i=re.matchErrorSignature(u),r=i.map(N=>N.tag.tag_id),p=[...new Set([...n,...r])];i.length>0&&K("ðŸ” Error signatures detected:",i.map(N=>`${N.tag.display_name} (${N.matchedSignature}, ${N.confidence})`));const g=re.extractTagsFromText(l),y=g.matchedTagIds||[];if(y.length>0){K("ðŸ·ï¸ Tag taxonomy matches:",g.matches.map(N=>`${N.tagId} (via "${N.matchedTerm}", ${N.matchType})`));for(const N of y)p.includes(N)||p.push(N)}const x=o.toLowerCase().split(/[\s\n:;,()[\]{}]+/).filter(N=>N.length>3&&!/^[0-9]+$/.test(N)).slice(0,10),d=l.toLowerCase().split(/\s+/).filter(N=>N.length>2&&!de.has(N)),m=new Set(d),_=l.toLowerCase();for(const[N,$]of Object.entries(Pt))if(_.includes(N))for(const T of $)T.split(/\s+/).forEach(P=>{P.length>2&&!de.has(P)&&m.add(P)});const b=[...m],k=async N=>!N||N.length<5?[]:(await Os(N,s)).map(T=>{const P=s.find(V=>V.code===T.courseCode);return!P||!le(P)?null:{...P,_relevanceScore:T.score,_matchedKeywords:T.matchedKeywords}}).filter(Boolean),E=N=>N.length===0?[]:s.filter(le).map(T=>{const P=(T.title||"").toLowerCase(),V=(T.description||"").toLowerCase(),ee=[...T.canonical_tags||[],...T.gemini_system_tags||[],...T.extracted_tags||[]].map(J=>typeof J=="string"?J.toLowerCase():"").join(" ");let D=0;const I=[];for(const J of N)P.includes(J)?(D+=50,I.push(J)):ee.includes(J)?(D+=30,I.push(J)):V.includes(J)&&(D+=10,I.push(J));if(y.length>0){const J=(T.canonical_tags||[]).map(se=>se.toLowerCase());y.some(se=>J.some(bt=>bt.includes(se.split(".").pop())))&&(D*=3)}const H=new Set(I).size;H>=2&&(D*=1+H*.3);const ue=N.length>0?H/N.length:1;return N.length>=2&&ue<.5?D*=.3:ue>=1&&(D*=2),D===0?null:{...T,_relevanceScore:D,_matchedKeywords:I}}).filter(Boolean).sort((T,P)=>P._relevanceScore-T._relevanceScore),R=N=>p.length===0?N:N.map($=>{const T=$.extracted_tags||$.tags||[],ee=(Array.isArray(T)?T:Object.values(T)).map(D=>typeof D=="string"?D:D.tag_id||D.name||"").filter(Boolean).some(D=>p.some(I=>D.toLowerCase().includes(I.toLowerCase())||I.toLowerCase().includes(D.toLowerCase())));return{...$,_relevanceScore:ee?$._relevanceScore*2:$._relevanceScore*.5}}).sort(($,T)=>T._relevanceScore-$._relevanceScore),F=x.length>0?`${l} ${x.join(" ")}`:l,q=await k(F),h=x.length>0?[...b,...x]:b,S=E(h),C=new Set,v=[];for(const N of q)C.has(N.code)||(v.push(N),C.add(N.code));for(const N of S)if(!C.has(N.code))v.push(N),C.add(N.code);else{const $=v.find(T=>T.code===N.code);$&&($._relevanceScore+=N._relevanceScore)}const L=(v.length>0?v[0]._relevanceScore:0)>=Us;if(c.length>0&&!L)for(const N of c)if(C.has(N.code)){const $=v.find(T=>T.code===N.code);$&&($._relevanceScore+=N.similarity*40)}else{const $=s.find(T=>T.code===N.code);$&&le($)&&(v.push({...$,_relevanceScore:N.similarity*100,_matchedKeywords:["semantic-match"],_semanticMatch:!0,_tier:2}),C.add(N.code))}else c.length>0;v.sort((N,$)=>$._relevanceScore-N._relevanceScore);const M=R(v);if(M.length>=3)return ke(M.slice(0,5),l);const O=[F,t?.diagnosis?.problem_summary,...t?.intent?.systems||[]].filter(Boolean).join(" "),Z=O.toLowerCase().split(/\s+/).filter(N=>N.length>2&&!de.has(N)),Q=await k(O),W=E(Z);for(const N of[...Q,...W])C.has(N.code)||(v.push(N),C.add(N.code));v.sort((N,$)=>$._relevanceScore-N._relevanceScore);const G=R(v);if(G.length>=3)return ke(G.slice(0,5),l);const Y=s.map(N=>{const $=re.scoreCourseRelevance(N,h);return{...N,_relevanceScore:$.score,_scoreBreakdown:$.breakdown,_topContributors:$.topContributors}}).filter(N=>N._relevanceScore>0&&le(N)).sort((N,$)=>$._relevanceScore-N._relevanceScore).slice(0,5);return ke(R(Y),l)}function ke(t,s){const n=Vs(s);return n?t.map(o=>{const l=[...o.canonical_tags||[],...o.gemini_system_tags||[],...o.extracted_tags||[]].map(a=>typeof a=="string"?a.toLowerCase():"").some(a=>[...Gs].some(u=>a.includes(u.split(".").pop())));return n===4&&l?(K(`â¬‡ï¸ UE4 demotion: ${o.code} (has UE5-only tags)`),{...o,_relevanceScore:o._relevanceScore*.2}):n===5&&l?{...o,_relevanceScore:o._relevanceScore*1.5}:o}).sort((o,c)=>c._relevanceScore-o._relevanceScore):t}let Te=null;async function Ws(){if(!Te){const t=await ae(()=>import("./data-courses-Dhl1VM8P.js").then(s=>s.j),[]);Te=t.default||t}return Te}const Ie=new Set(["help","helpful","helps","use","used","using","make","made","get","getting","look","going","come","know","thing","work","working","want","need","show","start","take","right","well"]);async function Qe(t,s,n={}){const o=[],c=(s||"").toLowerCase().split(/\s+/).filter(d=>d.length>2),l=await Ws(),a=[],u=(s||"").toLowerCase();for(const[d,m]of Object.entries(l))u.includes(d)&&a.push({label:m.label,url:m.url});for(const d of t){if(d.source==="youtube"&&d.youtube_url){const _=n[d.code]||{},b=(()=>{const k=(d._matchedKeywords||[]).filter(E=>E.length>3&&!Ie.has(E.toLowerCase())).slice(0,3);return k.length>0?k:[d.topic||d.tags?.topic||"UE5"].flat().slice(0,3)})();o.push({driveId:d.youtube_url,title:ce(d.title||d.code),duration:d.duration_seconds||0,courseCode:d.code,courseName:d.title||d.code,matchedTags:b,videoIndex:0,relevanceScore:d._relevanceScore||0,titleRelevance:0,isIntro:!1,timestampHint:null,startSeconds:0,topSegments:[],watchHint:"â–¶ Watch on YouTube",docLinks:a,_curatedMatch:d._curatedMatch||!1,_curatedExplanation:d._curatedExplanation||null,role:_.role||null,reason:_.reason||null,estimatedMinutes:_.estimatedMinutes||null,_source:"youtube",_externalUrl:d.youtube_url,type:"youtube",url:d.youtube_url,channel:d.channel_name||d.channel||null,channelTrust:d.channel_trust||null,topics:d.topics||[],description:d.description||"",durationMinutes:d.duration_seconds?Math.round(d.duration_seconds/60):10});continue}if(d.source==="epic_docs"){const _=d.url||d.youtube_url||"#",b=n[d.code]||{},k=(()=>{const E=(d._matchedKeywords||[]).filter(R=>R.length>3&&!Ie.has(R.toLowerCase())).slice(0,3);return E.length>0?E:[d.topic||d.tags?.topic||"UE5"].flat().slice(0,3)})();o.push({driveId:`doc_${d.code}`,title:ce(d.title||d.code),duration:0,courseCode:d.code,courseName:d.title||d.code,matchedTags:k,videoIndex:0,relevanceScore:d._relevanceScore||0,titleRelevance:0,isIntro:!1,timestampHint:null,startSeconds:0,topSegments:[],watchHint:"ðŸ“– Read Epic Docs",docLinks:[{label:d.title||"Epic Docs",url:_},...a],_curatedMatch:d._curatedMatch||!1,_curatedExplanation:d._curatedExplanation||null,role:b.role||null,reason:b.reason||null,estimatedMinutes:b.estimatedMinutes||null,_source:"epic_docs",_externalUrl:_,type:"doc",url:_,topics:d.topics||[],description:d.description||"",readTimeMinutes:10});continue}const m=d.videos||[];if(m.length!==0)for(let _=0;_<m.length;_++){const b=m[_];if(!b.drive_id)continue;const k=b.title||b.name||`Video ${_+1}`,E=k.toLowerCase(),R=ce(k),F=c.filter(Q=>E.includes(Q)).length,q=F*50,h=await Ys(d.code,k,_),S=await Qs(d.code,h,c),C=E.includes("intro")||E.includes("wrap up")||E.includes("outro"),v=C?-20:0,w=q+S.score+v+(d._relevanceScore||0),L=Gt(b.drive_id,w);let M="â–¶ Watch full video";const A=(S.topSegments||[])[0]||S.bestSegment||null;if(A){const Q=A.timestamp||"0:00",W=A.previewText,G=W.length>60?W.substring(0,57)+"...":W;M=A.startSeconds<5?`ðŸ“ Start of video â€” "${G}"`:`ðŸ“ Jump to ${Q} â€” "${G}"`}const O=n[d.code]||{},Z=(()=>{const Q=(d._matchedKeywords||[]).filter(W=>W.length>3&&!Ie.has(W.toLowerCase())).slice(0,3);return Q.length>0?Q:[d.topic||d.tags?.topic||"UE5"].flat().slice(0,3)})();o.push({driveId:b.drive_id,title:R,duration:b.duration_seconds||0,courseCode:d.code,courseName:d.title||d.code,matchedTags:Z,videoIndex:_,relevanceScore:L,titleRelevance:F,isIntro:C,timestampHint:S.bestSegment?.timestamp||null,startSeconds:S.bestSegment?.startSeconds||0,topSegments:S.topSegments||[],watchHint:M,docLinks:a,_curatedMatch:d._curatedMatch||!1,_curatedExplanation:d._curatedExplanation||null,role:O.role||null,reason:O.reason||null,estimatedMinutes:O.estimatedMinutes||null})}}const i=new Map;for(const d of o){const m=i.get(d.driveId);(!m||d.relevanceScore>m.relevanceScore)&&i.set(d.driveId,d)}const r=Array.from(i.values());r.sort((d,m)=>m.relevanceScore-d.relevanceScore);const p=new Map,g=1,y=r.filter(d=>{const m=p.get(d.courseCode)||0;return m>=g?!1:(p.set(d.courseCode,m+1),!0)});if(y.length>3){const d=y.map(k=>k.relevanceScore),m=d[Math.floor(d.length/2)],_=Math.max(m*.5,10),b=y.filter(k=>k.relevanceScore>=_);if(b.length>=3){const k=b.slice(0,6);return Be(k,c),k}}const x=y.slice(0,6);return Be(x,c),x}function Be(t,s){if(t.length===0)return;const n=Math.max(t[0].relevanceScore,1);for(const o of t){o.matchPercent=Math.min(100,Math.round(o.relevanceScore/n*100));const c=[];if(o._curatedMatch&&c.push("Known solution for this problem"),o.titleRelevance>0){const l=s.filter(a=>(o.title||"").toLowerCase().includes(a)).slice(0,3);l.length>0&&c.push(`Title matches: ${l.join(", ")}`)}if(o.topSegments.length>0){const l=new Set;for(const u of o.topSegments)for(const i of u.matchedKeywords||[])l.add(i);const a=[...l].slice(0,4);a.length>0&&c.push(`Transcript mentions: ${a.join(", ")}`)}o.matchedTags.length>0&&c.length<2&&c.push(`Tagged: ${o.matchedTags.slice(0,3).join(", ")}`),o.matchReason=c.length>0?c.join(" Â· "):"Related to your query"}}async function Ys(t,s,n){const c=(await Oe())[t];if(!c?.videos)return null;const l=i=>(i||"").toLowerCase().replace(/\.mp4$/i,"").replace(/_/g," ").trim(),a=l(s),u=Object.keys(c.videos);for(const i of u){const r=l(c.videos[i].title||""),p=l(i);if(a.includes(r)||r.includes(a)||a.includes(p)||p.includes(a))return i}return n<u.length?u[n]:u[0]||null}async function Qs(t,s,n){const o={score:0,bestSegment:null,topSegments:[]},l=(await Oe())[t];if(!l?.videos||!s)return o;const a=l.videos[s];if(!a?.segments)return o;const u=[];for(const p of a.segments){const g=p.text.toLowerCase();let y=0;const x=[];for(const d of n)if(g.includes(d)){const m=g.split(d).length-1;y+=m*10,x.push(d)}if(y>0){let d=p.text;if(d.length>100){const m=d.toLowerCase().indexOf(x[0]||"");m>30&&(d="..."+d.substring(m-20)),d.length>100&&(d=d.substring(0,97)+"...")}u.push({timestamp:p.start,startSeconds:p.start_seconds,previewText:d,matchedKeywords:x,score:y})}}u.sort((p,g)=>g.score-p.score);const i=u.slice(0,3);return{score:u.reduce((p,g)=>p+g.score,0),bestSegment:i[0]||null,topSegments:i}}let Ee=null,oe=null;function Bs(t,s=768){const n=atob(t),o=new Uint8Array(n.length);for(let a=0;a<n.length;a++)o[a]=n.charCodeAt(a);const c=new DataView(o.buffer),l=new Float32Array(s);for(let a=0;a<s;a++){const u=c.getUint16(a*2,!0);l[a]=Ks(u)}return l}function Ks(t){const s=t>>15&1,n=t>>10&31,o=t&1023;return n===0?(s?-1:1)*Math.pow(2,-14)*(o/1024):n===31?o?NaN:s?-1/0:1/0:(s?-1:1)*Math.pow(2,n-15)*(1+o/1024)}async function Hs(){if(oe)return oe;if(!Ee)try{const s=await fetch(new URL("../data/docs_embeddings.json",import.meta.url));if(!s.ok)throw new Error(`HTTP ${s.status}`);Ee=await s.json()}catch(s){return X("âš ï¸ docs_embeddings.json not available:",s.message),null}const t=Ee?.docs;if(!t)return null;oe=new Map;for(const[s,n]of Object.entries(t))oe.set(s,{vector:Bs(n.embedding),slug:n.slug,url:n.url,title:n.title,section:n.section,text:n.text,tokenEstimate:n.token_estimate});return K(`[DocsSearch] Decoded ${oe.size} doc embeddings`),oe}async function Zs(t,s=5,n=.35){if(!t)return[];const o=await Hs();if(!o)return[];const c=[];for(const[l,a]of o){const u=De(t,a.vector);u>=n&&c.push({id:l,slug:a.slug,url:a.url,title:a.title,section:a.section,previewText:a.text,similarity:u,source:"epic_docs"})}return c.sort((l,a)=>a.similarity-l.similarity),c.slice(0,s)}let ge=null;async function pt(){if(ge)return ge;try{const t=await ae(()=>import("./data-courses-Dhl1VM8P.js").then(s=>s.j),[]);return ge=t.default||t,ge}catch(t){return X("âš ï¸ doc_links.json not available:",t.message),{}}}const fe={beginner:0,intermediate:1,advanced:2};async function gt(t,{maxTier:s="advanced",limit:n=10}={}){const o=await pt();if(!o||!t?.length)return[];const c=fe[s]??2,l=t.map(i=>i.toLowerCase()),a=[];for(const[i,r]of Object.entries(o)){if((fe[r.tier]??1)>c)continue;let g=0;const y=i.toLowerCase(),x=(r.label||"").toLowerCase(),d=(r.url||"").split("/").pop().replace(/-/g," ").toLowerCase(),m=(r.tags||[]).map(b=>b.toLowerCase()),_=(r.description||"").toLowerCase();for(const b of l)y===b?g+=10:y.includes(b)?g+=5:b.includes(y)||r.subsystem===b||m.includes(b)?g+=4:x.includes(b)?g+=3:m.some(k=>k.includes(b)||b.includes(k))||d.includes(b)?g+=2:_.includes(b)&&(g+=1);g>0&&a.push({key:i,label:r.label,description:r.description||"",url:r.url,tier:r.tier,subsystem:r.subsystem,readTimeMinutes:r.readTimeMinutes||10,prerequisites:r.prerequisites||[],sections:r.sections||[],keySteps:r.keySteps||[],seeAlso:r.seeAlso||[],_score:g,source:"epic_docs"})}a.sort((i,r)=>r._score!==i._score?r._score-i._score:(fe[i.tier]??1)-(fe[r.tier]??1));const u=a.length>0?a[0]._score:1;return a.slice(0,n).map(({_score:i,...r})=>({...r,matchScore:Math.round(i/Math.max(u,1)*100)}))}async function Js(t,{limit:s=8}={}){const n=await pt();if(!n)return[];const o=await gt(t,{limit:s*2});if(!o.length)return[];const c=new Map(o.map(i=>[i.key,i.matchScore??0])),l=new Set,a=[];function u(i){if(l.has(i))return;l.add(i);const r=n[i];if(r){for(const p of r.prerequisites||[])u(p);a.push({key:i,label:r.label,description:r.description||"",keySteps:r.keySteps||[],seeAlso:r.seeAlso||[],url:r.url,tier:r.tier,subsystem:r.subsystem,readTimeMinutes:r.readTimeMinutes||10,matchScore:c.get(i)??0,source:"epic_docs"})}}for(const i of o)u(i.key);return a.slice(0,s)}const Ke={prerequisite:0,core:1,troubleshooting:2,supplemental:3};function Xs(t){return t.estimated_minutes?t.estimated_minutes:t.total_duration_seconds?Math.round(t.total_duration_seconds/60):(t.videos?.length||1)*10}function He(t,s){if(s.size===0)return 0;const n=new Set([...t.canonical_tags||[],...t.gemini_system_tags||[],...t.transcript_tags||[]].map(c=>typeof c=="string"?c.toLowerCase():""));if(n.size===0)return 0;let o=0;for(const c of n)(s.has(c)||s.has(c.split(".").pop()))&&o++;return o/n.size}function en(t,s){const n=[...t.canonical_tags||[],...t.gemini_system_tags||[]].map(u=>typeof u=="string"?u.toLowerCase():""),o=new Set(s.map(u=>u.toLowerCase()));let c=!1;for(const u of n)if(o.has(u)||o.has(u.split(".").pop())){c=!0;break}const l=n.some(u=>{const i=re.getTag(u);return i?.tag_type==="symptom"||i?.tag_type==="error_code"});let a=!1;for(const u of n){const i=re.edgesBySource?.get(u)||[];for(const r of i)if(r.relation==="subtopic"&&o.has(r.target)){a=!0;break}if(a)break}return a?"prerequisite":l?"troubleshooting":c?"core":"supplemental"}function Ze(t,s,n={}){const{timeBudgetMinutes:o=1/0,maxItems:c=8,preferTroubleshooting:l=!1,diversity:a=!0}=n;if(!t||t.length===0)return{path:[],metadata:{totalMinutes:0,tagCoverage:0,diversityScore:1,itemCount:0}};const u=t.map(m=>({course:m,role:en(m,s),estimatedMinutes:Xs(m),score:m._relevanceScore||0}));u.sort((m,_)=>{const b=Ke[m.role]-Ke[_.role];return b!==0?b:_.score-m.score}),l&&u.sort((m,_)=>{const b=m.role==="troubleshooting"?0:1,k=_.role==="troubleshooting"?0:1;return b!==k?b-k:_.score-m.score});const i=[],r=new Set;let p=0;for(const m of u){if(i.length>=c)break;if(p+m.estimatedMinutes>o||a&&i.length>0&&He(m.course,r)>.7)continue;const _=tn(m,s);i.push({course:m.course,role:m.role,reason:_,estimatedMinutes:m.estimatedMinutes}),p+=m.estimatedMinutes,[...m.course.canonical_tags||[],...m.course.gemini_system_tags||[]].map(k=>typeof k=="string"?k.toLowerCase():"").forEach(k=>{r.add(k),r.add(k.split(".").pop())})}const g=new Set(s.map(m=>m.toLowerCase()));let y=0;for(const m of g)(r.has(m)||r.has(m.split(".").pop()))&&y++;const x=g.size>0?y/g.size:0;let d=1;if(i.length>1){let m=0;const _=new Set;for(const b of i)m+=He(b.course,_),[...b.course.canonical_tags||[]].map(E=>E?.toLowerCase?.()||"").forEach(E=>_.add(E));d=1-m/i.length}return{path:i,metadata:{totalMinutes:p,tagCoverage:Math.round(x*100)/100,diversityScore:Math.round(d*100)/100,itemCount:i.length}}}function tn(t,s){const{course:n,role:o}=t,c=[...n.canonical_tags||[],...n.gemini_system_tags||[]].map(u=>typeof u=="string"?u.toLowerCase():""),l=new Set(s.map(u=>u.toLowerCase())),a=c.filter(u=>l.has(u)||l.has(u.split(".").pop()));switch(o){case"prerequisite":return`Foundation course â€” covers prerequisite concepts for ${a.slice(0,2).join(", ")}`;case"core":return`Directly covers: ${a.slice(0,3).join(", ")}`;case"troubleshooting":return"Troubleshooting guide â€” addresses symptoms related to your query";case"supplemental":return"Related content â€” expands on topics connected to your query";default:return"Relevant to your search"}}let ne=null;async function ft(){if(ne!=null)return ne;try{const t=await ae(()=>import("./data-courses-Dhl1VM8P.js").then(s=>s.y),[]);return ne=t.default||t,ne}catch{return ne={channels:{},resources:[]},ne}}const xe={beginner:0,intermediate:1,advanced:2};async function xt(t,{maxTier:s="advanced",limit:n=5}={}){if(!t?.length)return[];const o=await ft();if(!o?.resources?.length)return[];const c=xe[s]??2,l=new Set(t.map(i=>i.toLowerCase())),a=[];for(const i of o.resources){if((xe[i.tier]??1)>c)continue;const p=(i.topics||[]).map(x=>x.toLowerCase()),g=(i.tag_ids||[]).map(x=>x.toLowerCase());let y=0;for(const x of p){l.has(x)&&(y+=5);for(const d of l)(x.includes(d)||d.includes(x))&&(y+=2)}for(const x of g){l.has(x)&&(y+=5);const d=x.split(".");for(const m of d)l.has(m)&&(y+=3)}if(y>0){const x=o.channels?.[i.channelKey];a.push({id:i.id,title:i.title,url:i.url,channelName:x?.name||"Unreal Engine",channelTrust:"official",tier:i.tier,durationMinutes:i.durationMinutes,topics:i.topics,tag_ids:i.tag_ids||[],description:i.description||"",keyTakeaways:i.keyTakeaways||[],chapters:i.chapters||[],source:"epic_youtube",_score:y})}}const u=/\b(ue\s*5|unreal\s*engine\s*5|5\.\d)/i;for(const i of a)i._isUE5=u.test(i.title)||(i.topics||[]).some(r=>u.test(r));return a.sort((i,r)=>i._isUE5!==r._isUE5?i._isUE5?-1:1:r._score!==i._score?r._score-i._score:(xe[i.tier]??1)-(xe[r.tier]??1)),a.slice(0,n).map(({_score:i,_isUE5:r,...p})=>p)}async function sn(t,{limit:s=5}={}){if(!t?.length)return[];const n=await ft();if(!n?.resources?.length)return[];const o=new Set(t.map(l=>l.toLowerCase())),c=[];for(const l of n.resources){const a=(l.tag_ids||[]).map(i=>i.toLowerCase());let u=0;for(const i of a)o.has(i)&&(u+=5);if(u>0){const i=n.channels?.[l.channelKey];c.push({id:l.id,title:l.title,url:l.url,channelName:i?.name||"Unreal Engine",channelTrust:"official",tier:l.tier,durationMinutes:l.durationMinutes,topics:l.topics,tag_ids:l.tag_ids||[],description:l.description||"",keyTakeaways:l.keyTakeaways||[],chapters:l.chapters||[],source:"epic_youtube",_score:u})}}return c.sort((l,a)=>a._score-l._score),c.slice(0,s).map(({_score:l,...a})=>a)}async function nn(t,s=[]){if(!t?.length)return{topics:[],firstPartyVideos:0,docsArticles:0,youtubeResources:0,coverageScore:0,gaps:[]};const n=await gt(t,{limit:10}),o=await xt(t,{limit:10}),c={};for(const i of t){const r=i.toLowerCase(),p=s.filter(d=>{const m=(d.tags||[]).map(b=>b.toLowerCase()),_=(d.title||"").toLowerCase();return m.some(b=>b.includes(r))||_.includes(r)}).length,g=n.filter(d=>d.key?.toLowerCase().includes(r)||d.subsystem?.toLowerCase()===r||d.label?.toLowerCase().includes(r)).length,y=o.filter(d=>{const m=(d.topics||[]).some(b=>b.toLowerCase().includes(r)),_=(d.tag_ids||[]).some(b=>b.toLowerCase().includes(r));return m||_}).length,x=p+g+y;c[i]={firstPartyVideos:p,docsArticles:g,youtubeResources:y,total:x,covered:x>0}}const l=Object.values(c).filter(i=>i.covered).length,a=t.length>0?l/t.length:0,u=Object.entries(c).filter(([,i])=>!i.covered).map(([i])=>i);return{topics:t,topicCoverage:c,firstPartyVideos:s.length,docsArticles:n.length,youtubeResources:o.length,coverageScore:a,gaps:u}}async function rn(t,s=[],{maxDocs:n=5,maxYoutube:o=3}={}){if(!t?.length)return{docs:[],youtube:[],totalTimeMinutes:0,coverageScore:0};const c=await Js(t,{limit:n}),l=await xt(t,{limit:o}),a=await sn(t,{limit:o}),u=new Set(l.map(x=>x.id)),i=[...l];for(const x of a)u.has(x.id)||(i.push(x),u.add(x.id));const r=s.reduce((x,d)=>x+(d.durationMinutes||10),0),p=c.reduce((x,d)=>x+(d.readTimeMinutes||10),0),g=i.reduce((x,d)=>x+(d.durationMinutes||15),0),y=await nn(t,s);return{docs:c,youtube:i,totalTimeMinutes:r+p+g,coverageScore:y.coverageScore,gaps:y.gaps,externalEnabled:!0}}const ze={QUERY_SUBMITTED:"query_submitted",DIAGNOSIS_GENERATED:"diagnosis_generated",LEARNING_PATH_GENERATED:"learning_path_generated"};let Le=null;function an(){return Le||(Le=`session_${Date.now()}_${Math.random().toString(36).substring(2,9)}`),Le}async function Fe(t,s={}){try{const n=Je(),o={event:t,session_id:an(),...s,timestamp:wt(),client_timestamp:new Date().toISOString()};await St(Ct(n,"analytics_events"),o)}catch(n){X("[Analytics] Failed to track event:",t,n.message)}}function on(t,s=[],n=null){return Fe(ze.QUERY_SUBMITTED,{query_length:t?.length||0,query_preview:t?.substring(0,100),detected_tag_count:s.length,detected_tags:s.slice(0,5),persona_id:n})}function cn(t){return Fe(ze.DIAGNOSIS_GENERATED,{diagnosis_id:t?.diagnosis_id,root_causes_count:t?.root_causes?.length||0,signals_count:t?.signals_to_watch_for?.length||0,generalization_scope:t?.generalization_scope?.slice(0,3)})}function ln(t,s,n=!0){return Fe(ze.LEARNING_PATH_GENERATED,{fix_specific_count:t?.fix_specific?.length||0,transferable_count:t?.transferable?.length||0,course_count:s?.length||0,passed_validation:n})}const B={INPUT:"input",LOADING:"loading",DIAGNOSIS:"diagnosis",GUIDED:"guided",ERROR:"error"};function _n(){const[t,s]=j.useState(B.INPUT),[n,o]=j.useState(null),[c,l]=j.useState(null),[a,u]=j.useState(null),[i,r]=j.useState([]),{cart:p,addToCart:g,removeFromCart:y,clearCart:x,isInCart:d}=$s(),m=Nt(),_=j.useMemo(()=>m?.courses||[],[m?.courses]),b=j.useCallback(()=>{try{const h=localStorage.getItem("detected_persona");return h?JSON.parse(h):null}catch{return null}},[]),k=j.useCallback(async h=>{x(),s(B.LOADING),l(null),h.pastedImage&&K("[ProblemFirst] Screenshot attached (base64 length):",h.pastedImage.length),h.errorLog&&K("[ProblemFirst] Error log attached:",h.errorLog.slice(0,200));try{if(h.cachedCartId){K(`[Cache] Checking Firestore for cart: ${h.cachedCartId}`);try{const U=Ue(),Y=Je(U),N=kt(Y,"adaptive_carts",h.cachedCartId),$=await Tt(N);if($.exists()){const T=$.data(),P=T.cached_at?.toDate?.()||new Date(T.created_at||0),V=Date.now()-P.getTime(),ee=1440*60*1e3;if(V<ee){K(`[Cache Hit] Cart is ${Math.round(V/6e4)}min old â€” using cached result`);const D={...T,userQuery:h.query,retrievedPassages:[]},I=await Ye(D,_,h.selectedTagIds||[],h.errorLog||"",[]);D.matchedCourses=I;const H=[...D.diagnosis?.matched_tag_ids||[],...h.detectedTagIds||[],...h.selectedTagIds||[]],ue=Ze(I,H,{preferTroubleshooting:!0,diversity:!0}),J={};for(const se of ue.path)J[se.course.code]={role:se.role,reason:se.reason,estimatedMinutes:se.estimatedMinutes};const he=await Qe(I,h.query,J);if(he.length>0){r(he),o(D),s(B.DIAGNOSIS),K(`[Cache] Loaded ${he.length} videos from cached cart â€” 0 Gemini calls`);return}X("[Cache] Cached cart produced 0 videos â€” falling through to fresh diagnosis")}else K(`[Cache Expired] Cart is ${Math.round(V/36e5)}h old â€” refreshing`)}else K(`[Cache Miss] Cart ${h.cachedCartId} not found in Firestore`)}catch(U){X("[Cache Error] Falling through to fresh diagnosis:",U.message)}}await on(h.query,h.detectedTagIds,b()?.id);const S=Ue(),C=It(S,"us-central1");let v=null,w=[],L=[];try{const Y=await Ge(C,"embedQuery")({query:h.query});if(Y.data?.success&&Y.data?.embedding){v=Y.data.embedding,w=await Rs(v,8,.35);try{const $=(await Fs(v,6,.35)).map(P=>({text:P.previewText,courseCode:P.courseCode,videoTitle:P.videoTitle,timestamp:P.timestamp,similarity:P.similarity,source:"transcript"}));let T=[];try{T=(await Zs(v,6,.35)).map(V=>({text:V.previewText,url:V.url,title:V.title,section:V.section,similarity:V.similarity,source:"epic_docs"}))}catch(P){X("âš ï¸ Docs semantic search skipped:",P.message)}L=[...$,...T],K(`[RAG] Retrieved ${$.length} transcript + ${T.length} doc passages`)}catch(N){X("âš ï¸ Segment semantic search skipped:",N.message)}}}catch(U){X("âš ï¸ Semantic search skipped:",U.message)}let M,A=!0;try{const Y=await Ge(C,"queryLearningPath")({query:h.query,mode:"problem-first",detectedTagIds:h.detectedTagIds,personaHint:h.personaHint,retrievedContext:L.slice(0,5)});if(!Y.data.success)throw new Error(Y.data.message||"Failed to process query");M=Y.data.cart}catch(U){const Y=U.message?.includes("429")||U.code==="resource-exhausted";X(`âš ï¸ Gemini ${Y?"rate limited (429)":"error"}: ${U.message}. Falling back to local matching.`),A=!1,M={diagnosis:{problem_summary:h.query,matched_tag_ids:h.detectedTagIds||[]},objectives:[],intent:{systems:[]}}}M.userQuery=h.query,M.retrievedPassages=L,M._localFallback=!A;const O=await Ye(M,_,h.selectedTagIds||[],h.errorLog||"",w);M.matchedCourses=O;const Z=[...M.diagnosis?.matched_tag_ids||[],...h.detectedTagIds||[],...h.selectedTagIds||[]],Q=Ze(O,Z,{preferTroubleshooting:!0,diversity:!0}),W={};for(const U of Q.path)W[U.course.code]={role:U.role,reason:U.reason,estimatedMinutes:U.estimatedMinutes};const G=await Qe(O,h.query,W);if(G.length===0){l(`We couldn't find UE5 content matching your query. Try describing a specific Unreal Engine problem, for example:
â€¢ "Blueprint compile error LNK2019"
â€¢ "Lumen reflections flickering in indoor scene"
â€¢ "Niagara particle system not spawning"
â€¢ "UMG widget not rendering"`),s(B.ERROR);return}r(G),o(M);try{const Y=[...M.diagnosis?.matched_tag_ids||[],...h.detectedTagIds||[]].flatMap(T=>T.split(/[._]/).filter(P=>P.length>2&&P!=="unreal"&&P!=="engine")),N=(h.query||"").toLowerCase().split(/\s+/).filter(T=>T.length>3),$=[...new Set([...Y,...N])].slice(0,12);if($.length>0){const T=await rn($,G,{maxDocs:5,maxYoutube:3});u(T),K(`[Blended] ${T.docs.length} docs, ${T.youtube.length} YT, coverage: ${(T.coverageScore*100).toFixed(0)}%`)}}catch(U){X("âš ï¸ Blended path skipped:",U.message)}s(B.DIAGNOSIS),h.updateCartIdForQuery&&M.cart_id&&(h.updateCartIdForQuery(h.query,M.cart_id),K(`[Cache] Saved cart_id ${M.cart_id} to history for: "${h.query.substring(0,40)}..."`)),await cn(M.diagnosis),await ln(M.objectives,O,M.validation?.approved)}catch(S){console.error("[ProblemFirst] Error:",S),l(S.message||"An unexpected error occurred"),s(B.ERROR)}},[_,b,x]),E=j.useCallback(()=>s(B.INPUT),[]),R=j.useCallback(()=>{s(B.INPUT),o(null),r([]),l(null),u(null)},[]),F=j.useCallback(h=>{d(h.driveId)?y(h.driveId):g(h)},[d,g,y]),q=j.useCallback(()=>{p.length>0&&s(B.GUIDED)},[p]);return e.jsxs("div",{className:"problem-first-page",children:[e.jsxs("header",{className:"page-header",children:[e.jsx("h1",{children:"ðŸ”§ Fix a Problem"}),e.jsx("p",{children:"Describe your issue. We'll find the right videos to help you solve it."})]}),(t===B.INPUT||t===B.LOADING)&&e.jsx(Pe,{onSubmit:k,detectedPersona:b(),isLoading:t===B.LOADING}),t===B.ERROR&&e.jsxs("div",{className:"error-state",children:[e.jsx("div",{className:"error-icon",children:"âš ï¸"}),e.jsx("h3",{children:"Something went wrong"}),e.jsx("p",{children:c}),e.jsx("button",{className:"retry-btn",onClick:R,children:"Try Again"})]}),t===B.DIAGNOSIS&&n&&e.jsxs("div",{className:"shopping-layout",children:[e.jsxs("div",{className:"results-column",children:[e.jsxs("div",{className:"tldr-diagnosis",children:[e.jsxs("div",{className:"tldr-user-query",children:[e.jsx("span",{className:"tldr-query-label",children:"ðŸ” You asked:"}),e.jsx("p",{className:"tldr-query-text",children:n.userQuery})]}),n._localFallback&&e.jsxs("div",{className:"tldr-fallback-notice",style:{background:"rgba(255, 193, 7, 0.1)",border:"1px solid rgba(255, 193, 7, 0.3)",borderRadius:"8px",padding:"8px 14px",margin:"8px 0",fontSize:"0.85rem",color:"var(--text-muted, #aaa)"},children:["âš¡ ",e.jsx("strong",{children:"Fast results"})," â€” AI diagnosis unavailable (rate limit). Videos matched by tag taxonomy."]}),n.diagnosis?.problem_summary&&e.jsx("p",{className:"tldr-bridge",children:"Based on your question, we think these videos will help you:"})]}),e.jsxs("h2",{className:"results-title",children:["ðŸŽ¬ Videos for You (",i.length,")"]}),i.length===0&&e.jsx("div",{className:"no-results",children:e.jsx("p",{children:"No matching videos found. Try rephrasing your question."})}),(()=>{const h=[{key:"prerequisite",icon:"ðŸ”—",label:"Prerequisite",desc:"Build the foundation first â€” these cover concepts you'll need before tackling the main topic."},{key:"core",icon:"â­",label:"Core",desc:"These directly address your question and are the most important videos to watch."},{key:"troubleshooting",icon:"ðŸ”§",label:"Troubleshooting",desc:"Debugging helpers â€” watch these if you're hitting errors or unexpected behavior."},{key:"supplemental",icon:"ðŸ“š",label:"Supplemental",desc:"Go deeper â€” extra context and advanced techniques for when you're ready."}],S={};for(const C of h)S[C.key]=[];S._other=[];for(const C of i){const v=C.role||"_other";(S[v]||S._other).push(C)}return h.filter(C=>S[C.key].length>0).map(C=>e.jsxs("div",{className:"role-section",children:[e.jsxs("div",{className:"role-section-header",children:[e.jsxs("h3",{className:"role-section-title",children:[C.icon," ",C.label,e.jsx("span",{className:"role-section-count",children:S[C.key].length})]}),e.jsx("p",{className:"role-section-desc",children:C.desc})]}),e.jsx("div",{className:"video-results-grid",children:S[C.key].map(v=>e.jsx("div",{className:"video-result-wrapper",id:`video-${v.driveId}`,children:e.jsx(qe,{video:v,isAdded:d(v.driveId),onToggle:F,userQuery:n?.userQuery||""})},v.driveId))})]},C.key)).concat(S._other.length>0?[e.jsxs("div",{className:"role-section",children:[e.jsxs("div",{className:"role-section-header",children:[e.jsxs("h3",{className:"role-section-title",children:["ðŸ“Ž Related"," ",e.jsx("span",{className:"role-section-count",children:S._other.length})]}),e.jsx("p",{className:"role-section-desc",children:"Additional videos that may be relevant to your query."})]}),e.jsx("div",{className:"video-results-grid",children:S._other.map(C=>e.jsx("div",{className:"video-result-wrapper",id:`video-${C.driveId}`,children:e.jsx(qe,{video:C,isAdded:d(C.driveId),onToggle:F,userQuery:n?.userQuery||""})},C.driveId))})]},"_other")]:[])})(),a?.docs?.length>0&&e.jsxs("div",{className:"blended-section",children:[e.jsxs("div",{className:"blended-section-header",children:[e.jsx("h2",{className:"blended-section-title",children:"ðŸ“š Recommended Reading"}),e.jsxs("p",{className:"blended-section-desc",children:["Official Unreal Engine documentation to deepen your understanding.",a.docs.reduce((h,S)=>h+(S.readTimeMinutes||10),0)>0&&` (~${a.docs.reduce((h,S)=>h+(S.readTimeMinutes||10),0)} min total read time)`]})]}),e.jsx("div",{className:"doc-cards-grid",children:a.docs.map((h,S)=>{const C=`doc_${h.key||S}`,v=d(C);return e.jsxs("div",{className:`doc-card ${v?"doc-card-added":""}`,children:[e.jsxs("a",{href:h.url,target:"_blank",rel:"noopener noreferrer",className:"doc-card-link",onClick:w=>w.stopPropagation(),children:[e.jsxs("div",{className:"doc-card-header",children:[h.matchScore!=null&&(()=>{const w=h.matchScore>=90?"best":h.matchScore>=60?"strong":h.matchScore>=30?"good":"related",L=h.matchScore>=90?"Best Match":h.matchScore>=60?"Strong":h.matchScore>=30?"Good":"Related";return e.jsxs("span",{className:`doc-match-badge doc-match-${w}`,title:`${h.matchScore}% relevancy`,children:[e.jsx("span",{className:"doc-match-dot"}),L]})})(),e.jsx("span",{className:`tier-badge tier-${h.tier||"intermediate"}`,children:h.tier||"intermediate"}),h.subsystem&&e.jsx("span",{className:"subsystem-tag",children:h.subsystem})]}),e.jsx("h4",{className:"doc-card-title",children:h.label}),h.description&&e.jsx("p",{className:"doc-card-desc",children:h.description}),e.jsxs("div",{className:"doc-card-footer",children:[e.jsx("span",{className:"doc-source-badge",children:"ðŸ“„ Epic Docs"}),e.jsxs("span",{className:"doc-read-time",children:[h.readTimeMinutes||10," min read"]})]})]}),e.jsx("button",{className:`doc-add-btn ${v?"doc-added":""}`,onClick:()=>{v?y(C):g({type:"doc",itemId:C,title:h.label,description:h.description||"",keySteps:h.keySteps||[],seeAlso:h.seeAlso||[],sections:h.sections||[],url:h.url,tier:h.tier||"intermediate",subsystem:h.subsystem,readTimeMinutes:h.readTimeMinutes||10})},title:v?"Remove from path":"Add to learning path",children:v?"âœ“ Added":"âž• Add"})]},h.key||S)})})]}),a?.youtube?.length>0&&e.jsxs("div",{className:"blended-section",children:[e.jsxs("div",{className:"blended-section-header",children:[e.jsx("h2",{className:"blended-section-title",children:"ðŸ“º Official Epic YouTube"}),e.jsx("p",{className:"blended-section-desc",children:"Official Unreal Engine tutorials from Epic Games."})]}),e.jsx("div",{className:"doc-cards-grid",children:a.youtube.map(h=>{const S=h.id||`yt_${h.url}`,C=d(S);return e.jsxs("div",{className:`doc-card yt-card-with-thumb ${C?"doc-card-added":""}`,children:[e.jsxs("a",{href:h.url,target:"_blank",rel:"noopener noreferrer",className:"doc-card-link",onClick:v=>v.stopPropagation(),children:[(()=>{const v=h.url?.match(/[?&]v=([^&]+)/),w=v?v[1]:null;return w?e.jsxs("div",{className:"yt-thumb-wrapper",children:[e.jsx("img",{className:"yt-thumb-img",src:`https://img.youtube.com/vi/${w}/mqdefault.jpg`,alt:h.title,loading:"lazy"}),e.jsxs("span",{className:"yt-thumb-duration",children:[h.durationMinutes," min"]}),e.jsx("span",{className:"yt-thumb-play",children:"â–¶"})]}):null})(),e.jsxs("div",{className:"doc-card-header",children:[e.jsx("span",{className:`tier-badge tier-${h.tier||"intermediate"}`,children:h.tier||"intermediate"}),e.jsx("span",{className:"external-badge",children:"Official â€¢ YouTube"})]}),e.jsx("h4",{className:"doc-card-title",children:h.title}),e.jsxs("div",{className:"doc-card-footer",children:[e.jsxs("span",{className:"doc-source-badge",children:["ðŸ“º ",h.channelName]}),e.jsxs("span",{className:"doc-read-time",children:[h.durationMinutes," min"]})]})]}),e.jsx("button",{className:`doc-add-btn ${C?"doc-added":""}`,onClick:()=>{C?y(S):g({type:"youtube",itemId:S,title:h.title,description:h.description||"",keyTakeaways:h.keyTakeaways||[],chapters:h.chapters||[],topics:h.topics||[],url:h.url,channelName:h.channelName,channelTrust:h.channelTrust,tier:h.tier||"intermediate",durationMinutes:h.durationMinutes||15})},title:C?"Remove from path":"Add to learning path",children:C?"âœ“ Added":"âž• Add"})]},h.id)})})]}),e.jsxs("div",{className:"results-actions-bottom",children:[e.jsx("button",{className:"back-btn",onClick:R,children:"â† Start Over"}),e.jsx("button",{className:"ask-again-btn",onClick:E,children:"+ Ask Another Question"})]})]}),e.jsx("div",{className:"cart-column",children:e.jsx(ht,{cart:p,onRemove:y,onClear:x,onWatchPath:q})})]}),t===B.GUIDED&&e.jsx(Ae,{courses:p.map(h=>{const S=h.type||"video";if(S==="doc"||S==="youtube")return{code:h.itemId||`${S}_${h.url}`,title:h.title,_readingStep:!0,_resourceType:S,_description:h.description||"",_keySteps:h.keyTakeaways||h.keySteps||[],_seeAlso:h.seeAlso||[],_url:h.url,_tier:h.tier,_channel:h.channel||h.channelName,_channelTrust:h.channelTrust,_subsystem:h.subsystem,_topics:h.topics||[],_sections:h.sections||[],_chapters:h.chapters||[],_readTimeMinutes:h.readTimeMinutes||h.durationMinutes||10,videos:[]};const C=_.find(v=>v.code===h.courseCode);return C?{...C,videos:[{drive_id:h.driveId,title:h.title,duration_seconds:h.duration}]}:{code:h.courseCode,title:h.courseName,videos:[{drive_id:h.driveId,title:h.title,duration_seconds:h.duration}]}}),diagnosis:n?.diagnosis,problemSummary:n?.diagnosis?.problem_summary,pathSummary:n?.pathSummary,microLesson:n?.microLesson,onComplete:()=>{},onExit:()=>s(B.DIAGNOSIS)})]})}function yt({diagnosis:t}){if(!t)return null;const s=t.root_causes?.length||0,n=t.signals_to_watch_for?.length||0,o=t.variables_that_matter?.length||0,c=t.variables_that_do_not?.length||0;return e.jsxs("div",{className:"diagnosis-card",children:[e.jsxs("div",{className:"diagnosis-header",children:[e.jsx("h3",{children:"ðŸ”¬ Diagnosis"}),e.jsxs("span",{className:"diagnosis-id",children:["ID: ",t.diagnosis_id?.slice(-8)||"N/A"]})]}),e.jsx("p",{className:"problem-summary",children:t.problem_summary}),e.jsxs("div",{className:"diagnosis-sections",children:[e.jsxs("details",{className:"diagnosis-section root-causes",children:[e.jsxs("summary",{children:[e.jsx("span",{className:"icon",children:"ðŸŽ¯"}),"Root Causes",e.jsxs("span",{className:"count",children:["(",s,")"]})]}),e.jsx("ul",{children:(t.root_causes||[]).map((l,a)=>e.jsx("li",{children:l},a))})]}),e.jsxs("details",{className:"diagnosis-section signals",children:[e.jsxs("summary",{children:[e.jsx("span",{className:"icon",children:"ðŸ‘ï¸"}),"Signals to Watch For",e.jsxs("span",{className:"count",children:["(",n,")"]})]}),e.jsx("ul",{children:(t.signals_to_watch_for||[]).map((l,a)=>e.jsx("li",{children:l},a))})]}),e.jsxs("details",{className:"diagnosis-section variables-matter",children:[e.jsxs("summary",{children:[e.jsx("span",{className:"icon",children:"âœ…"}),"Variables That Matter",e.jsxs("span",{className:"count",children:["(",o,")"]})]}),e.jsx("ul",{children:(t.variables_that_matter||[]).map((l,a)=>e.jsx("li",{children:l},a))})]}),e.jsxs("details",{className:"diagnosis-section variables-dont-matter",children:[e.jsxs("summary",{children:[e.jsx("span",{className:"icon",children:"âŒ"}),"Variables That Don't",e.jsxs("span",{className:"count",children:["(",c,")"]})]}),e.jsx("ul",{children:(t.variables_that_do_not||[]).map((l,a)=>e.jsx("li",{children:l},a))})]}),t.generalization_scope?.length>0&&e.jsxs("details",{className:"diagnosis-section generalization",open:!0,children:[e.jsxs("summary",{children:[e.jsx("span",{className:"icon",children:"ðŸ”„"}),"Where Else This Applies",e.jsxs("span",{className:"count",children:["(",t.generalization_scope.length,")"]})]}),e.jsx("div",{className:"scope-chips",children:t.generalization_scope.map((l,a)=>e.jsx("span",{className:"scope-chip",children:l},a))})]})]})]})}yt.propTypes={diagnosis:f.shape({diagnosis_id:f.string,problem_summary:f.string,root_causes:f.arrayOf(f.string),signals_to_watch_for:f.arrayOf(f.string),variables_that_matter:f.arrayOf(f.string),variables_that_do_not:f.arrayOf(f.string),generalization_scope:f.arrayOf(f.string)})};yt.defaultProps={diagnosis:null};function vt({objectives:t,courses:s,validation:n,onCourseClick:o,onAddToCart:c,isCourseInCart:l}){const{fixCourses:a,learnCourses:u}=j.useMemo(()=>{if(!s||s.length===0)return{fixCourses:[],learnCourses:[]};const r=Math.ceil(s.length/2);return{fixCourses:s.slice(0,r),learnCourses:s.slice(r)}},[s]),i=j.useMemo(()=>n?{approved:n.approved,reason:n.reason,hasIssues:n.issues?.length>0}:null,[n]);return e.jsxs("div",{className:"adaptive-cart",children:[i&&!i.approved&&e.jsxs("div",{className:"validation-warning",children:[e.jsx("span",{className:"icon",children:"âš ï¸"}),e.jsxs("div",{className:"content",children:[e.jsx("strong",{children:"Quality Check:"})," ",i.reason,n.suggestions?.length>0&&e.jsx("ul",{className:"suggestions",children:n.suggestions.map((r,p)=>e.jsx("li",{children:r},p))})]})]}),e.jsxs("section",{className:"cart-section fix-now",children:[e.jsxs("div",{className:"section-header",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"icon",children:"ðŸ”§"}),"Fix Now"]}),e.jsx("p",{className:"description",children:"These solve your immediate problem:"})]}),e.jsx("div",{className:"objectives-list",children:(t?.fix_specific||[]).map((r,p)=>e.jsxs("div",{className:"objective-item fix",children:[e.jsx("span",{className:"number",children:p+1}),e.jsx("span",{className:"text",children:r})]},p))}),a.length>0&&e.jsx("div",{className:"course-list",children:a.map(r=>e.jsx(ye,{course:r,type:"fix",onClick:()=>o?.(r),onAddToCart:c,isInCart:l?.(r)},r.id||r.code))})]}),e.jsxs("section",{className:"cart-section learn-forever",children:[e.jsxs("div",{className:"section-header",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"icon",children:"ðŸŽ“"}),"Learn Forever"]}),e.jsx("p",{className:"description",children:"These help you diagnose similar issues in the future:"})]}),e.jsx("div",{className:"objectives-list transferable",children:(t?.transferable||[]).map((r,p)=>e.jsxs("div",{className:"objective-item transferable",children:[e.jsx("span",{className:"number",children:p+1}),e.jsx("span",{className:"text",children:r}),e.jsx("span",{className:"badge",children:"Transferable"})]},p))}),t?.transferable?.length===0&&e.jsx("div",{className:"empty-warning",children:"âš ï¸ No transferable objectives generated. This path may not teach reusable skills."}),u.length>0&&e.jsx("div",{className:"course-list",children:u.map(r=>e.jsx(ye,{course:r,type:"learn",onClick:()=>o?.(r),onAddToCart:c,isInCart:l?.(r)},r.id||r.code))})]}),e.jsxs("div",{className:"cart-summary",children:[e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"value",children:t?.fix_specific?.length||0}),e.jsx("span",{className:"label",children:"Fix Objectives"})]}),e.jsxs("div",{className:"stat highlight",children:[e.jsx("span",{className:"value",children:t?.transferable?.length||0}),e.jsx("span",{className:"label",children:"Transferable Skills"})]}),e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"value",children:s?.length||0}),e.jsx("span",{className:"label",children:"Recommended Courses"})]})]})]})}function ye({course:t,type:s,onClick:n,onAddToCart:o,isInCart:c}){const[l,a]=j.useState(!1),u=j.useMemo(()=>{if(t.duration)return t.duration;if(t.duration_minutes)return`${t.duration_minutes} min`;if(t.durationMinutes)return`${t.durationMinutes} min`;if(t.videos?.length){const y=t.videos.reduce((x,d)=>x+(d.duration_seconds||0),0);return y>0?js(y):null}return null},[t]),i=j.useMemo(()=>typeof t.difficulty=="string"?t.difficulty:typeof t.difficulty=="number"?["Beginner","Beginner","Intermediate","Intermediate","Advanced","Expert"][t.difficulty]||"Intermediate":t.gemini_skill_level?t.gemini_skill_level:null,[t]),r=j.useMemo(()=>_s(t),[t]),p=t.video_count||t.videos?.length||null,g=y=>{y.stopPropagation(),o?.(t)};return e.jsxs("div",{className:`course-card ${s} ${c?"in-cart":""}`,onClick:n,role:"button",tabIndex:0,onKeyDown:y=>y.key==="Enter"&&n?.(),children:[r&&!l&&e.jsx("div",{className:"course-thumbnail",children:e.jsx("img",{src:r,alt:t.title,loading:"lazy",onError:()=>a(!0)})}),e.jsxs("div",{className:"course-info",children:[e.jsx("h4",{className:"title",children:t.title||t.name}),t.gemini_outcomes?.[0]&&e.jsxs("p",{className:"description",children:[t.gemini_outcomes[0].slice(0,100),"..."]}),e.jsxs("div",{className:"meta",children:[u&&e.jsxs("span",{className:"duration",children:["â±ï¸ ",u]}),p&&e.jsxs("span",{className:"video-count",children:["ðŸŽ¬ ",p," videos"]}),i&&e.jsx("span",{className:`difficulty ${i.toLowerCase()}`,children:i})]})]}),e.jsx("div",{className:"course-action",children:o?e.jsx("button",{className:`add-btn ${c?"added":""}`,onClick:g,"aria-label":c?"Added to path":"Add to path",children:c?"âœ“ Added":"+ Add"}):e.jsx("span",{className:"arrow",children:"â†’"})})]})}ye.propTypes={course:f.shape({id:f.string,code:f.string,title:f.string,name:f.string,description:f.string,duration:f.string,durationMinutes:f.number,difficulty:f.string}).isRequired,type:f.oneOf(["fix","learn"]),onClick:f.func};ye.defaultProps={type:"fix",onClick:null};vt.propTypes={objectives:f.shape({fix_specific:f.arrayOf(f.string),transferable:f.arrayOf(f.string)}),courses:f.arrayOf(f.object),validation:f.shape({approved:f.bool,reason:f.string,issues:f.arrayOf(f.string),suggestions:f.arrayOf(f.string)}),onCourseClick:f.func};vt.defaultProps={objectives:null,courses:[],validation:null,onCourseClick:null};export{vt as AdaptiveLearningCart,yt as DiagnosisCard,_n as ProblemFirst,Pe as ProblemInput};

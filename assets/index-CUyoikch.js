import{j as e,_ as xe,a as ks,g as ss}from"./index-B1a8eLlC.js";import{a as N,P as h}from"./vendor-cytoscape-hdah7_Xt.js";import{c as ps,p as Is,r as Rs,d as Ms,j as Es,k as Ls,n as $s,m as ts}from"./vendor-firebase-BQvzIQYL.js";import{t as pe}from"./TagGraphService-B-wiM6gr.js";import{S as As,P as Os}from"./search-Blpc5bje.js";import{c as ye}from"./createLucideIcon-YhyuTmrv.js";import{c as Te,S as ke,G as Ps}from"./GuidedPlayer-BthsVKAs.js";import{getFeedbackStatus as qs,recordUpvote as Ds,recordDownvote as Fs,applyFeedbackMultiplier as Us}from"./feedbackService-CkyHLPU6.js";import{b as Ws,l as Vs,c as Bs,s as zs}from"./data-courses-Y_tFOtPD.js";import{C as Gs}from"./check-eCXpKYRG.js";import{d as re,a as G}from"./logger-HX1K3TKu.js";import"./x-HbUnH9yy.js";const Ks=[["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Hs=ye("circle-play",Ks);const Qs=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],ns=ye("circle-x",Qs);const Ys=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],Js=ye("image",Ys);const Xs=[["path",{d:"M13.172 2a2 2 0 0 1 1.414.586l6.71 6.71a2.4 2.4 0 0 1 0 3.408l-4.592 4.592a2.4 2.4 0 0 1-3.408 0l-6.71-6.71A2 2 0 0 1 6 9.172V3a1 1 0 0 1 1-1z",key:"16rjxf"}],["path",{d:"M2 7v6.172a2 2 0 0 0 .586 1.414l6.71 6.71a2.4 2.4 0 0 0 3.191.193",key:"178nd4"}],["circle",{cx:"10.5",cy:"6.5",r:".5",fill:"currentColor",key:"12ikhr"}]],Zs=ye("tags",Xs);const et=[["path",{d:"M12 19h8",key:"baeox8"}],["path",{d:"m4 17 6-6-6-6",key:"1yngyt"}]],st=ye("terminal",et);const tt=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],nt=ye("user",tt),rt=/(?:[A-Za-z]:\\[\w\\. -]+|\/(?:Users|home|tmp|var|opt|etc)\/[\w/. -]+)/g;function rs(s){return s.replace(rt,"[LOCAL_PATH]")}function We({onSubmit:s,detectedPersona:n,isLoading:a}){const[i,u]=N.useState(""),[o,r]=N.useState([]),[d,c]=N.useState(null),[t,l]=N.useState(""),[x,f]=N.useState(!1),y=N.useRef(null),[v,b]=N.useState(()=>{try{const _=JSON.parse(localStorage.getItem("fix-problem-history")||"[]"),R=_.map(C=>typeof C=="string"?{query:C,cartId:null}:C);return _.length>0&&typeof _[0]=="string"&&localStorage.setItem("fix-problem-history",JSON.stringify(R)),R}catch{return[]}}),O=N.useCallback(_=>{const R=rs(_.target.value);if(u(R),R.length>15){const C=pe.matchErrorSignature(R),D=pe.extractTagsFromText(R),U=C.map(H=>({tag:H.tag,confidence:H.confidence})),B=D.matches.map(H=>({tag:H.tag,confidence:H.confidence})),ne=[...U,...B],le=new Set,ie=ne.filter(H=>le.has(H.tag.tag_id)?!1:(le.add(H.tag.tag_id),!0));r(ie.slice(0,5))}else r([])},[]),m=N.useCallback(_=>{const R=_.clipboardData?.items;if(R){for(const C of R)if(C.type.startsWith("image/")){_.preventDefault();const D=C.getAsFile(),U=new FileReader;U.onload=B=>c(B.target.result),U.readAsDataURL(D);return}}},[]),T=N.useCallback(_=>{_.preventDefault(),_.stopPropagation(),f(!0)},[]),k=N.useCallback(_=>{_.preventDefault(),_.stopPropagation(),f(!1)},[]),I=N.useCallback(_=>{_.preventDefault(),_.stopPropagation(),f(!1);const R=_.dataTransfer?.files;if(!R||R.length===0)return;const C=R[0];if(C.type.startsWith("image/")){const D=new FileReader;D.onload=U=>c(U.target.result),D.readAsDataURL(C)}},[]),E=N.useCallback((_,R)=>{b(C=>{const D=C.map(U=>U.query===_?{...U,cartId:R}:U);return localStorage.setItem("fix-problem-history",JSON.stringify(D)),D})},[]),$=N.useCallback((_=null,R=null)=>{const C=(R||i).trim();C.length<10||(b(D=>{const U=D.filter(ne=>ne.query!==C),B=[{query:C,cartId:_},...U].slice(0,6);return localStorage.setItem("fix-problem-history",JSON.stringify(B)),B}),s({query:C,detectedTagIds:o.map(D=>D.tag.tag_id),selectedTagIds:[],personaHint:n?.name,pastedImage:d,errorLog:t.trim()||null,cachedCartId:_||null,updateCartIdForQuery:E}))},[i,o,n,s,d,t,E]),Q=N.useCallback(_=>{_.key==="Enter"&&_.ctrlKey&&$()},[$]),Y=N.useMemo(()=>['My Blueprint Cast is giving me "Accessed None" error when trying to...',"Lumen is too noisy in my interior scene and I've tried increasing quality...","My character animation stutters when blending between states...","Nanite is causing Z-fighting on overlapping meshes...","Material instances aren't updating at runtime when I change parameters..."],[])[0];return e.jsxs("div",{className:"problem-input-container",onPaste:m,children:[e.jsxs("div",{className:"problem-input-header",children:[e.jsxs("h2",{children:[e.jsx(As,{size:22,className:"icon-inline"})," What's the problem?"]}),e.jsx("p",{className:"subtitle",children:"Describe your UE5 issue in plain English. We'll diagnose the root cause and teach you to fix it."})]}),e.jsxs("div",{className:"problem-input-field",children:[e.jsx("textarea",{value:i,onChange:O,onKeyDown:Q,placeholder:Y,rows:5,disabled:a,"aria-label":"Problem description"}),e.jsxs("div",{className:"char-count",children:[i.length," characters",i.length<10&&i.length>0&&e.jsx("span",{className:"warning",children:" (minimum 10)"})]})]}),o.length>0&&e.jsxs("div",{className:"detected-tags",children:[e.jsxs("span",{className:"label",children:[e.jsx(Zs,{size:14,className:"icon-inline"})," Detected:"]}),e.jsx("div",{className:"tag-list",children:o.map(_=>e.jsxs("span",{className:"tag-chip",title:_.tag.description||_.tag.display_name,children:[_.tag.display_name,e.jsxs("span",{className:"confidence",children:[Math.round(_.confidence*100),"%"]})]},_.tag.tag_id))})]}),e.jsxs("div",{className:`screenshot-zone ${t.trim()?"has-image":""}`,onClick:()=>{t.trim()||document.getElementById("error-log-input")?.focus()},children:[t.trim()?e.jsxs("div",{className:"pasted-preview error-log-preview",children:[e.jsx("pre",{className:"error-log-display",children:t}),e.jsx("button",{type:"button",className:"clear-error-log",onClick:_=>{_.stopPropagation(),l("")},"aria-label":"Remove error log",title:"Clear error log",children:e.jsx(ns,{size:20})})]}):e.jsxs("div",{className:"drop-prompt",children:[e.jsx(st,{size:20}),e.jsxs("span",{children:["Paste (",e.jsx("kbd",{children:"Ctrl+V"}),") an error log or build output"]})]}),e.jsx("textarea",{id:"error-log-input",className:"error-log-hidden-input",value:t,onChange:_=>l(_.target.value),onPaste:_=>{const R=_.clipboardData?.getData("text");R&&(_.preventDefault(),l(rs(R)))},rows:1})]}),e.jsx("div",{ref:y,className:`screenshot-zone ${x?"drag-over":""} ${d?"has-image":""}`,onDragOver:T,onDragLeave:k,onDrop:I,children:d?e.jsxs("div",{className:"pasted-preview",children:[e.jsx("img",{src:d,alt:"Pasted screenshot"}),e.jsx("button",{type:"button",className:"clear-error-log",onClick:()=>c(null),"aria-label":"Remove screenshot",title:"Remove screenshot",children:e.jsx(ns,{size:20})})]}):e.jsxs("div",{className:"drop-prompt",children:[e.jsx(Js,{size:20}),e.jsxs("span",{children:["Paste (",e.jsx("kbd",{children:"Ctrl+V"}),") or drag a screenshot here"]})]})}),n&&e.jsxs("div",{className:"persona-context",children:[e.jsxs("span",{className:"label",children:[e.jsx(nt,{size:14,className:"icon-inline"})," Context:"]}),e.jsx("span",{className:"persona-chip",children:n.name}),e.jsx("span",{className:"hint",children:"Recommendations will be tailored for you"})]}),e.jsxs("div",{className:"problem-input-actions",children:[e.jsx("button",{className:"submit-btn primary",onClick:()=>$(),disabled:i.trim().length<10||a,children:a?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner"})," Diagnosing..."]}):e.jsx(e.Fragment,{children:"Get Diagnosis ‚Üí"})}),e.jsxs("span",{className:"hint",children:["Press ",e.jsx("kbd",{children:"Ctrl"})," + ",e.jsx("kbd",{children:"Enter"})," to submit"]})]}),v.length>0&&e.jsxs("div",{className:"query-history",children:[e.jsx("span",{className:"history-label",children:"üïò Recent questions:"}),e.jsx("div",{className:"history-chips",children:v.map((_,R)=>{const C=_.query||_,D=_.cartId||null,U=!!D;return e.jsxs("div",{className:"history-chip-row",children:[e.jsxs("button",{type:"button",className:`history-chip ${U?"cached":""}`,onClick:()=>{u(C),O({target:{value:C}}),U&&!a&&setTimeout(()=>$(D,C),50)},title:U?`${C} (cached ‚Äî instant load)`:C,disabled:a,children:[U&&e.jsx("span",{className:"cache-indicator",children:"‚ö°"}),C.length>50?C.slice(0,50)+"‚Ä¶":C]}),e.jsx("button",{type:"button",className:"history-delete",onClick:()=>{b(B=>{const ne=B.filter((le,ie)=>ie!==R);return localStorage.setItem("fix-problem-history",JSON.stringify(ne)),ne})},title:"Remove",children:"√ó"})]},R)})})]})]})}We.propTypes={onSubmit:h.func.isRequired,detectedPersona:h.shape({id:h.string,name:h.string,emoji:h.string}),isLoading:h.bool};We.defaultProps={detectedPersona:null,isLoading:!1};const gs={},fs={};(Vs.courses||[]).forEach(s=>{gs[s.code]=s.title,fs[s.code]=s.versions||[]});function at(s){const n=fs[s];return!n||n.length===0?!1:n.every(a=>{const i=String(a).replace(/^V/i,"");return i.startsWith("4")&&!i.startsWith("4.")?/^4\d{1,2}$/.test(i):i.startsWith("4.")})}function it(s){if(!s||s<=0)return"";const n=Math.round(s/60);return n<1?"<1 min":`${n} min`}function Ue({video:s,isAdded:n,onToggle:a,userQuery:i}){const{title:u,duration:o,driveId:r,courseCode:d,_curatedMatch:c,role:t,reason:l,matchPercent:x,matchReason:f,watchHint:y}=s,v=x>=100?"best":x>=70?"strong":x>=40?"good":"related",b=x>=100?"Best Match":x>=70?"Strong Match":x>=40?"Good Match":"Related",O=u?.replace(/\s+(?:Part\s+[A-Z]|PT\s*\d+)$/i,"").trim()||u,m=d?Ws[d]:null,T=m?.prereqs||[],[k,I]=N.useState(()=>qs(r)),[E,$]=N.useState(!1),Q=N.useRef(null),K=N.useRef(null);N.useEffect(()=>{if(!E)return;const C=D=>{Q.current&&!Q.current.contains(D.target)&&$(!1)};return document.addEventListener("mousedown",C),()=>document.removeEventListener("mousedown",C)},[E]);const Y=C=>{C.stopPropagation(),Ds(r,i||""),I("up")},_=C=>{C.stopPropagation(),Fs(r,i||""),I("down")},R=r?`https://drive.google.com/thumbnail?id=${r}&sz=w320`:null;return e.jsx("div",{ref:K,className:`video-result-card ${n?"added":""} ${c?"curated":""} ${k==="down"?"demoted":""}`,role:"button",tabIndex:0,children:e.jsxs("div",{className:"vrc-compact",children:[e.jsxs("div",{className:"vrc-thumbnail",children:[R?e.jsx("img",{src:R,alt:O,onError:C=>{C.target.style.display="none",C.target.nextSibling.style.display="flex"}}):null,e.jsx("div",{className:"vrc-thumb-fallback",style:{display:R?"none":"flex"},children:e.jsx("span",{className:"vrc-play-icon",children:e.jsx(Hs,{size:24})})}),o>0&&e.jsx("span",{className:"vrc-duration",children:it(o)})]}),e.jsxs("div",{className:"vrc-badge-row",children:[x!=null&&e.jsxs("span",{className:`vrc-match-badge vrc-match-${v}`,title:`${x}% match`,children:[e.jsx("span",{className:"vrc-match-dot"}),b]}),c&&e.jsx("span",{className:"vrc-curated-badge",children:"‚úì Solution"}),t&&t!=="core"&&e.jsxs("div",{className:"vrc-role-wrapper",ref:t==="prerequisite"?Q:null,children:[e.jsxs("button",{className:`vrc-role-badge vrc-role-${t} ${t==="prerequisite"?"vrc-role-clickable":""}`,onClick:C=>{C.stopPropagation(),t==="prerequisite"&&$(D=>!D)},title:t==="prerequisite"?"Click to see why this is a prerequisite":void 0,children:[t==="prerequisite"&&"üîó Prerequisite",t==="troubleshooting"&&"üîß Troubleshooting",t==="supplemental"&&"üìö Supplemental"]}),E&&t==="prerequisite"&&e.jsxs("div",{className:"vrc-prereq-tooltip",children:[e.jsx("strong",{children:"Prerequisite Course"}),T.length>0?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"Watch these first:"}),e.jsx("ul",{className:"vrc-prereq-list",children:T.map(C=>e.jsxs("li",{children:["üìò ",gs[C]||C,m?.reasons?.[C]&&e.jsxs("span",{className:"vrc-prereq-why",children:[" ‚Äî ",m.reasons[C]]})]},C))})]}):e.jsx("p",{children:"Watch this first ‚Äî it covers foundational concepts needed before advancing."}),l&&e.jsx("p",{className:"vrc-tip-reason",children:l})]})]}),d&&at(d)&&e.jsx("span",{className:"vrc-ue4-badge",title:"This content was created for Unreal Engine 4 ‚Äî some details may differ in UE5",children:"‚ö†Ô∏è UE4"})]}),e.jsxs("div",{className:"vrc-info",children:[e.jsx("h4",{className:"vrc-title",children:O}),y&&y!=="‚ñ∂ Watch full video"&&e.jsx("p",{className:"vrc-timestamp-hint",children:y}),f&&e.jsx("p",{className:"vrc-match-reason",children:f})]}),e.jsxs("div",{className:"vrc-actions",children:[e.jsxs("div",{className:"vrc-feedback",children:[e.jsx("button",{className:`vrc-fb-btn ${k==="up"?"active-up":""}`,onClick:Y,"aria-label":"Helpful",title:"This was helpful",children:e.jsx("span",{className:"vrc-fb-emoji",children:"üëç"})}),e.jsx("button",{className:`vrc-fb-btn ${k==="down"?"active-down":""}`,onClick:_,"aria-label":"Not helpful",title:"Not relevant",children:e.jsx("span",{className:"vrc-fb-emoji",children:"üëé"})})]}),e.jsx("button",{className:`vrc-add-btn ${n?"vrc-added":""}`,onClick:C=>{C.stopPropagation(),a(s)},"aria-label":n?"Remove from playlist":"Add to playlist",children:n?e.jsxs(e.Fragment,{children:[e.jsx(Gs,{size:14})," Added"]}):e.jsxs(e.Fragment,{children:[e.jsx(Os,{size:14})," Add"]})})]})]})})}Ue.propTypes={video:h.shape({driveId:h.string,title:h.string.isRequired,courseName:h.string,duration:h.number,matchedTags:h.arrayOf(h.string),courseCode:h.string,topSegments:h.array,docLinks:h.array,_curatedMatch:h.bool,role:h.oneOf(["prerequisite","core","troubleshooting","supplemental"]),reason:h.string,estimatedMinutes:h.number}).isRequired,isAdded:h.bool,onToggle:h.func.isRequired,userQuery:h.string};function as(s){const n=Math.round(s/60);if(n<1)return"<1 min";if(n>=60){const a=Math.floor(n/60),i=n%60;return i>0?`${a}h ${i}m`:`${a}h`}return`${n} min`}const ot={video:"üì∫",doc:"üìñ",youtube:"‚ñ∂Ô∏è"};function xs({cart:s,onRemove:n,onClear:a,onWatchPath:i}){const u=s.reduce((t,l)=>t+(l.duration||(l.readTimeMinutes||l.durationMinutes||0)*60),0),o=s.filter(t=>(t.type||"video")==="video").length,r=s.filter(t=>t.type==="doc").length,d=s.filter(t=>t.type==="youtube").length,c=[];return o>0&&c.push(`${o} video${o!==1?"s":""}`),r>0&&c.push(`${r} doc${r!==1?"s":""}`),d>0&&c.push(`${d} YT`),e.jsxs("div",{className:"cart-panel",children:[e.jsxs("div",{className:"cart-header",children:[e.jsx("h3",{className:"cart-title",children:"üõí My Learning Path"}),s.length>0&&e.jsx("button",{className:"cart-clear-btn",onClick:a,title:"Clear all",children:"Clear"})]}),s.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cart-stats",children:[e.jsx("span",{className:"cart-stat-count",children:c.join(" ¬∑ ")}),e.jsx("span",{className:"cart-stat-dot",children:"¬∑"}),e.jsx("span",{className:"cart-stat-time",children:as(u)})]}),u>28800&&e.jsx("div",{className:"cart-warning",children:"‚ö†Ô∏è That's over 8 hours of content ‚Äî consider narrowing your focus to the most relevant items."}),e.jsx("div",{className:"cart-items",children:s.map((t,l)=>{const x=t.itemId||t.driveId||l,f=t.type||"video",y=ot[f]||"üì∫",v=f==="video"?Te(t.title):t.title,b=t.duration>0?as(t.duration):t.readTimeMinutes?`${t.readTimeMinutes} min read`:t.durationMinutes?`${t.durationMinutes} min`:null;return e.jsxs("div",{className:`cart-item cart-item-${f}`,children:[e.jsx("span",{className:"cart-item-num",children:l+1}),e.jsx("span",{className:"cart-item-icon",title:f,children:y}),e.jsxs("div",{className:"cart-item-info",children:[e.jsx("span",{className:"cart-item-title",children:v}),b&&e.jsx("span",{className:"cart-item-dur",children:b})]}),e.jsx("button",{className:"cart-item-remove",onClick:()=>n(x),"aria-label":`Remove ${t.title}`,children:"√ó"})]},x)})}),e.jsx("button",{className:"cart-watch-btn",onClick:i,children:"‚ñ∂ Watch Path"})]}):e.jsxs("div",{className:"cart-empty",children:[e.jsx("span",{className:"cart-empty-icon",children:"üì∫"}),e.jsx("p",{children:"Add videos, docs, and resources to build your learning path"})]})]})}xs.propTypes={cart:h.arrayOf(h.shape({itemId:h.string,driveId:h.string,type:h.oneOf(["video","doc","youtube"]),title:h.string.isRequired,duration:h.number,readTimeMinutes:h.number,durationMinutes:h.number})).isRequired,onRemove:h.func.isRequired,onClear:h.func.isRequired,onWatchPath:h.func.isRequired};const ys="ue5_video_cart";function ct(){try{const s=localStorage.getItem(ys);return s?JSON.parse(s):[]}catch{return[]}}function Me(s){try{localStorage.setItem(ys,JSON.stringify(s))}catch{}}function _e(s){return s.itemId||s.driveId||s.id||`${s.type}_${s.url}`}function lt(){const[s,n]=N.useState(ct),a=N.useCallback(t=>{n(l=>{const x=_e(t);if(l.some(v=>_e(v)===x))return l;const f={...t,itemId:x,type:t.type||"video"},y=[...l,f];return Me(y),y})},[]),i=N.useCallback(t=>{n(l=>{const x=l.filter(f=>_e(f)!==t&&f.driveId!==t);return Me(x),x})},[]),u=N.useCallback(()=>{n([]),Me([])},[]),o=N.useCallback(t=>s.some(l=>_e(l)===t||l.driveId===t),[s]),r=s.filter(t=>(t.type||"video")==="video").length,d=N.useMemo(()=>s.reduce((t,l)=>t+(l.duration||(l.readTimeMinutes||l.durationMinutes||0)*60),0),[s]),c=N.useMemo(()=>{const t={video:[],doc:[],youtube:[]};for(const l of s){const x=l.type||"video";(t[x]||t.video).push(l)}return t},[s]);return{cart:s,addToCart:a,removeFromCart:i,clearCart:u,isInCart:o,videoCount:r,totalDuration:d,itemsByType:c}}let Ee=null;async function dt(){if(!Ee){const s=await xe(()=>import("./data-embeddings-EsTyY_EC.js"),[]);Ee=s.default||s}return Ee}function Ve(s,n){if(!s||!n||s.length!==n.length)return 0;let a=0,i=0,u=0;for(let r=0;r<s.length;r++)a+=s[r]*n[r],i+=s[r]*s[r],u+=n[r]*n[r];const o=Math.sqrt(i)*Math.sqrt(u);return o===0?0:a/o}async function ut(s,n=5,a=.3){const i=await dt();if(!s||!i?.courses)return[];const u=[];for(const[o,r]of Object.entries(i.courses)){const d=Ve(s,r.embedding);d>=a&&u.push({code:o,title:r.title,similarity:d})}return u.sort((o,r)=>r.similarity-o.similarity),u.slice(0,n)}let Le=null,$e=null;async function ht(){if(!Le){const s=await xe(()=>import("./data-search-SjqZFhcO.js").then(n=>n.s),[]);Le=s.default||s}return Le}async function Be(){if(!$e){const s=await xe(()=>import("./data-search-SjqZFhcO.js").then(n=>n.a),[]);$e=s.default||s}return $e}let Ae=null,ge=null;function mt(s,n=768){const a=atob(s),i=new Uint8Array(a.length);for(let r=0;r<a.length;r++)i[r]=a.charCodeAt(r);const u=new DataView(i.buffer),o=new Float32Array(n);for(let r=0;r<n;r++){const d=u.getUint16(r*2,!0);o[r]=pt(d)}return o}function pt(s){const n=s>>15&1,a=s>>10&31,i=s&1023;return a===0?(n?-1:1)*Math.pow(2,-14)*(i/1024):a===31?i?NaN:n?-1/0:1/0:(n?-1:1)*Math.pow(2,a-15)*(1+i/1024)}async function gt(){if(ge)return ge;if(!Ae)try{const n=await fetch(new URL("../data/segment_embeddings.json",import.meta.url));if(!n.ok)throw new Error(`HTTP ${n.status}`);Ae=await n.json()}catch(n){return re("‚ö†Ô∏è segment_embeddings.json not available:",n.message),null}const s=Ae?.segments;if(!s)return null;ge=new Map;for(const[n,a]of Object.entries(s))ge.set(n,{vector:mt(a.embedding),courseCode:a.course_code,videoKey:a.video_key,videoTitle:a.video_title,startTimestamp:a.start_timestamp,endTimestamp:a.end_timestamp,startSeconds:a.start_seconds,text:a.text,tokenEstimate:a.token_estimate});return G(`[SegmentSearch] Decoded ${ge.size} segment embeddings`),ge}async function vs(s,n=[]){if(!s||s.length<3)return[];const a=s.toLowerCase().split(/\s+/).filter(r=>r.length>2&&!ke.has(r));if(a.length===0)return[];const i=await ht(),u=[],o=i?.course_words||{};for(const[r,d]of Object.entries(o)){let c=0;const t=[];for(const l of a)if(d[l]&&(c+=d[l]*10,t.push(l)),l.length>=4)for(const[x,f]of Object.entries(d))x!==l&&x.length>=4&&(x.startsWith(l)||l.startsWith(x))&&(c+=f*3,t.includes(x)||t.push(x));if(c>=30&&t.length>0){const l=n.find(f=>f.code===r),x=await ft(r,t);u.push({courseCode:r,courseTitle:l?.title||r,score:c,matchedKeywords:t,topSegments:x,estimatedSegment:x.length>0?x[0]:null,videoCount:l?.video_count||0,duration:l?.duration_formatted||"Unknown"})}}return u.sort((r,d)=>d.score-r.score).slice(0,5)}async function ft(s,n){const i=(await Be())[s];if(!i||!i.videos)return[];const u=[];for(const[o,r]of Object.entries(i.videos))if(r.segments)for(const d of r.segments){const c=d.text.toLowerCase();let t=0;const l=[];for(const x of n){const f=x.toLowerCase(),y=new RegExp(f.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi"),v=c.match(y);v&&(t+=v.length*10,l.push(x)),c.includes(f)&&(t+=5,l.includes(x)||l.push(x))}if(t>0){let x=d.text;if(x.length>120){const f=l[0]||"",y=x.toLowerCase().indexOf(f.toLowerCase());y>40&&(x="..."+x.substring(y-30)),x.length>120&&(x=x.substring(0,117)+"...")}u.push({videoKey:o,videoTitle:r.title,timestamp:d.start,startSeconds:d.start_seconds,endTimestamp:d.end,previewText:x,matchedKeywords:l,score:t})}}return u.sort((o,r)=>r.score-o.score).slice(0,3)}async function xt(s,n=10,a=.35){if(!s)return[];const i=await gt();if(!i)return[];const u=[];for(const[o,r]of i){const d=Ve(s,r.vector);d>=a&&u.push({id:o,courseCode:r.courseCode,videoKey:r.videoKey,videoTitle:r.videoTitle,timestamp:r.startTimestamp,endTimestamp:r.endTimestamp,startSeconds:r.startSeconds,previewText:r.text,similarity:d,source:"transcript"})}return u.sort((o,r)=>r.similarity-o.similarity),u.slice(0,n)}async function yt(s,n,a=[],i=8){const u=await vs(s,a);let o=[];n&&(o=await xt(n,i,.35));const r=new Set,d=[];for(const c of o){const t=`${c.courseCode}:${c.videoKey}:${c.timestamp}`;r.has(t)||(r.add(t),d.push({...c,searchType:"semantic",score:Math.round(c.similarity*100)}))}for(const c of u)for(const t of c.topSegments||[]){const l=`${c.courseCode}:${t.videoKey}:${t.timestamp}`;r.has(l)||(r.add(l),d.push({id:`kw_${c.courseCode}_${t.videoKey}`,courseCode:c.courseCode,videoKey:t.videoKey,videoTitle:t.videoTitle,timestamp:t.timestamp,startSeconds:t.startSeconds,previewText:t.previewText,similarity:0,score:t.score,searchType:"keyword",source:"transcript"}))}return d.slice(0,i)}const vt=60,bt=new Set(["rendering.lumen","rendering.nanite","rendering.virtualShadowMaps","rendering.substrate","worldbuilding.worldPartition"]);function ve(s){return!!(s.videos?.length&&s.videos[0]?.drive_id||s.source==="youtube"&&s.youtube_url||s.source==="epic_docs")}function jt(s){const n=(s||"").toLowerCase();return/\bue\s*5\b|\bunreal\s*engine\s*5\b|\b5\.\d\b/.test(n)?5:/\bue\s*4\b|\bunreal\s*engine\s*4\b|\b4\.\d{1,2}\b/.test(n)?4:null}async function is(s,n,a=[],i="",u=[]){if(!n||n.length===0)return[];const o=s?.userQuery||"",r=o.toLowerCase();for(const g of Bs)if(g.patterns.some(S=>r.includes(S))){const S=g.courses.map(L=>{const W=n.find(ae=>ae.code===L);return!W||!ve(W)?null:{...W,_relevanceScore:200,_curatedMatch:!0,_curatedExplanation:g.explanation}}).filter(Boolean);if(S.length>0)return G("‚úÖ Curated solution match:",g.explanation),S}const d=`${o} ${i}`.trim(),c=pe.matchErrorSignature(d),t=c.map(g=>g.tag.tag_id),l=[...new Set([...a,...t])];c.length>0&&G("üîç Error signatures detected:",c.map(g=>`${g.tag.display_name} (${g.matchedSignature}, ${g.confidence})`));const x=pe.extractTagsFromText(o),f=x.matchedTagIds||[];if(f.length>0){G("üè∑Ô∏è Tag taxonomy matches:",x.matches.map(g=>`${g.tagId} (via "${g.matchedTerm}", ${g.matchType})`));for(const g of f)l.includes(g)||l.push(g)}const y=i.toLowerCase().split(/[\s\n:;,()[\]{}]+/).filter(g=>g.length>3&&!/^[0-9]+$/.test(g)).slice(0,10),v=o.toLowerCase().split(/\s+/).filter(g=>g.length>2&&!ke.has(g)),b=new Set(v),O=o.toLowerCase();for(const[g,w]of Object.entries(zs))if(O.includes(g))for(const S of w)S.split(/\s+/).forEach(L=>{L.length>2&&!ke.has(L)&&b.add(L)});const m=[...b],T=async g=>!g||g.length<5?[]:(await vs(g,n)).map(S=>{const L=n.find(W=>W.code===S.courseCode);return!L||!ve(L)?null:{...L,_relevanceScore:S.score,_matchedKeywords:S.matchedKeywords}}).filter(Boolean),k=g=>g.length===0?[]:n.filter(ve).map(S=>{const L=(S.title||"").toLowerCase(),W=(S.description||"").toLowerCase(),ae=[...S.canonical_tags||[],...S.gemini_system_tags||[],...S.extracted_tags||[],...S.ai_tags||[]].map(z=>typeof z=="string"?z.toLowerCase():"").join(" ");let j=0;const M=[];for(const z of g)L.includes(z)?(j+=50,M.push(z)):ae.includes(z)?(j+=30,M.push(z)):W.includes(z)&&(j+=10,M.push(z));if(f.length>0){const z=(S.canonical_tags||[]).map(ee=>ee.toLowerCase());f.some(ee=>z.some(de=>de.includes(ee.split(".").pop())))&&(j*=3)}const J=new Set(M).size;J>=2&&(j*=1+J*.3);const X=g.length>0?J/g.length:1;return g.length>=2&&X<.5?j*=.3:X>=1&&(j*=2),j===0?null:{...S,_relevanceScore:j,_matchedKeywords:M}}).filter(Boolean).sort((S,L)=>L._relevanceScore-S._relevanceScore),I=g=>l.length===0?g:g.map(w=>{const S=w.extracted_tags||w.tags||[],ae=(Array.isArray(S)?S:Object.values(S)).map(j=>typeof j=="string"?j:j.tag_id||j.name||"").filter(Boolean).some(j=>l.some(M=>j.toLowerCase().includes(M.toLowerCase())||M.toLowerCase().includes(j.toLowerCase())));return{...w,_relevanceScore:ae?w._relevanceScore*2:w._relevanceScore*.5}}).sort((w,S)=>S._relevanceScore-w._relevanceScore),E=y.length>0?`${o} ${y.join(" ")}`:o,$=await T(E),Q=y.length>0?[...m,...y]:m,K=k(Q),Y=new Set,_=[];for(const g of $)Y.has(g.code)||(_.push(g),Y.add(g.code));for(const g of K)if(!Y.has(g.code))_.push(g),Y.add(g.code);else{const w=_.find(S=>S.code===g.code);w&&(w._relevanceScore+=g._relevanceScore)}const C=(_.length>0?_[0]._relevanceScore:0)>=vt;if(u.length>0){const g=C?60:100,w=C?20:40;for(const S of u)if(Y.has(S.code)){const L=_.find(W=>W.code===S.code);L&&(L._relevanceScore+=S.similarity*w)}else{const L=n.find(W=>W.code===S.code);L&&ve(L)&&(_.push({...L,_relevanceScore:S.similarity*g,_matchedKeywords:["semantic-match"],_semanticMatch:!0,_tier:C?2:1}),Y.add(S.code))}}_.sort((g,w)=>w._relevanceScore-g._relevanceScore);const D=I(_);if(D.length>=3)return Oe(D.slice(0,5),o);const B=[E,s?.diagnosis?.problem_summary,...s?.intent?.systems||[]].filter(Boolean).join(" "),ne=B.toLowerCase().split(/\s+/).filter(g=>g.length>2&&!ke.has(g)),le=await T(B),ie=k(ne);for(const g of[...le,...ie])Y.has(g.code)||(_.push(g),Y.add(g.code));_.sort((g,w)=>w._relevanceScore-g._relevanceScore);const H=I(_);if(H.length>=3)return Oe(H.slice(0,5),o);const p=n.map(g=>{const w=pe.scoreCourseRelevance(g,Q);return{...g,_relevanceScore:w.score,_scoreBreakdown:w.breakdown,_topContributors:w.topContributors}}).filter(g=>g._relevanceScore>0&&ve(g)).sort((g,w)=>w._relevanceScore-g._relevanceScore).slice(0,5);return Oe(I(p),o)}function Oe(s,n){const a=jt(n);return a?s.map(i=>{const o=[...i.canonical_tags||[],...i.gemini_system_tags||[],...i.extracted_tags||[]].map(r=>typeof r=="string"?r.toLowerCase():"").some(r=>[...bt].some(d=>r.includes(d.split(".").pop())));return a===4&&o?(G(`‚¨áÔ∏è UE4 demotion: ${i.code} (has UE5-only tags)`),{...i,_relevanceScore:i._relevanceScore*.2}):a===5&&o?{...i,_relevanceScore:i._relevanceScore*1.5}:i}).sort((i,u)=>u._relevanceScore-i._relevanceScore):s}let Pe=null;async function _t(){if(!Pe){const s=await xe(()=>import("./data-courses-Y_tFOtPD.js").then(n=>n.j),[]);Pe=s.default||s}return Pe}const qe=new Set(["help","helpful","helps","use","used","using","make","made","get","getting","look","going","come","know","thing","work","working","want","need","show","start","take","right","well"]);function os(s){return s.replace(/ies$/i,"y").replace(/ves$/i,"f").replace(/(s|es|ing|ed|tion|ment)$/i,"").toLowerCase()}function Nt(s,n){const i=n.replace(/[-_]/g," ").split(/\s+/).filter(o=>o.length>2).map(os);return s.map(os).some(o=>i.some(r=>o.includes(r)||r.includes(o)))}async function cs(s,n,a={}){const i=[],u=(n||"").toLowerCase().split(/\s+/).filter(m=>m.length>2),o=await _t(),r=[],d=(n||"").toLowerCase(),c=d.split(/\s+/).filter(m=>m.length>2);for(const[m,T]of Object.entries(o))(d.includes(m)||Nt(c,m))&&r.push({label:T.label,url:T.url});for(const m of s){if(m.source==="youtube"&&m.youtube_url){const k=a[m.code]||{},I=(()=>{const E=(m._matchedKeywords||[]).filter($=>$.length>3&&!qe.has($.toLowerCase())).slice(0,3);return E.length>0?E:[m.topic||m.tags?.topic||"UE5"].flat().slice(0,3)})();i.push({driveId:m.youtube_url,title:Te(m.title||m.code),duration:m.duration_seconds||0,courseCode:m.code,courseName:m.title||m.code,matchedTags:I,videoIndex:0,relevanceScore:m._relevanceScore||0,titleRelevance:0,isIntro:!1,timestampHint:null,startSeconds:0,topSegments:[],watchHint:"‚ñ∂ Watch on YouTube",docLinks:r,_curatedMatch:m._curatedMatch||!1,_curatedExplanation:m._curatedExplanation||null,role:k.role||null,reason:k.reason||null,estimatedMinutes:k.estimatedMinutes||null,_source:"youtube",_externalUrl:m.youtube_url,type:"youtube",url:m.youtube_url,channel:m.channel_name||m.channel||null,channelTrust:m.channel_trust||null,topics:m.topics||[],description:m.description||"",durationMinutes:m.duration_seconds?Math.round(m.duration_seconds/60):10});continue}if(m.source==="epic_docs"){const k=m.url||m.youtube_url||"#",I=a[m.code]||{},E=(()=>{const $=(m._matchedKeywords||[]).filter(Q=>Q.length>3&&!qe.has(Q.toLowerCase())).slice(0,3);return $.length>0?$:[m.topic||m.tags?.topic||"UE5"].flat().slice(0,3)})();i.push({driveId:`doc_${m.code}`,title:Te(m.title||m.code),duration:0,courseCode:m.code,courseName:m.title||m.code,matchedTags:E,videoIndex:0,relevanceScore:m._relevanceScore||0,titleRelevance:0,isIntro:!1,timestampHint:null,startSeconds:0,topSegments:[],watchHint:"üìñ Read Epic Docs",docLinks:[{label:m.title||"Epic Docs",url:k},...r],_curatedMatch:m._curatedMatch||!1,_curatedExplanation:m._curatedExplanation||null,role:I.role||null,reason:I.reason||null,estimatedMinutes:I.estimatedMinutes||null,_source:"epic_docs",_externalUrl:k,type:"doc",url:k,topics:m.topics||[],description:m.description||"",readTimeMinutes:10});continue}const T=m.videos||[];if(T.length!==0)for(let k=0;k<T.length;k++){const I=T[k];if(!I.drive_id)continue;const E=I.title||I.name||`Video ${k+1}`,$=E.toLowerCase(),Q=Te(E),K=u.filter(Z=>$.includes(Z)).length,Y=K*50,_=await wt(m.code,E,k),R=await St(m.code,_,u),C=$.includes("intro")||$.includes("introduction")||$.includes("wrap up")||$.includes("outro")||$.includes("overview")||$.includes("getting started")||$.includes("welcome")||$.includes("course intro")||$.includes("what you'll learn")||$.includes("what we'll cover")||$.includes("summary")||$.includes("objectives")||/\bpart\s*a\b/i.test(E)&&k===0,D=C?.15:1,U=!C&&R.topSegments&&R.topSegments.length>0?15:0,B=I.duration_seconds||I.durationSeconds||0,ne=B/60,le=ne<2?.4:ne<5?.7:ne>20?1.1:1,ie=new Set;for(const Z of R.topSegments||[])for(const ee of Z.matchedKeywords||[])ie.add(ee);const H=ie.size,be=K>=2||K===1&&H>=1?1:H>=2?.8:H===1?.3:K===1?.5:.15,p=(m._relevanceScore||0)*be,g=(Y+R.score+U+p)*D*le,S=K===0&&R.score<30?Math.min(g,40):g,L=Us(I.drive_id,S);let W="‚ñ∂ Watch full video";const j=(R.topSegments||[]).filter(Z=>!B||Z.startSeconds<=B)[0]||(R.bestSegment&&(!B||R.bestSegment.startSeconds<=B)?R.bestSegment:null);if(j){const Z=j.timestamp||"0:00",ee=j.previewText,de=ee.length>60?ee.substring(0,57)+"...":ee;W=j.startSeconds<5?`üìç Start of video ‚Äî "${de}"`:`üìç Jump to ${Z} ‚Äî "${de}"`}const M=a[m.code]||{},J=(()=>{const Z=(m._matchedKeywords||[]).filter(ee=>ee.length>3&&!qe.has(ee.toLowerCase())).slice(0,3);return Z.length>0?Z:[m.topic||m.tags?.topic||"UE5"].flat().slice(0,3)})(),X=R.bestSegment?.startSeconds||0,z=B&&X>B?0:X;i.push({driveId:I.drive_id,title:Q,duration:I.duration_seconds||0,courseCode:m.code,courseName:m.title||m.code,matchedTags:J,videoIndex:k,relevanceScore:L,titleRelevance:K,isIntro:C,timestampHint:z>0&&R.bestSegment?.timestamp||null,startSeconds:z,topSegments:R.topSegments||[],watchHint:W,docLinks:r,_curatedMatch:m._curatedMatch||!1,_curatedExplanation:m._curatedExplanation||null,role:M.role||null,reason:M.reason||null,estimatedMinutes:M.estimatedMinutes||null})}}const t=new Map;for(const m of i){const T=t.get(m.driveId);(!T||m.relevanceScore>T.relevanceScore)&&t.set(m.driveId,m)}const l=Array.from(t.values());l.sort((m,T)=>T.relevanceScore-m.relevanceScore);const x=new Map,f=2,y=l.filter(m=>{const T=x.get(m.courseCode)||0;return T>=f?!1:(x.set(m.courseCode,T+1),!0)}),v=new Set;for(const m of y)m.isIntro||v.add(m.courseCode);const b=y.filter(m=>!(m.isIntro&&v.has(m.courseCode)));if(b.length>3){const m=b.map(E=>E.relevanceScore),T=m[Math.floor(m.length/2)],k=Math.max(T*.5,10),I=b.filter(E=>E.relevanceScore>=k);if(I.length>=3){const E=I.slice(0,6);return ls(E,u),E}}const O=b.slice(0,6);return ls(O,u),O}function ls(s,n){if(s.length===0)return;const a=Math.max(s[0].relevanceScore,1);for(const i of s){i.matchPercent=Math.min(100,Math.round(i.relevanceScore/a*100));const u=[];if(i._curatedMatch&&u.push("Known solution for this problem"),i.titleRelevance>0){const o=n.filter(r=>(i.title||"").toLowerCase().includes(r)).slice(0,3);o.length>0&&u.push(`Title matches: ${o.join(", ")}`)}if(i.topSegments.length>0){const o=new Set;for(const d of i.topSegments)for(const c of d.matchedKeywords||[])o.add(c);const r=[...o].slice(0,4);r.length>0&&u.push(`Transcript mentions: ${r.join(", ")}`)}i.matchedTags.length>0&&u.length<2&&u.push(`Tagged: ${i.matchedTags.slice(0,3).join(", ")}`),i.matchReason=u.length>0?u.join(" ¬∑ "):"Related to your query"}}async function wt(s,n,a){const u=(await Be())[s];if(!u?.videos)return null;const o=x=>(x||"").toLowerCase().replace(/\.mp4$/i,"").replace(/_/g," ").replace(/\s+/g," ").trim(),r=o(n),d=r.split(" ").filter(x=>x.length>2),c=Object.keys(u.videos);for(const x of c)if(o(u.videos[x].title||"")===r)return x;let t=null,l=0;for(const x of c){const f=o(u.videos[x].title||""),y=o(x),v=f+" "+y;let b=0;for(const O of d)new RegExp(`(^|\\s|_)${O.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&")}(\\s|_|$)`,"i").test(v)&&b++;b>0&&b>l&&(l=b,t=x)}if(t&&l>=Math.max(1,d.length*.5))return t;for(const x of c){const f=o(u.videos[x].title||""),y=o(x);if(r.includes(f)||f.includes(r)||r.includes(y)||y.includes(r))return x}return a<c.length?c[a]:c[0]||null}async function St(s,n,a){const i={score:0,bestSegment:null,topSegments:[]},o=(await Be())[s];if(!o?.videos||!n)return i;const r=o.videos[n];if(!r?.segments)return i;const d=[];for(const l of r.segments){const x=l.text.toLowerCase();let f=0;const y=[];for(const v of a)if(x.includes(v)){const b=x.split(v).length-1;f+=b*10,y.push(v)}if(f>0){let v=l.text;if(v.length>100){const b=v.toLowerCase().indexOf(y[0]||"");b>30&&(v="..."+v.substring(b-20)),v.length>100&&(v=v.substring(0,97)+"...")}d.push({timestamp:l.start,startSeconds:l.start_seconds,previewText:v,matchedKeywords:y,score:f})}}d.sort((l,x)=>x.score-l.score);const c=d.slice(0,3);return{score:d.reduce((l,x)=>l+x.score,0),bestSegment:c[0]||null,topSegments:c}}let De=null,fe=null;function Ct(s,n=768){const a=atob(s),i=new Uint8Array(a.length);for(let r=0;r<a.length;r++)i[r]=a.charCodeAt(r);const u=new DataView(i.buffer),o=new Float32Array(n);for(let r=0;r<n;r++){const d=u.getUint16(r*2,!0);o[r]=Tt(d)}return o}function Tt(s){const n=s>>15&1,a=s>>10&31,i=s&1023;return a===0?(n?-1:1)*Math.pow(2,-14)*(i/1024):a===31?i?NaN:n?-1/0:1/0:(n?-1:1)*Math.pow(2,a-15)*(1+i/1024)}async function kt(){if(fe)return fe;if(!De)try{const n=await fetch(new URL("../data/docs_embeddings.json",import.meta.url));if(!n.ok)throw new Error(`HTTP ${n.status}`);De=await n.json()}catch(n){return re("‚ö†Ô∏è docs_embeddings.json not available:",n.message),null}const s=De?.docs;if(!s)return null;fe=new Map;for(const[n,a]of Object.entries(s)){let i;if(typeof a.embedding=="string")i=Ct(a.embedding);else if(Array.isArray(a.embedding))i=new Float32Array(a.embedding);else{re(`[DocsSearch] Skipping doc ${n}: unknown embedding format (${typeof a.embedding})`);continue}fe.set(n,{vector:i,slug:a.slug,url:a.url,title:a.title,section:a.section,text:a.text,tokenEstimate:a.token_estimate})}return G(`[DocsSearch] Decoded ${fe.size} doc embeddings`),fe}async function It(s,n=5,a=.35){if(!s)return[];const i=await kt();if(!i)return[];const u=[];for(const[o,r]of i){const d=Ve(s,r.vector);d>=a&&u.push({id:o,slug:r.slug,url:r.url,title:r.title,section:r.section,previewText:r.text,similarity:d,source:"epic_docs"})}return u.sort((o,r)=>r.similarity-o.similarity),u.slice(0,n)}let Ne=null;async function bs(){if(Ne)return Ne;try{const s=await xe(()=>import("./data-courses-Y_tFOtPD.js").then(n=>n.j),[]);return Ne=s.default||s,Ne}catch(s){return re("‚ö†Ô∏è doc_links.json not available:",s.message),{}}}const we={beginner:0,intermediate:1,advanced:2};function ds(s){return s.replace(/ies$/i,"y").replace(/ves$/i,"f").replace(/(es|s|ing|ed|tion|ment)$/i,"").toLowerCase()}function Se(s,n){const a=s.split(/[\s_-]+/).filter(u=>u.length>2).map(ds),i=n.split(/[\s_-]+/).filter(u=>u.length>2).map(ds);return a.some(u=>i.some(o=>u===o||u.includes(o)||o.includes(u)))}async function js(s,{maxTier:n="advanced",limit:a=10}={}){const i=await bs();if(!i||!s?.length)return[];const u=we[n]??2,o=s.map(t=>t.toLowerCase()),r=[];for(const[t,l]of Object.entries(i)){if((we[l.tier]??1)>u)continue;let f=0;const y=t.toLowerCase(),v=(l.label||"").toLowerCase(),b=(l.url||"").split("/").pop().replace(/-/g," ").toLowerCase(),O=(l.tags||[]).map(k=>k.toLowerCase()),m=(l.description||"").toLowerCase();let T=0;for(const k of o){let I=!1;y===k?(f+=15,I=!0):y.includes(k)?(f+=8,I=!0):k.includes(y)?(f+=6,I=!0):l.subsystem===k?(f+=5,I=!0):v.includes(k)?(f+=6,I=!0):O.includes(k)?(f+=2,I=!0):O.some(E=>E.includes(k)||k.includes(E))?(f+=1,I=!0):b.includes(k)?(f+=2,I=!0):m.includes(k)?(f+=1,I=!0):Se(k,y)?(f+=4,I=!0):Se(k,v)?(f+=3,I=!0):(O.some(E=>Se(k,E))||Se(k,m))&&(f+=1,I=!0),I&&T++}T>=2&&(f+=T*5),f>0&&r.push({key:t,label:l.label,description:l.description||"",url:l.url,tier:l.tier,subsystem:l.subsystem,readTimeMinutes:l.readTimeMinutes||10,prerequisites:l.prerequisites||[],sections:l.sections||[],keySteps:l.keySteps||[],seeAlso:l.seeAlso||[],_score:f,source:"epic_docs"})}r.sort((t,l)=>l._score!==t._score?l._score-t._score:(we[t.tier]??1)-(we[l.tier]??1));const d=[];for(const t of r){const l=new Set(t.key.split(/[-_]+/).filter(f=>f.length>2));d.some(f=>{const y=new Set(f.key.split(/[-_]+/).filter(b=>b.length>2));return[...l].filter(b=>y.has(b)).length/Math.min(l.size,y.size)>.6})||d.push(t)}const c=d.length>0?d[0]._score:1;return d.slice(0,a).map(({_score:t,...l})=>({...l,_rawScore:t,matchScore:Math.round(t/Math.max(c,1)*100)}))}async function Rt(s,{limit:n=8}={}){const a=await bs();if(!a)return[];const i=await js(s,{limit:n*2});if(!i.length)return[];const u=new Map(i.map(t=>[t.key,t.matchScore??0])),o=new Map(i.map(t=>[t.key,t._rawScore??0])),r=new Set,d=[];function c(t){if(r.has(t))return;r.add(t);const l=a[t];if(l){for(const x of l.prerequisites||[])c(x);d.push({key:t,label:l.label,description:l.description||"",keySteps:l.keySteps||[],seeAlso:l.seeAlso||[],url:l.url,tier:l.tier,subsystem:l.subsystem,readTimeMinutes:l.readTimeMinutes||10,matchScore:u.get(t)??0,_rawScore:o.get(t)??0,source:"epic_docs"})}}for(const t of i)c(t.key);return d.sort((t,l)=>(l._rawScore??0)-(t._rawScore??0)),d.slice(0,n)}const us={prerequisite:0,core:1,troubleshooting:2,supplemental:3};function Mt(s){return s.estimated_minutes?s.estimated_minutes:s.total_duration_seconds?Math.round(s.total_duration_seconds/60):(s.videos?.length||1)*10}function hs(s,n){if(n.size===0)return 0;const a=new Set([...s.canonical_tags||[],...s.gemini_system_tags||[],...s.transcript_tags||[]].map(u=>typeof u=="string"?u.toLowerCase():""));if(a.size===0)return 0;let i=0;for(const u of a)(n.has(u)||n.has(u.split(".").pop()))&&i++;return i/a.size}function Et(s,n){const a=[...s.canonical_tags||[],...s.gemini_system_tags||[]].map(d=>typeof d=="string"?d.toLowerCase():""),i=new Set(n.map(d=>d.toLowerCase()));let u=!1;for(const d of a)if(i.has(d)||i.has(d.split(".").pop())){u=!0;break}const o=a.some(d=>{const c=pe.getTag(d);return c?.tag_type==="symptom"||c?.tag_type==="error_code"});let r=!1;for(const d of a){const c=pe.edgesBySource?.get(d)||[];for(const t of c)if(t.relation==="subtopic"&&i.has(t.target)){r=!0;break}if(r)break}return r?"prerequisite":o?"troubleshooting":u?"core":"supplemental"}function ms(s,n,a={}){const{timeBudgetMinutes:i=1/0,maxItems:u=8,preferTroubleshooting:o=!1,diversity:r=!0}=a;if(!s||s.length===0)return{path:[],metadata:{totalMinutes:0,tagCoverage:0,diversityScore:1,itemCount:0}};const d=s.map(b=>({course:b,role:Et(b,n),estimatedMinutes:Mt(b),score:b._relevanceScore||0}));d.sort((b,O)=>{const m=us[b.role]-us[O.role];return m!==0?m:O.score-b.score}),o&&d.sort((b,O)=>{const m=b.role==="troubleshooting"?0:1,T=O.role==="troubleshooting"?0:1;return m!==T?m-T:O.score-b.score});const c=[],t=new Set;let l=0;for(const b of d){if(c.length>=u)break;if(l+b.estimatedMinutes>i||r&&c.length>0&&hs(b.course,t)>.7)continue;const O=Lt(b,n);c.push({course:b.course,role:b.role,reason:O,estimatedMinutes:b.estimatedMinutes}),l+=b.estimatedMinutes,[...b.course.canonical_tags||[],...b.course.gemini_system_tags||[]].map(T=>typeof T=="string"?T.toLowerCase():"").forEach(T=>{t.add(T),t.add(T.split(".").pop())})}const x=new Set(n.map(b=>b.toLowerCase()));let f=0;for(const b of x)(t.has(b)||t.has(b.split(".").pop()))&&f++;const y=x.size>0?f/x.size:0;let v=1;if(c.length>1){let b=0;const O=new Set;for(const m of c)b+=hs(m.course,O),[...m.course.canonical_tags||[]].map(k=>k?.toLowerCase?.()||"").forEach(k=>O.add(k));v=1-b/c.length}return{path:c,metadata:{totalMinutes:l,tagCoverage:Math.round(y*100)/100,diversityScore:Math.round(v*100)/100,itemCount:c.length}}}function Lt(s,n){const{course:a,role:i}=s,u=[...a.canonical_tags||[],...a.gemini_system_tags||[]].map(d=>typeof d=="string"?d.toLowerCase():""),o=new Set(n.map(d=>d.toLowerCase())),r=u.filter(d=>o.has(d)||o.has(d.split(".").pop()));switch(i){case"prerequisite":return`Foundation course ‚Äî covers prerequisite concepts for ${r.slice(0,2).join(", ")}`;case"core":return`Directly covers: ${r.slice(0,3).join(", ")}`;case"troubleshooting":return"Troubleshooting guide ‚Äî addresses symptoms related to your query";case"supplemental":return"Related content ‚Äî expands on topics connected to your query";default:return"Relevant to your search"}}let me=null;async function _s(){if(me!=null)return me;try{const s=await xe(()=>import("./data-courses-Y_tFOtPD.js").then(n=>n.y),[]);return me=s.default||s,me}catch{return me={channels:{},resources:[]},me}}const Ce={beginner:0,intermediate:1,advanced:2};async function Ns(s,{maxTier:n="advanced",limit:a=5}={}){if(!s?.length)return[];const i=await _s();if(!i?.resources?.length)return[];const u=Ce[n]??2,o=new Set(s.map(c=>c.toLowerCase())),r=[];for(const c of i.resources){if((Ce[c.tier]??1)>u)continue;const l=(c.topics||[]).map(y=>y.toLowerCase()),x=(c.tag_ids||[]).map(y=>y.toLowerCase());let f=0;for(const y of l){o.has(y)&&(f+=5);for(const v of o)(y.includes(v)||v.includes(y))&&(f+=2)}for(const y of x){o.has(y)&&(f+=5);const v=y.split(".");for(const b of v)o.has(b)&&(f+=3)}if(f>0){const y=i.channels?.[c.channelKey];r.push({id:c.id,title:c.title,url:c.url,channelName:y?.name||"Unreal Engine",channelTrust:"official",tier:c.tier,durationMinutes:c.durationMinutes,topics:c.topics,tag_ids:c.tag_ids||[],description:c.description||"",keyTakeaways:c.keyTakeaways||[],chapters:c.chapters||[],source:"epic_youtube",_score:f})}}const d=/\b(ue\s*5|unreal\s*engine\s*5|5\.\d)/i;for(const c of r)c._isUE5=d.test(c.title)||(c.topics||[]).some(t=>d.test(t));return r.sort((c,t)=>c._isUE5!==t._isUE5?c._isUE5?-1:1:t._score!==c._score?t._score-c._score:(Ce[c.tier]??1)-(Ce[t.tier]??1)),r.slice(0,a).map(({_score:c,_isUE5:t,...l})=>l)}async function $t(s,{limit:n=5}={}){if(!s?.length)return[];const a=await _s();if(!a?.resources?.length)return[];const i=new Set(s.map(o=>o.toLowerCase())),u=[];for(const o of a.resources){const r=(o.tag_ids||[]).map(c=>c.toLowerCase());let d=0;for(const c of r)i.has(c)&&(d+=5);if(d>0){const c=a.channels?.[o.channelKey];u.push({id:o.id,title:o.title,url:o.url,channelName:c?.name||"Unreal Engine",channelTrust:"official",tier:o.tier,durationMinutes:o.durationMinutes,topics:o.topics,tag_ids:o.tag_ids||[],description:o.description||"",keyTakeaways:o.keyTakeaways||[],chapters:o.chapters||[],source:"epic_youtube",_score:d})}}return u.sort((o,r)=>r._score-o._score),u.slice(0,n).map(({_score:o,...r})=>r)}async function At(s,n=[]){if(!s?.length)return{topics:[],firstPartyVideos:0,docsArticles:0,youtubeResources:0,coverageScore:0,gaps:[]};const a=await js(s,{limit:10}),i=await Ns(s,{limit:10}),u={};for(const c of s){const t=c.toLowerCase(),l=n.filter(v=>{const b=(v.tags||[]).map(m=>m.toLowerCase()),O=(v.title||"").toLowerCase();return b.some(m=>m.includes(t))||O.includes(t)}).length,x=a.filter(v=>v.key?.toLowerCase().includes(t)||v.subsystem?.toLowerCase()===t||v.label?.toLowerCase().includes(t)).length,f=i.filter(v=>{const b=(v.topics||[]).some(m=>m.toLowerCase().includes(t)),O=(v.tag_ids||[]).some(m=>m.toLowerCase().includes(t));return b||O}).length,y=l+x+f;u[c]={firstPartyVideos:l,docsArticles:x,youtubeResources:f,total:y,covered:y>0}}const o=Object.values(u).filter(c=>c.covered).length,r=s.length>0?o/s.length:0,d=Object.entries(u).filter(([,c])=>!c.covered).map(([c])=>c);return{topics:s,topicCoverage:u,firstPartyVideos:n.length,docsArticles:a.length,youtubeResources:i.length,coverageScore:r,gaps:d}}async function Ot(s,n=[],{maxDocs:a=5,maxYoutube:i=3}={}){if(!s?.length)return{docs:[],youtube:[],totalTimeMinutes:0,coverageScore:0};const u=await Rt(s,{limit:a}),o=await Ns(s,{limit:i}),r=await $t(s,{limit:i}),d=new Set(o.map(y=>y.id)),c=[...o];for(const y of r)d.has(y.id)||(c.push(y),d.add(y.id));const t=n.reduce((y,v)=>y+(v.durationMinutes||10),0),l=u.reduce((y,v)=>y+(v.readTimeMinutes||10),0),x=c.reduce((y,v)=>y+(v.durationMinutes||15),0),f=await At(s,n);return{docs:u,youtube:c,totalTimeMinutes:t+l+x,coverageScore:f.coverageScore,gaps:f.gaps,externalEnabled:!0}}const ze={QUERY_SUBMITTED:"query_submitted",DIAGNOSIS_GENERATED:"diagnosis_generated",LEARNING_PATH_GENERATED:"learning_path_generated"};let Fe=null;function Pt(){return Fe||(Fe=`session_${Date.now()}_${Math.random().toString(36).substring(2,9)}`),Fe}async function Ge(s,n={}){try{const a=ps(),i={event:s,session_id:Pt(),...n,timestamp:Is(),client_timestamp:new Date().toISOString()};await Rs(Ms(a,"analytics_events"),i)}catch(a){re("[Analytics] Failed to track event:",s,a.message)}}function qt(s,n=[],a=null){return Ge(ze.QUERY_SUBMITTED,{query_length:s?.length||0,query_preview:s?.substring(0,100),detected_tag_count:n.length,detected_tags:n.slice(0,5),persona_id:a})}function Dt(s){return Ge(ze.DIAGNOSIS_GENERATED,{diagnosis_id:s?.diagnosis_id,root_causes_count:s?.root_causes?.length||0,signals_count:s?.signals_to_watch_for?.length||0,generalization_scope:s?.generalization_scope?.slice(0,3)})}function Ft(s,n,a=!0){return Ge(ze.LEARNING_PATH_GENERATED,{fix_specific_count:s?.fix_specific?.length||0,transferable_count:s?.transferable?.length||0,course_count:n?.length||0,passed_validation:a})}function Ke({onUpdate:s,disabled:n}){const[a,i]=N.useState(!1),[u,o]=N.useState({engineVersion:"",platform:"",context:"",renderer:"",features:"",whatChangedRecently:"",goal:""}),r=N.useCallback((d,c)=>{const t={...u,[d]:c};o(t);const l={engineVersion:t.engineVersion.trim()||void 0,platform:t.platform.trim()||void 0,context:t.context.trim()||void 0,renderer:t.renderer.trim()||void 0,features:t.features?t.features.split(",").map(f=>f.trim()).filter(Boolean):[],whatChangedRecently:t.whatChangedRecently.trim()||void 0,goal:t.goal.trim()||void 0},x=Object.values(l).some(f=>f!==void 0&&(!Array.isArray(f)||f.length>0));s(x?l:null)},[u,s]);return e.jsxs("div",{className:"case-report-form",children:[e.jsxs("button",{type:"button",className:"case-report-toggle",onClick:()=>i(!a),disabled:n,children:[e.jsx("span",{className:"case-report-toggle-icon",children:a?"‚ñæ":"‚ñ∏"}),e.jsxs("span",{className:"case-report-toggle-label",children:["üîß Add Case Details",e.jsx("span",{className:"case-report-hint",children:"(improves diagnosis accuracy)"})]})]}),a&&e.jsxs("div",{className:"case-report-fields",children:[e.jsxs("div",{className:"case-report-row",children:[e.jsxs("div",{className:"case-report-field",children:[e.jsx("label",{children:"Engine Version"}),e.jsx("input",{type:"text",placeholder:"e.g. 5.4.1",value:u.engineVersion,onChange:d=>r("engineVersion",d.target.value),disabled:n,maxLength:20})]}),e.jsxs("div",{className:"case-report-field",children:[e.jsx("label",{children:"Platform"}),e.jsxs("select",{value:u.platform,onChange:d=>r("platform",d.target.value),disabled:n,children:[e.jsx("option",{value:"",children:"Select..."}),e.jsx("option",{value:"Windows",children:"Windows"}),e.jsx("option",{value:"macOS",children:"macOS"}),e.jsx("option",{value:"Linux",children:"Linux"}),e.jsx("option",{value:"Android",children:"Android"}),e.jsx("option",{value:"iOS",children:"iOS"}),e.jsx("option",{value:"Console",children:"Console"})]})]}),e.jsxs("div",{className:"case-report-field",children:[e.jsx("label",{children:"Renderer"}),e.jsxs("select",{value:u.renderer,onChange:d=>r("renderer",d.target.value),disabled:n,children:[e.jsx("option",{value:"",children:"Select..."}),e.jsx("option",{value:"Lumen",children:"Lumen"}),e.jsx("option",{value:"Nanite",children:"Nanite"}),e.jsx("option",{value:"Forward",children:"Forward Shading"}),e.jsx("option",{value:"Deferred",children:"Deferred"}),e.jsx("option",{value:"Mobile",children:"Mobile"}),e.jsx("option",{value:"PathTracing",children:"Path Tracing"})]})]})]}),e.jsxs("div",{className:"case-report-field case-report-full",children:[e.jsx("label",{children:"What changed recently?"}),e.jsx("input",{type:"text",placeholder:"e.g. Updated to 5.4, migrated project, changed lighting settings",value:u.whatChangedRecently,onChange:d=>r("whatChangedRecently",d.target.value),disabled:n,maxLength:300})]}),e.jsxs("div",{className:"case-report-field case-report-full",children:[e.jsx("label",{children:"What are you trying to achieve?"}),e.jsx("input",{type:"text",placeholder:"e.g. Realistic interior lighting, smooth character animation",value:u.goal,onChange:d=>r("goal",d.target.value),disabled:n,maxLength:200})]}),e.jsxs("div",{className:"case-report-field case-report-full",children:[e.jsx("label",{children:"Active Features (comma separated)"}),e.jsx("input",{type:"text",placeholder:"e.g. Lumen, Nanite, Virtual Shadow Maps, World Partition",value:u.features,onChange:d=>r("features",d.target.value),disabled:n,maxLength:200})]})]})]})}Ke.propTypes={onUpdate:h.func.isRequired,disabled:h.bool};Ke.defaultProps={disabled:!1};function He({question:s,options:n,whyAsking:a,onAnswer:i,onSkip:u,isLoading:o}){return e.jsxs("div",{className:"clarify-step",children:[e.jsxs("div",{className:"clarify-header",children:[e.jsx("span",{className:"clarify-icon",children:"ü§î"}),e.jsx("h3",{children:"Quick question before we diagnose"})]}),e.jsx("p",{className:"clarify-question",children:s}),e.jsx("div",{className:"clarify-options",children:(n||[]).map((r,d)=>e.jsxs("button",{className:"clarify-option-btn",onClick:()=>i(r),disabled:o,children:[e.jsx("span",{className:"clarify-option-letter",children:String.fromCharCode(65+d)}),e.jsx("span",{className:"clarify-option-text",children:r})]},d))}),a&&e.jsxs("p",{className:"clarify-why",children:[e.jsx("span",{className:"clarify-why-label",children:"Why we're asking:"})," ",a]}),e.jsx("button",{className:"clarify-skip-btn",onClick:u,disabled:o,children:"Skip ‚Äî just give me the best answer you can"})]})}He.propTypes={question:h.string.isRequired,options:h.arrayOf(h.string),whyAsking:h.string,onAnswer:h.func.isRequired,onSkip:h.func.isRequired,isLoading:h.bool};He.defaultProps={options:[],whyAsking:"",isLoading:!1};function Qe({evidence:s}){const[n,a]=N.useState(!1);return!s||s.length===0?null:e.jsxs("details",{className:"evidence-panel",open:n,onToggle:i=>a(i.target.open),children:[e.jsxs("summary",{className:"evidence-toggle",children:[e.jsx("span",{className:"evidence-icon",children:"üìé"}),"Sources (",s.length,")"]}),e.jsx("div",{className:"evidence-list",children:s.map((i,u)=>e.jsxs("div",{className:"evidence-item",children:[e.jsxs("div",{className:"evidence-item-header",children:[e.jsxs("span",{className:"evidence-ref",children:["[",u+1,"]"]}),e.jsx("span",{className:"evidence-source-badge",children:i.source==="transcript"?"üé¨ Transcript":"üìÑ Docs"}),i.videoTitle&&e.jsx("span",{className:"evidence-video-title",children:i.videoTitle}),i.timestamp&&e.jsxs("span",{className:"evidence-timestamp",children:["@ ",i.timestamp]})]}),e.jsx("p",{className:"evidence-text",children:i.text}),i.courseCode&&e.jsxs("span",{className:"evidence-course",children:["Course: ",i.courseCode]})]},u))})]})}Qe.propTypes={evidence:h.arrayOf(h.shape({text:h.string,source:h.string,courseCode:h.string,videoTitle:h.string,timestamp:h.string}))};Qe.defaultProps={evidence:[]};function Ye({onFeedback:s,isRerunning:n}){const[a,i]=N.useState("ask"),[u,o]=N.useState(""),r=N.useCallback(()=>{i("thanks"),s({solved:!0})},[s]),d=N.useCallback(()=>{i("no-reason")},[]),c=N.useCallback(()=>{s({solved:!1,reason:u.trim()}),i("thanks")},[s,u]);return a==="thanks"?e.jsxs("div",{className:"feedback-panel feedback-thanks",children:[e.jsx("span",{className:"feedback-icon",children:"‚úÖ"}),e.jsx("span",{children:"Thanks for the feedback!"}),n&&e.jsx("span",{className:"feedback-rerunning",children:"Re-analyzing with your feedback..."})]}):a==="no-reason"?e.jsxs("div",{className:"feedback-panel feedback-reason",children:[e.jsx("p",{className:"feedback-question",children:"What didn't work?"}),e.jsx("textarea",{className:"feedback-textarea",value:u,onChange:t=>o(t.target.value),placeholder:"e.g. I already tried that, the setting doesn't exist in my version, the issue is different...",maxLength:300,rows:2,disabled:n}),e.jsx("button",{className:"feedback-submit-btn",onClick:c,disabled:u.trim().length<5||n,children:n?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner"})," Re-analyzing..."]}):"Try a different approach ‚Üí"})]}):e.jsxs("div",{className:"feedback-panel feedback-ask",children:[e.jsx("p",{className:"feedback-question",children:"Did this solve your problem?"}),e.jsxs("div",{className:"feedback-buttons",children:[e.jsx("button",{className:"feedback-btn feedback-yes",onClick:r,children:"üëç Yes"}),e.jsx("button",{className:"feedback-btn feedback-no",onClick:d,children:"üëé No"})]})]})}Ye.propTypes={onFeedback:h.func.isRequired,isRerunning:h.bool};Ye.defaultProps={isRerunning:!1};function Je({answer:s,onFeedback:n,onBackToVideos:a,onStartOver:i,isRerunning:u}){const[o,r]=N.useState(!1);if(!s)return null;const d=s.confidence==="high"?"#10b981":s.confidence==="med"?"#f59e0b":"#ef4444";return e.jsxs("div",{className:"answer-view",children:[e.jsxs("div",{className:"answer-header",children:[e.jsxs("h2",{className:"answer-title",children:[e.jsx("span",{className:"answer-icon",children:"üéØ"})," Most Likely Cause"]}),e.jsxs("span",{className:"answer-confidence-badge",style:{background:`${d}22`,color:d,border:`1px solid ${d}44`},children:[s.confidence," confidence"]})]}),e.jsx("p",{className:"answer-cause",children:s.mostLikelyCause}),s.fastChecks?.length>0&&e.jsxs("div",{className:"answer-section answer-fast-checks",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"section-icon",children:"‚ö°"})," Quick Checks"]}),e.jsx("ul",{children:s.fastChecks.map((c,t)=>e.jsxs("li",{children:[e.jsx("span",{className:"check-number",children:t+1}),e.jsx("span",{children:c})]},t))})]}),s.fixSteps?.length>0&&e.jsxs("div",{className:"answer-section answer-fix-steps",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"section-icon",children:"üîß"})," Fix Steps"]}),e.jsx("ol",{children:s.fixSteps.map((c,t)=>e.jsx("li",{children:c},t))})]}),s.ifStillBrokenBranches?.length>0&&e.jsxs("div",{className:"answer-section answer-branches",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"section-icon",children:"üîÄ"})," If Still Broken"]}),e.jsx("div",{className:"branch-list",children:s.ifStillBrokenBranches.map((c,t)=>e.jsxs("div",{className:"branch-item",children:[e.jsxs("span",{className:"branch-condition",children:["If ",c.condition,":"]}),e.jsx("span",{className:"branch-action",children:c.action})]},t))})]}),s.learnPath&&e.jsxs("details",{className:"answer-section answer-learn-path",open:o,onToggle:c=>r(c.target.open),children:[e.jsxs("summary",{children:[e.jsx("span",{className:"section-icon",children:"üìö"})," Learn More",e.jsxs("span",{className:"learn-path-badge",children:[s.learnPath.topicsCovered?.length||0," topics"]})]}),e.jsxs("div",{className:"learn-path-content",children:[e.jsx("p",{className:"learn-path-summary",children:s.learnPath.pathSummary}),s.learnPath.objectives&&e.jsxs("div",{className:"learn-path-objectives",children:[s.learnPath.objectives.fixSpecific?.length>0&&e.jsxs("div",{children:[e.jsx("h4",{children:"üéØ Fix-Specific"}),e.jsx("ul",{children:s.learnPath.objectives.fixSpecific.map((c,t)=>e.jsx("li",{children:c},t))})]}),s.learnPath.objectives.transferable?.length>0&&e.jsxs("div",{children:[e.jsx("h4",{children:"üîÑ Transferable Skills"}),e.jsx("ul",{children:s.learnPath.objectives.transferable.map((c,t)=>e.jsx("li",{children:c},t))})]})]})]})]}),s.whyThisResult?.length>0&&e.jsxs("div",{className:"answer-section answer-reasoning",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"section-icon",children:"üí°"})," Why This Result"]}),e.jsx("ul",{className:"reasoning-list",children:s.whyThisResult.map((c,t)=>e.jsx("li",{children:c},t))})]}),e.jsx(Qe,{evidence:s.evidence}),e.jsxs("div",{className:"answer-actions",children:[e.jsx("button",{className:"answer-action-btn primary",onClick:a,children:"üé¨ Browse Related Videos"}),e.jsx("button",{className:"answer-action-btn secondary",onClick:i,children:"‚Üê Ask Another Question"})]}),e.jsx(Ye,{onFeedback:n,isRerunning:u})]})}Je.propTypes={answer:h.shape({mostLikelyCause:h.string,confidence:h.oneOf(["high","med","low"]),fastChecks:h.arrayOf(h.string),fixSteps:h.arrayOf(h.string),ifStillBrokenBranches:h.arrayOf(h.shape({condition:h.string,action:h.string})),learnPath:h.shape({pathSummary:h.string,topicsCovered:h.arrayOf(h.string),objectives:h.shape({fixSpecific:h.arrayOf(h.string),transferable:h.arrayOf(h.string)})}),whyThisResult:h.arrayOf(h.string),evidence:h.array}),onFeedback:h.func.isRequired,onBackToVideos:h.func.isRequired,onStartOver:h.func.isRequired,isRerunning:h.bool};Je.defaultProps={answer:null,isRerunning:!1};const V={INPUT:"input",LOADING:"loading",CLARIFYING:"clarifying",ANSWERED:"answered",DIAGNOSIS:"diagnosis",GUIDED:"guided",ERROR:"error"};function tn(){const[s,n]=N.useState(V.INPUT),[a,i]=N.useState(null),[u,o]=N.useState(null),[r,d]=N.useState(null),[c,t]=N.useState([]),[l,x]=N.useState(null),[f,y]=N.useState(null),[v,b]=N.useState(null),[O,m]=N.useState(!1),[T,k]=N.useState(null),{cart:I,addToCart:E,removeFromCart:$,clearCart:Q,isInCart:K}=lt(),Y=ks(),_=N.useMemo(()=>Y?.courses||[],[Y?.courses]),R=N.useCallback(()=>{try{const p=localStorage.getItem("detected_persona");return p?JSON.parse(p):null}catch{return null}},[]),C=N.useCallback(async(p,g)=>{Q(),n(V.LOADING),o(null),x(null),y(null),k(p);const w=g||v;p.pastedImage&&G("[ProblemFirst] Screenshot attached (base64 length):",p.pastedImage.length),p.errorLog&&G("[ProblemFirst] Error log attached:",p.errorLog.slice(0,200));try{if(p.cachedCartId){G(`[Cache] Checking Firestore for cart: ${p.cachedCartId}`);try{const F=ss(),P=ps(F),ue=Es(P,"adaptive_carts",p.cachedCartId),he=await Ls(ue);if(he.exists()){const se=he.data(),oe=se.cached_at?.toDate?.()||new Date(se.created_at||0),te=Date.now()-oe.getTime(),A=1440*60*1e3;if(te<A){G(`[Cache Hit] Cart is ${Math.round(te/6e4)}min old ‚Äî using cached result`);const q={...se,userQuery:p.query,retrievedPassages:[]},ce=await is(q,_,p.selectedTagIds||[],p.errorLog||"",[]);q.matchedCourses=ce;const Cs=[...q.diagnosis?.matched_tag_ids||[],...p.detectedTagIds||[],...p.selectedTagIds||[]],Ts=ms(ce,Cs,{preferTroubleshooting:!0,diversity:!0,timeBudgetMinutes:300}),es={};for(const je of Ts.path)es[je.course.code]={role:je.role,reason:je.reason,estimatedMinutes:je.estimatedMinutes};const Re=await cs(ce,p.query,es);if(Re.length>0){t(Re),i(q),n(V.DIAGNOSIS),G(`[Cache] Loaded ${Re.length} videos from cached cart ‚Äî 0 Gemini calls`);return}re("[Cache] Cached cart produced 0 videos ‚Äî falling through to fresh diagnosis")}else G(`[Cache Expired] Cart is ${Math.round(te/36e5)}h old ‚Äî refreshing`)}else G(`[Cache Miss] Cart ${p.cachedCartId} not found in Firestore`)}catch(F){re("[Cache Error] Falling through to fresh diagnosis:",F.message)}}await qt(p.query,p.detectedTagIds,R()?.id);const S=ss(),L=$s(S,"us-central1");let W=null,ae=[],j=[];try{const P=await ts(L,"embedQuery")({query:p.query});if(P.data?.success&&P.data?.embedding){W=P.data.embedding;const[ue,he,se]=await Promise.allSettled([ut(W,8,.35),yt(p.query,W,[],8),It(W,6,.35)]);if(ue.status==="fulfilled"?ae=ue.value:re("‚ö†Ô∏è Course semantic search failed:",ue.reason?.message),he.status==="fulfilled"){const te=he.value.map(A=>({text:A.previewText,courseCode:A.courseCode,videoTitle:A.videoTitle,timestamp:A.timestamp,similarity:A.similarity,source:"transcript"}));j.push(...te),G(`[RAG] ${te.length} transcript passages`)}else re("‚ö†Ô∏è Segment search failed:",he.reason?.message);if(se.status==="fulfilled"){const te=se.value.map(A=>({text:A.previewText,url:A.url,title:A.title,section:A.section,similarity:A.similarity,source:"epic_docs"}));j.push(...te),G(`[RAG] ${te.length} doc passages`)}else re("‚ö†Ô∏è Docs search failed:",se.reason?.message);j.sort((te,A)=>(A.similarity||0)-(te.similarity||0));const oe=new Set;j=j.filter(te=>{const A=(te.text||"").trim().toLowerCase().slice(0,120);return oe.has(A)?!1:(oe.add(A),!0)}),G(`[RAG] Total: ${j.length} passages after rank+dedup (parallel)`)}}catch(F){re("‚ö†Ô∏è Semantic search skipped:",F.message)}let M,J=!0;try{const P=await ts(L,"queryLearningPath")({query:p.query,mode:"problem-first",detectedTagIds:p.detectedTagIds,personaHint:p.personaHint,retrievedContext:j.slice(0,8),caseReport:w||void 0});if(!P.data.success&&P.data.error==="off_topic"){o(P.data.message||"This doesn't appear to be a UE5 question. Please describe a specific Unreal Engine 5 issue."),n(V.ERROR);return}if(P.data.responseType==="NEEDS_CLARIFICATION"){y({question:P.data.question,options:P.data.options||[],whyAsking:P.data.whyAsking||"",query:P.data.query,caseReport:P.data.caseReport}),n(V.CLARIFYING);return}if(!P.data.success)throw new Error(P.data.message||"Failed to process query");P.data.responseType==="ANSWER"&&x({mostLikelyCause:P.data.mostLikelyCause,confidence:P.data.confidence,fastChecks:P.data.fastChecks||[],fixSteps:P.data.fixSteps||[],ifStillBrokenBranches:P.data.ifStillBrokenBranches||[],whyThisResult:P.data.whyThisResult||[],evidence:P.data.evidence||[],learnPath:P.data.learnPath}),M=P.data.cart}catch(F){const P=F.message?.includes("429")||F.code==="resource-exhausted";if(F.message?.includes("off_topic")||F.message?.includes("not a UE5")){o(`This doesn't appear to be a UE5 question. Try describing a specific Unreal Engine 5 issue, for example:
‚Ä¢ "Lumen reflections flickering"
‚Ä¢ "Blueprint compile error"
‚Ä¢ "Niagara particles not spawning"`),n(V.ERROR);return}re(`‚ö†Ô∏è Gemini ${P?"rate limited (429)":"error"}: ${F.message}. Falling back to local matching.`),J=!1,M={diagnosis:{problem_summary:p.query,matched_tag_ids:p.detectedTagIds||[]},objectives:[],intent:{systems:[]}}}M.userQuery=p.query,M.retrievedPassages=j,M._localFallback=!J;const X=await is(M,_,p.selectedTagIds||[],p.errorLog||"",ae);M.matchedCourses=X;const z=[...M.diagnosis?.matched_tag_ids||[],...p.detectedTagIds||[],...p.selectedTagIds||[]],Z=ms(X,z,{preferTroubleshooting:!0,diversity:!0,timeBudgetMinutes:300}),ee={};for(const F of Z.path)ee[F.course.code]={role:F.role,reason:F.reason,estimatedMinutes:F.estimatedMinutes};const de=await cs(X,p.query,ee),Xe=de.filter(F=>!F.type||F.type==="video"),Ze=de.filter(F=>F.type==="doc"||F.type==="youtube");if(de.length===0){o(`We couldn't find UE5 content matching your query. Try describing a specific Unreal Engine problem, for example:
‚Ä¢ "Blueprint compile error LNK2019"
‚Ä¢ "Lumen reflections flickering in indoor scene"
‚Ä¢ "Niagara particle system not spawning"
‚Ä¢ "UMG widget not rendering"`),n(V.ERROR);return}t(Xe),i(M);try{const P=[...M.diagnosis?.matched_tag_ids||[],...p.detectedTagIds||[]].flatMap(A=>A.split(/[._]/).filter(q=>q.length>2&&q!=="unreal"&&q!=="engine")),ue=new Set(["the","and","for","are","but","not","you","all","can","has","her","was","one","our","out","its","how","why","with","from","they","been","have","this","that","what","when","your","into"]),he=(p.query||"").toLowerCase().split(/\s+/).filter(A=>A.length>2&&!ue.has(A)),se=[...new Set(he)],oe=A=>se.some(q=>q.includes(A));oe("mesh")&&!oe("skeletal")&&se.push("static mesh","static meshes","import","importing"),(oe("size")||oe("scale")||oe("wrong"))&&se.push("scale","transform");const te=[...new Set([...P,...se])].slice(0,15);if(G(`[DocTopics] ${se.join(", ")}`),G(`[AllTopics] ${te.join(", ")}`),se.length>0){const A=await Ot(se,Xe,{maxDocs:5,maxYoutube:3});if(Ze.length>0)for(const q of Ze)q.type==="doc"&&!A.docs.some(ce=>ce.url===q._externalUrl)&&A.docs.push({label:q.title,url:q._externalUrl||q.url,description:q.description||"",readTimeMinutes:q.readTimeMinutes||10,tier:"intermediate"}),q.type==="youtube"&&!A.youtube.some(ce=>ce.url===q._externalUrl)&&A.youtube.push({title:q.title,url:q._externalUrl||q.url,channelName:q.channel||"YouTube",channelTrust:q.channelTrust||null,durationMinutes:q.durationMinutes||10,tier:"intermediate"});A.docs.sort((q,ce)=>(ce._rawScore??ce.matchScore??0)-(q._rawScore??q.matchScore??0)),d(A),G(`[Blended] ${A.docs.length} docs, ${A.youtube.length} YT, coverage: ${(A.coverageScore*100).toFixed(0)}%`)}}catch(F){re("‚ö†Ô∏è Blended path skipped:",F.message)}n(l?V.ANSWERED:V.DIAGNOSIS),p.updateCartIdForQuery&&M.cart_id&&(p.updateCartIdForQuery(p.query,M.cart_id),G(`[Cache] Saved cart_id ${M.cart_id} to history for: "${p.query.substring(0,40)}..."`)),await Dt(M.diagnosis),await Ft(M.objectives,X,M.validation?.approved)}catch(S){console.error("[ProblemFirst] Error:",S),o(S.message||"An unexpected error occurred"),n(V.ERROR)}},[_,R,Q,v,l]),D=N.useCallback(()=>n(V.INPUT),[]),U=N.useCallback(()=>{n(V.INPUT),i(null),t([]),o(null),d(null),x(null),y(null),b(null),m(!1)},[]),B=N.useCallback(p=>{if(!T)return;const g={...T,query:`${T.query} (${p})`};C(g,v)},[T,v,C]),ne=N.useCallback(()=>{T&&C(T,v)},[T,v,C]),le=N.useCallback(p=>{if(p.solved||!T)return;m(!0);const g={...v||{},exclusions:[...(v||{}).exclusions||[],p.reason||"Previous solution did not work"]};b(g),C(T,g)},[T,v,C]),ie=N.useCallback(()=>{n(V.DIAGNOSIS)},[]),H=N.useCallback(p=>{K(p.driveId)?$(p.driveId):E(p)},[K,E,$]),be=N.useCallback(()=>{I.length>0&&n(V.GUIDED)},[I]);return e.jsxs("div",{className:"problem-first-page",children:[e.jsxs("header",{className:"page-header",children:[e.jsx("h1",{children:"üîß Fix a Problem"}),e.jsx("p",{children:"Describe your issue. We'll diagnose it and show you how to fix it."})]}),(s===V.INPUT||s===V.LOADING)&&e.jsxs(e.Fragment,{children:[e.jsx(We,{onSubmit:C,detectedPersona:R(),isLoading:s===V.LOADING}),e.jsx(Ke,{onUpdate:b,disabled:s===V.LOADING})]}),s===V.CLARIFYING&&f&&e.jsx(He,{question:f.question,options:f.options,whyAsking:f.whyAsking,onAnswer:B,onSkip:ne,isLoading:!1}),s===V.ANSWERED&&l&&e.jsx(Je,{answer:l,onFeedback:le,onBackToVideos:ie,onStartOver:U,isRerunning:O}),s===V.ERROR&&e.jsxs("div",{className:"error-state",children:[e.jsx("div",{className:"error-icon",children:"‚ö†Ô∏è"}),e.jsx("h3",{children:"Something went wrong"}),e.jsx("p",{children:u}),e.jsx("button",{className:"retry-btn",onClick:U,children:"Try Again"})]}),s===V.DIAGNOSIS&&a&&e.jsxs("div",{className:"shopping-layout",children:[e.jsxs("div",{className:"results-column",children:[e.jsxs("div",{className:"tldr-diagnosis",children:[e.jsxs("div",{className:"tldr-user-query",children:[e.jsx("span",{className:"tldr-query-label",children:"üîç You asked:"}),e.jsx("p",{className:"tldr-query-text",children:a.userQuery})]}),a._localFallback&&e.jsxs("div",{className:"tldr-fallback-notice",style:{background:"rgba(255, 193, 7, 0.1)",border:"1px solid rgba(255, 193, 7, 0.3)",borderRadius:"8px",padding:"8px 14px",margin:"8px 0",fontSize:"0.85rem",color:"var(--text-muted, #aaa)"},children:["‚ö° ",e.jsx("strong",{children:"Fast results"})," ‚Äî AI diagnosis temporarily unavailable. Videos matched by tag taxonomy. Try again in a moment for AI-powered results."]}),a.diagnosis?.problem_summary&&e.jsx("p",{className:"tldr-bridge",children:"Based on your question, we think these videos will help you:"})]}),e.jsxs("h2",{className:"results-title",children:["üé¨ Videos for You (",c.length,")"]}),c.length===0&&e.jsx("div",{className:"no-results",children:e.jsx("p",{children:"No matching videos found. Try rephrasing your question."})}),(()=>{const p=[{key:"prerequisite",icon:"üîó",label:"Prerequisite",desc:"Build the foundation first ‚Äî these cover concepts you'll need before tackling the main topic."},{key:"core",icon:"‚≠ê",label:"Core",desc:"These directly address your question and are the most important videos to watch."},{key:"troubleshooting",icon:"üîß",label:"Troubleshooting",desc:"Debugging helpers ‚Äî watch these if you're hitting errors or unexpected behavior."},{key:"supplemental",icon:"üìö",label:"Supplemental",desc:"Go deeper ‚Äî extra context and advanced techniques for when you're ready."}],g={};for(const w of p)g[w.key]=[];g._other=[];for(const w of c){const S=w.role||"_other";(g[S]||g._other).push(w)}return p.filter(w=>g[w.key].length>0).map(w=>e.jsxs("div",{className:"role-section",children:[e.jsxs("div",{className:"role-section-header",children:[e.jsxs("h3",{className:"role-section-title",children:[w.icon," ",w.label,e.jsx("span",{className:"role-section-count",children:g[w.key].length})]}),e.jsx("p",{className:"role-section-desc",children:w.desc})]}),e.jsx("div",{className:"video-results-grid",children:g[w.key].map(S=>e.jsx("div",{className:"video-result-wrapper",id:`video-${S.driveId}`,children:e.jsx(Ue,{video:S,isAdded:K(S.driveId),onToggle:H,userQuery:a?.userQuery||""})},S.driveId))})]},w.key)).concat(g._other.length>0?[e.jsxs("div",{className:"role-section",children:[e.jsxs("div",{className:"role-section-header",children:[e.jsxs("h3",{className:"role-section-title",children:["üìé Related"," ",e.jsx("span",{className:"role-section-count",children:g._other.length})]}),e.jsx("p",{className:"role-section-desc",children:"Additional videos that may be relevant to your query."})]}),e.jsx("div",{className:"video-results-grid",children:g._other.map(w=>e.jsx("div",{className:"video-result-wrapper",id:`video-${w.driveId}`,children:e.jsx(Ue,{video:w,isAdded:K(w.driveId),onToggle:H,userQuery:a?.userQuery||""})},w.driveId))})]},"_other")]:[])})(),r?.docs?.length>0&&e.jsxs("div",{className:"blended-section",children:[e.jsxs("div",{className:"blended-section-header",children:[e.jsx("h2",{className:"blended-section-title",children:"üìö Recommended Reading"}),e.jsxs("p",{className:"blended-section-desc",children:["Official Unreal Engine documentation to deepen your understanding.",r.docs.reduce((p,g)=>p+(g.readTimeMinutes||10),0)>0&&` (~${r.docs.reduce((p,g)=>p+(g.readTimeMinutes||10),0)} min total read time)`]})]}),e.jsx("div",{className:"doc-cards-grid",children:r.docs.map((p,g)=>{const w=`doc_${p.key||g}`,S=K(w);return e.jsxs("div",{className:`doc-card ${S?"doc-card-added":""}`,children:[e.jsxs("a",{href:p.url,target:"_blank",rel:"noopener noreferrer",className:"doc-card-link",onClick:L=>L.stopPropagation(),children:[e.jsxs("div",{className:"doc-card-header",children:[p.matchScore!=null&&(()=>{const L=p.matchScore>=90?"best":p.matchScore>=60?"strong":p.matchScore>=30?"good":"related",W=p.matchScore>=90?"Best Match":p.matchScore>=60?"Strong":p.matchScore>=30?"Good":"Related";return e.jsxs("span",{className:`doc-match-badge doc-match-${L}`,title:`${p.matchScore}% relevancy`,children:[e.jsx("span",{className:"doc-match-dot"}),W]})})(),e.jsx("span",{className:`tier-badge tier-${p.tier||"intermediate"}`,children:p.tier||"intermediate"}),p.subsystem&&e.jsx("span",{className:"subsystem-tag",children:p.subsystem})]}),e.jsx("h4",{className:"doc-card-title",children:p.label}),p.description&&e.jsx("p",{className:"doc-card-desc",children:p.description}),e.jsxs("div",{className:"doc-card-footer",children:[e.jsx("span",{className:"doc-source-badge",children:"üìÑ Epic Docs"}),e.jsxs("span",{className:"doc-read-time",children:[p.readTimeMinutes||10," min read"]})]})]}),e.jsx("button",{className:`doc-add-btn ${S?"doc-added":""}`,onClick:()=>{S?$(w):E({type:"doc",itemId:w,title:p.label,description:p.description||"",keySteps:p.keySteps||[],seeAlso:p.seeAlso||[],sections:p.sections||[],url:p.url,tier:p.tier||"intermediate",subsystem:p.subsystem,readTimeMinutes:p.readTimeMinutes||10})},title:S?"Remove from path":"Add to learning path",children:S?"‚úì Added":"‚ûï Add"})]},p.key||g)})})]}),r?.youtube?.length>0&&e.jsxs("div",{className:"blended-section",children:[e.jsxs("div",{className:"blended-section-header",children:[e.jsx("h2",{className:"blended-section-title",children:"üì∫ Official Epic YouTube"}),e.jsx("p",{className:"blended-section-desc",children:"Official Unreal Engine tutorials from Epic Games."})]}),e.jsx("div",{className:"doc-cards-grid",children:r.youtube.map(p=>{const g=p.id||`yt_${p.url}`,w=K(g);return e.jsxs("div",{className:`doc-card yt-card-with-thumb ${w?"doc-card-added":""}`,children:[e.jsxs("a",{href:p.url,target:"_blank",rel:"noopener noreferrer",className:"doc-card-link",onClick:S=>S.stopPropagation(),children:[(()=>{const S=p.url?.match(/[?&]v=([^&]+)/),L=S?S[1]:null;return L?e.jsxs("div",{className:"yt-thumb-wrapper",children:[e.jsx("img",{className:"yt-thumb-img",src:`https://img.youtube.com/vi/${L}/mqdefault.jpg`,alt:p.title,loading:"lazy"}),e.jsxs("span",{className:"yt-thumb-duration",children:[p.durationMinutes," min"]}),e.jsx("span",{className:"yt-thumb-play",children:"‚ñ∂"})]}):null})(),e.jsxs("div",{className:"doc-card-header",children:[e.jsx("span",{className:`tier-badge tier-${p.tier||"intermediate"}`,children:p.tier||"intermediate"}),e.jsx("span",{className:"external-badge",children:"Official ‚Ä¢ YouTube"})]}),e.jsx("h4",{className:"doc-card-title",children:p.title}),e.jsxs("div",{className:"doc-card-footer",children:[e.jsxs("span",{className:"doc-source-badge",children:["üì∫ ",p.channelName]}),e.jsxs("span",{className:"doc-read-time",children:[p.durationMinutes," min"]})]})]}),e.jsx("button",{className:`doc-add-btn ${w?"doc-added":""}`,onClick:()=>{w?$(g):E({type:"youtube",itemId:g,title:p.title,description:p.description||"",keyTakeaways:p.keyTakeaways||[],chapters:p.chapters||[],topics:p.topics||[],url:p.url,channelName:p.channelName,channelTrust:p.channelTrust,tier:p.tier||"intermediate",durationMinutes:p.durationMinutes||15})},title:w?"Remove from path":"Add to learning path",children:w?"‚úì Added":"‚ûï Add"})]},p.id)})})]}),e.jsxs("div",{className:"results-actions-bottom",children:[e.jsx("button",{className:"back-btn",onClick:U,children:"‚Üê Start Over"}),e.jsx("button",{className:"ask-again-btn",onClick:D,children:"+ Ask Another Question"})]})]}),e.jsx("div",{className:"cart-column",children:e.jsx(xs,{cart:I,onRemove:$,onClear:Q,onWatchPath:be})})]}),s===V.GUIDED&&(()=>{const p=a?.microLesson?.quick_fix?.steps;return e.jsx(Ps,{courses:(()=>{const g=new Map,w=[];for(const j of I){const M=j.type||"video";if(M==="doc"||M==="youtube"){const X=w.filter(Z=>Z.startsWith("_doc_")).length===0,z=`_doc_${j.itemId||j.url||j.driveId}`;w.push(z),g.set(z,{course:{code:j.itemId||j.driveId||`${M}_${j.url}`,title:j.title,_readingStep:!0,_resourceType:M,_description:j.description||"",_keySteps:X&&p?.length>0?p:j.keyTakeaways||j.keySteps||[],_seeAlso:j.seeAlso||[],_url:j.url,_tier:j.tier,_channel:j.channel||j.channelName,_channelTrust:j.channelTrust,_subsystem:j.subsystem,_topics:j.topics||[],_sections:j.sections||[],_chapters:j.chapters||[],_readTimeMinutes:j.readTimeMinutes||j.durationMinutes||10,videos:[]}});continue}const J=j.courseCode;if(!g.has(J)){const X=_.find(z=>z.code===J);w.push(J),g.set(J,{course:X?{...X,videos:[]}:{code:J,title:j.courseName,videos:[]},videos:[]})}g.get(J).videos.push({drive_id:j.driveId,title:j.title,duration_seconds:j.duration,_videoIndex:j.videoIndex??999})}const S=w.map(j=>{const M=g.get(j);return M.videos?.length>0&&(M.videos.sort((J,X)=>J._videoIndex-X._videoIndex),M.course.videos=M.videos),M.course}),L=new Set(["100.01","100.02"]),W=S.filter(j=>L.has(j.code)),ae=S.filter(j=>!L.has(j.code));return[...W,...ae]})(),diagnosis:a?.diagnosis,problemSummary:a?.diagnosis?.problem_summary,pathSummary:a?.pathSummary,microLesson:a?.microLesson,onComplete:()=>{},onExit:()=>n(V.DIAGNOSIS)})})()]})}function ws({diagnosis:s}){if(!s)return null;const n=s.root_causes?.length||0,a=s.signals_to_watch_for?.length||0,i=s.variables_that_matter?.length||0,u=s.variables_that_do_not?.length||0;return e.jsxs("div",{className:"diagnosis-card",children:[e.jsxs("div",{className:"diagnosis-header",children:[e.jsx("h3",{children:"üî¨ Diagnosis"}),e.jsxs("span",{className:"diagnosis-id",children:["ID: ",s.diagnosis_id?.slice(-8)||"N/A"]})]}),e.jsx("p",{className:"problem-summary",children:s.problem_summary}),e.jsxs("div",{className:"diagnosis-sections",children:[e.jsxs("details",{className:"diagnosis-section root-causes",children:[e.jsxs("summary",{children:[e.jsx("span",{className:"icon",children:"üéØ"}),"Root Causes",e.jsxs("span",{className:"count",children:["(",n,")"]})]}),e.jsx("ul",{children:(s.root_causes||[]).map((o,r)=>e.jsx("li",{children:o},r))})]}),e.jsxs("details",{className:"diagnosis-section signals",children:[e.jsxs("summary",{children:[e.jsx("span",{className:"icon",children:"üëÅÔ∏è"}),"Signals to Watch For",e.jsxs("span",{className:"count",children:["(",a,")"]})]}),e.jsx("ul",{children:(s.signals_to_watch_for||[]).map((o,r)=>e.jsx("li",{children:o},r))})]}),e.jsxs("details",{className:"diagnosis-section variables-matter",children:[e.jsxs("summary",{children:[e.jsx("span",{className:"icon",children:"‚úÖ"}),"Variables That Matter",e.jsxs("span",{className:"count",children:["(",i,")"]})]}),e.jsx("ul",{children:(s.variables_that_matter||[]).map((o,r)=>e.jsx("li",{children:o},r))})]}),e.jsxs("details",{className:"diagnosis-section variables-dont-matter",children:[e.jsxs("summary",{children:[e.jsx("span",{className:"icon",children:"‚ùå"}),"Variables That Don't",e.jsxs("span",{className:"count",children:["(",u,")"]})]}),e.jsx("ul",{children:(s.variables_that_do_not||[]).map((o,r)=>e.jsx("li",{children:o},r))})]}),s.generalization_scope?.length>0&&e.jsxs("details",{className:"diagnosis-section generalization",open:!0,children:[e.jsxs("summary",{children:[e.jsx("span",{className:"icon",children:"üîÑ"}),"Where Else This Applies",e.jsxs("span",{className:"count",children:["(",s.generalization_scope.length,")"]})]}),e.jsx("div",{className:"scope-chips",children:s.generalization_scope.map((o,r)=>e.jsx("span",{className:"scope-chip",children:o},r))})]})]})]})}ws.propTypes={diagnosis:h.shape({diagnosis_id:h.string,problem_summary:h.string,root_causes:h.arrayOf(h.string),signals_to_watch_for:h.arrayOf(h.string),variables_that_matter:h.arrayOf(h.string),variables_that_do_not:h.arrayOf(h.string),generalization_scope:h.arrayOf(h.string)})};ws.defaultProps={diagnosis:null};function Ut(s){if(!s||s<=0)return null;const n=Math.floor(s/3600),a=Math.floor(s%3600/60);return n>0?a>0?`${n} hr ${a} min`:`${n} hr`:`${a} min`}function Wt(s,n=320){const a=s?.drive_id||s?.driveId;return a?`https://drive.google.com/thumbnail?id=${a}&sz=w${n}`:null}function Vt(s,n=320){const a=s?.videos?.[0];return Wt(a,n)}function Ss({objectives:s,courses:n,validation:a,onCourseClick:i,onAddToCart:u,isCourseInCart:o}){const{fixCourses:r,learnCourses:d}=N.useMemo(()=>{if(!n||n.length===0)return{fixCourses:[],learnCourses:[]};const t=Math.ceil(n.length/2);return{fixCourses:n.slice(0,t),learnCourses:n.slice(t)}},[n]),c=N.useMemo(()=>a?{approved:a.approved,reason:a.reason,hasIssues:a.issues?.length>0}:null,[a]);return e.jsxs("div",{className:"adaptive-cart",children:[c&&!c.approved&&e.jsxs("div",{className:"validation-warning",children:[e.jsx("span",{className:"icon",children:"‚ö†Ô∏è"}),e.jsxs("div",{className:"content",children:[e.jsx("strong",{children:"Quality Check:"})," ",c.reason,a.suggestions?.length>0&&e.jsx("ul",{className:"suggestions",children:a.suggestions.map((t,l)=>e.jsx("li",{children:t},l))})]})]}),e.jsxs("section",{className:"cart-section fix-now",children:[e.jsxs("div",{className:"section-header",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"icon",children:"üîß"}),"Fix Now"]}),e.jsx("p",{className:"description",children:"These solve your immediate problem:"})]}),e.jsx("div",{className:"objectives-list",children:(s?.fix_specific||[]).map((t,l)=>e.jsxs("div",{className:"objective-item fix",children:[e.jsx("span",{className:"number",children:l+1}),e.jsx("span",{className:"text",children:t})]},l))}),r.length>0&&e.jsx("div",{className:"course-list",children:r.map(t=>e.jsx(Ie,{course:t,type:"fix",onClick:()=>i?.(t),onAddToCart:u,isInCart:o?.(t)},t.id||t.code))})]}),e.jsxs("section",{className:"cart-section learn-forever",children:[e.jsxs("div",{className:"section-header",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"icon",children:"üéì"}),"Learn Forever"]}),e.jsx("p",{className:"description",children:"These help you diagnose similar issues in the future:"})]}),e.jsx("div",{className:"objectives-list transferable",children:(s?.transferable||[]).map((t,l)=>e.jsxs("div",{className:"objective-item transferable",children:[e.jsx("span",{className:"number",children:l+1}),e.jsx("span",{className:"text",children:t}),e.jsx("span",{className:"badge",children:"Transferable"})]},l))}),s?.transferable?.length===0&&e.jsx("div",{className:"empty-warning",children:"‚ö†Ô∏è No transferable objectives generated. This path may not teach reusable skills."}),d.length>0&&e.jsx("div",{className:"course-list",children:d.map(t=>e.jsx(Ie,{course:t,type:"learn",onClick:()=>i?.(t),onAddToCart:u,isInCart:o?.(t)},t.id||t.code))})]}),e.jsxs("div",{className:"cart-summary",children:[e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"value",children:s?.fix_specific?.length||0}),e.jsx("span",{className:"label",children:"Fix Objectives"})]}),e.jsxs("div",{className:"stat highlight",children:[e.jsx("span",{className:"value",children:s?.transferable?.length||0}),e.jsx("span",{className:"label",children:"Transferable Skills"})]}),e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"value",children:n?.length||0}),e.jsx("span",{className:"label",children:"Recommended Courses"})]})]})]})}function Ie({course:s,type:n,onClick:a,onAddToCart:i,isInCart:u}){const[o,r]=N.useState(!1),d=N.useMemo(()=>{if(s.duration)return s.duration;if(s.duration_minutes)return`${s.duration_minutes} min`;if(s.durationMinutes)return`${s.durationMinutes} min`;if(s.videos?.length){const f=s.videos.reduce((y,v)=>y+(v.duration_seconds||0),0);return f>0?Ut(f):null}return null},[s]),c=N.useMemo(()=>typeof s.difficulty=="string"?s.difficulty:typeof s.difficulty=="number"?["Beginner","Beginner","Intermediate","Intermediate","Advanced","Expert"][s.difficulty]||"Intermediate":s.gemini_skill_level?s.gemini_skill_level:null,[s]),t=N.useMemo(()=>Vt(s),[s]),l=s.video_count||s.videos?.length||null,x=f=>{f.stopPropagation(),i?.(s)};return e.jsxs("div",{className:`course-card ${n} ${u?"in-cart":""}`,onClick:a,role:"button",tabIndex:0,onKeyDown:f=>f.key==="Enter"&&a?.(),children:[t&&!o&&e.jsx("div",{className:"course-thumbnail",children:e.jsx("img",{src:t,alt:s.title,loading:"lazy",onError:()=>r(!0)})}),e.jsxs("div",{className:"course-info",children:[e.jsx("h4",{className:"title",children:s.title||s.name}),s.gemini_outcomes?.[0]&&e.jsxs("p",{className:"description",children:[s.gemini_outcomes[0].slice(0,100),"..."]}),e.jsxs("div",{className:"meta",children:[d&&e.jsxs("span",{className:"duration",children:["‚è±Ô∏è ",d]}),l&&e.jsxs("span",{className:"video-count",children:["üé¨ ",l," videos"]}),c&&e.jsx("span",{className:`difficulty ${c.toLowerCase()}`,children:c})]})]}),e.jsx("div",{className:"course-action",children:i?e.jsx("button",{className:`add-btn ${u?"added":""}`,onClick:x,"aria-label":u?"Added to path":"Add to path",children:u?"‚úì Added":"+ Add"}):e.jsx("span",{className:"arrow",children:"‚Üí"})})]})}Ie.propTypes={course:h.shape({id:h.string,code:h.string,title:h.string,name:h.string,description:h.string,duration:h.string,durationMinutes:h.number,difficulty:h.string}).isRequired,type:h.oneOf(["fix","learn"]),onClick:h.func};Ie.defaultProps={type:"fix",onClick:null};Ss.propTypes={objectives:h.shape({fix_specific:h.arrayOf(h.string),transferable:h.arrayOf(h.string)}),courses:h.arrayOf(h.object),validation:h.shape({approved:h.bool,reason:h.string,issues:h.arrayOf(h.string),suggestions:h.arrayOf(h.string)}),onCourseClick:h.func};Ss.defaultProps={objectives:null,courses:[],validation:null,onCourseClick:null};export{Ss as AdaptiveLearningCart,ws as DiagnosisCard,tn as ProblemFirst,We as ProblemInput};

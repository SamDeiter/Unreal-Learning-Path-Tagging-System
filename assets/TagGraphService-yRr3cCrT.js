import{t as q,e as O}from"./data-courses-z9H_F5gc.js";const N=new Map([["bp","blueprint"],["bps","blueprints"],["gas","gameplay ability system"],["pcg","procedural content generation"],["gi","global illumination"],["lod","level of detail"],["hdr","high dynamic range"],["pbr","physically based rendering"],["vsm","virtual shadow maps"],["rt","ray tracing"],["hlod","hierarchical level of detail"],["wp","world partition"],["ik","inverse kinematics"],["fk","forward kinematics"],["dof","depth of field"],["vfx","visual effects"],["ai","artificial intelligence"],["hud","heads up display"],["umg","unreal motion graphics"],["cpp","c++"],["c++","cpp"],["ue5","unreal engine 5"],["ue4","unreal engine 4"],["rhi","render hardware interface"],["niagara","niagara"],["nanite","nanite"],["lumen","lumen"],["chaos","chaos physics"],["sequencer","sequencer"],["metahuman","metahuman"],["fab","fab marketplace"],["eqs","environment query system"],["abp","animation blueprint"],["tsr","temporal super resolution"],["pso","pipeline state object"],["rpc","remote procedure call"],["dlss","deep learning super sampling"],["fsr","fidelity super resolution"],["dmx","lighting protocol"],["ecs","entity component system"],["cas","contrast adaptive sharpening"],["ssgi","screen space global illumination"],["wpo","world position offset"],["mrq","movie render queue"]]),F=new Set(["chaos","physics","atlas","canvas","alias","diagnosis","analysis","basis","class","process","pass","grass","address","access","progress","mass","less","cross"]),G=[/\bnot\s+(\w+)/gi,/\bwithout\s+(\w+)/gi,/\bexclude\s+(\w+)/gi,/\bno\s+(\w+)/gi,/\bdon'?t\s+(?:want|need|use)\s+(\w+)/gi];function Q(i){if(!i||typeof i!="string")return{normalized:"",expandedTerms:[],negatedTerms:[]};const t=[];for(const r of G){let a;for(r.lastIndex=0;(a=r.exec(i))!==null;)t.push(a[1].toLowerCase())}let s=i.toLowerCase();const e=[];for(const[r,a]of N)new RegExp(`\\b${D(r)}\\b`,"gi").test(s)&&(e.push(`${r} â†’ ${a}`),s=s+" "+a);return s=s.replace(/([a-z])([A-Z])/g,"$1 $2").toLowerCase(),s=s.replace(/_/g," "),s=s.replace(/[^a-z0-9\s\-+.]/g," "),s=s.replace(/\s+/g," ").trim(),{normalized:s,expandedTerms:e,negatedTerms:t}}function I(i){return!i||i.length<4||F.has(i)?i:i.endsWith("ies")&&i.length>4?i.slice(0,-3)+"y":i.endsWith("sses")||i.endsWith("xes")||i.endsWith("shes")||i.endsWith("ches")||i.endsWith("es")&&!/[aeiou]/.test(i[i.length-3])?i.slice(0,-2):i.endsWith("s")&&!i.endsWith("ss")&&!i.endsWith("us")?i.slice(0,-1):i}function D(i){return i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}class j{constructor(){this.tags=q?.tags||[],this.edges=O?.edges||[],this.tagMap=new Map(this.tags.map(t=>[t.tag_id,t])),this.edgesBySource=this._buildEdgeMap("source"),this.edgesByTarget=this._buildEdgeMap("target"),this.errorSignatureIndex=this._buildErrorSignatureIndex(),this.termIndex=this._buildTermIndex(),this._relatedCache=new Map,this.edgeWeights={subtopic:{forward:.8,reverse:.6},related:{forward:.5,reverse:.4},symptom_of:{forward:.7,reverse:.3},often_caused_by:{forward:.6,reverse:.4},replaces:{forward:.5,reverse:.15}}}_buildEdgeMap(t){const s=new Map;for(const e of this.edges){const r=e[t];s.has(r)||s.set(r,[]),s.get(r).push(e)}return s}_buildErrorSignatureIndex(){const t=[];for(const s of this.tags){const e=s.signals?.error_signatures||[];for(const r of e)t.push({signature:r.toLowerCase(),tagId:s.tag_id,tag:s})}return t}_buildTermIndex(){const t=[],s=(e,r,a,c)=>{if(!e||typeof e!="string")return;const o=e.toLowerCase().trim();if(o.length<2)return;const d=o.split(/\s+/),f=d.map(n=>I(n)).join(" ");t.push({term:o,tagId:r,termType:a,originalTerm:c||e,isPhrase:d.length>1}),f!==o&&t.push({term:f,tagId:r,termType:a,originalTerm:c||e,isPhrase:d.length>1})};for(const e of this.tags){s(e.display_name,e.tag_id,"display_name",e.display_name);const r=e.tag_id.split(".").pop();if(r&&r.length>2&&s(r.replace(/_/g," "),e.tag_id,"tag_id_suffix",r),e.synonyms)for(const a of e.synonyms)s(a,e.tag_id,"synonym",a);if(e.aliases)for(const a of e.aliases)s(a.value,e.tag_id,"alias",a.value);if(e.signals?.ui_terms)for(const a of e.signals.ui_terms)s(a,e.tag_id,"ui_term",a);if(e.signals?.error_signatures)for(const a of e.signals.error_signatures)s(a,e.tag_id,"error_sig",a)}return t.sort((e,r)=>e.isPhrase!==r.isPhrase?e.isPhrase?-1:1:r.term.length-e.term.length),t}getTag(t){return this.tagMap.get(t)||null}getAllTags(){return this.tags}getTagsByType(t){return this.tags.filter(s=>s.tag_type===t)}getPrerequisites(t){return(this.edgesBySource.get(t)||[]).filter(e=>e.relation==="subtopic"||e.relation==="related").map(e=>({tag:this.getTag(e.target),weight:e.weight||.5,relation:e.relation})).filter(e=>e.tag!==null)}getRelated(t,s=.5){const e=this.edgesBySource.get(t)||[],r=this.edgesByTarget.get(t)||[],a=[...e,...r],c=new Set;return a.filter(o=>o.weight>=s).map(o=>{const d=o.source===t?o.target:o.source;return c.has(d)?null:(c.add(d),{tag:this.getTag(d),weight:o.weight,relation:o.relation})}).filter(o=>o!==null&&o.tag!==null)}getSymptoms(t){return(this.edgesByTarget.get(t)||[]).filter(e=>e.relation==="symptom_of").map(e=>({tag:this.getTag(e.source),weight:e.weight||.5})).filter(e=>e.tag!==null)}getCauses(t){return(this.edgesBySource.get(t)||[]).filter(e=>e.relation==="symptom_of"||e.relation==="often_caused_by").map(e=>({tag:this.getTag(e.target),weight:e.weight||.5,relation:e.relation})).filter(e=>e.tag!==null)}matchErrorSignature(t){if(!t)return[];const s=t.toLowerCase(),e=[];for(const r of this.errorSignatureIndex)s.includes(r.signature)&&e.push({tag:r.tag,matchedSignature:r.signature,confidence:.9});for(const r of this.tags){const a=r.synonyms||[];for(const c of a)s.includes(c.toLowerCase())&&(e.some(o=>o.tag.tag_id===r.tag_id)||e.push({tag:r,matchedSignature:c,confidence:.6}))}return e.sort((r,a)=>a.confidence-r.confidence)}scoreCourseRelevance(t,s){const e={score:0,breakdown:{directOverlap:0,graphPropagation:0,geminiBonus:0,penalties:0},topContributors:[]};if(!t||!s||s.length===0)return e;const r=[...Array.isArray(t.canonical_tags)?t.canonical_tags:[],...Array.isArray(t.ai_tags)?t.ai_tags:[],...Array.isArray(t.gemini_system_tags)?t.gemini_system_tags:[],...Array.isArray(t.transcript_tags)?t.transcript_tags:[],...Array.isArray(t.extracted_tags)?t.extracted_tags:[]].map(g=>typeof g=="string"?g.toLowerCase():"");t.tags&&typeof t.tags=="object"&&!Array.isArray(t.tags)&&Object.values(t.tags).forEach(g=>{typeof g=="string"&&r.push(g.toLowerCase())});const a=new Set(s.map(g=>g.toLowerCase())),c=new Set(r),o=[];let d=0;for(const g of a){if(c.has(g)){d+=25,o.push({sourceQueryTagId:g,targetCourseTagId:g,path:[],contribution:25});continue}const p=g.split(".").pop();for(const m of r){const y=m.split(".").pop();if(p===y&&p.length>2){d+=15,o.push({sourceQueryTagId:g,targetCourseTagId:m,path:[],contribution:15});break}}}let f=0;const n=(t.gemini_system_tags||[]).map(g=>g.toLowerCase());for(const g of a){const p=g.split(".").pop();n.some(m=>m.toLowerCase()===p||m.toLowerCase().includes(p))&&(f+=10)}let h=0;const u=15,_=2,P=.5;for(const g of s){let p=0;const m=new Set([g]);let y=[{id:g,hops:0,pathSoFar:[]}];for(;y.length>0;){const S=[];for(const{id:b,hops:w,pathSoFar:C}of y){if(w>=_)continue;const M=(this.edgesBySource.get(b)||[]).map(l=>({...l,direction:"forward",neighborId:l.target})),W=(this.edgesByTarget.get(b)||[]).map(l=>({...l,direction:"reverse",neighborId:l.source}));for(const l of[...M,...W]){if(m.has(l.neighborId))continue;m.add(l.neighborId);const v=this.edgeWeights[l.relation]||{forward:.2,reverse:.1},B=l.direction==="forward"?v.forward:v.reverse,R=Math.pow(P,w),z=l.weight||.5,A=l.neighborId.toLowerCase(),E=A.split(".").pop();let x=!1;if(c.has(A))x=!0;else for(const T of r)if(T.split(".").pop()===E&&E.length>2){x=!0;break}if(x){const T=5*B*R*z;p+=T;const $=[...C,{from:b,to:l.neighborId,edgeType:l.relation}];o.push({sourceQueryTagId:g,targetCourseTagId:l.neighborId,path:$,contribution:Math.round(T*100)/100})}const k=[...C,{from:b,to:l.neighborId,edgeType:l.relation}];S.push({id:l.neighborId,hops:w+1,pathSoFar:k})}}y=S}h+=Math.min(p,u)}const L=d+f+h;return{score:Math.min(100,L),breakdown:{directOverlap:d,graphPropagation:Math.round(h*100)/100,geminiBonus:f,penalties:0},topContributors:o.sort((g,p)=>p.contribution-g.contribution).slice(0,10)}}clearRelatedCache(){this._relatedCache.clear()}extractTagsFromText(t){const s={matchedTagIds:[],matches:[],excludedTagIds:[],normalizedQuery:""};if(!t)return s;const{normalized:e,negatedTerms:r}=Q(t),a=new Set(e.split(/\s+/).filter(n=>n.length>1)),c=[],o=new Set,d={error_sig:.95,display_name:.85,synonym:.8,tag_id_suffix:.75,alias:.7,ui_term:.65};for(const n of this.termIndex){if(o.has(n.tagId))continue;let h=!1;if(n.isPhrase)new RegExp(`\\b${n.term.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\b`,"i").test(e)&&(h=!0);else if(a.has(n.term))h=!0;else for(const u of a)if(I(u)===n.term||u===I(n.term)){h=!0;break}if(h){o.add(n.tagId);const u=d[n.termType]||.5;c.push({tagId:n.tagId,tag:this.getTag(n.tagId),matchedTerm:n.originalTerm,matchType:n.termType,confidence:u})}}const f=[];if(r.length>0)for(let n=c.length-1;n>=0;n--){const h=c[n],u=h.tagId.split(".").pop();r.some(_=>u.includes(_)||_.includes(u))&&(f.push(h.tagId),c.splice(n,1))}return c.sort((n,h)=>h.confidence-n.confidence),{matchedTagIds:c.map(n=>n.tagId),matches:c,excludedTagIds:f,normalizedQuery:e}}}const V=new j;export{V as t};

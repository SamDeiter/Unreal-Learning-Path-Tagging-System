import{j as e,_ as us,g as Ne,a as hs}from"./index-Clug9y5g.js";import{a as b,P as h}from"./vendor-cytoscape-hdah7_Xt.js";import{t as de}from"./TagGraphService-DUJV4Gip.js";import{S as Te,c as ms,D as Re,d as Ie,e as ze,g as ts,f as ps,s as $e,h as ns,a as gs,u as fs,P as xs,C as ys,G as vs,V as Qe}from"./segmentSearchService-DLsO92HE.js";import{S as bs}from"./search-BvlZ0fxD.js";import{c as Se}from"./createLucideIcon-YhyuTmrv.js";import{c as as,r as js,t as Ns,d as _s,p as rs,n as je,a as Ss,j as ws,k as Cs}from"./vendor-firebase-BEnYNivV.js";import{c as ks,s as Ts}from"./data-courses-Cfgu6N5t.js";import{d as O,a as Z}from"./logger-CCt-ETDk.js";import{applyFeedbackMultiplier as Rs,getBoostMap as Is}from"./feedbackService-UHPTMrP0.js";import"./check-eCXpKYRG.js";import"./x-HbUnH9yy.js";import"./lightbulb-B9S7Im5O.js";import"./plus-mlfspTQG.js";const Es=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],Ke=Se("circle-x",Es);const Ms=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],As=Se("image",Ms);const Ls=[["path",{d:"M13.172 2a2 2 0 0 1 1.414.586l6.71 6.71a2.4 2.4 0 0 1 0 3.408l-4.592 4.592a2.4 2.4 0 0 1-3.408 0l-6.71-6.71A2 2 0 0 1 6 9.172V3a1 1 0 0 1 1-1z",key:"16rjxf"}],["path",{d:"M2 7v6.172a2 2 0 0 0 .586 1.414l6.71 6.71a2.4 2.4 0 0 0 3.191.193",key:"178nd4"}],["circle",{cx:"10.5",cy:"6.5",r:".5",fill:"currentColor",key:"12ikhr"}]],Ps=Se("tags",Ls);const $s=[["path",{d:"M12 19h8",key:"baeox8"}],["path",{d:"m4 17 6-6-6-6",key:"1yngyt"}]],Os=Se("terminal",$s),qs=/(?:[A-Za-z]:\\[\w\\. -]+|\/(?:Users|home|tmp|var|opt|etc)\/[\w/. -]+)/g;function Ye(s){return s.replace(qs,"[LOCAL_PATH]")}function Oe({onSubmit:s,detectedPersona:n,isLoading:r}){const[a,t]=b.useState(""),[i,c]=b.useState([]),[u,m]=b.useState(null),[o,f]=b.useState(""),[p,g]=b.useState(!1),y=b.useRef(null),[N,v]=b.useState(()=>{try{const x=JSON.parse(localStorage.getItem("fix-problem-history")||"[]"),j=x.map(C=>typeof C=="string"?{query:C,cartId:null}:C);return x.length>0&&typeof x[0]=="string"&&localStorage.setItem("fix-problem-history",JSON.stringify(j)),j}catch{return[]}}),T=b.useCallback(x=>{const j=Ye(x.target.value);if(t(j),j.length>15){const C=de.matchErrorSignature(j),P=de.extractTagsFromText(j),A=C.map(W=>({tag:W.tag,confidence:W.confidence})),U=P.matches.map(W=>({tag:W.tag,confidence:W.confidence})),z=[...A,...U],se=new Set,ee=z.filter(W=>se.has(W.tag.tag_id)?!1:(se.add(W.tag.tag_id),!0));c(ee.slice(0,5))}else c([])},[]),d=b.useCallback(x=>{const j=x.clipboardData?.items;if(j){for(const C of j)if(C.type.startsWith("image/")){x.preventDefault();const P=C.getAsFile(),A=new FileReader;A.onload=U=>m(U.target.result),A.readAsDataURL(P);return}}},[]),S=b.useCallback(x=>{x.preventDefault(),x.stopPropagation(),g(!0)},[]),E=b.useCallback(x=>{x.preventDefault(),x.stopPropagation(),g(!1)},[]),I=b.useCallback(x=>{x.preventDefault(),x.stopPropagation(),g(!1);const j=x.dataTransfer?.files;if(!j||j.length===0)return;const C=j[0];if(C.type.startsWith("image/")){const P=new FileReader;P.onload=A=>m(A.target.result),P.readAsDataURL(C)}},[]),w=b.useCallback((x,j)=>{v(C=>{const P=C.map(A=>A.query===x?{...A,cartId:j}:A);return localStorage.setItem("fix-problem-history",JSON.stringify(P)),P})},[]),_=b.useCallback((x=null,j=null)=>{const C=(j||a).trim();C.length<10||(v(P=>{const A=P.filter(z=>z.query!==C),U=[{query:C,cartId:x},...A].slice(0,6);return localStorage.setItem("fix-problem-history",JSON.stringify(U)),U}),s({query:C,detectedTagIds:i.map(P=>P.tag.tag_id),selectedTagIds:[],personaHint:n?.name,pastedImage:u,errorLog:o.trim()||null,cachedCartId:x||null,updateCartIdForQuery:w}))},[a,i,n,s,u,o,w]),V=b.useCallback(x=>{x.key==="Enter"&&x.ctrlKey&&_()},[_]),Q=b.useMemo(()=>['My Blueprint Cast is giving me "Accessed None" error when trying to...',"Lumen is too noisy in my interior scene and I've tried increasing quality...","My character animation stutters when blending between states...","Nanite is causing Z-fighting on overlapping meshes...","Material instances aren't updating at runtime when I change parameters..."],[])[0];return e.jsxs("div",{className:"problem-input-container",onPaste:d,children:[e.jsxs("div",{className:"problem-input-header",children:[e.jsxs("h2",{children:[e.jsx(bs,{size:22,className:"icon-inline"})," What's the problem?"]}),e.jsx("p",{className:"subtitle",children:"Describe your UE5 issue in plain English. We'll diagnose the root cause and teach you to fix it."})]}),e.jsxs("div",{className:"problem-input-field",children:[e.jsx("textarea",{value:a,onChange:T,onKeyDown:V,placeholder:Q,rows:5,disabled:r,"aria-label":"Problem description"}),e.jsxs("div",{className:"char-count",children:[a.length," characters",a.length<10&&a.length>0&&e.jsx("span",{className:"warning",children:" (minimum 10)"})]})]}),i.length>0&&e.jsxs("div",{className:"detected-tags",children:[e.jsxs("span",{className:"label",children:[e.jsx(Ps,{size:14,className:"icon-inline"})," Detected:"]}),e.jsx("div",{className:"tag-list",children:i.map(x=>e.jsxs("span",{className:"tag-chip",title:x.tag.description||x.tag.display_name,children:[x.tag.display_name,e.jsxs("span",{className:"confidence",children:[Math.round(x.confidence*100),"%"]})]},x.tag.tag_id))})]}),e.jsxs("div",{className:`screenshot-zone ${o.trim()?"has-image":""}`,onClick:()=>{o.trim()||document.getElementById("error-log-input")?.focus()},children:[o.trim()?e.jsxs("div",{className:"pasted-preview error-log-preview",children:[e.jsx("pre",{className:"error-log-display",children:o}),e.jsx("button",{type:"button",className:"clear-error-log",onClick:x=>{x.stopPropagation(),f("")},"aria-label":"Remove error log",title:"Clear error log",children:e.jsx(Ke,{size:20})})]}):e.jsxs("div",{className:"drop-prompt",children:[e.jsx(Os,{size:20}),e.jsxs("span",{children:["Paste (",e.jsx("kbd",{children:"Ctrl+V"}),") an error log or build output"]})]}),e.jsx("textarea",{id:"error-log-input",className:"error-log-hidden-input",value:o,onChange:x=>f(x.target.value),onPaste:x=>{const j=x.clipboardData?.getData("text");j&&(x.preventDefault(),f(Ye(j)))},rows:1})]}),e.jsx("div",{ref:y,className:`screenshot-zone ${p?"drag-over":""} ${u?"has-image":""}`,onDragOver:S,onDragLeave:E,onDrop:I,children:u?e.jsxs("div",{className:"pasted-preview",children:[e.jsx("img",{src:u,alt:"Pasted screenshot"}),e.jsx("button",{type:"button",className:"clear-error-log",onClick:()=>m(null),"aria-label":"Remove screenshot",title:"Remove screenshot",children:e.jsx(Ke,{size:20})})]}):e.jsxs("div",{className:"drop-prompt",children:[e.jsx(As,{size:20}),e.jsxs("span",{children:["Paste (",e.jsx("kbd",{children:"Ctrl+V"}),") or drag a screenshot here"]})]})}),e.jsxs("div",{className:"problem-input-actions",children:[e.jsx("button",{className:"submit-btn primary",onClick:()=>_(),disabled:a.trim().length<10||r,children:r?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner"})," Diagnosing..."]}):e.jsx(e.Fragment,{children:"Get Diagnosis â†’"})}),e.jsxs("span",{className:"hint",children:["Press ",e.jsx("kbd",{children:"Ctrl"})," + ",e.jsx("kbd",{children:"Enter"})," to submit"]})]}),N.length>0&&e.jsxs("div",{className:"query-history",children:[e.jsx("span",{className:"history-label",children:"ðŸ•˜ Recent questions:"}),e.jsx("div",{className:"history-chips",children:N.map((x,j)=>{const C=x.query||x,P=x.cartId||null,A=!!P;return e.jsxs("div",{className:"history-chip-row",children:[e.jsxs("button",{type:"button",className:`history-chip ${A?"cached":""}`,onClick:()=>{t(C),T({target:{value:C}}),A&&!r&&setTimeout(()=>_(P,C),50)},title:A?`${C} (cached â€” instant load)`:C,disabled:r,children:[A&&e.jsx("span",{className:"cache-indicator",children:"âš¡"}),C.length>50?C.slice(0,50)+"â€¦":C]}),e.jsx("button",{type:"button",className:"history-delete",onClick:()=>{v(U=>{const z=U.filter((se,ee)=>ee!==j);return localStorage.setItem("fix-problem-history",JSON.stringify(z)),z})},title:"Remove",children:"Ã—"})]},j)})})]})]})}Oe.propTypes={onSubmit:h.func.isRequired,detectedPersona:h.shape({id:h.string,name:h.string,emoji:h.string}),isLoading:h.bool};Oe.defaultProps={detectedPersona:null,isLoading:!1};const le={engineVersion:{points:15,label:"Engine Version"},platform:{points:5,label:"Platform"},renderer:{points:10,label:"Renderer"},whatChangedRecently:{points:10,label:"Recent Changes"},goal:{points:5,label:"Goal"},features:{points:5,label:"Features"}},Ds=Object.values(le).reduce((s,n)=>s+n.points,0);function qe({onUpdate:s,disabled:n}){const[r,a]=b.useState({engineVersion:"",platform:"",context:"",renderer:"",features:"",whatChangedRecently:"",goal:""}),t=b.useCallback((m,o)=>{const f={...r,[m]:o};a(f);const p={engineVersion:f.engineVersion.trim()||void 0,platform:f.platform.trim()||void 0,context:f.context.trim()||void 0,renderer:f.renderer.trim()||void 0,features:f.features?f.features.split(",").map(y=>y.trim()).filter(Boolean):[],whatChangedRecently:f.whatChangedRecently.trim()||void 0,goal:f.goal.trim()||void 0},g=Object.values(p).some(y=>y!==void 0&&(!Array.isArray(y)||y.length>0));s(g?p:null)},[r,s]),i=b.useMemo(()=>{let m=0;return r.engineVersion.trim()&&(m+=le.engineVersion.points),r.platform&&(m+=le.platform.points),r.renderer&&(m+=le.renderer.points),r.whatChangedRecently.trim()&&(m+=le.whatChangedRecently.points),r.goal.trim()&&(m+=le.goal.points),r.features.trim()&&(m+=le.features.points),m},[r]),c=Math.round(i/Ds*100),u=i===0?"none":i<=15?"low":i<=30?"med":"high";return e.jsxs("div",{className:"case-report-card",children:[e.jsxs("div",{className:"case-report-card-header",children:[e.jsx("h3",{children:"ðŸ“‹ Case Details"}),e.jsx("p",{className:"case-report-card-hint",children:"Fill in what you can â€” each field improves diagnosis accuracy."})]}),e.jsxs("div",{className:"case-boost-meter",children:[e.jsxs("div",{className:"case-boost-row",children:[e.jsx("span",{className:"case-boost-label",children:"Confidence Boost"}),e.jsx("span",{className:`case-boost-value case-boost-${u}`,children:i>0?`+${i} pts`:"â€”"})]}),e.jsx("div",{className:"case-boost-bar",children:e.jsx("div",{className:`case-boost-fill case-boost-fill-${u}`,style:{width:`${c}%`}})})]}),e.jsxs("div",{className:"case-report-fields",children:[e.jsxs("div",{className:"case-report-row",children:[e.jsxs("div",{className:"case-report-field",children:[e.jsx("label",{children:"Engine Version"}),e.jsx("input",{type:"text",placeholder:"e.g. 5.4.1",value:r.engineVersion,onChange:m=>t("engineVersion",m.target.value),disabled:n,maxLength:20})]}),e.jsxs("div",{className:"case-report-field",children:[e.jsx("label",{children:"Platform"}),e.jsxs("select",{value:r.platform,onChange:m=>t("platform",m.target.value),disabled:n,children:[e.jsx("option",{value:"",children:"Select..."}),e.jsx("option",{value:"Windows",children:"Windows"}),e.jsx("option",{value:"macOS",children:"macOS"}),e.jsx("option",{value:"Linux",children:"Linux"}),e.jsx("option",{value:"Android",children:"Android"}),e.jsx("option",{value:"iOS",children:"iOS"}),e.jsx("option",{value:"Console",children:"Console"})]})]})]}),e.jsxs("div",{className:"case-report-field",children:[e.jsx("label",{children:"Renderer"}),e.jsxs("select",{value:r.renderer,onChange:m=>t("renderer",m.target.value),disabled:n,children:[e.jsx("option",{value:"",children:"Select..."}),e.jsx("option",{value:"Lumen",children:"Lumen"}),e.jsx("option",{value:"Nanite",children:"Nanite"}),e.jsx("option",{value:"Forward",children:"Forward Shading"}),e.jsx("option",{value:"Deferred",children:"Deferred"}),e.jsx("option",{value:"Mobile",children:"Mobile"}),e.jsx("option",{value:"PathTracing",children:"Path Tracing"})]})]}),e.jsxs("div",{className:"case-report-field",children:[e.jsx("label",{children:"What changed recently?"}),e.jsx("input",{type:"text",placeholder:"e.g. Migrated to 5.4, changed lighting",value:r.whatChangedRecently,onChange:m=>t("whatChangedRecently",m.target.value),disabled:n,maxLength:300})]}),e.jsxs("div",{className:"case-report-field",children:[e.jsx("label",{children:"What are you trying to achieve?"}),e.jsx("input",{type:"text",placeholder:"e.g. Realistic interior lighting",value:r.goal,onChange:m=>t("goal",m.target.value),disabled:n,maxLength:200})]}),e.jsxs("div",{className:"case-report-field",children:[e.jsx("label",{children:"Active Features (comma separated)"}),e.jsx("input",{type:"text",placeholder:"e.g. Lumen, Nanite, VSM",value:r.features,onChange:m=>t("features",m.target.value),disabled:n,maxLength:200})]})]})]})}qe.propTypes={onUpdate:h.func.isRequired,disabled:h.bool};qe.defaultProps={disabled:!1};function De({question:s,options:n,whyAsking:r,onAnswer:a,onSkip:t,isLoading:i,clarifyRound:c,maxClarifyRounds:u,conversationHistory:m}){return e.jsxs("div",{className:"clarify-step",children:[c>0&&u>1&&e.jsxs("div",{className:"clarify-round-counter",children:[e.jsxs("span",{className:"clarify-round-badge",children:["Narrowing downâ€¦ ",c," of ",u]}),e.jsx("div",{className:"clarify-round-bar",children:e.jsx("div",{className:"clarify-round-fill",style:{width:`${c/u*100}%`}})})]}),m.length>0&&e.jsx("div",{className:"clarify-history",children:m.map((o,f)=>e.jsxs("div",{className:`clarify-history-turn clarify-history-${o.role}`,children:[e.jsx("span",{className:"clarify-history-role",children:o.role==="assistant"?"ðŸ¤– Asked:":"ðŸ‘¤ You said:"}),e.jsx("span",{className:"clarify-history-content",children:o.content})]},f))}),e.jsxs("div",{className:"clarify-header",children:[e.jsx("span",{className:"clarify-icon",children:"ðŸ¤”"}),e.jsx("h3",{children:c>1?"One more thing to narrow it down":"Quick question before we diagnose"})]}),e.jsx("p",{className:"clarify-question",children:s}),e.jsxs("div",{className:"clarify-options",children:[(n||[]).map((o,f)=>e.jsxs("button",{className:"clarify-option-btn",onClick:()=>a(o),disabled:i,children:[e.jsx("span",{className:"clarify-option-letter",children:String.fromCharCode(65+f)}),e.jsx("span",{className:"clarify-option-text",children:o})]},f)),e.jsxs("button",{className:"clarify-option-btn clarify-option-idk",onClick:()=>a("I'm not sure â€” show me foundational content on this topic"),disabled:i,children:[e.jsx("span",{className:"clarify-option-letter",children:"ðŸ¤·"}),e.jsx("span",{className:"clarify-option-text",children:"I'm not sure"})]})]}),r&&e.jsxs("p",{className:"clarify-why",children:[e.jsx("span",{className:"clarify-why-label",children:"Why we're asking:"})," ",r]}),e.jsx("button",{className:"clarify-skip-btn",onClick:t,disabled:i,children:"Skip â€” just give me the best answer you can"})]})}De.propTypes={question:h.string.isRequired,options:h.arrayOf(h.string),whyAsking:h.string,onAnswer:h.func.isRequired,onSkip:h.func.isRequired,isLoading:h.bool,clarifyRound:h.number,maxClarifyRounds:h.number,conversationHistory:h.arrayOf(h.shape({role:h.string.isRequired,content:h.string.isRequired}))};De.defaultProps={options:[],whyAsking:"",isLoading:!1,clarifyRound:1,maxClarifyRounds:3,conversationHistory:[]};const Je=[{icon:"ðŸ”",label:"Analyzing your problem...",detail:"Extracting intent and key systems"},{icon:"ðŸ“š",label:"Searching knowledge base...",detail:"Finding relevant courses and documentation"},{icon:"ðŸ”§",label:"Building your fix...",detail:"Generating step-by-step solution"}];function Fe({query:s}){const[n,r]=b.useState(0);return b.useEffect(()=>{const a=setTimeout(()=>r(1),2500),t=setTimeout(()=>r(2),5500);return()=>{clearTimeout(a),clearTimeout(t)}},[]),e.jsx("div",{className:"dx-loader",children:e.jsxs("div",{className:"dx-loader-card",children:[e.jsxs("h2",{className:"dx-loader-title",children:[e.jsx("span",{className:"dx-loader-spinner"})," Diagnosing..."]}),e.jsx("div",{className:"dx-phases",children:Je.map((a,t)=>e.jsxs("div",{className:`dx-phase ${t<n?"done":""} ${t===n?"active":""} ${t>n?"pending":""}`,children:[e.jsx("span",{className:"dx-phase-icon",children:t<n?"âœ“":a.icon}),e.jsxs("div",{className:"dx-phase-text",children:[e.jsx("span",{className:"dx-phase-label",children:a.label}),e.jsx("span",{className:"dx-phase-detail",children:a.detail})]})]},t))}),e.jsx("div",{className:"dx-progress-bar",children:e.jsx("div",{className:"dx-progress-fill",style:{width:`${(n+1)/Je.length*100}%`}})}),s&&e.jsxs("div",{className:"dx-query-echo",children:[e.jsx("span",{className:"dx-query-label",children:"Your question:"}),e.jsxs("p",{className:"dx-query-text",children:["â€œ",s,"â€"]})]})]})})}Fe.propTypes={query:h.string};Fe.defaultProps={query:""};function Be({evidence:s}){const[n,r]=b.useState(!1);return!s||s.length===0?null:e.jsxs("details",{className:"evidence-panel",open:n,onToggle:a=>r(a.target.open),children:[e.jsxs("summary",{className:"evidence-toggle",children:[e.jsx("span",{className:"evidence-icon",children:"ðŸ“Ž"}),"Sources (",s.length,")"]}),e.jsx("div",{className:"evidence-list",children:s.map((a,t)=>e.jsxs("div",{className:"evidence-item",children:[e.jsxs("div",{className:"evidence-item-header",children:[e.jsxs("span",{className:"evidence-ref",children:["[",t+1,"]"]}),e.jsx("span",{className:"evidence-source-badge",children:a.source==="transcript"?"ðŸŽ¬ Transcript":"ðŸ“„ Docs"}),a.source==="transcript"?a.timestamp&&e.jsxs("span",{className:"evidence-timestamp",children:["@ ",a.timestamp]}):a.source==="epic_docs"&&a.url?e.jsxs("a",{href:a.url,target:"_blank",rel:"noopener noreferrer",className:"evidence-doc-link",children:[a.title||"Epic Developer Community",e.jsx("svg",{className:"external-icon",viewBox:"0 0 24 24",width:"12",height:"12",children:e.jsx("path",{fill:"currentColor",d:"M14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7zm-2 16H5V5h7V3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7z"})})]}):e.jsxs(e.Fragment,{children:[a.videoTitle&&e.jsx("span",{className:"evidence-video-title",children:a.videoTitle}),a.timestamp&&e.jsxs("span",{className:"evidence-timestamp",children:["@ ",a.timestamp]})]})]}),a.source==="transcript"?e.jsx("p",{className:"evidence-text",children:a.text}):e.jsxs("p",{className:"evidence-text",children:[a.text?.replace(/Unreal Engine \d\.\d/g,"").replace(/Epic Developer Community/g,"").replace(/\|/g,"").trim().substring(0,300),a.text?.length>300?"...":""]})]},t))})]})}Be.propTypes={evidence:h.arrayOf(h.shape({text:h.string,source:h.string,courseCode:h.string,videoTitle:h.string,timestamp:h.string,url:h.string,title:h.string}))};Be.defaultProps={evidence:[]};function Ge({onFeedback:s,isRerunning:n}){const[r,a]=b.useState("ask"),[t,i]=b.useState(""),c=b.useCallback(()=>{a("thanks"),s({solved:!0})},[s]),u=b.useCallback(()=>{a("no-reason")},[]),m=b.useCallback(()=>{s({solved:!1,reason:t.trim()}),a("thanks")},[s,t]);return r==="thanks"?e.jsxs("div",{className:"feedback-panel feedback-thanks",children:[e.jsx("span",{className:"feedback-icon",children:"âœ…"}),e.jsx("span",{children:"Thanks for the feedback!"}),n&&e.jsx("span",{className:"feedback-rerunning",children:"Re-analyzing with your feedback..."})]}):r==="no-reason"?e.jsxs("div",{className:"feedback-panel feedback-reason",children:[e.jsx("p",{className:"feedback-question",children:"What didn't work?"}),e.jsx("textarea",{className:"feedback-textarea",value:t,onChange:o=>i(o.target.value),placeholder:"e.g. I already tried that, the setting doesn't exist in my version, the issue is different...",maxLength:300,rows:2,disabled:n}),e.jsx("button",{className:"feedback-submit-btn",onClick:m,disabled:t.trim().length<5||n,children:n?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner"})," Re-analyzing..."]}):"Try a different approach â†’"})]}):e.jsxs("div",{className:"feedback-panel feedback-ask",children:[e.jsx("p",{className:"feedback-question",children:"Did this solve your problem?"}),e.jsxs("div",{className:"feedback-buttons",children:[e.jsx("button",{className:"feedback-btn feedback-yes",onClick:c,children:"ðŸ‘ Yes"}),e.jsx("button",{className:"feedback-btn feedback-no",onClick:u,children:"ðŸ‘Ž No"})]})]})}Ge.propTypes={onFeedback:h.func.isRequired,isRerunning:h.bool};Ge.defaultProps={isRerunning:!1};const Fs=["Lumen","Nanite","Niagara","Virtual Shadow Maps","VSM","Path Tracing","Forward Shading","Deferred Shading","Ray Tracing","Screen Space Reflections","World Partition","Level Streaming","Data Layers","Blueprint","Blueprints","C\\+\\+","Actor","Component","Pawn","Character","GameMode","PlayerController","AnimBlueprint","Content Browser","Details panel","World Outliner","Static Mesh Editor","Material Editor","Blueprint Editor","Sequencer","Level Sequence","Project Settings","World Settings","Rendering Settings","Static Mesh","Skeletal Mesh","Material Instance","Quixel","Megascans","MetaHuman","Chaos Physics","Enhanced Input","Gameplay Ability System","GAS","Common UI","UMG"],Bs="'([^']{2,60})'",Gs="([A-Z][\\w ]+(?:\\s*(?:â†’|->|>)\\s*[A-Z][\\w ]+)+)",Us=Fs.map(s=>`\\b${s}\\b`).join("|"),Ee=new RegExp(`${Bs}|${Gs}|${Us}`,"gi");function ce(s){if(!s||typeof s!="string")return s;const n=[];let r=0,a;for(Ee.lastIndex=0;(a=Ee.exec(s))!==null;){a.index>r&&n.push(s.slice(r,a.index));const t=a[1],i=a[2],c=t||i||a[0];n.push(e.jsx("strong",{className:"hl-term",children:c},a.index)),r=Ee.lastIndex}return r<s.length&&n.push(s.slice(r)),n.length>0?n:s}function Ue({answer:s,onFeedback:n,onBackToVideos:r,onStartOver:a,isRerunning:t}){if(!s)return null;const i=s.confidence==="high"?"#10b981":s.confidence==="med"?"#f59e0b":"#ef4444";return e.jsxs("div",{className:"answer-view",children:[e.jsxs("div",{className:"answer-header",children:[e.jsxs("h2",{className:"answer-title",children:[e.jsx("span",{className:"answer-icon",children:"ðŸŽ¯"})," Most Likely Cause"]}),e.jsxs("span",{className:"answer-confidence-badge",style:{background:`${i}22`,color:i,border:`1px solid ${i}44`},children:[s.confidence," confidence"]})]}),e.jsx("p",{className:"answer-cause",children:ce(s.mostLikelyCause)}),s.fastChecks?.length>0&&e.jsxs("div",{className:"answer-section answer-fast-checks",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"section-icon",children:"âš¡"})," Quick Checks"]}),e.jsx("ul",{children:s.fastChecks.map((c,u)=>e.jsxs("li",{children:[e.jsx("span",{className:"check-number",children:u+1}),e.jsx("span",{children:ce(c)})]},u))})]}),s.fixSteps?.length>0&&e.jsxs("div",{className:"answer-section answer-fix-steps",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"section-icon",children:"ðŸ”§"})," Fix Steps"]}),e.jsx("ol",{children:s.fixSteps.map((c,u)=>e.jsx("li",{children:ce(c)},u))})]}),s.ifStillBrokenBranches?.length>0&&e.jsxs("div",{className:"answer-section answer-branches",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"section-icon",children:"ðŸ”€"})," If Still Broken"]}),e.jsx("div",{className:"branch-list",children:s.ifStillBrokenBranches.map((c,u)=>e.jsxs("div",{className:"branch-item",children:[e.jsxs("span",{className:"branch-condition",children:["If ",ce(c.condition),":"]}),e.jsx("span",{className:"branch-action",children:ce(c.action)})]},u))})]}),s.learnPath?.objectives?.transferable?.length>0&&e.jsxs("div",{className:"answer-section answer-skills",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"section-icon",children:"ðŸ”„"})," Skills You'll Build"]}),e.jsx("ul",{className:"skills-list",children:s.learnPath.objectives.transferable.map((c,u)=>e.jsx("li",{children:ce(c)},u))})]}),s.whyThisResult?.length>0&&e.jsxs("div",{className:"answer-section answer-reasoning",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"section-icon",children:"ðŸ’¡"})," How the AI reached this conclusion"]}),e.jsx("ul",{className:"reasoning-list",children:s.whyThisResult.map((c,u)=>e.jsx("li",{children:e.jsx("span",{children:ce(c)})},u))})]}),e.jsx(Be,{evidence:s.evidence}),e.jsxs("div",{className:"answer-actions",children:[e.jsx("button",{className:"answer-action-btn primary",onClick:r,children:"ðŸ“š Browse Related Resources"}),e.jsx("button",{className:"answer-action-btn secondary",onClick:a,children:"â† Ask Another Question"})]}),e.jsx(Ge,{onFeedback:n,isRerunning:t})]})}Ue.propTypes={answer:h.shape({mostLikelyCause:h.string,confidence:h.oneOf(["high","med","low"]),fastChecks:h.arrayOf(h.string),fixSteps:h.arrayOf(h.string),ifStillBrokenBranches:h.arrayOf(h.shape({condition:h.string,action:h.string})),learnPath:h.shape({objectives:h.shape({transferable:h.arrayOf(h.string)})}),whyThisResult:h.arrayOf(h.string),evidence:h.array}),onFeedback:h.func.isRequired,onBackToVideos:h.func.isRequired,onStartOver:h.func.isRequired,isRerunning:h.bool};Ue.defaultProps={answer:null,isRerunning:!1};const Vs=60,Hs=new Set(["rendering.lumen","rendering.nanite","rendering.virtualShadowMaps","rendering.substrate","worldbuilding.worldPartition"]);function fe(s){return!!(s.videos?.length&&s.videos[0]?.drive_id||s.source==="youtube"&&s.youtube_url||s.source==="epic_docs")}function Ws(s){const n=(s||"").toLowerCase();return/\bue\s*5\b|\bunreal\s*engine\s*5\b|\b5\.\d\b/.test(n)?5:/\bue\s*4\b|\bunreal\s*engine\s*4\b|\b4\.\d{1,2}\b/.test(n)?4:null}async function is(s,n,r=[],a="",t=[],i=null){if(!n||n.length===0)return[];const c=s?.userQuery||"",u=c.toLowerCase();for(const l of ks)if(l.patterns.some(k=>u.includes(k))){const k=l.courses.map(L=>{const H=n.find(K=>K.code===L);return!H||!fe(H)?null:{...H,_relevanceScore:200,_curatedMatch:!0,_curatedExplanation:l.explanation}}).filter(Boolean);if(k.length>0)return O("âœ… Curated solution match:",l.explanation),k}const m=`${c} ${a}`.trim(),o=de.matchErrorSignature(m),f=o.map(l=>l.tag.tag_id),p=[...new Set([...r,...f])];o.length>0&&O("ðŸ” Error signatures detected:",o.map(l=>`${l.tag.display_name} (${l.matchedSignature}, ${l.confidence})`));const g=de.extractTagsFromText(c),y=g.matchedTagIds||[];if(y.length>0){O("ðŸ·ï¸ Tag taxonomy matches:",g.matches.map(l=>`${l.tagId} (via "${l.matchedTerm}", ${l.matchType})`));for(const l of y)p.includes(l)||p.push(l)}const N=a.toLowerCase().split(/[\s\n:;,()[\]{}]+/).filter(l=>l.length>3&&!/^[0-9]+$/.test(l)).slice(0,10),v=c.toLowerCase().split(/\s+/).filter(l=>l.length>2&&!Te.has(l)),T=new Set(v),d=c.toLowerCase();for(const[l,R]of Object.entries(Ts))if(d.includes(l))for(const k of R)k.split(/\s+/).forEach(L=>{L.length>2&&!Te.has(L)&&T.add(L)});const S=[...T],E=async l=>!l||l.length<5?[]:(await ms(l,n)).map(k=>{const L=n.find(H=>H.code===k.courseCode);return!L||!fe(L)?null:{...L,_relevanceScore:k.score,_matchedKeywords:k.matchedKeywords}}).filter(Boolean),I=l=>l.length===0?[]:n.filter(fe).map(k=>{const L=(k.title||"").toLowerCase(),H=(k.description||"").toLowerCase(),K=[...k.canonical_tags||[],...k.gemini_system_tags||[],...k.extracted_tags||[],...k.ai_tags||[]].map(q=>typeof q=="string"?q.toLowerCase():"").join(" ");let D=0;const $=[];for(const q of l)L.includes(q)?(D+=50,$.push(q)):K.includes(q)?(D+=30,$.push(q)):H.includes(q)&&(D+=10,$.push(q));if(y.length>0){const q=(k.canonical_tags||[]).map(ae=>ae.toLowerCase());y.some(ae=>q.some(we=>we.includes(ae.split(".").pop())))&&(D*=3)}const te=new Set($).size;te>=2&&(D*=1+te*.3);const ne=l.length>0?te/l.length:1;return l.length>=2&&ne<.5?D*=.3:ne>=1&&(D*=2),D===0?null:{...k,_relevanceScore:D,_matchedKeywords:$}}).filter(Boolean).sort((k,L)=>L._relevanceScore-k._relevanceScore),w=l=>p.length===0?l:l.map(R=>{const k=R.extracted_tags||R.tags||[],K=(Array.isArray(k)?k:Object.values(k)).map(D=>typeof D=="string"?D:D.tag_id||D.name||"").filter(Boolean).some(D=>p.some($=>D.toLowerCase().includes($.toLowerCase())||$.toLowerCase().includes(D.toLowerCase())));return{...R,_relevanceScore:K?R._relevanceScore*2:R._relevanceScore*.5}}).sort((R,k)=>k._relevanceScore-R._relevanceScore),_=N.length>0?`${c} ${N.join(" ")}`:c,V=await E(_),F=N.length>0?[...S,...N]:S,Q=I(F),x=new Set,j=[];for(const l of V)x.has(l.code)||(j.push(l),x.add(l.code));for(const l of Q)if(!x.has(l.code))j.push(l),x.add(l.code);else{const R=j.find(k=>k.code===l.code);R&&(R._relevanceScore+=l._relevanceScore)}const P=(j.length>0?j[0]._relevanceScore:0)>=Vs;if(t.length>0){const l=P?60:100,R=P?20:40;for(const k of t)if(x.has(k.code)){const L=j.find(H=>H.code===k.code);L&&(L._relevanceScore+=k.similarity*R)}else{const L=n.find(H=>H.code===k.code);L&&fe(L)&&(j.push({...L,_relevanceScore:k.similarity*l,_matchedKeywords:["semantic-match"],_semanticMatch:!0,_tier:P?2:1}),x.add(k.code))}}j.sort((l,R)=>R._relevanceScore-l._relevanceScore);const A=w(j);if(A.length>=3)return Me(Ae(A.slice(0,5),c),i);const z=[_,s?.diagnosis?.problem_summary,...s?.intent?.systems||[]].filter(Boolean).join(" "),se=z.toLowerCase().split(/\s+/).filter(l=>l.length>2&&!Te.has(l)),ee=await E(z),W=I(se);for(const l of[...ee,...W])x.has(l.code)||(j.push(l),x.add(l.code));j.sort((l,R)=>R._relevanceScore-l._relevanceScore);const ue=w(j);if(ue.length>=3)return Me(Ae(ue.slice(0,5),c),i);const he=n.map(l=>{const R=de.scoreCourseRelevance(l,F);return{...l,_relevanceScore:R.score,_scoreBreakdown:R.breakdown,_topContributors:R.topContributors}}).filter(l=>l._relevanceScore>0&&fe(l)).sort((l,R)=>R._relevanceScore-l._relevanceScore).slice(0,5);return Me(Ae(w(he),c),i)}function Me(s,n){return!n||n.size===0?s:s.map(r=>{const a=n.get(r.code);return a?(O(`ðŸ“Š Feedback boost: ${r.code} Ã— ${a.toFixed(2)}`),{...r,_relevanceScore:r._relevanceScore*a}):r}).sort((r,a)=>a._relevanceScore-r._relevanceScore)}function Ae(s,n){const r=Ws(n);return r?s.map(a=>{const i=[...a.canonical_tags||[],...a.gemini_system_tags||[],...a.extracted_tags||[]].map(c=>typeof c=="string"?c.toLowerCase():"").some(c=>[...Hs].some(u=>c.includes(u.split(".").pop())));return r===4&&i?(O(`â¬‡ï¸ UE4 demotion: ${a.code} (has UE5-only tags)`),{...a,_relevanceScore:a._relevanceScore*.2}):r===5&&i?{...a,_relevanceScore:a._relevanceScore*1.5}:a}).sort((a,t)=>t._relevanceScore-a._relevanceScore):s}let Le=null;async function zs(){if(!Le){const s=await us(()=>import("./data-courses-Cfgu6N5t.js").then(n=>n.m),[]);Le=s.default||s}return Le}function Qs(s,n){const a=n.replace(/[-_]/g," ").split(/\s+/).filter(i=>i.length>2).map(ze);return s.map(ze).some(i=>a.some(c=>i.includes(c)||c.includes(i)))}async function os(s,n,r={}){const a=[],t=(n||"").toLowerCase().split(/\s+/).filter(d=>d.length>2),i=await zs(),c=[],u=(n||"").toLowerCase(),m=u.split(/\s+/).filter(d=>d.length>2);for(const[d,S]of Object.entries(i))(u.includes(d)||Qs(m,d))&&c.push({label:S.label,url:S.url});for(const d of s){if(d.source==="youtube"&&d.youtube_url){const E=r[d.code]||{},I=(()=>{const w=(d._matchedKeywords||[]).filter(_=>_.length>3&&!Re.has(_.toLowerCase())).slice(0,3);return w.length>0?w:[d.topic||d.tags?.topic||"UE5"].flat().slice(0,3)})();a.push({driveId:d.youtube_url,title:Ie(d.title||d.code),duration:d.duration_seconds||0,courseCode:d.code,courseName:d.title||d.code,matchedTags:I,videoIndex:0,relevanceScore:d._relevanceScore||0,titleRelevance:0,isIntro:!1,timestampHint:null,startSeconds:0,topSegments:[],watchHint:"â–¶ Watch on YouTube",docLinks:c,_curatedMatch:d._curatedMatch||!1,_curatedExplanation:d._curatedExplanation||null,role:E.role||null,reason:E.reason||null,estimatedMinutes:E.estimatedMinutes||null,_source:"youtube",_externalUrl:d.youtube_url,type:"youtube",url:d.youtube_url,channel:d.channel_name||d.channel||null,channelTrust:d.channel_trust||null,topics:d.topics||[],description:d.description||"",durationMinutes:d.duration_seconds?Math.round(d.duration_seconds/60):10});continue}if(d.source==="epic_docs"){const E=d.url||d.youtube_url||"#",I=r[d.code]||{},w=(()=>{const _=(d._matchedKeywords||[]).filter(V=>V.length>3&&!Re.has(V.toLowerCase())).slice(0,3);return _.length>0?_:[d.topic||d.tags?.topic||"UE5"].flat().slice(0,3)})();a.push({driveId:`doc_${d.code}`,title:Ie(d.title||d.code),duration:0,courseCode:d.code,courseName:d.title||d.code,matchedTags:w,videoIndex:0,relevanceScore:d._relevanceScore||0,titleRelevance:0,isIntro:!1,timestampHint:null,startSeconds:0,topSegments:[],watchHint:"ðŸ“– Read Epic Docs",docLinks:[{label:d.title||"Epic Docs",url:E},...c],_curatedMatch:d._curatedMatch||!1,_curatedExplanation:d._curatedExplanation||null,role:I.role||null,reason:I.reason||null,estimatedMinutes:I.estimatedMinutes||null,_source:"epic_docs",_externalUrl:E,type:"doc",url:E,topics:d.topics||[],description:d.description||"",readTimeMinutes:10});continue}const S=d.videos||[];if(S.length!==0){S.sort((E,I)=>{const w=parseInt((E.name||"").match(/_(\d+)[_.]/)?.[1]||"999",10),_=parseInt((I.name||"").match(/_(\d+)[_.]/)?.[1]||"999",10);return w-_});for(let E=0;E<S.length;E++){const I=S[E];if(!I.drive_id)continue;const w=I.title||I.name||`Video ${E+1}`,_=w.toLowerCase(),V=Ie(w),F=t.filter(q=>_.includes(q)).length,Q=F*50,x=await Ks(d.code,w,E),j=await Ys(d.code,x,t),C=_.includes("intro")||_.includes("introduction")||_.includes("wrap up")||_.includes("outro")||_.includes("overview")||_.includes("getting started")||_.includes("welcome")||_.includes("course intro")||_.includes("what you'll learn")||_.includes("what we'll cover")||_.includes("summary")||_.includes("objectives")||/\bpart\s*a\b/i.test(w)&&E===0,P=C?.15:1,A=!C&&j.topSegments&&j.topSegments.length>0?15:0,U=I.duration_seconds||I.durationSeconds||0,z=U/60,se=z<2?.4:z<5?.7:z>20?1.1:1,ee=new Set;for(const q of j.topSegments||[])for(const Y of q.matchedKeywords||[])ee.add(Y);const W=ee.size,ue=F>=2||F===1&&W>=1?1:W>=2?.8:W===1?.3:F===1?.5:.15,xe=(d._relevanceScore||0)*ue,he=(Q+j.score+A+xe)*P*se,R=F===0&&j.score<30?Math.min(he,40):he,k=Rs(I.drive_id,R);let L="â–¶ Watch full video";const K=(j.topSegments||[]).filter(q=>!U||q.startSeconds<=U)[0]||(j.bestSegment&&(!U||j.bestSegment.startSeconds<=U)?j.bestSegment:null);if(K){const q=K.timestamp||"0:00",Y=K.previewText,ae=Y.length>60?Y.substring(0,57)+"...":Y;L=K.startSeconds<5?`ðŸ“ Start of video â€” "${ae}"`:`ðŸ“ Jump to ${q} â€” "${ae}"`}const D=r[d.code]||{},$=(()=>{const q=(d._matchedKeywords||[]).filter(Y=>Y.length>3&&!Re.has(Y.toLowerCase())).slice(0,3);return q.length>0?q:[d.topic||d.tags?.topic||"UE5"].flat().slice(0,3)})(),te=j.bestSegment?.startSeconds||0,ne=U&&te>U?0:te;a.push({driveId:I.drive_id,title:V,duration:I.duration_seconds||0,courseCode:d.code,courseName:d.title||d.code,matchedTags:$,videoIndex:E,relevanceScore:k,titleRelevance:F,isIntro:C,timestampHint:ne>0&&j.bestSegment?.timestamp||null,startSeconds:ne,topSegments:j.topSegments||[],watchHint:L,docLinks:c,_curatedMatch:d._curatedMatch||!1,_curatedExplanation:d._curatedExplanation||null,role:D.role||null,reason:D.reason||null,estimatedMinutes:D.estimatedMinutes||null})}}}const o=new Map;for(const d of a){const S=o.get(d.driveId);(!S||d.relevanceScore>S.relevanceScore)&&o.set(d.driveId,d)}const f=Array.from(o.values());f.sort((d,S)=>S.relevanceScore-d.relevanceScore);const p=new Map,g=2,y=f.filter(d=>{const S=p.get(d.courseCode)||0;return S>=g?!1:(p.set(d.courseCode,S+1),!0)}),N=new Set;for(const d of y)d.isIntro||N.add(d.courseCode);const v=y.filter(d=>!(d.isIntro&&N.has(d.courseCode)));if(v.length>3){const d=v.map(w=>w.relevanceScore),S=d[Math.floor(d.length/2)],E=Math.max(S*.5,10),I=v.filter(w=>w.relevanceScore>=E);if(I.length>=3){const w=I.slice(0,6);return Xe(w,t),w}}const T=v.slice(0,6);return Xe(T,t),T}function Xe(s,n){if(s.length===0)return;const r=Math.max(s[0].relevanceScore,1);for(const a of s){a.matchPercent=Math.min(100,Math.round(a.relevanceScore/r*100));const t=[];if(a._curatedMatch&&t.push("Known solution for this problem"),a.titleRelevance>0){const i=n.filter(c=>(a.title||"").toLowerCase().includes(c)).slice(0,3);i.length>0&&t.push(`Title matches: ${i.join(", ")}`)}if(a.topSegments.length>0){const i=new Set;for(const u of a.topSegments)for(const m of u.matchedKeywords||[])i.add(m);const c=[...i].slice(0,4);c.length>0&&t.push(`Transcript mentions: ${c.join(", ")}`)}a.matchedTags.length>0&&t.length<2&&t.push(`Tagged: ${a.matchedTags.slice(0,3).join(", ")}`),a.matchReason=t.length>0?t.join(" Â· "):"Related to your query"}}async function Ks(s,n,r){const t=(await ts())[s];if(!t?.videos)return null;const i=p=>(p||"").toLowerCase().replace(/\.mp4$/i,"").replace(/_/g," ").replace(/\s+/g," ").trim(),c=i(n),u=c.split(" ").filter(p=>p.length>2),m=Object.keys(t.videos);for(const p of m)if(i(t.videos[p].title||"")===c)return p;let o=null,f=0;for(const p of m){const g=i(t.videos[p].title||""),y=i(p),N=g+" "+y;let v=0;for(const T of u)new RegExp(`(^|\\s|_)${T.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&")}(\\s|_|$)`,"i").test(N)&&v++;v>0&&v>f&&(f=v,o=p)}if(o&&f>=Math.max(1,u.length*.5))return o;for(const p of m){const g=i(t.videos[p].title||""),y=i(p);if(c.includes(g)||g.includes(c)||c.includes(y)||y.includes(c))return p}return r<m.length?m[r]:m[0]||null}async function Ys(s,n,r){const a={score:0,bestSegment:null,topSegments:[]},i=(await ts())[s];if(!i?.videos||!n)return a;const c=i.videos[n];if(!c?.segments)return a;const u=[];for(const f of c.segments){const p=f.text.toLowerCase();let g=0;const y=[];for(const N of r)if(p.includes(N)){const v=p.split(N).length-1;g+=v*10,y.push(N)}if(g>0){let N=f.text;if(N.length>100){const v=N.toLowerCase().indexOf(y[0]||"");v>30&&(N="..."+N.substring(v-20)),N.length>100&&(N=N.substring(0,97)+"...")}u.push({timestamp:f.start,startSeconds:f.start_seconds,previewText:N,matchedKeywords:y,score:g})}}u.sort((f,p)=>p.score-f.score);const m=u.slice(0,3);return{score:u.reduce((f,p)=>f+p.score,0),bestSegment:m[0]||null,topSegments:m}}const Ze={prerequisite:0,core:1,troubleshooting:2,supplemental:3};function Js(s){return s.estimated_minutes?s.estimated_minutes:s.total_duration_seconds?Math.round(s.total_duration_seconds/60):(s.videos?.length||1)*10}function es(s,n){if(n.size===0)return 0;const r=new Set([...s.canonical_tags||[],...s.gemini_system_tags||[],...s.transcript_tags||[]].map(t=>typeof t=="string"?t.toLowerCase():""));if(r.size===0)return 0;let a=0;for(const t of r)(n.has(t)||n.has(t.split(".").pop()))&&a++;return a/r.size}function Xs(s,n){const r=[...s.canonical_tags||[],...s.gemini_system_tags||[]].map(u=>typeof u=="string"?u.toLowerCase():""),a=new Set(n.map(u=>u.toLowerCase()));let t=!1;for(const u of r)if(a.has(u)||a.has(u.split(".").pop())){t=!0;break}const i=r.some(u=>{const m=de.getTag(u);return m?.tag_type==="symptom"||m?.tag_type==="error_code"});let c=!1;for(const u of r){const m=de.edgesBySource?.get(u)||[];for(const o of m)if(o.relation==="subtopic"&&a.has(o.target)){c=!0;break}if(c)break}return c?"prerequisite":i?"troubleshooting":t?"core":"supplemental"}function cs(s,n,r={}){const{timeBudgetMinutes:a=1/0,maxItems:t=8,preferTroubleshooting:i=!1,diversity:c=!0}=r;if(!s||s.length===0)return{path:[],metadata:{totalMinutes:0,tagCoverage:0,diversityScore:1,itemCount:0}};const u=s.map(v=>({course:v,role:Xs(v,n),estimatedMinutes:Js(v),score:v._relevanceScore||0}));u.sort((v,T)=>{const d=Ze[v.role]-Ze[T.role];return d!==0?d:T.score-v.score}),i&&u.sort((v,T)=>{const d=v.role==="troubleshooting"?0:1,S=T.role==="troubleshooting"?0:1;return d!==S?d-S:T.score-v.score});const m=[],o=new Set;let f=0;for(const v of u){if(m.length>=t)break;if(f+v.estimatedMinutes>a||c&&m.length>0&&es(v.course,o)>.7)continue;const T=Zs(v,n);m.push({course:v.course,role:v.role,reason:T,estimatedMinutes:v.estimatedMinutes}),f+=v.estimatedMinutes,[...v.course.canonical_tags||[],...v.course.gemini_system_tags||[]].map(S=>typeof S=="string"?S.toLowerCase():"").forEach(S=>{o.add(S),o.add(S.split(".").pop())})}const p=new Set(n.map(v=>v.toLowerCase()));let g=0;for(const v of p)(o.has(v)||o.has(v.split(".").pop()))&&g++;const y=p.size>0?g/p.size:0;let N=1;if(m.length>1){let v=0;const T=new Set;for(const d of m)v+=es(d.course,T),[...d.course.canonical_tags||[]].map(E=>E?.toLowerCase?.()||"").forEach(E=>T.add(E));N=1-v/m.length}return{path:m,metadata:{totalMinutes:f,tagCoverage:Math.round(y*100)/100,diversityScore:Math.round(N*100)/100,itemCount:m.length}}}function Zs(s,n){const{course:r,role:a}=s,t=[...r.canonical_tags||[],...r.gemini_system_tags||[]].map(u=>typeof u=="string"?u.toLowerCase():""),i=new Set(n.map(u=>u.toLowerCase())),c=t.filter(u=>i.has(u)||i.has(u.split(".").pop()));switch(a){case"prerequisite":return`Foundation course â€” covers prerequisite concepts for ${c.slice(0,2).join(", ")}`;case"core":return`Directly covers: ${c.slice(0,3).join(", ")}`;case"troubleshooting":return"Troubleshooting guide â€” addresses symptoms related to your query";case"supplemental":return"Related content â€” expands on topics connected to your query";default:return"Relevant to your search"}}const Ve={QUERY_SUBMITTED:"query_submitted",DIAGNOSIS_GENERATED:"diagnosis_generated",LEARNING_PATH_GENERATED:"learning_path_generated"};let Pe=null;function et(){return Pe||(Pe=`session_${Date.now()}_${Math.random().toString(36).substring(2,9)}`),Pe}async function He(s,n={}){try{const r=as(),a={event:s,session_id:et(),...n,timestamp:js(),client_timestamp:new Date().toISOString()};await Ns(_s(r,"analytics_events"),a)}catch(r){Z("[Analytics] Failed to track event:",s,r.message)}}function st(s,n=[],r=null){return He(Ve.QUERY_SUBMITTED,{query_length:s?.length||0,query_preview:s?.substring(0,100),detected_tag_count:n.length,detected_tags:n.slice(0,5),persona_id:r})}function tt(s){return He(Ve.DIAGNOSIS_GENERATED,{diagnosis_id:s?.diagnosis_id,root_causes_count:s?.root_causes?.length||0,signals_count:s?.signals_to_watch_for?.length||0,generalization_scope:s?.generalization_scope?.slice(0,3)})}function nt(s,n,r=!0){return He(Ve.LEARNING_PATH_GENERATED,{fix_specific_count:s?.fix_specific?.length||0,transferable_count:s?.transferable?.length||0,course_count:n?.length||0,passed_validation:r})}async function at(s,n={}){const{maxPassages:r=10,maxCourses:a=8,maxSegments:t=8,maxDocs:i=6,minSimilarity:c=.35}=n,u=Ne(),m=rs(u,"us-central1");let o=null,f=[],p=[],g=[];try{const y=je(m,"embedQuery"),N=je(m,"expandQuery"),[v,T]=await Promise.allSettled([y({query:s}),N({query:s})]);if(T.status==="fulfilled"&&T.value.data?.expansions&&(g=T.value.data.expansions,O(`[QueryExpansion] ${g.length} variants: ${g.join(" | ")}`)),v.status==="fulfilled"&&v.value.data?.success&&v.value.data?.embedding){o=v.value.data.embedding;const[d,S,E]=await Promise.allSettled([ps(o,a,c),$e(s,o,[],t),ns(o,i,c)]);if(d.status==="fulfilled"?f=d.value:Z("âš ï¸ Course semantic search failed:",d.reason?.message),S.status==="fulfilled"){const w=S.value.map(_=>({text:_.previewText,courseCode:_.courseCode,videoTitle:_.videoTitle,timestamp:_.timestamp,similarity:_.similarity,source:"transcript"}));p.push(...w),O(`[RAG] ${w.length} transcript passages`)}else Z("âš ï¸ Segment search failed:",S.reason?.message);if(E.status==="fulfilled"){const w=E.value.map(_=>({text:_.previewText,url:_.url,title:_.title,section:_.section,similarity:_.similarity,source:"epic_docs"}));p.push(...w),O(`[RAG] ${w.length} doc passages`)}else Z("âš ï¸ Docs search failed:",E.reason?.message);if(g.length>0){const w=g.map(F=>$e(F,null,[],4).catch(()=>[])),_=await Promise.allSettled(w);let V=0;for(const F of _)if(F.status==="fulfilled"&&F.value.length>0){const Q=F.value.map(x=>({text:x.previewText,courseCode:x.courseCode,videoTitle:x.videoTitle,timestamp:x.timestamp,similarity:(x.similarity||0)*.9,source:"transcript"}));p.push(...Q),V+=Q.length}V>0&&O(`[QueryExpansion] +${V} passages from expanded queries`)}p.sort((w,_)=>(_.similarity||0)-(w.similarity||0));const I=new Set;p=p.filter(w=>{const _=(w.text||"").trim().toLowerCase().slice(0,120);return I.has(_)?!1:(I.add(_),!0)}),O(`[RAG] Total: ${p.length} passages after rank+dedup`)}}catch(y){Z("âš ï¸ Semantic search skipped:",y.message)}if(p.length>2)try{const N=await je(m,"rerankPassages")({query:s,passages:p.slice(0,20)});N.data?.success&&N.data?.reranked&&(p=N.data.reranked,N.data.fallback||O("[Rerank] Passages re-ranked by Gemini cross-encoder"))}catch(y){Z("âš ï¸ Re-ranking skipped:",y.message)}return p=p.slice(0,r),{queryEmbedding:o,semanticResults:f,retrievedPassages:p,expandedQueries:g}}async function rt(s,n,r,a,t){try{const c=[...n.diagnosis?.matched_tag_ids||[],...s.detectedTagIds||[]].flatMap(g=>g.split(/[._]/).filter(y=>y.length>2&&y!=="unreal"&&y!=="engine")),u=(s.query||"").toLowerCase().split(/\s+/).filter(g=>g.length>2&&!t.has(g)),m=[...new Set(u)],o=g=>m.some(y=>y.includes(g));o("mesh")&&!o("skeletal")&&m.push("static mesh","static meshes","import","importing"),(o("size")||o("scale"))&&m.push("scale","transform");const f=[...new Set([...c,...m])].slice(0,15);if(O(`[DocTopics] ${m.join(", ")}`),O(`[AllTopics] ${f.join(", ")}`),f.length===0)return null;const p=await gs(f,r,{maxDocs:5,maxYoutube:3});for(const g of a)g.type==="doc"&&!p.docs.some(y=>y.url===g._externalUrl)&&p.docs.push({label:g.title,url:g._externalUrl||g.url,description:g.description||"",readTimeMinutes:g.readTimeMinutes||10,tier:"intermediate"}),g.type==="youtube"&&!p.youtube.some(y=>y.url===g._externalUrl)&&p.youtube.push({title:g.title,url:g._externalUrl||g.url,channelName:g.channel||"YouTube",channelTrust:g.channelTrust||null,durationMinutes:g.durationMinutes||10,tier:"intermediate"});return p.docs.sort((g,y)=>(y._rawScore??y.matchScore??0)-(g._rawScore??g.matchScore??0)),O(`[Blended] ${p.docs.length} docs, ${p.youtube.length} YT, coverage: ${(p.coverageScore*100).toFixed(0)}%`),p}catch(i){return Z("âš ï¸ Blended path skipped:",i.message),null}}async function it(s,n,r,a,t={}){const{preferTroubleshooting:i=!1,errorLog:c=""}=t,u=Ss(Ne()).currentUser,m=u?await Is(u.uid):null,o=await is(s,n,r.selectedTagIds||[],c,a,m);s.matchedCourses=o;const f=[...s.diagnosis?.matched_tag_ids||[],...r.detectedTagIds||[],...r.selectedTagIds||[]],p=cs(o,f,{preferTroubleshooting:i,diversity:!0,timeBudgetMinutes:300}),g={};for(const T of p.path)g[T.course.code]={role:T.role,reason:T.reason,estimatedMinutes:T.estimatedMinutes};const y=await os(o,r.query,g),N=y.filter(T=>!T.type||T.type==="video"),v=y.filter(T=>T.type==="doc"||T.type==="youtube");return{matchedCourses:o,driveVideos:N,nonVideoItems:v,allItems:y}}const G={INPUT:"input",LOADING:"loading",CLARIFYING:"clarifying",ANSWERED:"answered",DIAGNOSIS:"diagnosis",GUIDED:"guided",ERROR:"error"};function ot(){const[s,n]=b.useState(G.INPUT),[r,a]=b.useState(null),[t,i]=b.useState(null),[c,u]=b.useState(null),[m,o]=b.useState([]),[f,p]=b.useState(null),[g,y]=b.useState(null),[N,v]=b.useState(null),[T,d]=b.useState(!1),[S,E]=b.useState(null),[I,w]=b.useState([]),{cart:_,addToCart:V,removeFromCart:F,clearCart:Q,isInCart:x}=fs(),j=hs(),C=b.useMemo(()=>j?.courses||[],[j?.courses]),P=b.useCallback(()=>{try{const l=localStorage.getItem("detected_persona");return l?JSON.parse(l):null}catch{return null}},[]),A=b.useCallback(async(l,R)=>{Q(),n(G.LOADING),i(null),p(null),y(null),E(l);const k=R||N;l.pastedImage&&O("[ProblemFirst] Screenshot attached (base64 length):",l.pastedImage.length),l.errorLog&&O("[ProblemFirst] Error log attached:",l.errorLog.slice(0,200));try{if(l.cachedCartId){O(`[Cache] Checking Firestore for cart: ${l.cachedCartId}`);try{const J=Ne(),M=as(J),Ce=ws(M,"adaptive_carts",l.cachedCartId),re=await Cs(Ce);if(re.exists()){const me=re.data(),pe=me.cached_at?.toDate?.()||new Date(me.created_at||0),ge=Date.now()-pe.getTime(),ye=1440*60*1e3;if(ge<ye){O(`[Cache Hit] Cart is ${Math.round(ge/6e4)}min old â€” using cached result`);const ie={...me,userQuery:l.query,retrievedPassages:[]},oe=await is(ie,C,l.selectedTagIds||[],l.errorLog||"",[],null);ie.matchedCourses=oe;const ve=[...ie.diagnosis?.matched_tag_ids||[],...l.detectedTagIds||[],...l.selectedTagIds||[]],X=cs(oe,ve,{preferTroubleshooting:!0,diversity:!0,timeBudgetMinutes:300}),B={};for(const be of X.path)B[be.course.code]={role:be.role,reason:be.reason,estimatedMinutes:be.estimatedMinutes};const ke=await os(oe,l.query,B);if(ke.length>0){o(ke),a(ie),n(G.DIAGNOSIS),O(`[Cache] Loaded ${ke.length} videos from cached cart â€” 0 Gemini calls`);return}Z("[Cache] Cached cart produced 0 videos â€” falling through to fresh diagnosis")}else O(`[Cache Expired] Cart is ${Math.round(ge/36e5)}h old â€” refreshing`)}else O(`[Cache Miss] Cart ${l.cachedCartId} not found in Firestore`)}catch(J){Z("[Cache Error] Falling through to fresh diagnosis:",J.message)}}await st(l.query,l.detectedTagIds,P()?.id);let{semanticResults:L,retrievedPassages:H}=await at(l.query,{maxPassages:10});const K=Ne(),D=rs(K,"us-central1");let $,te=!0,ne=!1;try{const J=je(D,"queryLearningPath");let M=await J({query:l.query,mode:"problem-first",detectedTagIds:l.detectedTagIds,personaHint:l.personaHint,retrievedContext:H.slice(0,10),caseReport:k||void 0,conversationHistory:l._conversationHistory||I});if(!M.data.success&&M.data.error==="off_topic"){i(M.data.message||"This doesn't appear to be a UE5 question. Please describe a specific Unreal Engine 5 issue."),n(G.ERROR);return}if(M.data.responseType==="NEEDS_CLARIFICATION"){w(re=>[...re,{role:"assistant",content:M.data.question}]),y({question:M.data.question,options:M.data.options||[],whyAsking:M.data.whyAsking||"",query:M.data.query,caseReport:M.data.caseReport,clarifyRound:M.data.clarifyRound||1,maxClarifyRounds:M.data.maxClarifyRounds||3,conversationHistory:M.data.conversationHistory||[]}),n(G.CLARIFYING);return}if(M.data.responseType==="NEEDS_MORE_CONTEXT"){O(`[AgenticRAG] Cloud function requested ${M.data.searchQueries?.length} targeted searches: ${M.data.searchQueries?.join(" | ")}`);try{const re=(M.data.searchQueries||[]).flatMap(X=>[$e(X,null,[],4).catch(()=>[]),ns(null,3,.3,X).catch(()=>[])]),me=await Promise.allSettled(re),pe=[];for(const X of me)if(!(X.status!=="fulfilled"||!Array.isArray(X.value)))for(const B of X.value)(B.previewText||B.text)&&pe.push({text:B.previewText||B.text||"",courseCode:B.courseCode||"",videoTitle:B.videoTitle||B.title||"",timestamp:B.timestamp||"",similarity:(B.similarity||0)*.85,source:B.url?"epic_docs":"transcript",url:B.url||"",title:B.title||"",section:B.section||""});O(`[AgenticRAG] Found ${pe.length} additional passages`);const ge=[...H,...pe],ye=new Set,ie=ge.filter(X=>{const B=(X.text||"").trim().toLowerCase().slice(0,120);return ye.has(B)?!1:(ye.add(B),!0)});ie.sort((X,B)=>(B.similarity||0)-(X.similarity||0));const oe=ie.slice(0,12);O(`[AgenticRAG] Re-submitting with ${oe.length} enriched passages`);const ve=await J({query:l.query,mode:"problem-first",detectedTagIds:l.detectedTagIds,personaHint:l.personaHint,retrievedContext:oe,caseReport:k||void 0,conversationHistory:l._conversationHistory||I,agenticRound:M.data.agenticRound||1});ve.data?.responseType==="ANSWER"?(M=ve,H=oe):Z("[AgenticRAG] Retry didn't produce ANSWER, using original result")}catch(re){Z("[AgenticRAG] Escalation failed, proceeding with best-effort:",re.message)}}if(!M.data.success)throw new Error(M.data.message||"Failed to process query");M.data.responseType==="ANSWER"&&M.data.mostLikelyCause&&(ne=!0,p({mostLikelyCause:M.data.mostLikelyCause,confidence:M.data.confidence,fastChecks:M.data.fastChecks||[],fixSteps:M.data.fixSteps||[],ifStillBrokenBranches:M.data.ifStillBrokenBranches||[],whyThisResult:M.data.whyThisResult||[],evidence:M.data.evidence||[],learnPath:M.data.learnPath})),$=M.data.cart}catch(J){const M=J.message?.includes("429")||J.code==="resource-exhausted";if(J.message?.includes("off_topic")||J.message?.includes("not a UE5")){i(`This doesn't appear to be a UE5 question. Try describing a specific Unreal Engine 5 issue, for example:
â€¢ "Lumen reflections flickering"
â€¢ "Blueprint compile error"
â€¢ "Niagara particles not spawning"`),n(G.ERROR);return}Z(`âš ï¸ Gemini ${M?"rate limited (429)":"error"}: ${J.message}. Falling back to local matching.`),te=!1,$={diagnosis:{problem_summary:l.query,matched_tag_ids:l.detectedTagIds||[]},objectives:[],intent:{systems:[]}}}$.userQuery=l.query,$.retrievedPassages=H,$._localFallback=!te;const{matchedCourses:q,driveVideos:Y,nonVideoItems:ae,allItems:we}=await it($,C,l,L,{preferTroubleshooting:!0,errorLog:l.errorLog||""});if(we.length===0){i(`We couldn't find UE5 content matching your query. Try describing a specific Unreal Engine problem, for example:
â€¢ "Blueprint compile error LNK2019"
â€¢ "Lumen reflections flickering in indoor scene"
â€¢ "Niagara particle system not spawning"
â€¢ "UMG widget not rendering"`),n(G.ERROR);return}o(Y),a($);const We=await rt(l,$,Y,ae,xs);We&&u(We),n(ne?G.ANSWERED:G.DIAGNOSIS),l.updateCartIdForQuery&&$.cart_id&&(l.updateCartIdForQuery(l.query,$.cart_id),O(`[Cache] Saved cart_id ${$.cart_id} to history for: "${l.query.substring(0,40)}..."`)),await tt($.diagnosis),await nt($.objectives,q,$.validation?.approved)}catch(L){console.error("[ProblemFirst] Error:",L),i(L.message||"An unexpected error occurred"),n(G.ERROR)}},[C,P,Q,N,I]),U=b.useCallback(()=>n(G.INPUT),[]),z=b.useCallback(()=>{n(G.INPUT),a(null),o([]),i(null),u(null),p(null),y(null),v(null),d(!1),w([])},[]),se=b.useCallback(l=>{if(!S)return;const R=[...I,{role:"user",content:l}];w(R);const k={...S,_conversationHistory:R};A(k,N)},[S,N,A,I]),ee=b.useCallback(()=>{if(!S)return;const l=[...I,{role:"user",content:"(skipped â€” proceed with best effort)"}];w(l);const R={...S,_conversationHistory:l};A(R,N)},[S,N,A,I]),W=b.useCallback(l=>{if(l.solved||!S)return;d(!0);const R={...N||{},exclusions:[...(N||{}).exclusions||[],l.reason||"Previous solution did not work"]};v(R),A(S,R)},[S,N,A]),ue=b.useCallback(()=>{n(G.DIAGNOSIS)},[]),xe=b.useCallback(l=>{x(l.driveId)?F(l.driveId):V(l)},[x,V,F]),he=b.useCallback(()=>{_.length>0&&n(G.GUIDED)},[_]);return{stage:s,diagnosisData:r,error:t,blendedPath:c,videoResults:m,answerData:f,clarifyData:g,isRerunning:T,courses:C,cart:_,addToCart:V,removeFromCart:F,clearCart:Q,isInCart:x,handleSubmit:A,handleReset:z,handleAskAgain:U,handleClarifyAnswer:se,handleClarifySkip:ee,handleFeedback:W,handleBackToVideos:ue,handleVideoToggle:xe,handleWatchPath:he,setCaseReport:v,getDetectedPersona:P}}function ct(s,n,r=null){const a=new Map,t=[];for(const o of s){const f=o.type||"video";if(f==="doc"||f==="youtube"){const g=t.filter(N=>N.startsWith("_doc_")).length===0,y=`_doc_${o.itemId||o.url||o.driveId}`;t.push(y),a.set(y,{course:{code:o.itemId||o.driveId||`${f}_${o.url}`,title:o.title,_readingStep:!0,_resourceType:f,_description:o.description||"",_keySteps:g&&r?.length>0?r:o.keyTakeaways||o.keySteps||[],_seeAlso:o.seeAlso||[],_url:o.url,_tier:o.tier,_channel:o.channel||o.channelName,_channelTrust:o.channelTrust,_subsystem:o.subsystem,_topics:o.topics||[],_sections:o.sections||[],_chapters:o.chapters||[],_readTimeMinutes:o.readTimeMinutes||o.durationMinutes||10,videos:[]}});continue}const p=o.courseCode;if(!a.has(p)){const g=n.find(y=>y.code===p);t.push(p),a.set(p,{course:g?{...g,videos:[]}:{code:p,title:o.courseName,videos:[]},videos:[]})}a.get(p).videos.push({drive_id:o.driveId,title:o.title,duration_seconds:o.duration,_videoIndex:o.videoIndex??999})}const i=t.map(o=>{const f=a.get(o);return f.videos?.length>0&&(f.videos.sort((p,g)=>p._videoIndex-g._videoIndex),f.course.videos=f.videos),f.course}),c=new Set(["100.01","100.02"]),u=i.filter(o=>c.has(o.code)),m=i.filter(o=>!c.has(o.code));return[...u,...m]}function It(){const{stage:s,diagnosisData:n,error:r,blendedPath:a,videoResults:t,answerData:i,clarifyData:c,isRerunning:u,courses:m,cart:o,addToCart:f,removeFromCart:p,clearCart:g,isInCart:y,handleSubmit:N,handleReset:v,handleAskAgain:T,handleClarifyAnswer:d,handleClarifySkip:S,handleFeedback:E,handleBackToVideos:I,handleVideoToggle:w,handleWatchPath:_,setCaseReport:V,getDetectedPersona:F}=ot(),[Q,x]=b.useState(""),j=b.useCallback((...C)=>(typeof C[0]=="string"?x(C[0]):C[0]?.query&&x(C[0].query),N(...C)),[N]);return e.jsxs("div",{className:"problem-first-page",children:[e.jsxs("header",{className:"page-header",children:[e.jsx("h1",{children:"ðŸ”§ Fix a Problem"}),e.jsx("p",{children:"Describe your issue. We'll diagnose it and show you how to fix it."})]}),s===G.INPUT&&e.jsxs("div",{className:"pf-input-layout",children:[e.jsx("div",{className:"pf-input-main",children:e.jsx(Oe,{onSubmit:j,detectedPersona:F(),isLoading:!1})}),e.jsx("aside",{className:"pf-input-sidebar",children:e.jsx(qe,{onUpdate:V,disabled:!1})})]}),s===G.LOADING&&e.jsx(Fe,{query:Q}),s===G.CLARIFYING&&c&&e.jsx(De,{question:c.question,options:c.options,whyAsking:c.whyAsking,onAnswer:d,onSkip:S,isLoading:!1,clarifyRound:c.clarifyRound||1,maxClarifyRounds:c.maxClarifyRounds||3,conversationHistory:c.conversationHistory||[]}),s===G.ANSWERED&&i&&e.jsx(Ue,{answer:i,onFeedback:E,onBackToVideos:I,onStartOver:v,isRerunning:u}),s===G.ERROR&&e.jsxs("div",{className:"error-state",children:[e.jsx("div",{className:"error-icon",children:"âš ï¸"}),e.jsx("h3",{children:"Something went wrong"}),e.jsx("p",{children:r}),e.jsx("button",{className:"retry-btn",onClick:v,children:"Try Again"})]}),s===G.DIAGNOSIS&&n&&e.jsxs("div",{className:"shopping-layout",children:[e.jsxs("div",{className:"results-column",children:[e.jsxs("div",{className:"tldr-diagnosis",children:[e.jsxs("div",{className:"tldr-user-query",children:[e.jsx("span",{className:"tldr-query-label",children:"ðŸ” You asked:"}),e.jsx("p",{className:"tldr-query-text",children:n.userQuery})]}),n._localFallback&&e.jsxs("div",{className:"tldr-fallback-notice",style:{background:"rgba(255, 193, 7, 0.1)",border:"1px solid rgba(255, 193, 7, 0.3)",borderRadius:"8px",padding:"8px 14px",margin:"8px 0",fontSize:"0.85rem",color:"var(--text-muted, #aaa)"},children:["âš¡ ",e.jsx("strong",{children:"Fast results"})," â€” AI diagnosis temporarily unavailable. Videos matched by tag taxonomy. Try again in a moment for AI-powered results."]}),n.diagnosis?.problem_summary&&e.jsx("p",{className:"tldr-bridge",children:"Based on your question, we think these videos will help you:"})]}),e.jsxs("h2",{className:"results-title",children:["ðŸŽ¬ Videos for You (",t.length,")"]}),t.length===0&&e.jsx("div",{className:"no-results",children:e.jsx("p",{children:"No matching videos found. Try rephrasing your question."})}),e.jsx(lt,{videoResults:t,isInCart:y,handleVideoToggle:w,userQuery:n?.userQuery||""}),a?.docs?.length>0&&e.jsx(dt,{docs:a.docs,isInCart:y,addToCart:f,removeFromCart:p}),a?.youtube?.length>0&&e.jsx(ht,{youtube:a.youtube,isInCart:y,addToCart:f,removeFromCart:p}),e.jsxs("div",{className:"results-actions-bottom",children:[e.jsx("button",{className:"back-btn",onClick:v,children:"â† Start Over"}),e.jsx("button",{className:"ask-again-btn",onClick:T,children:"+ Ask Another Question"})]})]}),e.jsx("div",{className:"cart-column",children:e.jsx(ys,{cart:o,onRemove:p,onClear:g,onWatchPath:_})})]}),s===G.GUIDED&&e.jsx(vs,{courses:ct(o,m,n?.microLesson?.quick_fix?.steps),diagnosis:n?.diagnosis,problemSummary:n?.diagnosis?.problem_summary,pathSummary:n?.pathSummary,microLesson:n?.microLesson,fixRecipe:i?{mostLikelyCause:i.mostLikelyCause,fixSteps:i.fixSteps||[],fastChecks:i.fastChecks||[]}:null,onComplete:()=>{},onExit:()=>I()})]})}const ss=[{key:"prerequisite",icon:"ðŸ”—",label:"Prerequisite",desc:"Build the foundation first â€” these cover concepts you'll need before tackling the main topic."},{key:"core",icon:"â­",label:"Core",desc:"These directly address your question and are the most important videos to watch."},{key:"troubleshooting",icon:"ðŸ”§",label:"Troubleshooting",desc:"Debugging helpers â€” watch these if you're hitting errors or unexpected behavior."},{key:"supplemental",icon:"ðŸ“š",label:"Supplemental",desc:"Go deeper â€” extra context and advanced techniques for when you're ready."}];function lt({videoResults:s,isInCart:n,handleVideoToggle:r,userQuery:a}){const t={};for(const i of ss)t[i.key]=[];t._other=[];for(const i of s){const c=i.role||"_other";(t[c]||t._other).push(i)}return e.jsxs(e.Fragment,{children:[ss.filter(i=>t[i.key].length>0).map(i=>e.jsxs("div",{className:"role-section",children:[e.jsxs("div",{className:"role-section-header",children:[e.jsxs("h3",{className:"role-section-title",children:[i.icon," ",i.label,e.jsx("span",{className:"role-section-count",children:t[i.key].length})]}),e.jsx("p",{className:"role-section-desc",children:i.desc})]}),e.jsx("div",{className:"video-results-grid",children:t[i.key].map(c=>e.jsx("div",{className:"video-result-wrapper",id:`video-${c.driveId}`,children:e.jsx(Qe,{video:c,isAdded:n(c.driveId),onToggle:r,userQuery:a})},c.driveId))})]},i.key)),t._other.length>0&&e.jsxs("div",{className:"role-section",children:[e.jsxs("div",{className:"role-section-header",children:[e.jsxs("h3",{className:"role-section-title",children:["ðŸ“Ž Related ",e.jsx("span",{className:"role-section-count",children:t._other.length})]}),e.jsx("p",{className:"role-section-desc",children:"Additional videos that may be relevant to your query."})]}),e.jsx("div",{className:"video-results-grid",children:t._other.map(i=>e.jsx("div",{className:"video-result-wrapper",id:`video-${i.driveId}`,children:e.jsx(Qe,{video:i,isAdded:n(i.driveId),onToggle:r,userQuery:a})},i.driveId))})]})]})}function dt({docs:s,isInCart:n,addToCart:r,removeFromCart:a}){return e.jsxs("div",{className:"blended-section",children:[e.jsxs("div",{className:"blended-section-header",children:[e.jsx("h2",{className:"blended-section-title",children:"ðŸ“š Recommended Reading"}),e.jsxs("p",{className:"blended-section-desc",children:["Official Unreal Engine documentation to deepen your understanding.",s.reduce((t,i)=>t+(i.readTimeMinutes||10),0)>0&&` (~${s.reduce((t,i)=>t+(i.readTimeMinutes||10),0)} min total read time)`]})]}),e.jsx("div",{className:"doc-cards-grid",children:s.map((t,i)=>{const c=`doc_${t.key||i}`,u=n(c);return e.jsxs("div",{className:`doc-card ${u?"doc-card-added":""}`,children:[e.jsxs("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:"doc-card-link",onClick:m=>m.stopPropagation(),children:[e.jsxs("div",{className:"doc-card-header",children:[t.matchScore!=null&&e.jsx(ut,{matchScore:t.matchScore}),e.jsx("span",{className:`tier-badge tier-${t.tier||"intermediate"}`,children:t.tier||"intermediate"}),t.subsystem&&e.jsx("span",{className:"subsystem-tag",children:t.subsystem})]}),e.jsx("h4",{className:"doc-card-title",children:t.label}),t.description&&e.jsx("p",{className:"doc-card-desc",children:t.description}),e.jsxs("div",{className:"doc-card-footer",children:[e.jsx("span",{className:"doc-source-badge",children:"ðŸ“„ Epic Docs"}),e.jsxs("span",{className:"doc-read-time",children:[t.readTimeMinutes||10," min read"]})]})]}),e.jsx("button",{className:`doc-add-btn ${u?"doc-added":""}`,onClick:()=>{u?a(c):r({type:"doc",itemId:c,title:t.label,description:t.description||"",keySteps:t.keySteps||[],seeAlso:t.seeAlso||[],sections:t.sections||[],url:t.url,tier:t.tier||"intermediate",subsystem:t.subsystem,readTimeMinutes:t.readTimeMinutes||10})},title:u?"Remove from path":"Add to learning path",children:u?"âœ“ Added":"âž• Add"})]},t.key||i)})})]})}function ut({matchScore:s}){const n=s>=90?"best":s>=60?"strong":s>=30?"good":"related",r=s>=90?"Best Match":s>=60?"Strong":s>=30?"Good":"Related";return e.jsxs("span",{className:`doc-match-badge doc-match-${n}`,title:`${s}% relevancy`,children:[e.jsx("span",{className:"doc-match-dot"}),r]})}function ht({youtube:s,isInCart:n,addToCart:r,removeFromCart:a}){return e.jsxs("div",{className:"blended-section",children:[e.jsxs("div",{className:"blended-section-header",children:[e.jsx("h2",{className:"blended-section-title",children:"ðŸ“º Official Epic YouTube"}),e.jsx("p",{className:"blended-section-desc",children:"Official Unreal Engine tutorials from Epic Games."})]}),e.jsx("div",{className:"doc-cards-grid",children:s.map(t=>{const i=t.id||`yt_${t.url}`,c=n(i),u=t.url?.match(/[?&]v=([^&]+)/),m=u?u[1]:null;return e.jsxs("div",{className:`doc-card yt-card-with-thumb ${c?"doc-card-added":""}`,children:[e.jsxs("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:"doc-card-link",onClick:o=>o.stopPropagation(),children:[m&&e.jsxs("div",{className:"yt-thumb-wrapper",children:[e.jsx("img",{className:"yt-thumb-img",src:`https://img.youtube.com/vi/${m}/mqdefault.jpg`,alt:t.title,loading:"lazy"}),e.jsxs("span",{className:"yt-thumb-duration",children:[t.durationMinutes," min"]}),e.jsx("span",{className:"yt-thumb-play",children:"â–¶"})]}),e.jsxs("div",{className:"doc-card-header",children:[e.jsx("span",{className:`tier-badge tier-${t.tier||"intermediate"}`,children:t.tier||"intermediate"}),e.jsx("span",{className:"external-badge",children:"Official â€¢ YouTube"})]}),e.jsx("h4",{className:"doc-card-title",children:t.title}),e.jsxs("div",{className:"doc-card-footer",children:[e.jsxs("span",{className:"doc-source-badge",children:["ðŸ“º ",t.channelName]}),e.jsxs("span",{className:"doc-read-time",children:[t.durationMinutes," min"]})]})]}),e.jsx("button",{className:`doc-add-btn ${c?"doc-added":""}`,onClick:()=>{c?a(i):r({type:"youtube",itemId:i,title:t.title,description:t.description||"",keyTakeaways:t.keyTakeaways||[],chapters:t.chapters||[],topics:t.topics||[],url:t.url,channelName:t.channelName,channelTrust:t.channelTrust,tier:t.tier||"intermediate",durationMinutes:t.durationMinutes||15})},title:c?"Remove from path":"Add to learning path",children:c?"âœ“ Added":"âž• Add"})]},t.id)})})]})}function ls({diagnosis:s}){if(!s)return null;const n=s.root_causes?.length||0,r=s.signals_to_watch_for?.length||0,a=s.variables_that_matter?.length||0,t=s.variables_that_do_not?.length||0;return e.jsxs("div",{className:"diagnosis-card",children:[e.jsxs("div",{className:"diagnosis-header",children:[e.jsx("h3",{children:"ðŸ”¬ Diagnosis"}),e.jsxs("span",{className:"diagnosis-id",children:["ID: ",s.diagnosis_id?.slice(-8)||"N/A"]})]}),e.jsx("p",{className:"problem-summary",children:s.problem_summary}),e.jsxs("div",{className:"diagnosis-sections",children:[e.jsxs("details",{className:"diagnosis-section root-causes",children:[e.jsxs("summary",{children:[e.jsx("span",{className:"icon",children:"ðŸŽ¯"}),"Root Causes",e.jsxs("span",{className:"count",children:["(",n,")"]})]}),e.jsx("ul",{children:(s.root_causes||[]).map((i,c)=>e.jsx("li",{children:i},c))})]}),e.jsxs("details",{className:"diagnosis-section signals",children:[e.jsxs("summary",{children:[e.jsx("span",{className:"icon",children:"ðŸ‘ï¸"}),"Signals to Watch For",e.jsxs("span",{className:"count",children:["(",r,")"]})]}),e.jsx("ul",{children:(s.signals_to_watch_for||[]).map((i,c)=>e.jsx("li",{children:i},c))})]}),e.jsxs("details",{className:"diagnosis-section variables-matter",children:[e.jsxs("summary",{children:[e.jsx("span",{className:"icon",children:"âœ…"}),"Variables That Matter",e.jsxs("span",{className:"count",children:["(",a,")"]})]}),e.jsx("ul",{children:(s.variables_that_matter||[]).map((i,c)=>e.jsx("li",{children:i},c))})]}),e.jsxs("details",{className:"diagnosis-section variables-dont-matter",children:[e.jsxs("summary",{children:[e.jsx("span",{className:"icon",children:"âŒ"}),"Variables That Don't",e.jsxs("span",{className:"count",children:["(",t,")"]})]}),e.jsx("ul",{children:(s.variables_that_do_not||[]).map((i,c)=>e.jsx("li",{children:i},c))})]}),s.generalization_scope?.length>0&&e.jsxs("details",{className:"diagnosis-section generalization",open:!0,children:[e.jsxs("summary",{children:[e.jsx("span",{className:"icon",children:"ðŸ”„"}),"Where Else This Applies",e.jsxs("span",{className:"count",children:["(",s.generalization_scope.length,")"]})]}),e.jsx("div",{className:"scope-chips",children:s.generalization_scope.map((i,c)=>e.jsx("span",{className:"scope-chip",children:i},c))})]})]})]})}ls.propTypes={diagnosis:h.shape({diagnosis_id:h.string,problem_summary:h.string,root_causes:h.arrayOf(h.string),signals_to_watch_for:h.arrayOf(h.string),variables_that_matter:h.arrayOf(h.string),variables_that_do_not:h.arrayOf(h.string),generalization_scope:h.arrayOf(h.string)})};ls.defaultProps={diagnosis:null};function mt(s){if(!s||s<=0)return null;const n=Math.floor(s/3600),r=Math.floor(s%3600/60);return n>0?r>0?`${n} hr ${r} min`:`${n} hr`:`${r} min`}function pt(s,n=320){const r=s?.drive_id||s?.driveId;return r?`https://drive.google.com/thumbnail?id=${r}&sz=w${n}`:null}function gt(s,n=320){const r=s?.videos?.[0];return pt(r,n)}function ds({objectives:s,courses:n,validation:r,onCourseClick:a,onAddToCart:t,isCourseInCart:i}){const{fixCourses:c,learnCourses:u}=b.useMemo(()=>{if(!n||n.length===0)return{fixCourses:[],learnCourses:[]};const o=Math.ceil(n.length/2);return{fixCourses:n.slice(0,o),learnCourses:n.slice(o)}},[n]),m=b.useMemo(()=>r?{approved:r.approved,reason:r.reason,hasIssues:r.issues?.length>0}:null,[r]);return e.jsxs("div",{className:"adaptive-cart",children:[m&&!m.approved&&e.jsxs("div",{className:"validation-warning",children:[e.jsx("span",{className:"icon",children:"âš ï¸"}),e.jsxs("div",{className:"content",children:[e.jsx("strong",{children:"Quality Check:"})," ",m.reason,r.suggestions?.length>0&&e.jsx("ul",{className:"suggestions",children:r.suggestions.map((o,f)=>e.jsx("li",{children:o},f))})]})]}),e.jsxs("section",{className:"cart-section fix-now",children:[e.jsxs("div",{className:"section-header",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"icon",children:"ðŸ”§"}),"Fix Now"]}),e.jsx("p",{className:"description",children:"These solve your immediate problem:"})]}),e.jsx("div",{className:"objectives-list",children:(s?.fix_specific||[]).map((o,f)=>e.jsxs("div",{className:"objective-item fix",children:[e.jsx("span",{className:"number",children:f+1}),e.jsx("span",{className:"text",children:o})]},f))}),c.length>0&&e.jsx("div",{className:"course-list",children:c.map(o=>e.jsx(_e,{course:o,type:"fix",onClick:()=>a?.(o),onAddToCart:t,isInCart:i?.(o)},o.id||o.code))})]}),e.jsxs("section",{className:"cart-section learn-forever",children:[e.jsxs("div",{className:"section-header",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"icon",children:"ðŸŽ“"}),"Learn Forever"]}),e.jsx("p",{className:"description",children:"These help you diagnose similar issues in the future:"})]}),e.jsx("div",{className:"objectives-list transferable",children:(s?.transferable||[]).map((o,f)=>e.jsxs("div",{className:"objective-item transferable",children:[e.jsx("span",{className:"number",children:f+1}),e.jsx("span",{className:"text",children:o}),e.jsx("span",{className:"badge",children:"Transferable"})]},f))}),s?.transferable?.length===0&&e.jsx("div",{className:"empty-warning",children:"âš ï¸ No transferable objectives generated. This path may not teach reusable skills."}),u.length>0&&e.jsx("div",{className:"course-list",children:u.map(o=>e.jsx(_e,{course:o,type:"learn",onClick:()=>a?.(o),onAddToCart:t,isInCart:i?.(o)},o.id||o.code))})]}),e.jsxs("div",{className:"cart-summary",children:[e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"value",children:s?.fix_specific?.length||0}),e.jsx("span",{className:"label",children:"Fix Objectives"})]}),e.jsxs("div",{className:"stat highlight",children:[e.jsx("span",{className:"value",children:s?.transferable?.length||0}),e.jsx("span",{className:"label",children:"Transferable Skills"})]}),e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"value",children:n?.length||0}),e.jsx("span",{className:"label",children:"Recommended Courses"})]})]})]})}function _e({course:s,type:n,onClick:r,onAddToCart:a,isInCart:t}){const[i,c]=b.useState(!1),u=b.useMemo(()=>{if(s.duration)return s.duration;if(s.duration_minutes)return`${s.duration_minutes} min`;if(s.durationMinutes)return`${s.durationMinutes} min`;if(s.videos?.length){const g=s.videos.reduce((y,N)=>y+(N.duration_seconds||0),0);return g>0?mt(g):null}return null},[s]),m=b.useMemo(()=>typeof s.difficulty=="string"?s.difficulty:typeof s.difficulty=="number"?["Beginner","Beginner","Intermediate","Intermediate","Advanced","Expert"][s.difficulty]||"Intermediate":s.gemini_skill_level?s.gemini_skill_level:null,[s]),o=b.useMemo(()=>gt(s),[s]),f=s.video_count||s.videos?.length||null,p=g=>{g.stopPropagation(),a?.(s)};return e.jsxs("div",{className:`course-card ${n} ${t?"in-cart":""}`,onClick:r,role:"button",tabIndex:0,onKeyDown:g=>g.key==="Enter"&&r?.(),children:[o&&!i&&e.jsx("div",{className:"course-thumbnail",children:e.jsx("img",{src:o,alt:s.title,loading:"lazy",onError:()=>c(!0)})}),e.jsxs("div",{className:"course-info",children:[e.jsx("h4",{className:"title",children:s.title||s.name}),s.gemini_outcomes?.[0]&&e.jsxs("p",{className:"description",children:[s.gemini_outcomes[0].slice(0,100),"..."]}),e.jsxs("div",{className:"meta",children:[u&&e.jsxs("span",{className:"duration",children:["â±ï¸ ",u]}),f&&e.jsxs("span",{className:"video-count",children:["ðŸŽ¬ ",f," videos"]}),m&&e.jsx("span",{className:`difficulty ${m.toLowerCase()}`,children:m})]})]}),e.jsx("div",{className:"course-action",children:a?e.jsx("button",{className:`add-btn ${t?"added":""}`,onClick:p,"aria-label":t?"Added to path":"Add to path",children:t?"âœ“ Added":"+ Add"}):e.jsx("span",{className:"arrow",children:"â†’"})})]})}_e.propTypes={course:h.shape({id:h.string,code:h.string,title:h.string,name:h.string,description:h.string,duration:h.string,durationMinutes:h.number,difficulty:h.string}).isRequired,type:h.oneOf(["fix","learn"]),onClick:h.func};_e.defaultProps={type:"fix",onClick:null};ds.propTypes={objectives:h.shape({fix_specific:h.arrayOf(h.string),transferable:h.arrayOf(h.string)}),courses:h.arrayOf(h.object),validation:h.shape({approved:h.bool,reason:h.string,issues:h.arrayOf(h.string),suggestions:h.arrayOf(h.string)}),onCourseClick:h.func};ds.defaultProps={objectives:null,courses:[],validation:null,onCourseClick:null};export{ds as AdaptiveLearningCart,ls as DiagnosisCard,It as ProblemFirst,Oe as ProblemInput};

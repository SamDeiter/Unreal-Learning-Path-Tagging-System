import{a as R,j as s}from"./index-DfmT6uPk.js";import{a as g}from"./vendor-cytoscape-hdah7_Xt.js";import"./vendor-firebase-BQvzIQYL.js";import"./data-courses-aYLqO-5R.js";function P(){const{courses:u}=R(),[_,S]=g.useState(null),[h,y]=g.useState("all"),[j,k]=g.useState(15),[p,E]=g.useState(15),i=g.useMemo(()=>{let e=0,a=0;const c=Object.create(null),o=Object.create(null),m=Object.create(null),v=new Set(["using","creating","button","notes","release","focus","orlando","fest","click","select","open","make","made","show","look","know","want","need","take","going","right","left","back","just","like","also","well","really","thing","things","way","actually","basically","different","example","here","inside","called","got","put","done","let","run","set","top","end","new","now","not","get","see","use","two","one","bit","lot","big","kind","sort","part","able"]),d=/[^a-zA-Z0-9_\- ]/,r=t=>!(!t||t.length<3||t.length>18||d.test(t)||v.has(t.toLowerCase())||/^\d+$/.test(t)),N=15;u.forEach(t=>{t.gemini_enriched?e++:a++,t.tags&&Object.entries(t.tags).forEach(([l,n])=>{l!=="_confidence"&&n&&(c[n]=(c[n]||0)+1)}),t.ai_tags&&(Array.isArray(t.ai_tags)?t.ai_tags:Object.values(t.ai_tags)).slice(0,N).forEach(n=>{const A=typeof n=="string"?n:n?.tag_id||n?.name;A&&r(A)&&(o[A]=(o[A]||0)+1)});const T=l=>l.includes(".")?l.split(".").map(n=>n.charAt(0).toUpperCase()+n.slice(1)):[l],O=[...(t.canonical_tags||[]).flatMap(T),...(t.transcript_tags||[]).flatMap(T),...t.extracted_tags||[],...(Array.isArray(t.ai_tags)?t.ai_tags:t.ai_tags?Object.values(t.ai_tags):[]).slice(0,N).map(l=>typeof l=="string"?l:l?.tag_id||l?.name||"").filter(Boolean)],q=t.tags||{};Object.entries(q).forEach(([l,n])=>{l.startsWith("_")||(Array.isArray(n)?O.push(...n):typeof n=="string"&&n&&O.push(n))}),O.filter(r).forEach(l=>{m[l]=(m[l]||0)+1})});const M=3;return[m,o].forEach(t=>{Object.keys(t).forEach(T=>{t[T]<M&&delete t[T]})}),{enriched:e,pending:a,total:u.length,baseTagCounts:c,aiTagCounts:o,videoTagCounts:m}},[u]),f=g.useMemo(()=>h==="enriched"?u.filter(e=>e.gemini_enriched):h==="pending"?u.filter(e=>!e.gemini_enriched):u,[u,h]),w=((e,a=15)=>Object.entries(e).sort((c,o)=>o[1]-c[1]).slice(0,a))(i.baseTagCounts,1/0),I=g.useMemo(()=>Object.entries(i.aiTagCounts).sort((e,a)=>a[1]-e[1]),[i.aiTagCounts]),V=p==="all"?I:I.slice(0,p),b=g.useMemo(()=>Object.entries(i.videoTagCounts).sort((e,a)=>a[1]-e[1]),[i.videoTagCounts]),B=j==="all"?b:b.slice(0,j),x=g.useMemo(()=>{const e=Object.keys(i.baseTagCounts).length,a=Object.keys(i.videoTagCounts).length,c=Object.keys(i.aiTagCounts).length,o=Object.values(i.baseTagCounts).reduce((d,r)=>d+r,0),m=Object.values(i.videoTagCounts).reduce((d,r)=>d+r,0),v=Object.values(i.aiTagCounts).reduce((d,r)=>d+r,0);return{uniqueBaseTags:e,uniqueVideoTags:a,uniqueAITags:c,totalBaseTags:o,totalVideoTags:m,totalAITags:v,grandTotal:e+a+c}},[i]),C=e=>{let a,c;switch(e){case"base":a=i.baseTagCounts,c="base_tags_export.csv";break;case"video":a=i.videoTagCounts,c="video_extracted_tags_export.csv";break;case"ai":a=i.aiTagCounts,c="ai_tags_export.csv";break;default:a={...i.baseTagCounts,...i.videoTagCounts,...i.aiTagCounts},c="all_tags_export.csv"}const o=`Tag,Count,Source
`+Object.entries(a).sort((r,N)=>N[1]-r[1]).map(([r,N])=>`"${r}",${N},${e}`).join(`
`),m=new Blob([o],{type:"text/csv"}),v=URL.createObjectURL(m),d=document.createElement("a");d.href=v,d.download=c,d.click(),URL.revokeObjectURL(v)};return s.jsxs("div",{className:"tag-sources",children:[s.jsxs("div",{className:"ts-header",children:[s.jsx("h2",{children:"ðŸ·ï¸ Tag Source Analysis"}),s.jsx("p",{children:"Understand the origin and coverage of tags across your content"})]}),s.jsxs("div",{className:"ts-status-row",children:[s.jsxs("div",{className:`ts-status-card ${h==="all"?"active":""}`,onClick:()=>y("all"),children:[s.jsx("div",{className:"ts-status-value",children:i.total}),s.jsx("div",{className:"ts-status-label",children:"Total Courses"})]}),s.jsxs("div",{className:`ts-status-card enriched ${h==="enriched"?"active":""}`,onClick:()=>y("enriched"),children:[s.jsx("div",{className:"ts-status-value",children:i.enriched}),s.jsx("div",{className:"ts-status-label",children:"AI Enriched"}),s.jsxs("div",{className:"ts-status-pct",children:[Math.round(i.enriched/i.total*100),"%"]})]}),s.jsxs("div",{className:`ts-status-card pending ${h==="pending"?"active":""}`,onClick:()=>y("pending"),title:"These courses need AI enrichment â€” run the transcript analyzer",children:[s.jsx("div",{className:"ts-status-value",children:i.pending}),s.jsx("div",{className:"ts-status-label",children:"Pending AI"}),s.jsx("div",{className:"ts-status-hint",children:"Click to see which need processing"})]})]}),s.jsxs("div",{className:"ts-legend",children:[s.jsxs("div",{className:"legend-item",children:[s.jsx("span",{className:"legend-badge base",children:"BASE"}),s.jsx("span",{children:"Manual taxonomy (topic, level, product)"})]}),s.jsxs("div",{className:"legend-item",children:[s.jsx("span",{className:"legend-badge video",children:"VIDEO"}),s.jsx("span",{children:"Extracted from video titles & transcripts"})]}),s.jsxs("div",{className:"legend-item",children:[s.jsx("span",{className:"legend-badge ai",children:"AI"}),s.jsx("span",{children:"Gemini-analyzed from content"})]})]}),s.jsxs("div",{className:"ts-export-stats",children:[s.jsxs("div",{className:"export-header",children:[s.jsx("h3",{children:"ðŸ“Š Tag Generation Summary"}),s.jsx("button",{className:"export-all-btn",onClick:()=>C("all"),children:"â¬‡ï¸ Export All Tags (CSV)"})]}),s.jsxs("div",{className:"export-grid",children:[s.jsxs("div",{className:"export-stat base",children:[s.jsx("div",{className:"stat-label",children:"BASE Tags"}),s.jsx("div",{className:"stat-value",children:x.uniqueBaseTags}),s.jsxs("div",{className:"stat-usage",children:[x.totalBaseTags," total uses"]}),s.jsx("button",{className:"export-btn",onClick:()=>C("base"),children:"Export"})]}),s.jsxs("div",{className:"export-stat video",children:[s.jsx("div",{className:"stat-label",children:"VIDEO Tags"}),s.jsx("div",{className:"stat-value",children:x.uniqueVideoTags}),s.jsxs("div",{className:"stat-usage",children:[x.totalVideoTags," total uses"]}),s.jsx("button",{className:"export-btn",onClick:()=>C("video"),children:"Export"})]}),s.jsxs("div",{className:"export-stat ai",children:[s.jsx("div",{className:"stat-label",children:"AI Tags"}),s.jsx("div",{className:"stat-value",children:x.uniqueAITags}),s.jsxs("div",{className:"stat-usage",children:[x.totalAITags," total uses"]}),s.jsx("button",{className:"export-btn",onClick:()=>C("ai"),children:"Export"})]})]}),s.jsxs("div",{className:"export-total",children:["Grand Total: ",s.jsx("strong",{children:x.grandTotal})," unique tags generated"]})]}),s.jsxs("div",{className:"ts-sources-grid",children:[s.jsxs("div",{className:"ts-source-card",children:[s.jsxs("h3",{children:[s.jsx("span",{className:"source-badge base",children:"BASE"}),"Manual Taxonomy",s.jsxs("span",{className:"source-total",children:[Object.keys(i.baseTagCounts).length," unique tags"]})]}),s.jsx("p",{className:"ts-source-desc",children:"Official tags assigned during content creation"}),s.jsx("div",{className:"tag-list",children:w.map(([e,a])=>s.jsxs("span",{className:"tag-chip base",children:[e," ",s.jsx("span",{className:"count",children:a})]},e))})]}),s.jsxs("div",{className:"ts-source-card",children:[s.jsxs("h3",{children:[s.jsx("span",{className:"source-badge video",children:"VIDEO"}),"Video Extracted",s.jsxs("span",{className:"source-total",children:[b.length," unique tags"]})]}),s.jsx("p",{className:"ts-source-desc",children:"Keywords from video titles and transcript analysis"}),s.jsxs("div",{className:"tag-limit-controls",children:[s.jsx("span",{children:"Show:"}),s.jsx("button",{className:j===15?"active":"",onClick:()=>k(15),children:"Top 15"}),s.jsx("button",{className:j===100?"active":"",onClick:()=>k(100),children:"Top 100"}),s.jsxs("button",{className:j==="all"?"active":"",onClick:()=>k("all"),children:["All (",b.length,")"]})]}),b.length===0?s.jsxs("div",{className:"no-tags-warning",children:["âš ï¸ No video-extracted tags found. Check if ",s.jsx("code",{children:"ai_tags"})," or"," ",s.jsx("code",{children:"transcript_tags"})," fields exist in your data."]}):s.jsx("div",{className:`tag-list ${j!==15?"expanded":""}`,children:B.map(([e,a])=>s.jsxs("span",{className:"tag-chip video",children:[e," ",s.jsx("span",{className:"count",children:a})]},e))})]}),s.jsxs("div",{className:"ts-source-card",children:[s.jsxs("h3",{children:[s.jsx("span",{className:"source-badge ai",children:"AI"}),"Gemini Enriched",s.jsxs("span",{className:"source-total",children:[Object.keys(i.aiTagCounts).length," unique tags"]})]}),s.jsx("p",{className:"ts-source-desc",children:"System tags identified by AI content analysis"}),s.jsxs("div",{className:"tag-limit-controls",children:[s.jsx("span",{children:"Show:"}),s.jsx("button",{className:p===15?"active":"",onClick:()=>E(15),children:"Top 15"}),s.jsx("button",{className:p===100?"active":"",onClick:()=>E(100),children:"Top 100"}),s.jsxs("button",{className:p==="all"?"active":"",onClick:()=>E("all"),children:["All (",I.length,")"]})]}),s.jsx("div",{className:`tag-list ${p!==15?"expanded":""}`,children:V.map(([e,a])=>s.jsxs("span",{className:"tag-chip ai",children:[e," ",s.jsx("span",{className:"count",children:a})]},e))})]})]}),s.jsxs("div",{className:"ts-section",children:[s.jsxs("h3",{children:["ðŸ“‹ ",h==="pending"?"Courses Needing AI Enrichment":"All Courses",s.jsxs("span",{className:"course-count",children:["(",f.length,")"]})]}),h==="pending"&&s.jsxs("div",{className:"ts-action-hint",children:["ðŸ’¡ Run ",s.jsx("code",{children:"npm run analyze:transcripts"})," to generate AI tags for these courses"]}),s.jsx("div",{className:"ts-course-grid",children:f.slice(0,50).map(e=>s.jsxs("div",{className:`ts-course-card ${_===e.code?"selected":""}`,onClick:()=>S(_===e.code?null:e.code),children:[s.jsxs("div",{className:"ts-course-header",children:[s.jsx("span",{className:"course-code",children:e.code}),e.gemini_enriched?s.jsx("span",{className:"enrichment-badge enriched",title:"AI enrichment complete",children:"âœ… AI"}):s.jsx("span",{className:"enrichment-badge pending",title:"Needs AI enrichment",children:"â³ Pending"})]}),s.jsx("div",{className:"ts-course-title",children:e.title}),_===e.code&&s.jsxs("div",{className:"ts-course-tags",children:[s.jsxs("div",{className:"tag-group",children:[s.jsx("span",{className:"tag-group-label base",children:"BASE"}),s.jsxs("div",{className:"tag-group-items",children:[e.tags?.topic&&s.jsx("span",{className:"mini-tag base",children:e.tags.topic}),e.tags?.level&&s.jsx("span",{className:"mini-tag base",children:e.tags.level}),e.tags?.industry&&s.jsx("span",{className:"mini-tag base",children:e.tags.industry})]})]}),(e.ai_tags?.length>0||e.transcript_tags?.length>0)&&s.jsxs("div",{className:"tag-group",children:[s.jsx("span",{className:"tag-group-label video",children:"VIDEO"}),s.jsxs("div",{className:"tag-group-items",children:[e.ai_tags?.slice(0,5).map(a=>s.jsx("span",{className:"mini-tag video",children:a},a)),e.transcript_tags?.slice(0,3).map(a=>s.jsx("span",{className:"mini-tag video",children:a},a))]})]}),e.ai_tags?.length>0&&s.jsxs("div",{className:"tag-group",children:[s.jsx("span",{className:"tag-group-label ai",children:"AI"}),s.jsx("div",{className:"tag-group-items",children:e.ai_tags.map(a=>s.jsx("span",{className:"mini-tag ai",children:a},a))})]}),!e.gemini_enriched&&s.jsx("div",{className:"missing-ai-note",children:"âš ï¸ No AI analysis yet â€” add to processing queue"})]})]},e.code))}),f.length>50&&s.jsxs("div",{className:"ts-more-hint",children:["Showing first 50 of ",f.length," courses"]})]})]})}export{P as default};

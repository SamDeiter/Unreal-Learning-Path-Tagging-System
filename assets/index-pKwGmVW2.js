import{j as e,_ as xe,a as Ts,g as ss}from"./index-Coq7OcDr.js";import{a as w,P as h}from"./vendor-cytoscape-hdah7_Xt.js";import{c as ps,p as ks,r as Is,d as Rs,j as Ms,k as Es,n as Ls,m as ts}from"./vendor-firebase-BQvzIQYL.js";import{t as pe}from"./TagGraphService-VQV6zz-g.js";import{S as $s,P as As}from"./search-Blpc5bje.js";import{c as ye}from"./createLucideIcon-YhyuTmrv.js";import{c as Te,S as ke,G as Ps}from"./GuidedPlayer-lzTdWybx.js";import{getFeedbackStatus as Os,recordUpvote as qs,recordDownvote as Ds,applyFeedbackMultiplier as Fs}from"./feedbackService-CkyHLPU6.js";import{b as Us,l as Ws,c as Vs,s as zs}from"./data-courses-CDlycmza.js";import{C as Bs}from"./check-eCXpKYRG.js";import{d as ne,a as z}from"./logger-HX1K3TKu.js";import"./x-HbUnH9yy.js";const Gs=[["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Ks=ye("circle-play",Gs);const Hs=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],ns=ye("circle-x",Hs);const Qs=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],Ys=ye("image",Qs);const Js=[["path",{d:"M13.172 2a2 2 0 0 1 1.414.586l6.71 6.71a2.4 2.4 0 0 1 0 3.408l-4.592 4.592a2.4 2.4 0 0 1-3.408 0l-6.71-6.71A2 2 0 0 1 6 9.172V3a1 1 0 0 1 1-1z",key:"16rjxf"}],["path",{d:"M2 7v6.172a2 2 0 0 0 .586 1.414l6.71 6.71a2.4 2.4 0 0 0 3.191.193",key:"178nd4"}],["circle",{cx:"10.5",cy:"6.5",r:".5",fill:"currentColor",key:"12ikhr"}]],Xs=ye("tags",Js);const Zs=[["path",{d:"M12 19h8",key:"baeox8"}],["path",{d:"m4 17 6-6-6-6",key:"1yngyt"}]],et=ye("terminal",Zs);const st=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],tt=ye("user",st),nt=/(?:[A-Za-z]:\\[\w\\. -]+|\/(?:Users|home|tmp|var|opt|etc)\/[\w/. -]+)/g;function rs(s){return s.replace(nt,"[LOCAL_PATH]")}function We({onSubmit:s,detectedPersona:t,isLoading:a}){const[i,u]=w.useState(""),[o,r]=w.useState([]),[d,l]=w.useState(null),[n,c]=w.useState(""),[x,f]=w.useState(!1),v=w.useRef(null),[b,j]=w.useState(()=>{try{const N=JSON.parse(localStorage.getItem("fix-problem-history")||"[]"),I=N.map(S=>typeof S=="string"?{query:S,cartId:null}:S);return N.length>0&&typeof N[0]=="string"&&localStorage.setItem("fix-problem-history",JSON.stringify(I)),I}catch{return[]}}),L=w.useCallback(N=>{const I=rs(N.target.value);if(u(I),I.length>15){const S=pe.matchErrorSignature(I),q=pe.extractTagsFromText(I),U=S.map(G=>({tag:G.tag,confidence:G.confidence})),V=q.matches.map(G=>({tag:G.tag,confidence:G.confidence})),ee=[...U,...V],oe=new Set,re=ee.filter(G=>oe.has(G.tag.tag_id)?!1:(oe.add(G.tag.tag_id),!0));r(re.slice(0,5))}else r([])},[]),m=w.useCallback(N=>{const I=N.clipboardData?.items;if(I){for(const S of I)if(S.type.startsWith("image/")){N.preventDefault();const q=S.getAsFile(),U=new FileReader;U.onload=V=>l(V.target.result),U.readAsDataURL(q);return}}},[]),C=w.useCallback(N=>{N.preventDefault(),N.stopPropagation(),f(!0)},[]),T=w.useCallback(N=>{N.preventDefault(),N.stopPropagation(),f(!1)},[]),k=w.useCallback(N=>{N.preventDefault(),N.stopPropagation(),f(!1);const I=N.dataTransfer?.files;if(!I||I.length===0)return;const S=I[0];if(S.type.startsWith("image/")){const q=new FileReader;q.onload=U=>l(U.target.result),q.readAsDataURL(S)}},[]),R=w.useCallback((N,I)=>{j(S=>{const q=S.map(U=>U.query===N?{...U,cartId:I}:U);return localStorage.setItem("fix-problem-history",JSON.stringify(q)),q})},[]),E=w.useCallback((N=null,I=null)=>{const S=(I||i).trim();S.length<10||(j(q=>{const U=q.filter(ee=>ee.query!==S),V=[{query:S,cartId:N},...U].slice(0,6);return localStorage.setItem("fix-problem-history",JSON.stringify(V)),V}),s({query:S,detectedTagIds:o.map(q=>q.tag.tag_id),selectedTagIds:[],personaHint:t?.name,pastedImage:d,errorLog:n.trim()||null,cachedCartId:N||null,updateCartIdForQuery:R}))},[i,o,t,s,d,n,R]),H=w.useCallback(N=>{N.key==="Enter"&&N.ctrlKey&&E()},[E]),Q=w.useMemo(()=>['My Blueprint Cast is giving me "Accessed None" error when trying to...',"Lumen is too noisy in my interior scene and I've tried increasing quality...","My character animation stutters when blending between states...","Nanite is causing Z-fighting on overlapping meshes...","Material instances aren't updating at runtime when I change parameters..."],[])[0];return e.jsxs("div",{className:"problem-input-container",onPaste:m,children:[e.jsxs("div",{className:"problem-input-header",children:[e.jsxs("h2",{children:[e.jsx($s,{size:22,className:"icon-inline"})," What's the problem?"]}),e.jsx("p",{className:"subtitle",children:"Describe your UE5 issue in plain English. We'll diagnose the root cause and teach you to fix it."})]}),e.jsxs("div",{className:"problem-input-field",children:[e.jsx("textarea",{value:i,onChange:L,onKeyDown:H,placeholder:Q,rows:5,disabled:a,"aria-label":"Problem description"}),e.jsxs("div",{className:"char-count",children:[i.length," characters",i.length<10&&i.length>0&&e.jsx("span",{className:"warning",children:" (minimum 10)"})]})]}),o.length>0&&e.jsxs("div",{className:"detected-tags",children:[e.jsxs("span",{className:"label",children:[e.jsx(Xs,{size:14,className:"icon-inline"})," Detected:"]}),e.jsx("div",{className:"tag-list",children:o.map(N=>e.jsxs("span",{className:"tag-chip",title:N.tag.description||N.tag.display_name,children:[N.tag.display_name,e.jsxs("span",{className:"confidence",children:[Math.round(N.confidence*100),"%"]})]},N.tag.tag_id))})]}),e.jsxs("div",{className:`screenshot-zone ${n.trim()?"has-image":""}`,onClick:()=>{n.trim()||document.getElementById("error-log-input")?.focus()},children:[n.trim()?e.jsxs("div",{className:"pasted-preview error-log-preview",children:[e.jsx("pre",{className:"error-log-display",children:n}),e.jsx("button",{type:"button",className:"clear-error-log",onClick:N=>{N.stopPropagation(),c("")},"aria-label":"Remove error log",title:"Clear error log",children:e.jsx(ns,{size:20})})]}):e.jsxs("div",{className:"drop-prompt",children:[e.jsx(et,{size:20}),e.jsxs("span",{children:["Paste (",e.jsx("kbd",{children:"Ctrl+V"}),") an error log or build output"]})]}),e.jsx("textarea",{id:"error-log-input",className:"error-log-hidden-input",value:n,onChange:N=>c(N.target.value),onPaste:N=>{const I=N.clipboardData?.getData("text");I&&(N.preventDefault(),c(rs(I)))},rows:1})]}),e.jsx("div",{ref:v,className:`screenshot-zone ${x?"drag-over":""} ${d?"has-image":""}`,onDragOver:C,onDragLeave:T,onDrop:k,children:d?e.jsxs("div",{className:"pasted-preview",children:[e.jsx("img",{src:d,alt:"Pasted screenshot"}),e.jsx("button",{type:"button",className:"clear-error-log",onClick:()=>l(null),"aria-label":"Remove screenshot",title:"Remove screenshot",children:e.jsx(ns,{size:20})})]}):e.jsxs("div",{className:"drop-prompt",children:[e.jsx(Ys,{size:20}),e.jsxs("span",{children:["Paste (",e.jsx("kbd",{children:"Ctrl+V"}),") or drag a screenshot here"]})]})}),t&&e.jsxs("div",{className:"persona-context",children:[e.jsxs("span",{className:"label",children:[e.jsx(tt,{size:14,className:"icon-inline"})," Context:"]}),e.jsx("span",{className:"persona-chip",children:t.name}),e.jsx("span",{className:"hint",children:"Recommendations will be tailored for you"})]}),e.jsxs("div",{className:"problem-input-actions",children:[e.jsx("button",{className:"submit-btn primary",onClick:()=>E(),disabled:i.trim().length<10||a,children:a?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner"})," Diagnosing..."]}):e.jsx(e.Fragment,{children:"Get Diagnosis ‚Üí"})}),e.jsxs("span",{className:"hint",children:["Press ",e.jsx("kbd",{children:"Ctrl"})," + ",e.jsx("kbd",{children:"Enter"})," to submit"]})]}),b.length>0&&e.jsxs("div",{className:"query-history",children:[e.jsx("span",{className:"history-label",children:"üïò Recent questions:"}),e.jsx("div",{className:"history-chips",children:b.map((N,I)=>{const S=N.query||N,q=N.cartId||null,U=!!q;return e.jsxs("div",{className:"history-chip-row",children:[e.jsxs("button",{type:"button",className:`history-chip ${U?"cached":""}`,onClick:()=>{u(S),L({target:{value:S}}),U&&!a&&setTimeout(()=>E(q,S),50)},title:U?`${S} (cached ‚Äî instant load)`:S,disabled:a,children:[U&&e.jsx("span",{className:"cache-indicator",children:"‚ö°"}),S.length>50?S.slice(0,50)+"‚Ä¶":S]}),e.jsx("button",{type:"button",className:"history-delete",onClick:()=>{j(V=>{const ee=V.filter((oe,re)=>re!==I);return localStorage.setItem("fix-problem-history",JSON.stringify(ee)),ee})},title:"Remove",children:"√ó"})]},I)})})]})]})}We.propTypes={onSubmit:h.func.isRequired,detectedPersona:h.shape({id:h.string,name:h.string,emoji:h.string}),isLoading:h.bool};We.defaultProps={detectedPersona:null,isLoading:!1};const gs={},fs={};(Ws.courses||[]).forEach(s=>{gs[s.code]=s.title,fs[s.code]=s.versions||[]});function rt(s){const t=fs[s];return!t||t.length===0?!1:t.every(a=>{const i=String(a).replace(/^V/i,"");return i.startsWith("4")&&!i.startsWith("4.")?/^4\d{1,2}$/.test(i):i.startsWith("4.")})}function at(s){if(!s||s<=0)return"";const t=Math.round(s/60);return t<1?"<1 min":`${t} min`}function Ue({video:s,isAdded:t,onToggle:a,userQuery:i}){const{title:u,duration:o,driveId:r,courseCode:d,_curatedMatch:l,role:n,reason:c,matchPercent:x,matchReason:f,watchHint:v}=s,b=x>=100?"best":x>=70?"strong":x>=40?"good":"related",j=x>=100?"Best Match":x>=70?"Strong Match":x>=40?"Good Match":"Related",L=u?.replace(/\s+(?:Part\s+[A-Z]|PT\s*\d+)$/i,"").trim()||u,m=d?Us[d]:null,C=m?.prereqs||[],[T,k]=w.useState(()=>Os(r)),[R,E]=w.useState(!1),H=w.useRef(null),B=w.useRef(null);w.useEffect(()=>{if(!R)return;const S=q=>{H.current&&!H.current.contains(q.target)&&E(!1)};return document.addEventListener("mousedown",S),()=>document.removeEventListener("mousedown",S)},[R]);const Q=S=>{S.stopPropagation(),qs(r,i||""),k("up")},N=S=>{S.stopPropagation(),Ds(r,i||""),k("down")},I=r?`https://drive.google.com/thumbnail?id=${r}&sz=w320`:null;return e.jsx("div",{ref:B,className:`video-result-card ${t?"added":""} ${l?"curated":""} ${T==="down"?"demoted":""}`,role:"button",tabIndex:0,children:e.jsxs("div",{className:"vrc-compact",children:[e.jsxs("div",{className:"vrc-thumbnail",children:[I?e.jsx("img",{src:I,alt:L,onError:S=>{S.target.style.display="none",S.target.nextSibling.style.display="flex"}}):null,e.jsx("div",{className:"vrc-thumb-fallback",style:{display:I?"none":"flex"},children:e.jsx("span",{className:"vrc-play-icon",children:e.jsx(Ks,{size:24})})}),o>0&&e.jsx("span",{className:"vrc-duration",children:at(o)})]}),e.jsxs("div",{className:"vrc-badge-row",children:[x!=null&&e.jsxs("span",{className:`vrc-match-badge vrc-match-${b}`,title:`${x}% match`,children:[e.jsx("span",{className:"vrc-match-dot"}),j]}),l&&e.jsx("span",{className:"vrc-curated-badge",children:"‚úì Solution"}),n&&n!=="core"&&e.jsxs("div",{className:"vrc-role-wrapper",ref:n==="prerequisite"?H:null,children:[e.jsxs("button",{className:`vrc-role-badge vrc-role-${n} ${n==="prerequisite"?"vrc-role-clickable":""}`,onClick:S=>{S.stopPropagation(),n==="prerequisite"&&E(q=>!q)},title:n==="prerequisite"?"Click to see why this is a prerequisite":void 0,children:[n==="prerequisite"&&"üîó Prerequisite",n==="troubleshooting"&&"üîß Troubleshooting",n==="supplemental"&&"üìö Supplemental"]}),R&&n==="prerequisite"&&e.jsxs("div",{className:"vrc-prereq-tooltip",children:[e.jsx("strong",{children:"Prerequisite Course"}),C.length>0?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"Watch these first:"}),e.jsx("ul",{className:"vrc-prereq-list",children:C.map(S=>e.jsxs("li",{children:["üìò ",gs[S]||S,m?.reasons?.[S]&&e.jsxs("span",{className:"vrc-prereq-why",children:[" ‚Äî ",m.reasons[S]]})]},S))})]}):e.jsx("p",{children:"Watch this first ‚Äî it covers foundational concepts needed before advancing."}),c&&e.jsx("p",{className:"vrc-tip-reason",children:c})]})]}),d&&rt(d)&&e.jsx("span",{className:"vrc-ue4-badge",title:"This content was created for Unreal Engine 4 ‚Äî some details may differ in UE5",children:"‚ö†Ô∏è UE4"})]}),e.jsxs("div",{className:"vrc-info",children:[e.jsx("h4",{className:"vrc-title",children:L}),v&&v!=="‚ñ∂ Watch full video"&&e.jsx("p",{className:"vrc-timestamp-hint",children:v}),f&&e.jsx("p",{className:"vrc-match-reason",children:f})]}),e.jsxs("div",{className:"vrc-actions",children:[e.jsxs("div",{className:"vrc-feedback",children:[e.jsx("button",{className:`vrc-fb-btn ${T==="up"?"active-up":""}`,onClick:Q,"aria-label":"Helpful",title:"This was helpful",children:e.jsx("span",{className:"vrc-fb-emoji",children:"üëç"})}),e.jsx("button",{className:`vrc-fb-btn ${T==="down"?"active-down":""}`,onClick:N,"aria-label":"Not helpful",title:"Not relevant",children:e.jsx("span",{className:"vrc-fb-emoji",children:"üëé"})})]}),e.jsx("button",{className:`vrc-add-btn ${t?"vrc-added":""}`,onClick:S=>{S.stopPropagation(),a(s)},"aria-label":t?"Remove from playlist":"Add to playlist",children:t?e.jsxs(e.Fragment,{children:[e.jsx(Bs,{size:14})," Added"]}):e.jsxs(e.Fragment,{children:[e.jsx(As,{size:14})," Add"]})})]})]})})}Ue.propTypes={video:h.shape({driveId:h.string,title:h.string.isRequired,courseName:h.string,duration:h.number,matchedTags:h.arrayOf(h.string),courseCode:h.string,topSegments:h.array,docLinks:h.array,_curatedMatch:h.bool,role:h.oneOf(["prerequisite","core","troubleshooting","supplemental"]),reason:h.string,estimatedMinutes:h.number}).isRequired,isAdded:h.bool,onToggle:h.func.isRequired,userQuery:h.string};function as(s){const t=Math.round(s/60);if(t<1)return"<1 min";if(t>=60){const a=Math.floor(t/60),i=t%60;return i>0?`${a}h ${i}m`:`${a}h`}return`${t} min`}const it={video:"üì∫",doc:"üìñ",youtube:"‚ñ∂Ô∏è"};function xs({cart:s,onRemove:t,onClear:a,onWatchPath:i}){const u=s.reduce((n,c)=>n+(c.duration||(c.readTimeMinutes||c.durationMinutes||0)*60),0),o=s.filter(n=>(n.type||"video")==="video").length,r=s.filter(n=>n.type==="doc").length,d=s.filter(n=>n.type==="youtube").length,l=[];return o>0&&l.push(`${o} video${o!==1?"s":""}`),r>0&&l.push(`${r} doc${r!==1?"s":""}`),d>0&&l.push(`${d} YT`),e.jsxs("div",{className:"cart-panel",children:[e.jsxs("div",{className:"cart-header",children:[e.jsx("h3",{className:"cart-title",children:"üõí My Learning Path"}),s.length>0&&e.jsx("button",{className:"cart-clear-btn",onClick:a,title:"Clear all",children:"Clear"})]}),s.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cart-stats",children:[e.jsx("span",{className:"cart-stat-count",children:l.join(" ¬∑ ")}),e.jsx("span",{className:"cart-stat-dot",children:"¬∑"}),e.jsx("span",{className:"cart-stat-time",children:as(u)})]}),u>28800&&e.jsx("div",{className:"cart-warning",children:"‚ö†Ô∏è That's over 8 hours of content ‚Äî consider narrowing your focus to the most relevant items."}),e.jsx("div",{className:"cart-items",children:s.map((n,c)=>{const x=n.itemId||n.driveId||c,f=n.type||"video",v=it[f]||"üì∫",b=f==="video"?Te(n.title):n.title,j=n.duration>0?as(n.duration):n.readTimeMinutes?`${n.readTimeMinutes} min read`:n.durationMinutes?`${n.durationMinutes} min`:null;return e.jsxs("div",{className:`cart-item cart-item-${f}`,children:[e.jsx("span",{className:"cart-item-num",children:c+1}),e.jsx("span",{className:"cart-item-icon",title:f,children:v}),e.jsxs("div",{className:"cart-item-info",children:[e.jsx("span",{className:"cart-item-title",children:b}),j&&e.jsx("span",{className:"cart-item-dur",children:j})]}),e.jsx("button",{className:"cart-item-remove",onClick:()=>t(x),"aria-label":`Remove ${n.title}`,children:"√ó"})]},x)})}),e.jsx("button",{className:"cart-watch-btn",onClick:i,children:"‚ñ∂ Watch Path"})]}):e.jsxs("div",{className:"cart-empty",children:[e.jsx("span",{className:"cart-empty-icon",children:"üì∫"}),e.jsx("p",{children:"Add videos, docs, and resources to build your learning path"})]})]})}xs.propTypes={cart:h.arrayOf(h.shape({itemId:h.string,driveId:h.string,type:h.oneOf(["video","doc","youtube"]),title:h.string.isRequired,duration:h.number,readTimeMinutes:h.number,durationMinutes:h.number})).isRequired,onRemove:h.func.isRequired,onClear:h.func.isRequired,onWatchPath:h.func.isRequired};const ys="ue5_video_cart";function ot(){try{const s=localStorage.getItem(ys);return s?JSON.parse(s):[]}catch{return[]}}function Me(s){try{localStorage.setItem(ys,JSON.stringify(s))}catch{}}function _e(s){return s.itemId||s.driveId||s.id||`${s.type}_${s.url}`}function ct(){const[s,t]=w.useState(ot),a=w.useCallback(n=>{t(c=>{const x=_e(n);if(c.some(b=>_e(b)===x))return c;const f={...n,itemId:x,type:n.type||"video"},v=[...c,f];return Me(v),v})},[]),i=w.useCallback(n=>{t(c=>{const x=c.filter(f=>_e(f)!==n&&f.driveId!==n);return Me(x),x})},[]),u=w.useCallback(()=>{t([]),Me([])},[]),o=w.useCallback(n=>s.some(c=>_e(c)===n||c.driveId===n),[s]),r=s.filter(n=>(n.type||"video")==="video").length,d=w.useMemo(()=>s.reduce((n,c)=>n+(c.duration||(c.readTimeMinutes||c.durationMinutes||0)*60),0),[s]),l=w.useMemo(()=>{const n={video:[],doc:[],youtube:[]};for(const c of s){const x=c.type||"video";(n[x]||n.video).push(c)}return n},[s]);return{cart:s,addToCart:a,removeFromCart:i,clearCart:u,isInCart:o,videoCount:r,totalDuration:d,itemsByType:l}}let Ee=null;async function lt(){if(!Ee){const s=await xe(()=>import("./data-embeddings-EsTyY_EC.js"),[]);Ee=s.default||s}return Ee}function Ve(s,t){if(!s||!t||s.length!==t.length)return 0;let a=0,i=0,u=0;for(let r=0;r<s.length;r++)a+=s[r]*t[r],i+=s[r]*s[r],u+=t[r]*t[r];const o=Math.sqrt(i)*Math.sqrt(u);return o===0?0:a/o}async function dt(s,t=5,a=.3){const i=await lt();if(!s||!i?.courses)return[];const u=[];for(const[o,r]of Object.entries(i.courses)){const d=Ve(s,r.embedding);d>=a&&u.push({code:o,title:r.title,similarity:d})}return u.sort((o,r)=>r.similarity-o.similarity),u.slice(0,t)}let Le=null,$e=null;async function ut(){if(!Le){const s=await xe(()=>import("./data-search-SjqZFhcO.js").then(t=>t.s),[]);Le=s.default||s}return Le}async function ze(){if(!$e){const s=await xe(()=>import("./data-search-SjqZFhcO.js").then(t=>t.a),[]);$e=s.default||s}return $e}let Ae=null,ge=null;function ht(s,t=768){const a=atob(s),i=new Uint8Array(a.length);for(let r=0;r<a.length;r++)i[r]=a.charCodeAt(r);const u=new DataView(i.buffer),o=new Float32Array(t);for(let r=0;r<t;r++){const d=u.getUint16(r*2,!0);o[r]=mt(d)}return o}function mt(s){const t=s>>15&1,a=s>>10&31,i=s&1023;return a===0?(t?-1:1)*Math.pow(2,-14)*(i/1024):a===31?i?NaN:t?-1/0:1/0:(t?-1:1)*Math.pow(2,a-15)*(1+i/1024)}async function pt(){if(ge)return ge;if(!Ae)try{const t=await fetch(new URL("../data/segment_embeddings.json",import.meta.url));if(!t.ok)throw new Error(`HTTP ${t.status}`);Ae=await t.json()}catch(t){return ne("‚ö†Ô∏è segment_embeddings.json not available:",t.message),null}const s=Ae?.segments;if(!s)return null;ge=new Map;for(const[t,a]of Object.entries(s))ge.set(t,{vector:ht(a.embedding),courseCode:a.course_code,videoKey:a.video_key,videoTitle:a.video_title,startTimestamp:a.start_timestamp,endTimestamp:a.end_timestamp,startSeconds:a.start_seconds,text:a.text,tokenEstimate:a.token_estimate});return z(`[SegmentSearch] Decoded ${ge.size} segment embeddings`),ge}async function gt(s,t=[]){if(!s||s.length<3)return[];const a=s.toLowerCase().split(/\s+/).filter(r=>r.length>2&&!ke.has(r));if(a.length===0)return[];const i=await ut(),u=[],o=i?.course_words||{};for(const[r,d]of Object.entries(o)){let l=0;const n=[];for(const c of a)if(d[c]&&(l+=d[c]*10,n.push(c)),c.length>=4)for(const[x,f]of Object.entries(d))x!==c&&x.length>=4&&(x.startsWith(c)||c.startsWith(x))&&(l+=f*3,n.includes(x)||n.push(x));if(l>=30&&n.length>0){const c=t.find(f=>f.code===r),x=await ft(r,n);u.push({courseCode:r,courseTitle:c?.title||r,score:l,matchedKeywords:n,topSegments:x,estimatedSegment:x.length>0?x[0]:null,videoCount:c?.video_count||0,duration:c?.duration_formatted||"Unknown"})}}return u.sort((r,d)=>d.score-r.score).slice(0,5)}async function ft(s,t){const i=(await ze())[s];if(!i||!i.videos)return[];const u=[];for(const[o,r]of Object.entries(i.videos))if(r.segments)for(const d of r.segments){const l=d.text.toLowerCase();let n=0;const c=[];for(const x of t){const f=x.toLowerCase(),v=new RegExp(f.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi"),b=l.match(v);b&&(n+=b.length*10,c.push(x)),l.includes(f)&&(n+=5,c.includes(x)||c.push(x))}if(n>0){let x=d.text;if(x.length>120){const f=c[0]||"",v=x.toLowerCase().indexOf(f.toLowerCase());v>40&&(x="..."+x.substring(v-30)),x.length>120&&(x=x.substring(0,117)+"...")}u.push({videoKey:o,videoTitle:r.title,timestamp:d.start,startSeconds:d.start_seconds,endTimestamp:d.end,previewText:x,matchedKeywords:c,score:n})}}return u.sort((o,r)=>r.score-o.score).slice(0,3)}async function xt(s,t=10,a=.35){if(!s)return[];const i=await pt();if(!i)return[];const u=[];for(const[o,r]of i){const d=Ve(s,r.vector);d>=a&&u.push({id:o,courseCode:r.courseCode,videoKey:r.videoKey,videoTitle:r.videoTitle,timestamp:r.startTimestamp,endTimestamp:r.endTimestamp,startSeconds:r.startSeconds,previewText:r.text,similarity:d,source:"transcript"})}return u.sort((o,r)=>r.similarity-o.similarity),u.slice(0,t)}const yt=60,vt=new Set(["rendering.lumen","rendering.nanite","rendering.virtualShadowMaps","rendering.substrate","worldbuilding.worldPartition"]);function ve(s){return!!(s.videos?.length&&s.videos[0]?.drive_id||s.source==="youtube"&&s.youtube_url||s.source==="epic_docs")}function bt(s){const t=(s||"").toLowerCase();return/\bue\s*5\b|\bunreal\s*engine\s*5\b|\b5\.\d\b/.test(t)?5:/\bue\s*4\b|\bunreal\s*engine\s*4\b|\b4\.\d{1,2}\b/.test(t)?4:null}async function is(s,t,a=[],i="",u=[]){if(!t||t.length===0)return[];const o=s?.userQuery||"",r=o.toLowerCase();for(const g of Vs)if(g.patterns.some(_=>r.includes(_))){const _=g.courses.map(M=>{const F=t.find(ce=>ce.code===M);return!F||!ve(F)?null:{...F,_relevanceScore:200,_curatedMatch:!0,_curatedExplanation:g.explanation}}).filter(Boolean);if(_.length>0)return z("‚úÖ Curated solution match:",g.explanation),_}const d=`${o} ${i}`.trim(),l=pe.matchErrorSignature(d),n=l.map(g=>g.tag.tag_id),c=[...new Set([...a,...n])];l.length>0&&z("üîç Error signatures detected:",l.map(g=>`${g.tag.display_name} (${g.matchedSignature}, ${g.confidence})`));const x=pe.extractTagsFromText(o),f=x.matchedTagIds||[];if(f.length>0){z("üè∑Ô∏è Tag taxonomy matches:",x.matches.map(g=>`${g.tagId} (via "${g.matchedTerm}", ${g.matchType})`));for(const g of f)c.includes(g)||c.push(g)}const v=i.toLowerCase().split(/[\s\n:;,()[\]{}]+/).filter(g=>g.length>3&&!/^[0-9]+$/.test(g)).slice(0,10),b=o.toLowerCase().split(/\s+/).filter(g=>g.length>2&&!ke.has(g)),j=new Set(b),L=o.toLowerCase();for(const[g,y]of Object.entries(zs))if(L.includes(g))for(const _ of y)_.split(/\s+/).forEach(M=>{M.length>2&&!ke.has(M)&&j.add(M)});const m=[...j],C=async g=>!g||g.length<5?[]:(await gt(g,t)).map(_=>{const M=t.find(F=>F.code===_.courseCode);return!M||!ve(M)?null:{...M,_relevanceScore:_.score,_matchedKeywords:_.matchedKeywords}}).filter(Boolean),T=g=>g.length===0?[]:t.filter(ve).map(_=>{const M=(_.title||"").toLowerCase(),F=(_.description||"").toLowerCase(),ce=[..._.canonical_tags||[],..._.gemini_system_tags||[],..._.extracted_tags||[],..._.ai_tags||[]].map(J=>typeof J=="string"?J.toLowerCase():"").join(" ");let O=0;const A=[];for(const J of g)M.includes(J)?(O+=50,A.push(J)):ce.includes(J)?(O+=30,A.push(J)):F.includes(J)&&(O+=10,A.push(J));if(f.length>0){const J=(_.canonical_tags||[]).map(X=>X.toLowerCase());f.some(X=>J.some(de=>de.includes(X.split(".").pop())))&&(O*=3)}const le=new Set(A).size;le>=2&&(O*=1+le*.3);const ae=g.length>0?le/g.length:1;return g.length>=2&&ae<.5?O*=.3:ae>=1&&(O*=2),O===0?null:{..._,_relevanceScore:O,_matchedKeywords:A}}).filter(Boolean).sort((_,M)=>M._relevanceScore-_._relevanceScore),k=g=>c.length===0?g:g.map(y=>{const _=y.extracted_tags||y.tags||[],ce=(Array.isArray(_)?_:Object.values(_)).map(O=>typeof O=="string"?O:O.tag_id||O.name||"").filter(Boolean).some(O=>c.some(A=>O.toLowerCase().includes(A.toLowerCase())||A.toLowerCase().includes(O.toLowerCase())));return{...y,_relevanceScore:ce?y._relevanceScore*2:y._relevanceScore*.5}}).sort((y,_)=>_._relevanceScore-y._relevanceScore),R=v.length>0?`${o} ${v.join(" ")}`:o,E=await C(R),H=v.length>0?[...m,...v]:m,B=T(H),Q=new Set,N=[];for(const g of E)Q.has(g.code)||(N.push(g),Q.add(g.code));for(const g of B)if(!Q.has(g.code))N.push(g),Q.add(g.code);else{const y=N.find(_=>_.code===g.code);y&&(y._relevanceScore+=g._relevanceScore)}const S=(N.length>0?N[0]._relevanceScore:0)>=yt;if(u.length>0){const g=S?60:100,y=S?20:40;for(const _ of u)if(Q.has(_.code)){const M=N.find(F=>F.code===_.code);M&&(M._relevanceScore+=_.similarity*y)}else{const M=t.find(F=>F.code===_.code);M&&ve(M)&&(N.push({...M,_relevanceScore:_.similarity*g,_matchedKeywords:["semantic-match"],_semanticMatch:!0,_tier:S?2:1}),Q.add(_.code))}}N.sort((g,y)=>y._relevanceScore-g._relevanceScore);const q=k(N);if(q.length>=3)return Pe(q.slice(0,5),o);const V=[R,s?.diagnosis?.problem_summary,...s?.intent?.systems||[]].filter(Boolean).join(" "),ee=V.toLowerCase().split(/\s+/).filter(g=>g.length>2&&!ke.has(g)),oe=await C(V),re=T(ee);for(const g of[...oe,...re])Q.has(g.code)||(N.push(g),Q.add(g.code));N.sort((g,y)=>y._relevanceScore-g._relevanceScore);const G=k(N);if(G.length>=3)return Pe(G.slice(0,5),o);const p=t.map(g=>{const y=pe.scoreCourseRelevance(g,H);return{...g,_relevanceScore:y.score,_scoreBreakdown:y.breakdown,_topContributors:y.topContributors}}).filter(g=>g._relevanceScore>0&&ve(g)).sort((g,y)=>y._relevanceScore-g._relevanceScore).slice(0,5);return Pe(k(p),o)}function Pe(s,t){const a=bt(t);return a?s.map(i=>{const o=[...i.canonical_tags||[],...i.gemini_system_tags||[],...i.extracted_tags||[]].map(r=>typeof r=="string"?r.toLowerCase():"").some(r=>[...vt].some(d=>r.includes(d.split(".").pop())));return a===4&&o?(z(`‚¨áÔ∏è UE4 demotion: ${i.code} (has UE5-only tags)`),{...i,_relevanceScore:i._relevanceScore*.2}):a===5&&o?{...i,_relevanceScore:i._relevanceScore*1.5}:i}).sort((i,u)=>u._relevanceScore-i._relevanceScore):s}let Oe=null;async function jt(){if(!Oe){const s=await xe(()=>import("./data-courses-CDlycmza.js").then(t=>t.j),[]);Oe=s.default||s}return Oe}const qe=new Set(["help","helpful","helps","use","used","using","make","made","get","getting","look","going","come","know","thing","work","working","want","need","show","start","take","right","well"]);function os(s){return s.replace(/ies$/i,"y").replace(/ves$/i,"f").replace(/(s|es|ing|ed|tion|ment)$/i,"").toLowerCase()}function _t(s,t){const i=t.replace(/[-_]/g," ").split(/\s+/).filter(o=>o.length>2).map(os);return s.map(os).some(o=>i.some(r=>o.includes(r)||r.includes(o)))}async function cs(s,t,a={}){const i=[],u=(t||"").toLowerCase().split(/\s+/).filter(m=>m.length>2),o=await jt(),r=[],d=(t||"").toLowerCase(),l=d.split(/\s+/).filter(m=>m.length>2);for(const[m,C]of Object.entries(o))(d.includes(m)||_t(l,m))&&r.push({label:C.label,url:C.url});for(const m of s){if(m.source==="youtube"&&m.youtube_url){const T=a[m.code]||{},k=(()=>{const R=(m._matchedKeywords||[]).filter(E=>E.length>3&&!qe.has(E.toLowerCase())).slice(0,3);return R.length>0?R:[m.topic||m.tags?.topic||"UE5"].flat().slice(0,3)})();i.push({driveId:m.youtube_url,title:Te(m.title||m.code),duration:m.duration_seconds||0,courseCode:m.code,courseName:m.title||m.code,matchedTags:k,videoIndex:0,relevanceScore:m._relevanceScore||0,titleRelevance:0,isIntro:!1,timestampHint:null,startSeconds:0,topSegments:[],watchHint:"‚ñ∂ Watch on YouTube",docLinks:r,_curatedMatch:m._curatedMatch||!1,_curatedExplanation:m._curatedExplanation||null,role:T.role||null,reason:T.reason||null,estimatedMinutes:T.estimatedMinutes||null,_source:"youtube",_externalUrl:m.youtube_url,type:"youtube",url:m.youtube_url,channel:m.channel_name||m.channel||null,channelTrust:m.channel_trust||null,topics:m.topics||[],description:m.description||"",durationMinutes:m.duration_seconds?Math.round(m.duration_seconds/60):10});continue}if(m.source==="epic_docs"){const T=m.url||m.youtube_url||"#",k=a[m.code]||{},R=(()=>{const E=(m._matchedKeywords||[]).filter(H=>H.length>3&&!qe.has(H.toLowerCase())).slice(0,3);return E.length>0?E:[m.topic||m.tags?.topic||"UE5"].flat().slice(0,3)})();i.push({driveId:`doc_${m.code}`,title:Te(m.title||m.code),duration:0,courseCode:m.code,courseName:m.title||m.code,matchedTags:R,videoIndex:0,relevanceScore:m._relevanceScore||0,titleRelevance:0,isIntro:!1,timestampHint:null,startSeconds:0,topSegments:[],watchHint:"üìñ Read Epic Docs",docLinks:[{label:m.title||"Epic Docs",url:T},...r],_curatedMatch:m._curatedMatch||!1,_curatedExplanation:m._curatedExplanation||null,role:k.role||null,reason:k.reason||null,estimatedMinutes:k.estimatedMinutes||null,_source:"epic_docs",_externalUrl:T,type:"doc",url:T,topics:m.topics||[],description:m.description||"",readTimeMinutes:10});continue}const C=m.videos||[];if(C.length!==0)for(let T=0;T<C.length;T++){const k=C[T];if(!k.drive_id)continue;const R=k.title||k.name||`Video ${T+1}`,E=R.toLowerCase(),H=Te(R),B=u.filter(se=>E.includes(se)).length,Q=B*50,N=await Nt(m.code,R,T),I=await wt(m.code,N,u),S=E.includes("intro")||E.includes("introduction")||E.includes("wrap up")||E.includes("outro")||E.includes("overview")||E.includes("getting started")||E.includes("welcome")||E.includes("course intro")||E.includes("what you'll learn")||E.includes("what we'll cover")||E.includes("summary")||E.includes("objectives")||/\bpart\s*a\b/i.test(R)&&T===0,q=S?.15:1,U=!S&&I.topSegments&&I.topSegments.length>0?15:0,V=k.duration_seconds||k.durationSeconds||0,ee=V/60,oe=ee<2?.4:ee<5?.7:ee>20?1.1:1,re=new Set;for(const se of I.topSegments||[])for(const X of se.matchedKeywords||[])re.add(X);const G=re.size,be=B>=2||B===1&&G>=1?1:G>=2?.8:G===1?.3:B===1?.5:.15,p=(m._relevanceScore||0)*be,g=(Q+I.score+U+p)*q*oe,_=B===0&&I.score<30?Math.min(g,40):g,M=Fs(k.drive_id,_);let F="‚ñ∂ Watch full video";const O=(I.topSegments||[]).filter(se=>!V||se.startSeconds<=V)[0]||(I.bestSegment&&(!V||I.bestSegment.startSeconds<=V)?I.bestSegment:null);if(O){const se=O.timestamp||"0:00",X=O.previewText,de=X.length>60?X.substring(0,57)+"...":X;F=O.startSeconds<5?`üìç Start of video ‚Äî "${de}"`:`üìç Jump to ${se} ‚Äî "${de}"`}const A=a[m.code]||{},le=(()=>{const se=(m._matchedKeywords||[]).filter(X=>X.length>3&&!qe.has(X.toLowerCase())).slice(0,3);return se.length>0?se:[m.topic||m.tags?.topic||"UE5"].flat().slice(0,3)})(),ae=I.bestSegment?.startSeconds||0,J=V&&ae>V?0:ae;i.push({driveId:k.drive_id,title:H,duration:k.duration_seconds||0,courseCode:m.code,courseName:m.title||m.code,matchedTags:le,videoIndex:T,relevanceScore:M,titleRelevance:B,isIntro:S,timestampHint:J>0&&I.bestSegment?.timestamp||null,startSeconds:J,topSegments:I.topSegments||[],watchHint:F,docLinks:r,_curatedMatch:m._curatedMatch||!1,_curatedExplanation:m._curatedExplanation||null,role:A.role||null,reason:A.reason||null,estimatedMinutes:A.estimatedMinutes||null})}}const n=new Map;for(const m of i){const C=n.get(m.driveId);(!C||m.relevanceScore>C.relevanceScore)&&n.set(m.driveId,m)}const c=Array.from(n.values());c.sort((m,C)=>C.relevanceScore-m.relevanceScore);const x=new Map,f=2,v=c.filter(m=>{const C=x.get(m.courseCode)||0;return C>=f?!1:(x.set(m.courseCode,C+1),!0)}),b=new Set;for(const m of v)m.isIntro||b.add(m.courseCode);const j=v.filter(m=>!(m.isIntro&&b.has(m.courseCode)));if(j.length>3){const m=j.map(R=>R.relevanceScore),C=m[Math.floor(m.length/2)],T=Math.max(C*.5,10),k=j.filter(R=>R.relevanceScore>=T);if(k.length>=3){const R=k.slice(0,6);return ls(R,u),R}}const L=j.slice(0,6);return ls(L,u),L}function ls(s,t){if(s.length===0)return;const a=Math.max(s[0].relevanceScore,1);for(const i of s){i.matchPercent=Math.min(100,Math.round(i.relevanceScore/a*100));const u=[];if(i._curatedMatch&&u.push("Known solution for this problem"),i.titleRelevance>0){const o=t.filter(r=>(i.title||"").toLowerCase().includes(r)).slice(0,3);o.length>0&&u.push(`Title matches: ${o.join(", ")}`)}if(i.topSegments.length>0){const o=new Set;for(const d of i.topSegments)for(const l of d.matchedKeywords||[])o.add(l);const r=[...o].slice(0,4);r.length>0&&u.push(`Transcript mentions: ${r.join(", ")}`)}i.matchedTags.length>0&&u.length<2&&u.push(`Tagged: ${i.matchedTags.slice(0,3).join(", ")}`),i.matchReason=u.length>0?u.join(" ¬∑ "):"Related to your query"}}async function Nt(s,t,a){const u=(await ze())[s];if(!u?.videos)return null;const o=x=>(x||"").toLowerCase().replace(/\.mp4$/i,"").replace(/_/g," ").replace(/\s+/g," ").trim(),r=o(t),d=r.split(" ").filter(x=>x.length>2),l=Object.keys(u.videos);for(const x of l)if(o(u.videos[x].title||"")===r)return x;let n=null,c=0;for(const x of l){const f=o(u.videos[x].title||""),v=o(x),b=f+" "+v;let j=0;for(const L of d)new RegExp(`(^|\\s|_)${L.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&")}(\\s|_|$)`,"i").test(b)&&j++;j>0&&j>c&&(c=j,n=x)}if(n&&c>=Math.max(1,d.length*.5))return n;for(const x of l){const f=o(u.videos[x].title||""),v=o(x);if(r.includes(f)||f.includes(r)||r.includes(v)||v.includes(r))return x}return a<l.length?l[a]:l[0]||null}async function wt(s,t,a){const i={score:0,bestSegment:null,topSegments:[]},o=(await ze())[s];if(!o?.videos||!t)return i;const r=o.videos[t];if(!r?.segments)return i;const d=[];for(const c of r.segments){const x=c.text.toLowerCase();let f=0;const v=[];for(const b of a)if(x.includes(b)){const j=x.split(b).length-1;f+=j*10,v.push(b)}if(f>0){let b=c.text;if(b.length>100){const j=b.toLowerCase().indexOf(v[0]||"");j>30&&(b="..."+b.substring(j-20)),b.length>100&&(b=b.substring(0,97)+"...")}d.push({timestamp:c.start,startSeconds:c.start_seconds,previewText:b,matchedKeywords:v,score:f})}}d.sort((c,x)=>x.score-c.score);const l=d.slice(0,3);return{score:d.reduce((c,x)=>c+x.score,0),bestSegment:l[0]||null,topSegments:l}}let De=null,fe=null;function St(s,t=768){const a=atob(s),i=new Uint8Array(a.length);for(let r=0;r<a.length;r++)i[r]=a.charCodeAt(r);const u=new DataView(i.buffer),o=new Float32Array(t);for(let r=0;r<t;r++){const d=u.getUint16(r*2,!0);o[r]=Ct(d)}return o}function Ct(s){const t=s>>15&1,a=s>>10&31,i=s&1023;return a===0?(t?-1:1)*Math.pow(2,-14)*(i/1024):a===31?i?NaN:t?-1/0:1/0:(t?-1:1)*Math.pow(2,a-15)*(1+i/1024)}async function Tt(){if(fe)return fe;if(!De)try{const t=await fetch(new URL("../data/docs_embeddings.json",import.meta.url));if(!t.ok)throw new Error(`HTTP ${t.status}`);De=await t.json()}catch(t){return ne("‚ö†Ô∏è docs_embeddings.json not available:",t.message),null}const s=De?.docs;if(!s)return null;fe=new Map;for(const[t,a]of Object.entries(s))fe.set(t,{vector:St(a.embedding),slug:a.slug,url:a.url,title:a.title,section:a.section,text:a.text,tokenEstimate:a.token_estimate});return z(`[DocsSearch] Decoded ${fe.size} doc embeddings`),fe}async function kt(s,t=5,a=.35){if(!s)return[];const i=await Tt();if(!i)return[];const u=[];for(const[o,r]of i){const d=Ve(s,r.vector);d>=a&&u.push({id:o,slug:r.slug,url:r.url,title:r.title,section:r.section,previewText:r.text,similarity:d,source:"epic_docs"})}return u.sort((o,r)=>r.similarity-o.similarity),u.slice(0,t)}let Ne=null;async function vs(){if(Ne)return Ne;try{const s=await xe(()=>import("./data-courses-CDlycmza.js").then(t=>t.j),[]);return Ne=s.default||s,Ne}catch(s){return ne("‚ö†Ô∏è doc_links.json not available:",s.message),{}}}const we={beginner:0,intermediate:1,advanced:2};function ds(s){return s.replace(/ies$/i,"y").replace(/ves$/i,"f").replace(/(es|s|ing|ed|tion|ment)$/i,"").toLowerCase()}function Se(s,t){const a=s.split(/[\s_-]+/).filter(u=>u.length>2).map(ds),i=t.split(/[\s_-]+/).filter(u=>u.length>2).map(ds);return a.some(u=>i.some(o=>u===o||u.includes(o)||o.includes(u)))}async function bs(s,{maxTier:t="advanced",limit:a=10}={}){const i=await vs();if(!i||!s?.length)return[];const u=we[t]??2,o=s.map(n=>n.toLowerCase()),r=[];for(const[n,c]of Object.entries(i)){if((we[c.tier]??1)>u)continue;let f=0;const v=n.toLowerCase(),b=(c.label||"").toLowerCase(),j=(c.url||"").split("/").pop().replace(/-/g," ").toLowerCase(),L=(c.tags||[]).map(T=>T.toLowerCase()),m=(c.description||"").toLowerCase();let C=0;for(const T of o){let k=!1;v===T?(f+=15,k=!0):v.includes(T)?(f+=8,k=!0):T.includes(v)?(f+=6,k=!0):c.subsystem===T?(f+=5,k=!0):b.includes(T)?(f+=6,k=!0):L.includes(T)?(f+=2,k=!0):L.some(R=>R.includes(T)||T.includes(R))?(f+=1,k=!0):j.includes(T)?(f+=2,k=!0):m.includes(T)?(f+=1,k=!0):Se(T,v)?(f+=4,k=!0):Se(T,b)?(f+=3,k=!0):(L.some(R=>Se(T,R))||Se(T,m))&&(f+=1,k=!0),k&&C++}C>=2&&(f+=C*5),f>0&&r.push({key:n,label:c.label,description:c.description||"",url:c.url,tier:c.tier,subsystem:c.subsystem,readTimeMinutes:c.readTimeMinutes||10,prerequisites:c.prerequisites||[],sections:c.sections||[],keySteps:c.keySteps||[],seeAlso:c.seeAlso||[],_score:f,source:"epic_docs"})}r.sort((n,c)=>c._score!==n._score?c._score-n._score:(we[n.tier]??1)-(we[c.tier]??1));const d=[];for(const n of r){const c=new Set(n.key.split(/[-_]+/).filter(f=>f.length>2));d.some(f=>{const v=new Set(f.key.split(/[-_]+/).filter(j=>j.length>2));return[...c].filter(j=>v.has(j)).length/Math.min(c.size,v.size)>.6})||d.push(n)}const l=d.length>0?d[0]._score:1;return d.slice(0,a).map(({_score:n,...c})=>({...c,_rawScore:n,matchScore:Math.round(n/Math.max(l,1)*100)}))}async function It(s,{limit:t=8}={}){const a=await vs();if(!a)return[];const i=await bs(s,{limit:t*2});if(!i.length)return[];const u=new Map(i.map(n=>[n.key,n.matchScore??0])),o=new Map(i.map(n=>[n.key,n._rawScore??0])),r=new Set,d=[];function l(n){if(r.has(n))return;r.add(n);const c=a[n];if(c){for(const x of c.prerequisites||[])l(x);d.push({key:n,label:c.label,description:c.description||"",keySteps:c.keySteps||[],seeAlso:c.seeAlso||[],url:c.url,tier:c.tier,subsystem:c.subsystem,readTimeMinutes:c.readTimeMinutes||10,matchScore:u.get(n)??0,_rawScore:o.get(n)??0,source:"epic_docs"})}}for(const n of i)l(n.key);return d.sort((n,c)=>(c._rawScore??0)-(n._rawScore??0)),d.slice(0,t)}const us={prerequisite:0,core:1,troubleshooting:2,supplemental:3};function Rt(s){return s.estimated_minutes?s.estimated_minutes:s.total_duration_seconds?Math.round(s.total_duration_seconds/60):(s.videos?.length||1)*10}function hs(s,t){if(t.size===0)return 0;const a=new Set([...s.canonical_tags||[],...s.gemini_system_tags||[],...s.transcript_tags||[]].map(u=>typeof u=="string"?u.toLowerCase():""));if(a.size===0)return 0;let i=0;for(const u of a)(t.has(u)||t.has(u.split(".").pop()))&&i++;return i/a.size}function Mt(s,t){const a=[...s.canonical_tags||[],...s.gemini_system_tags||[]].map(d=>typeof d=="string"?d.toLowerCase():""),i=new Set(t.map(d=>d.toLowerCase()));let u=!1;for(const d of a)if(i.has(d)||i.has(d.split(".").pop())){u=!0;break}const o=a.some(d=>{const l=pe.getTag(d);return l?.tag_type==="symptom"||l?.tag_type==="error_code"});let r=!1;for(const d of a){const l=pe.edgesBySource?.get(d)||[];for(const n of l)if(n.relation==="subtopic"&&i.has(n.target)){r=!0;break}if(r)break}return r?"prerequisite":o?"troubleshooting":u?"core":"supplemental"}function ms(s,t,a={}){const{timeBudgetMinutes:i=1/0,maxItems:u=8,preferTroubleshooting:o=!1,diversity:r=!0}=a;if(!s||s.length===0)return{path:[],metadata:{totalMinutes:0,tagCoverage:0,diversityScore:1,itemCount:0}};const d=s.map(j=>({course:j,role:Mt(j,t),estimatedMinutes:Rt(j),score:j._relevanceScore||0}));d.sort((j,L)=>{const m=us[j.role]-us[L.role];return m!==0?m:L.score-j.score}),o&&d.sort((j,L)=>{const m=j.role==="troubleshooting"?0:1,C=L.role==="troubleshooting"?0:1;return m!==C?m-C:L.score-j.score});const l=[],n=new Set;let c=0;for(const j of d){if(l.length>=u)break;if(c+j.estimatedMinutes>i||r&&l.length>0&&hs(j.course,n)>.7)continue;const L=Et(j,t);l.push({course:j.course,role:j.role,reason:L,estimatedMinutes:j.estimatedMinutes}),c+=j.estimatedMinutes,[...j.course.canonical_tags||[],...j.course.gemini_system_tags||[]].map(C=>typeof C=="string"?C.toLowerCase():"").forEach(C=>{n.add(C),n.add(C.split(".").pop())})}const x=new Set(t.map(j=>j.toLowerCase()));let f=0;for(const j of x)(n.has(j)||n.has(j.split(".").pop()))&&f++;const v=x.size>0?f/x.size:0;let b=1;if(l.length>1){let j=0;const L=new Set;for(const m of l)j+=hs(m.course,L),[...m.course.canonical_tags||[]].map(T=>T?.toLowerCase?.()||"").forEach(T=>L.add(T));b=1-j/l.length}return{path:l,metadata:{totalMinutes:c,tagCoverage:Math.round(v*100)/100,diversityScore:Math.round(b*100)/100,itemCount:l.length}}}function Et(s,t){const{course:a,role:i}=s,u=[...a.canonical_tags||[],...a.gemini_system_tags||[]].map(d=>typeof d=="string"?d.toLowerCase():""),o=new Set(t.map(d=>d.toLowerCase())),r=u.filter(d=>o.has(d)||o.has(d.split(".").pop()));switch(i){case"prerequisite":return`Foundation course ‚Äî covers prerequisite concepts for ${r.slice(0,2).join(", ")}`;case"core":return`Directly covers: ${r.slice(0,3).join(", ")}`;case"troubleshooting":return"Troubleshooting guide ‚Äî addresses symptoms related to your query";case"supplemental":return"Related content ‚Äî expands on topics connected to your query";default:return"Relevant to your search"}}let me=null;async function js(){if(me!=null)return me;try{const s=await xe(()=>import("./data-courses-CDlycmza.js").then(t=>t.y),[]);return me=s.default||s,me}catch{return me={channels:{},resources:[]},me}}const Ce={beginner:0,intermediate:1,advanced:2};async function _s(s,{maxTier:t="advanced",limit:a=5}={}){if(!s?.length)return[];const i=await js();if(!i?.resources?.length)return[];const u=Ce[t]??2,o=new Set(s.map(l=>l.toLowerCase())),r=[];for(const l of i.resources){if((Ce[l.tier]??1)>u)continue;const c=(l.topics||[]).map(v=>v.toLowerCase()),x=(l.tag_ids||[]).map(v=>v.toLowerCase());let f=0;for(const v of c){o.has(v)&&(f+=5);for(const b of o)(v.includes(b)||b.includes(v))&&(f+=2)}for(const v of x){o.has(v)&&(f+=5);const b=v.split(".");for(const j of b)o.has(j)&&(f+=3)}if(f>0){const v=i.channels?.[l.channelKey];r.push({id:l.id,title:l.title,url:l.url,channelName:v?.name||"Unreal Engine",channelTrust:"official",tier:l.tier,durationMinutes:l.durationMinutes,topics:l.topics,tag_ids:l.tag_ids||[],description:l.description||"",keyTakeaways:l.keyTakeaways||[],chapters:l.chapters||[],source:"epic_youtube",_score:f})}}const d=/\b(ue\s*5|unreal\s*engine\s*5|5\.\d)/i;for(const l of r)l._isUE5=d.test(l.title)||(l.topics||[]).some(n=>d.test(n));return r.sort((l,n)=>l._isUE5!==n._isUE5?l._isUE5?-1:1:n._score!==l._score?n._score-l._score:(Ce[l.tier]??1)-(Ce[n.tier]??1)),r.slice(0,a).map(({_score:l,_isUE5:n,...c})=>c)}async function Lt(s,{limit:t=5}={}){if(!s?.length)return[];const a=await js();if(!a?.resources?.length)return[];const i=new Set(s.map(o=>o.toLowerCase())),u=[];for(const o of a.resources){const r=(o.tag_ids||[]).map(l=>l.toLowerCase());let d=0;for(const l of r)i.has(l)&&(d+=5);if(d>0){const l=a.channels?.[o.channelKey];u.push({id:o.id,title:o.title,url:o.url,channelName:l?.name||"Unreal Engine",channelTrust:"official",tier:o.tier,durationMinutes:o.durationMinutes,topics:o.topics,tag_ids:o.tag_ids||[],description:o.description||"",keyTakeaways:o.keyTakeaways||[],chapters:o.chapters||[],source:"epic_youtube",_score:d})}}return u.sort((o,r)=>r._score-o._score),u.slice(0,t).map(({_score:o,...r})=>r)}async function $t(s,t=[]){if(!s?.length)return{topics:[],firstPartyVideos:0,docsArticles:0,youtubeResources:0,coverageScore:0,gaps:[]};const a=await bs(s,{limit:10}),i=await _s(s,{limit:10}),u={};for(const l of s){const n=l.toLowerCase(),c=t.filter(b=>{const j=(b.tags||[]).map(m=>m.toLowerCase()),L=(b.title||"").toLowerCase();return j.some(m=>m.includes(n))||L.includes(n)}).length,x=a.filter(b=>b.key?.toLowerCase().includes(n)||b.subsystem?.toLowerCase()===n||b.label?.toLowerCase().includes(n)).length,f=i.filter(b=>{const j=(b.topics||[]).some(m=>m.toLowerCase().includes(n)),L=(b.tag_ids||[]).some(m=>m.toLowerCase().includes(n));return j||L}).length,v=c+x+f;u[l]={firstPartyVideos:c,docsArticles:x,youtubeResources:f,total:v,covered:v>0}}const o=Object.values(u).filter(l=>l.covered).length,r=s.length>0?o/s.length:0,d=Object.entries(u).filter(([,l])=>!l.covered).map(([l])=>l);return{topics:s,topicCoverage:u,firstPartyVideos:t.length,docsArticles:a.length,youtubeResources:i.length,coverageScore:r,gaps:d}}async function At(s,t=[],{maxDocs:a=5,maxYoutube:i=3}={}){if(!s?.length)return{docs:[],youtube:[],totalTimeMinutes:0,coverageScore:0};const u=await It(s,{limit:a}),o=await _s(s,{limit:i}),r=await Lt(s,{limit:i}),d=new Set(o.map(v=>v.id)),l=[...o];for(const v of r)d.has(v.id)||(l.push(v),d.add(v.id));const n=t.reduce((v,b)=>v+(b.durationMinutes||10),0),c=u.reduce((v,b)=>v+(b.readTimeMinutes||10),0),x=l.reduce((v,b)=>v+(b.durationMinutes||15),0),f=await $t(s,t);return{docs:u,youtube:l,totalTimeMinutes:n+c+x,coverageScore:f.coverageScore,gaps:f.gaps,externalEnabled:!0}}const Be={QUERY_SUBMITTED:"query_submitted",DIAGNOSIS_GENERATED:"diagnosis_generated",LEARNING_PATH_GENERATED:"learning_path_generated"};let Fe=null;function Pt(){return Fe||(Fe=`session_${Date.now()}_${Math.random().toString(36).substring(2,9)}`),Fe}async function Ge(s,t={}){try{const a=ps(),i={event:s,session_id:Pt(),...t,timestamp:ks(),client_timestamp:new Date().toISOString()};await Is(Rs(a,"analytics_events"),i)}catch(a){ne("[Analytics] Failed to track event:",s,a.message)}}function Ot(s,t=[],a=null){return Ge(Be.QUERY_SUBMITTED,{query_length:s?.length||0,query_preview:s?.substring(0,100),detected_tag_count:t.length,detected_tags:t.slice(0,5),persona_id:a})}function qt(s){return Ge(Be.DIAGNOSIS_GENERATED,{diagnosis_id:s?.diagnosis_id,root_causes_count:s?.root_causes?.length||0,signals_count:s?.signals_to_watch_for?.length||0,generalization_scope:s?.generalization_scope?.slice(0,3)})}function Dt(s,t,a=!0){return Ge(Be.LEARNING_PATH_GENERATED,{fix_specific_count:s?.fix_specific?.length||0,transferable_count:s?.transferable?.length||0,course_count:t?.length||0,passed_validation:a})}function Ke({onUpdate:s,disabled:t}){const[a,i]=w.useState(!1),[u,o]=w.useState({engineVersion:"",platform:"",context:"",renderer:"",features:"",whatChangedRecently:"",goal:""}),r=w.useCallback((d,l)=>{const n={...u,[d]:l};o(n);const c={engineVersion:n.engineVersion.trim()||void 0,platform:n.platform.trim()||void 0,context:n.context.trim()||void 0,renderer:n.renderer.trim()||void 0,features:n.features?n.features.split(",").map(f=>f.trim()).filter(Boolean):[],whatChangedRecently:n.whatChangedRecently.trim()||void 0,goal:n.goal.trim()||void 0},x=Object.values(c).some(f=>f!==void 0&&(!Array.isArray(f)||f.length>0));s(x?c:null)},[u,s]);return e.jsxs("div",{className:"case-report-form",children:[e.jsxs("button",{type:"button",className:"case-report-toggle",onClick:()=>i(!a),disabled:t,children:[e.jsx("span",{className:"case-report-toggle-icon",children:a?"‚ñæ":"‚ñ∏"}),e.jsxs("span",{className:"case-report-toggle-label",children:["üîß Add Case Details",e.jsx("span",{className:"case-report-hint",children:"(improves diagnosis accuracy)"})]})]}),a&&e.jsxs("div",{className:"case-report-fields",children:[e.jsxs("div",{className:"case-report-row",children:[e.jsxs("div",{className:"case-report-field",children:[e.jsx("label",{children:"Engine Version"}),e.jsx("input",{type:"text",placeholder:"e.g. 5.4.1",value:u.engineVersion,onChange:d=>r("engineVersion",d.target.value),disabled:t,maxLength:20})]}),e.jsxs("div",{className:"case-report-field",children:[e.jsx("label",{children:"Platform"}),e.jsxs("select",{value:u.platform,onChange:d=>r("platform",d.target.value),disabled:t,children:[e.jsx("option",{value:"",children:"Select..."}),e.jsx("option",{value:"Windows",children:"Windows"}),e.jsx("option",{value:"macOS",children:"macOS"}),e.jsx("option",{value:"Linux",children:"Linux"}),e.jsx("option",{value:"Android",children:"Android"}),e.jsx("option",{value:"iOS",children:"iOS"}),e.jsx("option",{value:"Console",children:"Console"})]})]}),e.jsxs("div",{className:"case-report-field",children:[e.jsx("label",{children:"Renderer"}),e.jsxs("select",{value:u.renderer,onChange:d=>r("renderer",d.target.value),disabled:t,children:[e.jsx("option",{value:"",children:"Select..."}),e.jsx("option",{value:"Lumen",children:"Lumen"}),e.jsx("option",{value:"Nanite",children:"Nanite"}),e.jsx("option",{value:"Forward",children:"Forward Shading"}),e.jsx("option",{value:"Deferred",children:"Deferred"}),e.jsx("option",{value:"Mobile",children:"Mobile"}),e.jsx("option",{value:"PathTracing",children:"Path Tracing"})]})]})]}),e.jsxs("div",{className:"case-report-field case-report-full",children:[e.jsx("label",{children:"What changed recently?"}),e.jsx("input",{type:"text",placeholder:"e.g. Updated to 5.4, migrated project, changed lighting settings",value:u.whatChangedRecently,onChange:d=>r("whatChangedRecently",d.target.value),disabled:t,maxLength:300})]}),e.jsxs("div",{className:"case-report-field case-report-full",children:[e.jsx("label",{children:"What are you trying to achieve?"}),e.jsx("input",{type:"text",placeholder:"e.g. Realistic interior lighting, smooth character animation",value:u.goal,onChange:d=>r("goal",d.target.value),disabled:t,maxLength:200})]}),e.jsxs("div",{className:"case-report-field case-report-full",children:[e.jsx("label",{children:"Active Features (comma separated)"}),e.jsx("input",{type:"text",placeholder:"e.g. Lumen, Nanite, Virtual Shadow Maps, World Partition",value:u.features,onChange:d=>r("features",d.target.value),disabled:t,maxLength:200})]})]})]})}Ke.propTypes={onUpdate:h.func.isRequired,disabled:h.bool};Ke.defaultProps={disabled:!1};function He({question:s,options:t,whyAsking:a,onAnswer:i,onSkip:u,isLoading:o}){return e.jsxs("div",{className:"clarify-step",children:[e.jsxs("div",{className:"clarify-header",children:[e.jsx("span",{className:"clarify-icon",children:"ü§î"}),e.jsx("h3",{children:"Quick question before we diagnose"})]}),e.jsx("p",{className:"clarify-question",children:s}),e.jsx("div",{className:"clarify-options",children:(t||[]).map((r,d)=>e.jsxs("button",{className:"clarify-option-btn",onClick:()=>i(r),disabled:o,children:[e.jsx("span",{className:"clarify-option-letter",children:String.fromCharCode(65+d)}),e.jsx("span",{className:"clarify-option-text",children:r})]},d))}),a&&e.jsxs("p",{className:"clarify-why",children:[e.jsx("span",{className:"clarify-why-label",children:"Why we're asking:"})," ",a]}),e.jsx("button",{className:"clarify-skip-btn",onClick:u,disabled:o,children:"Skip ‚Äî just give me the best answer you can"})]})}He.propTypes={question:h.string.isRequired,options:h.arrayOf(h.string),whyAsking:h.string,onAnswer:h.func.isRequired,onSkip:h.func.isRequired,isLoading:h.bool};He.defaultProps={options:[],whyAsking:"",isLoading:!1};function Qe({evidence:s}){const[t,a]=w.useState(!1);return!s||s.length===0?null:e.jsxs("details",{className:"evidence-panel",open:t,onToggle:i=>a(i.target.open),children:[e.jsxs("summary",{className:"evidence-toggle",children:[e.jsx("span",{className:"evidence-icon",children:"üìé"}),"Sources (",s.length,")"]}),e.jsx("div",{className:"evidence-list",children:s.map((i,u)=>e.jsxs("div",{className:"evidence-item",children:[e.jsxs("div",{className:"evidence-item-header",children:[e.jsxs("span",{className:"evidence-ref",children:["[",u+1,"]"]}),e.jsx("span",{className:"evidence-source-badge",children:i.source==="transcript"?"üé¨ Transcript":"üìÑ Docs"}),i.videoTitle&&e.jsx("span",{className:"evidence-video-title",children:i.videoTitle}),i.timestamp&&e.jsxs("span",{className:"evidence-timestamp",children:["@ ",i.timestamp]})]}),e.jsx("p",{className:"evidence-text",children:i.text}),i.courseCode&&e.jsxs("span",{className:"evidence-course",children:["Course: ",i.courseCode]})]},u))})]})}Qe.propTypes={evidence:h.arrayOf(h.shape({text:h.string,source:h.string,courseCode:h.string,videoTitle:h.string,timestamp:h.string}))};Qe.defaultProps={evidence:[]};function Ye({onFeedback:s,isRerunning:t}){const[a,i]=w.useState("ask"),[u,o]=w.useState(""),r=w.useCallback(()=>{i("thanks"),s({solved:!0})},[s]),d=w.useCallback(()=>{i("no-reason")},[]),l=w.useCallback(()=>{s({solved:!1,reason:u.trim()}),i("thanks")},[s,u]);return a==="thanks"?e.jsxs("div",{className:"feedback-panel feedback-thanks",children:[e.jsx("span",{className:"feedback-icon",children:"‚úÖ"}),e.jsx("span",{children:"Thanks for the feedback!"}),t&&e.jsx("span",{className:"feedback-rerunning",children:"Re-analyzing with your feedback..."})]}):a==="no-reason"?e.jsxs("div",{className:"feedback-panel feedback-reason",children:[e.jsx("p",{className:"feedback-question",children:"What didn't work?"}),e.jsx("textarea",{className:"feedback-textarea",value:u,onChange:n=>o(n.target.value),placeholder:"e.g. I already tried that, the setting doesn't exist in my version, the issue is different...",maxLength:300,rows:2,disabled:t}),e.jsx("button",{className:"feedback-submit-btn",onClick:l,disabled:u.trim().length<5||t,children:t?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner"})," Re-analyzing..."]}):"Try a different approach ‚Üí"})]}):e.jsxs("div",{className:"feedback-panel feedback-ask",children:[e.jsx("p",{className:"feedback-question",children:"Did this solve your problem?"}),e.jsxs("div",{className:"feedback-buttons",children:[e.jsx("button",{className:"feedback-btn feedback-yes",onClick:r,children:"üëç Yes"}),e.jsx("button",{className:"feedback-btn feedback-no",onClick:d,children:"üëé No"})]})]})}Ye.propTypes={onFeedback:h.func.isRequired,isRerunning:h.bool};Ye.defaultProps={isRerunning:!1};function Je({answer:s,onFeedback:t,onBackToVideos:a,onStartOver:i,isRerunning:u}){const[o,r]=w.useState(!1);if(!s)return null;const d=s.confidence==="high"?"#10b981":s.confidence==="med"?"#f59e0b":"#ef4444";return e.jsxs("div",{className:"answer-view",children:[e.jsxs("div",{className:"answer-header",children:[e.jsxs("h2",{className:"answer-title",children:[e.jsx("span",{className:"answer-icon",children:"üéØ"})," Most Likely Cause"]}),e.jsxs("span",{className:"answer-confidence-badge",style:{background:`${d}22`,color:d,border:`1px solid ${d}44`},children:[s.confidence," confidence"]})]}),e.jsx("p",{className:"answer-cause",children:s.mostLikelyCause}),s.fastChecks?.length>0&&e.jsxs("div",{className:"answer-section answer-fast-checks",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"section-icon",children:"‚ö°"})," Quick Checks"]}),e.jsx("ul",{children:s.fastChecks.map((l,n)=>e.jsxs("li",{children:[e.jsx("span",{className:"check-number",children:n+1}),e.jsx("span",{children:l})]},n))})]}),s.fixSteps?.length>0&&e.jsxs("div",{className:"answer-section answer-fix-steps",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"section-icon",children:"üîß"})," Fix Steps"]}),e.jsx("ol",{children:s.fixSteps.map((l,n)=>e.jsx("li",{children:l},n))})]}),s.ifStillBrokenBranches?.length>0&&e.jsxs("div",{className:"answer-section answer-branches",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"section-icon",children:"üîÄ"})," If Still Broken"]}),e.jsx("div",{className:"branch-list",children:s.ifStillBrokenBranches.map((l,n)=>e.jsxs("div",{className:"branch-item",children:[e.jsxs("span",{className:"branch-condition",children:["If ",l.condition,":"]}),e.jsx("span",{className:"branch-action",children:l.action})]},n))})]}),s.learnPath&&e.jsxs("details",{className:"answer-section answer-learn-path",open:o,onToggle:l=>r(l.target.open),children:[e.jsxs("summary",{children:[e.jsx("span",{className:"section-icon",children:"üìö"})," Learn More",e.jsxs("span",{className:"learn-path-badge",children:[s.learnPath.topicsCovered?.length||0," topics"]})]}),e.jsxs("div",{className:"learn-path-content",children:[e.jsx("p",{className:"learn-path-summary",children:s.learnPath.pathSummary}),s.learnPath.objectives&&e.jsxs("div",{className:"learn-path-objectives",children:[s.learnPath.objectives.fixSpecific?.length>0&&e.jsxs("div",{children:[e.jsx("h4",{children:"üéØ Fix-Specific"}),e.jsx("ul",{children:s.learnPath.objectives.fixSpecific.map((l,n)=>e.jsx("li",{children:l},n))})]}),s.learnPath.objectives.transferable?.length>0&&e.jsxs("div",{children:[e.jsx("h4",{children:"üîÑ Transferable Skills"}),e.jsx("ul",{children:s.learnPath.objectives.transferable.map((l,n)=>e.jsx("li",{children:l},n))})]})]})]})]}),s.whyThisResult?.length>0&&e.jsxs("div",{className:"answer-section answer-reasoning",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"section-icon",children:"üí°"})," Why This Result"]}),e.jsx("ul",{className:"reasoning-list",children:s.whyThisResult.map((l,n)=>e.jsx("li",{children:l},n))})]}),e.jsx(Qe,{evidence:s.evidence}),e.jsxs("div",{className:"answer-actions",children:[e.jsx("button",{className:"answer-action-btn primary",onClick:a,children:"üé¨ Browse Related Videos"}),e.jsx("button",{className:"answer-action-btn secondary",onClick:i,children:"‚Üê Ask Another Question"})]}),e.jsx(Ye,{onFeedback:t,isRerunning:u})]})}Je.propTypes={answer:h.shape({mostLikelyCause:h.string,confidence:h.oneOf(["high","med","low"]),fastChecks:h.arrayOf(h.string),fixSteps:h.arrayOf(h.string),ifStillBrokenBranches:h.arrayOf(h.shape({condition:h.string,action:h.string})),learnPath:h.shape({pathSummary:h.string,topicsCovered:h.arrayOf(h.string),objectives:h.shape({fixSpecific:h.arrayOf(h.string),transferable:h.arrayOf(h.string)})}),whyThisResult:h.arrayOf(h.string),evidence:h.array}),onFeedback:h.func.isRequired,onBackToVideos:h.func.isRequired,onStartOver:h.func.isRequired,isRerunning:h.bool};Je.defaultProps={answer:null,isRerunning:!1};const W={INPUT:"input",LOADING:"loading",CLARIFYING:"clarifying",ANSWERED:"answered",DIAGNOSIS:"diagnosis",GUIDED:"guided",ERROR:"error"};function sn(){const[s,t]=w.useState(W.INPUT),[a,i]=w.useState(null),[u,o]=w.useState(null),[r,d]=w.useState(null),[l,n]=w.useState([]),[c,x]=w.useState(null),[f,v]=w.useState(null),[b,j]=w.useState(null),[L,m]=w.useState(!1),[C,T]=w.useState(null),{cart:k,addToCart:R,removeFromCart:E,clearCart:H,isInCart:B}=ct(),Q=Ts(),N=w.useMemo(()=>Q?.courses||[],[Q?.courses]),I=w.useCallback(()=>{try{const p=localStorage.getItem("detected_persona");return p?JSON.parse(p):null}catch{return null}},[]),S=w.useCallback(async(p,g)=>{H(),t(W.LOADING),o(null),x(null),v(null),T(p);const y=g||b;p.pastedImage&&z("[ProblemFirst] Screenshot attached (base64 length):",p.pastedImage.length),p.errorLog&&z("[ProblemFirst] Error log attached:",p.errorLog.slice(0,200));try{if(p.cachedCartId){z(`[Cache] Checking Firestore for cart: ${p.cachedCartId}`);try{const D=ss(),$=ps(D),ue=Ms($,"adaptive_carts",p.cachedCartId),he=await Es(ue);if(he.exists()){const Z=he.data(),te=Z.cached_at?.toDate?.()||new Date(Z.created_at||0),Y=Date.now()-te.getTime(),K=1440*60*1e3;if(Y<K){z(`[Cache Hit] Cart is ${Math.round(Y/6e4)}min old ‚Äî using cached result`);const P={...Z,userQuery:p.query,retrievedPassages:[]},ie=await is(P,N,p.selectedTagIds||[],p.errorLog||"",[]);P.matchedCourses=ie;const Ss=[...P.diagnosis?.matched_tag_ids||[],...p.detectedTagIds||[],...p.selectedTagIds||[]],Cs=ms(ie,Ss,{preferTroubleshooting:!0,diversity:!0}),es={};for(const je of Cs.path)es[je.course.code]={role:je.role,reason:je.reason,estimatedMinutes:je.estimatedMinutes};const Re=await cs(ie,p.query,es);if(Re.length>0){n(Re),i(P),t(W.DIAGNOSIS),z(`[Cache] Loaded ${Re.length} videos from cached cart ‚Äî 0 Gemini calls`);return}ne("[Cache] Cached cart produced 0 videos ‚Äî falling through to fresh diagnosis")}else z(`[Cache Expired] Cart is ${Math.round(Y/36e5)}h old ‚Äî refreshing`)}else z(`[Cache Miss] Cart ${p.cachedCartId} not found in Firestore`)}catch(D){ne("[Cache Error] Falling through to fresh diagnosis:",D.message)}}await Ot(p.query,p.detectedTagIds,I()?.id);const _=ss(),M=Ls(_,"us-central1");let F=null,ce=[],O=[];try{const $=await ts(M,"embedQuery")({query:p.query});if($.data?.success&&$.data?.embedding){F=$.data.embedding;const[ue,he,Z]=await Promise.allSettled([dt(F,8,.35),xt(F,6,.35),kt(F,6,.35)]);if(ue.status==="fulfilled"?ce=ue.value:ne("‚ö†Ô∏è Course semantic search failed:",ue.reason?.message),he.status==="fulfilled"){const te=he.value.map(Y=>({text:Y.previewText,courseCode:Y.courseCode,videoTitle:Y.videoTitle,timestamp:Y.timestamp,similarity:Y.similarity,source:"transcript"}));O.push(...te),z(`[RAG] ${te.length} transcript passages`)}else ne("‚ö†Ô∏è Segment search failed:",he.reason?.message);if(Z.status==="fulfilled"){const te=Z.value.map(Y=>({text:Y.previewText,url:Y.url,title:Y.title,section:Y.section,similarity:Y.similarity,source:"epic_docs"}));O.push(...te),z(`[RAG] ${te.length} doc passages`)}else ne("‚ö†Ô∏è Docs search failed:",Z.reason?.message);z(`[RAG] Total: ${O.length} passages retrieved (parallel)`)}}catch(D){ne("‚ö†Ô∏è Semantic search skipped:",D.message)}let A,le=!0;try{const $=await ts(M,"queryLearningPath")({query:p.query,mode:"problem-first",detectedTagIds:p.detectedTagIds,personaHint:p.personaHint,retrievedContext:O.slice(0,5),caseReport:y||void 0});if(!$.data.success&&$.data.error==="off_topic"){o($.data.message||"This doesn't appear to be a UE5 question. Please describe a specific Unreal Engine 5 issue."),t(W.ERROR);return}if($.data.responseType==="NEEDS_CLARIFICATION"){v({question:$.data.question,options:$.data.options||[],whyAsking:$.data.whyAsking||"",query:$.data.query,caseReport:$.data.caseReport}),t(W.CLARIFYING);return}if(!$.data.success)throw new Error($.data.message||"Failed to process query");$.data.responseType==="ANSWER"&&x({mostLikelyCause:$.data.mostLikelyCause,confidence:$.data.confidence,fastChecks:$.data.fastChecks||[],fixSteps:$.data.fixSteps||[],ifStillBrokenBranches:$.data.ifStillBrokenBranches||[],whyThisResult:$.data.whyThisResult||[],evidence:$.data.evidence||[],learnPath:$.data.learnPath}),A=$.data.cart}catch(D){const $=D.message?.includes("429")||D.code==="resource-exhausted";if(D.message?.includes("off_topic")||D.message?.includes("not a UE5")){o(`This doesn't appear to be a UE5 question. Try describing a specific Unreal Engine 5 issue, for example:
‚Ä¢ "Lumen reflections flickering"
‚Ä¢ "Blueprint compile error"
‚Ä¢ "Niagara particles not spawning"`),t(W.ERROR);return}ne(`‚ö†Ô∏è Gemini ${$?"rate limited (429)":"error"}: ${D.message}. Falling back to local matching.`),le=!1,A={diagnosis:{problem_summary:p.query,matched_tag_ids:p.detectedTagIds||[]},objectives:[],intent:{systems:[]}}}A.userQuery=p.query,A.retrievedPassages=O,A._localFallback=!le;const ae=await is(A,N,p.selectedTagIds||[],p.errorLog||"",ce);A.matchedCourses=ae;const J=[...A.diagnosis?.matched_tag_ids||[],...p.detectedTagIds||[],...p.selectedTagIds||[]],se=ms(ae,J,{preferTroubleshooting:!0,diversity:!0}),X={};for(const D of se.path)X[D.course.code]={role:D.role,reason:D.reason,estimatedMinutes:D.estimatedMinutes};const de=await cs(ae,p.query,X),Xe=de.filter(D=>!D.type||D.type==="video"),Ze=de.filter(D=>D.type==="doc"||D.type==="youtube");if(de.length===0){o(`We couldn't find UE5 content matching your query. Try describing a specific Unreal Engine problem, for example:
‚Ä¢ "Blueprint compile error LNK2019"
‚Ä¢ "Lumen reflections flickering in indoor scene"
‚Ä¢ "Niagara particle system not spawning"
‚Ä¢ "UMG widget not rendering"`),t(W.ERROR);return}n(Xe),i(A);try{const $=[...A.diagnosis?.matched_tag_ids||[],...p.detectedTagIds||[]].flatMap(K=>K.split(/[._]/).filter(P=>P.length>2&&P!=="unreal"&&P!=="engine")),ue=new Set(["the","and","for","are","but","not","you","all","can","has","her","was","one","our","out","its","how","why","with","from","they","been","have","this","that","what","when","your","into"]),he=(p.query||"").toLowerCase().split(/\s+/).filter(K=>K.length>2&&!ue.has(K)),Z=[...new Set(he)],te=K=>Z.some(P=>P.includes(K));te("mesh")&&!te("skeletal")&&Z.push("static mesh","static meshes","import","importing"),(te("size")||te("scale")||te("wrong"))&&Z.push("scale","transform");const Y=[...new Set([...$,...Z])].slice(0,15);if(z(`[DocTopics] ${Z.join(", ")}`),z(`[AllTopics] ${Y.join(", ")}`),Z.length>0){const K=await At(Z,Xe,{maxDocs:5,maxYoutube:3});if(Ze.length>0)for(const P of Ze)P.type==="doc"&&!K.docs.some(ie=>ie.url===P._externalUrl)&&K.docs.push({label:P.title,url:P._externalUrl||P.url,description:P.description||"",readTimeMinutes:P.readTimeMinutes||10,tier:"intermediate"}),P.type==="youtube"&&!K.youtube.some(ie=>ie.url===P._externalUrl)&&K.youtube.push({title:P.title,url:P._externalUrl||P.url,channelName:P.channel||"YouTube",channelTrust:P.channelTrust||null,durationMinutes:P.durationMinutes||10,tier:"intermediate"});K.docs.sort((P,ie)=>(ie._rawScore??ie.matchScore??0)-(P._rawScore??P.matchScore??0)),d(K),z(`[Blended] ${K.docs.length} docs, ${K.youtube.length} YT, coverage: ${(K.coverageScore*100).toFixed(0)}%`)}}catch(D){ne("‚ö†Ô∏è Blended path skipped:",D.message)}t(c?W.ANSWERED:W.DIAGNOSIS),p.updateCartIdForQuery&&A.cart_id&&(p.updateCartIdForQuery(p.query,A.cart_id),z(`[Cache] Saved cart_id ${A.cart_id} to history for: "${p.query.substring(0,40)}..."`)),await qt(A.diagnosis),await Dt(A.objectives,ae,A.validation?.approved)}catch(_){console.error("[ProblemFirst] Error:",_),o(_.message||"An unexpected error occurred"),t(W.ERROR)}},[N,I,H,b,c]),q=w.useCallback(()=>t(W.INPUT),[]),U=w.useCallback(()=>{t(W.INPUT),i(null),n([]),o(null),d(null),x(null),v(null),j(null),m(!1)},[]),V=w.useCallback(p=>{if(!C)return;const g={...C,query:`${C.query} (${p})`};S(g,b)},[C,b,S]),ee=w.useCallback(()=>{C&&S(C,b)},[C,b,S]),oe=w.useCallback(p=>{if(p.solved||!C)return;m(!0);const g={...b||{},exclusions:[...(b||{}).exclusions||[],p.reason||"Previous solution did not work"]};j(g),S(C,g)},[C,b,S]),re=w.useCallback(()=>{t(W.DIAGNOSIS)},[]),G=w.useCallback(p=>{B(p.driveId)?E(p.driveId):R(p)},[B,R,E]),be=w.useCallback(()=>{k.length>0&&t(W.GUIDED)},[k]);return e.jsxs("div",{className:"problem-first-page",children:[e.jsxs("header",{className:"page-header",children:[e.jsx("h1",{children:"üîß Fix a Problem"}),e.jsx("p",{children:"Describe your issue. We'll diagnose it and show you how to fix it."})]}),(s===W.INPUT||s===W.LOADING)&&e.jsxs(e.Fragment,{children:[e.jsx(We,{onSubmit:S,detectedPersona:I(),isLoading:s===W.LOADING}),e.jsx(Ke,{onUpdate:j,disabled:s===W.LOADING})]}),s===W.CLARIFYING&&f&&e.jsx(He,{question:f.question,options:f.options,whyAsking:f.whyAsking,onAnswer:V,onSkip:ee,isLoading:!1}),s===W.ANSWERED&&c&&e.jsx(Je,{answer:c,onFeedback:oe,onBackToVideos:re,onStartOver:U,isRerunning:L}),s===W.ERROR&&e.jsxs("div",{className:"error-state",children:[e.jsx("div",{className:"error-icon",children:"‚ö†Ô∏è"}),e.jsx("h3",{children:"Something went wrong"}),e.jsx("p",{children:u}),e.jsx("button",{className:"retry-btn",onClick:U,children:"Try Again"})]}),s===W.DIAGNOSIS&&a&&e.jsxs("div",{className:"shopping-layout",children:[e.jsxs("div",{className:"results-column",children:[e.jsxs("div",{className:"tldr-diagnosis",children:[e.jsxs("div",{className:"tldr-user-query",children:[e.jsx("span",{className:"tldr-query-label",children:"üîç You asked:"}),e.jsx("p",{className:"tldr-query-text",children:a.userQuery})]}),a._localFallback&&e.jsxs("div",{className:"tldr-fallback-notice",style:{background:"rgba(255, 193, 7, 0.1)",border:"1px solid rgba(255, 193, 7, 0.3)",borderRadius:"8px",padding:"8px 14px",margin:"8px 0",fontSize:"0.85rem",color:"var(--text-muted, #aaa)"},children:["‚ö° ",e.jsx("strong",{children:"Fast results"})," ‚Äî AI diagnosis temporarily unavailable. Videos matched by tag taxonomy. Try again in a moment for AI-powered results."]}),a.diagnosis?.problem_summary&&e.jsx("p",{className:"tldr-bridge",children:"Based on your question, we think these videos will help you:"})]}),e.jsxs("h2",{className:"results-title",children:["üé¨ Videos for You (",l.length,")"]}),l.length===0&&e.jsx("div",{className:"no-results",children:e.jsx("p",{children:"No matching videos found. Try rephrasing your question."})}),(()=>{const p=[{key:"prerequisite",icon:"üîó",label:"Prerequisite",desc:"Build the foundation first ‚Äî these cover concepts you'll need before tackling the main topic."},{key:"core",icon:"‚≠ê",label:"Core",desc:"These directly address your question and are the most important videos to watch."},{key:"troubleshooting",icon:"üîß",label:"Troubleshooting",desc:"Debugging helpers ‚Äî watch these if you're hitting errors or unexpected behavior."},{key:"supplemental",icon:"üìö",label:"Supplemental",desc:"Go deeper ‚Äî extra context and advanced techniques for when you're ready."}],g={};for(const y of p)g[y.key]=[];g._other=[];for(const y of l){const _=y.role||"_other";(g[_]||g._other).push(y)}return p.filter(y=>g[y.key].length>0).map(y=>e.jsxs("div",{className:"role-section",children:[e.jsxs("div",{className:"role-section-header",children:[e.jsxs("h3",{className:"role-section-title",children:[y.icon," ",y.label,e.jsx("span",{className:"role-section-count",children:g[y.key].length})]}),e.jsx("p",{className:"role-section-desc",children:y.desc})]}),e.jsx("div",{className:"video-results-grid",children:g[y.key].map(_=>e.jsx("div",{className:"video-result-wrapper",id:`video-${_.driveId}`,children:e.jsx(Ue,{video:_,isAdded:B(_.driveId),onToggle:G,userQuery:a?.userQuery||""})},_.driveId))})]},y.key)).concat(g._other.length>0?[e.jsxs("div",{className:"role-section",children:[e.jsxs("div",{className:"role-section-header",children:[e.jsxs("h3",{className:"role-section-title",children:["üìé Related"," ",e.jsx("span",{className:"role-section-count",children:g._other.length})]}),e.jsx("p",{className:"role-section-desc",children:"Additional videos that may be relevant to your query."})]}),e.jsx("div",{className:"video-results-grid",children:g._other.map(y=>e.jsx("div",{className:"video-result-wrapper",id:`video-${y.driveId}`,children:e.jsx(Ue,{video:y,isAdded:B(y.driveId),onToggle:G,userQuery:a?.userQuery||""})},y.driveId))})]},"_other")]:[])})(),r?.docs?.length>0&&e.jsxs("div",{className:"blended-section",children:[e.jsxs("div",{className:"blended-section-header",children:[e.jsx("h2",{className:"blended-section-title",children:"üìö Recommended Reading"}),e.jsxs("p",{className:"blended-section-desc",children:["Official Unreal Engine documentation to deepen your understanding.",r.docs.reduce((p,g)=>p+(g.readTimeMinutes||10),0)>0&&` (~${r.docs.reduce((p,g)=>p+(g.readTimeMinutes||10),0)} min total read time)`]})]}),e.jsx("div",{className:"doc-cards-grid",children:r.docs.map((p,g)=>{const y=`doc_${p.key||g}`,_=B(y);return e.jsxs("div",{className:`doc-card ${_?"doc-card-added":""}`,children:[e.jsxs("a",{href:p.url,target:"_blank",rel:"noopener noreferrer",className:"doc-card-link",onClick:M=>M.stopPropagation(),children:[e.jsxs("div",{className:"doc-card-header",children:[p.matchScore!=null&&(()=>{const M=p.matchScore>=90?"best":p.matchScore>=60?"strong":p.matchScore>=30?"good":"related",F=p.matchScore>=90?"Best Match":p.matchScore>=60?"Strong":p.matchScore>=30?"Good":"Related";return e.jsxs("span",{className:`doc-match-badge doc-match-${M}`,title:`${p.matchScore}% relevancy`,children:[e.jsx("span",{className:"doc-match-dot"}),F]})})(),e.jsx("span",{className:`tier-badge tier-${p.tier||"intermediate"}`,children:p.tier||"intermediate"}),p.subsystem&&e.jsx("span",{className:"subsystem-tag",children:p.subsystem})]}),e.jsx("h4",{className:"doc-card-title",children:p.label}),p.description&&e.jsx("p",{className:"doc-card-desc",children:p.description}),e.jsxs("div",{className:"doc-card-footer",children:[e.jsx("span",{className:"doc-source-badge",children:"üìÑ Epic Docs"}),e.jsxs("span",{className:"doc-read-time",children:[p.readTimeMinutes||10," min read"]})]})]}),e.jsx("button",{className:`doc-add-btn ${_?"doc-added":""}`,onClick:()=>{_?E(y):R({type:"doc",itemId:y,title:p.label,description:p.description||"",keySteps:p.keySteps||[],seeAlso:p.seeAlso||[],sections:p.sections||[],url:p.url,tier:p.tier||"intermediate",subsystem:p.subsystem,readTimeMinutes:p.readTimeMinutes||10})},title:_?"Remove from path":"Add to learning path",children:_?"‚úì Added":"‚ûï Add"})]},p.key||g)})})]}),r?.youtube?.length>0&&e.jsxs("div",{className:"blended-section",children:[e.jsxs("div",{className:"blended-section-header",children:[e.jsx("h2",{className:"blended-section-title",children:"üì∫ Official Epic YouTube"}),e.jsx("p",{className:"blended-section-desc",children:"Official Unreal Engine tutorials from Epic Games."})]}),e.jsx("div",{className:"doc-cards-grid",children:r.youtube.map(p=>{const g=p.id||`yt_${p.url}`,y=B(g);return e.jsxs("div",{className:`doc-card yt-card-with-thumb ${y?"doc-card-added":""}`,children:[e.jsxs("a",{href:p.url,target:"_blank",rel:"noopener noreferrer",className:"doc-card-link",onClick:_=>_.stopPropagation(),children:[(()=>{const _=p.url?.match(/[?&]v=([^&]+)/),M=_?_[1]:null;return M?e.jsxs("div",{className:"yt-thumb-wrapper",children:[e.jsx("img",{className:"yt-thumb-img",src:`https://img.youtube.com/vi/${M}/mqdefault.jpg`,alt:p.title,loading:"lazy"}),e.jsxs("span",{className:"yt-thumb-duration",children:[p.durationMinutes," min"]}),e.jsx("span",{className:"yt-thumb-play",children:"‚ñ∂"})]}):null})(),e.jsxs("div",{className:"doc-card-header",children:[e.jsx("span",{className:`tier-badge tier-${p.tier||"intermediate"}`,children:p.tier||"intermediate"}),e.jsx("span",{className:"external-badge",children:"Official ‚Ä¢ YouTube"})]}),e.jsx("h4",{className:"doc-card-title",children:p.title}),e.jsxs("div",{className:"doc-card-footer",children:[e.jsxs("span",{className:"doc-source-badge",children:["üì∫ ",p.channelName]}),e.jsxs("span",{className:"doc-read-time",children:[p.durationMinutes," min"]})]})]}),e.jsx("button",{className:`doc-add-btn ${y?"doc-added":""}`,onClick:()=>{y?E(g):R({type:"youtube",itemId:g,title:p.title,description:p.description||"",keyTakeaways:p.keyTakeaways||[],chapters:p.chapters||[],topics:p.topics||[],url:p.url,channelName:p.channelName,channelTrust:p.channelTrust,tier:p.tier||"intermediate",durationMinutes:p.durationMinutes||15})},title:y?"Remove from path":"Add to learning path",children:y?"‚úì Added":"‚ûï Add"})]},p.id)})})]}),e.jsxs("div",{className:"results-actions-bottom",children:[e.jsx("button",{className:"back-btn",onClick:U,children:"‚Üê Start Over"}),e.jsx("button",{className:"ask-again-btn",onClick:q,children:"+ Ask Another Question"})]})]}),e.jsx("div",{className:"cart-column",children:e.jsx(xs,{cart:k,onRemove:E,onClear:H,onWatchPath:be})})]}),s===W.GUIDED&&(()=>{let p=0;const g=a?.microLesson?.quick_fix?.steps;return e.jsx(Ps,{courses:k.map(y=>{const _=y.type||"video";if(_==="doc"||_==="youtube"){const F=p===0;return p++,{code:y.itemId||y.driveId||`${_}_${y.url}`,title:y.title,_readingStep:!0,_resourceType:_,_description:y.description||"",_keySteps:F&&g?.length>0?g:y.keyTakeaways||y.keySteps||[],_seeAlso:y.seeAlso||[],_url:y.url,_tier:y.tier,_channel:y.channel||y.channelName,_channelTrust:y.channelTrust,_subsystem:y.subsystem,_topics:y.topics||[],_sections:y.sections||[],_chapters:y.chapters||[],_readTimeMinutes:y.readTimeMinutes||y.durationMinutes||10,videos:[]}}const M=N.find(F=>F.code===y.courseCode);return M?{...M,videos:[{drive_id:y.driveId,title:y.title,duration_seconds:y.duration}]}:{code:y.courseCode,title:y.courseName,videos:[{drive_id:y.driveId,title:y.title,duration_seconds:y.duration}]}}),diagnosis:a?.diagnosis,problemSummary:a?.diagnosis?.problem_summary,pathSummary:a?.pathSummary,microLesson:a?.microLesson,onComplete:()=>{},onExit:()=>t(W.DIAGNOSIS)})})()]})}function Ns({diagnosis:s}){if(!s)return null;const t=s.root_causes?.length||0,a=s.signals_to_watch_for?.length||0,i=s.variables_that_matter?.length||0,u=s.variables_that_do_not?.length||0;return e.jsxs("div",{className:"diagnosis-card",children:[e.jsxs("div",{className:"diagnosis-header",children:[e.jsx("h3",{children:"üî¨ Diagnosis"}),e.jsxs("span",{className:"diagnosis-id",children:["ID: ",s.diagnosis_id?.slice(-8)||"N/A"]})]}),e.jsx("p",{className:"problem-summary",children:s.problem_summary}),e.jsxs("div",{className:"diagnosis-sections",children:[e.jsxs("details",{className:"diagnosis-section root-causes",children:[e.jsxs("summary",{children:[e.jsx("span",{className:"icon",children:"üéØ"}),"Root Causes",e.jsxs("span",{className:"count",children:["(",t,")"]})]}),e.jsx("ul",{children:(s.root_causes||[]).map((o,r)=>e.jsx("li",{children:o},r))})]}),e.jsxs("details",{className:"diagnosis-section signals",children:[e.jsxs("summary",{children:[e.jsx("span",{className:"icon",children:"üëÅÔ∏è"}),"Signals to Watch For",e.jsxs("span",{className:"count",children:["(",a,")"]})]}),e.jsx("ul",{children:(s.signals_to_watch_for||[]).map((o,r)=>e.jsx("li",{children:o},r))})]}),e.jsxs("details",{className:"diagnosis-section variables-matter",children:[e.jsxs("summary",{children:[e.jsx("span",{className:"icon",children:"‚úÖ"}),"Variables That Matter",e.jsxs("span",{className:"count",children:["(",i,")"]})]}),e.jsx("ul",{children:(s.variables_that_matter||[]).map((o,r)=>e.jsx("li",{children:o},r))})]}),e.jsxs("details",{className:"diagnosis-section variables-dont-matter",children:[e.jsxs("summary",{children:[e.jsx("span",{className:"icon",children:"‚ùå"}),"Variables That Don't",e.jsxs("span",{className:"count",children:["(",u,")"]})]}),e.jsx("ul",{children:(s.variables_that_do_not||[]).map((o,r)=>e.jsx("li",{children:o},r))})]}),s.generalization_scope?.length>0&&e.jsxs("details",{className:"diagnosis-section generalization",open:!0,children:[e.jsxs("summary",{children:[e.jsx("span",{className:"icon",children:"üîÑ"}),"Where Else This Applies",e.jsxs("span",{className:"count",children:["(",s.generalization_scope.length,")"]})]}),e.jsx("div",{className:"scope-chips",children:s.generalization_scope.map((o,r)=>e.jsx("span",{className:"scope-chip",children:o},r))})]})]})]})}Ns.propTypes={diagnosis:h.shape({diagnosis_id:h.string,problem_summary:h.string,root_causes:h.arrayOf(h.string),signals_to_watch_for:h.arrayOf(h.string),variables_that_matter:h.arrayOf(h.string),variables_that_do_not:h.arrayOf(h.string),generalization_scope:h.arrayOf(h.string)})};Ns.defaultProps={diagnosis:null};function Ft(s){if(!s||s<=0)return null;const t=Math.floor(s/3600),a=Math.floor(s%3600/60);return t>0?a>0?`${t} hr ${a} min`:`${t} hr`:`${a} min`}function Ut(s,t=320){const a=s?.drive_id||s?.driveId;return a?`https://drive.google.com/thumbnail?id=${a}&sz=w${t}`:null}function Wt(s,t=320){const a=s?.videos?.[0];return Ut(a,t)}function ws({objectives:s,courses:t,validation:a,onCourseClick:i,onAddToCart:u,isCourseInCart:o}){const{fixCourses:r,learnCourses:d}=w.useMemo(()=>{if(!t||t.length===0)return{fixCourses:[],learnCourses:[]};const n=Math.ceil(t.length/2);return{fixCourses:t.slice(0,n),learnCourses:t.slice(n)}},[t]),l=w.useMemo(()=>a?{approved:a.approved,reason:a.reason,hasIssues:a.issues?.length>0}:null,[a]);return e.jsxs("div",{className:"adaptive-cart",children:[l&&!l.approved&&e.jsxs("div",{className:"validation-warning",children:[e.jsx("span",{className:"icon",children:"‚ö†Ô∏è"}),e.jsxs("div",{className:"content",children:[e.jsx("strong",{children:"Quality Check:"})," ",l.reason,a.suggestions?.length>0&&e.jsx("ul",{className:"suggestions",children:a.suggestions.map((n,c)=>e.jsx("li",{children:n},c))})]})]}),e.jsxs("section",{className:"cart-section fix-now",children:[e.jsxs("div",{className:"section-header",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"icon",children:"üîß"}),"Fix Now"]}),e.jsx("p",{className:"description",children:"These solve your immediate problem:"})]}),e.jsx("div",{className:"objectives-list",children:(s?.fix_specific||[]).map((n,c)=>e.jsxs("div",{className:"objective-item fix",children:[e.jsx("span",{className:"number",children:c+1}),e.jsx("span",{className:"text",children:n})]},c))}),r.length>0&&e.jsx("div",{className:"course-list",children:r.map(n=>e.jsx(Ie,{course:n,type:"fix",onClick:()=>i?.(n),onAddToCart:u,isInCart:o?.(n)},n.id||n.code))})]}),e.jsxs("section",{className:"cart-section learn-forever",children:[e.jsxs("div",{className:"section-header",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"icon",children:"üéì"}),"Learn Forever"]}),e.jsx("p",{className:"description",children:"These help you diagnose similar issues in the future:"})]}),e.jsx("div",{className:"objectives-list transferable",children:(s?.transferable||[]).map((n,c)=>e.jsxs("div",{className:"objective-item transferable",children:[e.jsx("span",{className:"number",children:c+1}),e.jsx("span",{className:"text",children:n}),e.jsx("span",{className:"badge",children:"Transferable"})]},c))}),s?.transferable?.length===0&&e.jsx("div",{className:"empty-warning",children:"‚ö†Ô∏è No transferable objectives generated. This path may not teach reusable skills."}),d.length>0&&e.jsx("div",{className:"course-list",children:d.map(n=>e.jsx(Ie,{course:n,type:"learn",onClick:()=>i?.(n),onAddToCart:u,isInCart:o?.(n)},n.id||n.code))})]}),e.jsxs("div",{className:"cart-summary",children:[e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"value",children:s?.fix_specific?.length||0}),e.jsx("span",{className:"label",children:"Fix Objectives"})]}),e.jsxs("div",{className:"stat highlight",children:[e.jsx("span",{className:"value",children:s?.transferable?.length||0}),e.jsx("span",{className:"label",children:"Transferable Skills"})]}),e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"value",children:t?.length||0}),e.jsx("span",{className:"label",children:"Recommended Courses"})]})]})]})}function Ie({course:s,type:t,onClick:a,onAddToCart:i,isInCart:u}){const[o,r]=w.useState(!1),d=w.useMemo(()=>{if(s.duration)return s.duration;if(s.duration_minutes)return`${s.duration_minutes} min`;if(s.durationMinutes)return`${s.durationMinutes} min`;if(s.videos?.length){const f=s.videos.reduce((v,b)=>v+(b.duration_seconds||0),0);return f>0?Ft(f):null}return null},[s]),l=w.useMemo(()=>typeof s.difficulty=="string"?s.difficulty:typeof s.difficulty=="number"?["Beginner","Beginner","Intermediate","Intermediate","Advanced","Expert"][s.difficulty]||"Intermediate":s.gemini_skill_level?s.gemini_skill_level:null,[s]),n=w.useMemo(()=>Wt(s),[s]),c=s.video_count||s.videos?.length||null,x=f=>{f.stopPropagation(),i?.(s)};return e.jsxs("div",{className:`course-card ${t} ${u?"in-cart":""}`,onClick:a,role:"button",tabIndex:0,onKeyDown:f=>f.key==="Enter"&&a?.(),children:[n&&!o&&e.jsx("div",{className:"course-thumbnail",children:e.jsx("img",{src:n,alt:s.title,loading:"lazy",onError:()=>r(!0)})}),e.jsxs("div",{className:"course-info",children:[e.jsx("h4",{className:"title",children:s.title||s.name}),s.gemini_outcomes?.[0]&&e.jsxs("p",{className:"description",children:[s.gemini_outcomes[0].slice(0,100),"..."]}),e.jsxs("div",{className:"meta",children:[d&&e.jsxs("span",{className:"duration",children:["‚è±Ô∏è ",d]}),c&&e.jsxs("span",{className:"video-count",children:["üé¨ ",c," videos"]}),l&&e.jsx("span",{className:`difficulty ${l.toLowerCase()}`,children:l})]})]}),e.jsx("div",{className:"course-action",children:i?e.jsx("button",{className:`add-btn ${u?"added":""}`,onClick:x,"aria-label":u?"Added to path":"Add to path",children:u?"‚úì Added":"+ Add"}):e.jsx("span",{className:"arrow",children:"‚Üí"})})]})}Ie.propTypes={course:h.shape({id:h.string,code:h.string,title:h.string,name:h.string,description:h.string,duration:h.string,durationMinutes:h.number,difficulty:h.string}).isRequired,type:h.oneOf(["fix","learn"]),onClick:h.func};Ie.defaultProps={type:"fix",onClick:null};ws.propTypes={objectives:h.shape({fix_specific:h.arrayOf(h.string),transferable:h.arrayOf(h.string)}),courses:h.arrayOf(h.object),validation:h.shape({approved:h.bool,reason:h.string,issues:h.arrayOf(h.string),suggestions:h.arrayOf(h.string)}),onCourseClick:h.func};ws.defaultProps={objectives:null,courses:[],validation:null,onCourseClick:null};export{ws as AdaptiveLearningCart,Ns as DiagnosisCard,sn as ProblemFirst,We as ProblemInput};

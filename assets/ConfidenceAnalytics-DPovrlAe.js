import{g as A,j as s}from"./index-DgEbrpg4.js";import{a as d}from"./vendor-cytoscape-hdah7_Xt.js";import{c as R,q as w,d as S,w as D,e as E,t as $,f as F}from"./vendor-firebase-DNc0QRT5.js";import"./data-courses-Y_tFOtPD.js";function k(){const[t,y]=d.useState([]),[u,g]=d.useState(!0),[p,N]=d.useState(null),[o,f]=d.useState(100),h=d.useCallback(async()=>{g(!0),N(null);try{const a=A(),e=R(a),x=w(S(e,"apiUsage"),D("type","==","confidence_routing"),E("timestamp","desc"),$(o)),L=(await F(x)).docs.map(j=>({id:j.id,...j.data(),timestamp:j.data().timestamp?.toDate?.()||null}));y(L)}catch(a){console.error("Failed to load confidence analytics:",a),N(a.message)}finally{g(!1)}},[o]);d.useEffect(()=>{h()},[h]);const n=t.length,l=t.filter(a=>a.outcome==="clarify").length,i=t.filter(a=>a.outcome==="direct_answer").length,r=t.filter(a=>a.outcome==="agentic_rag").length,b=n>0?(t.reduce((a,e)=>a+(e.score||0),0)/n).toFixed(1):"â€”",C=n>0?Math.round(t.reduce((a,e)=>a+(e.queryLength||0),0)/n):"â€”",c=a=>n>0?(a/n*100).toFixed(1):"0",m={};t.forEach(a=>{(a.reasons||[]).forEach(e=>{m[e]=(m[e]||0)+1})});const v=Object.entries(m).sort((a,e)=>e[1]-a[1]).slice(0,8);return s.jsxs("div",{className:"ca-container",children:[s.jsxs("div",{className:"ca-header",children:[s.jsx("h3",{children:"ðŸ§  Confidence Routing Analytics"}),s.jsxs("div",{className:"ca-controls",children:[s.jsxs("select",{value:o,onChange:a=>f(Number(a.target.value)),className:"ca-limit-select",children:[s.jsx("option",{value:50,children:"Last 50"}),s.jsx("option",{value:100,children:"Last 100"}),s.jsx("option",{value:250,children:"Last 250"}),s.jsx("option",{value:500,children:"Last 500"})]}),s.jsx("button",{className:"ca-refresh-btn",onClick:h,disabled:u,children:"ðŸ”„ Refresh"})]})]}),p&&s.jsxs("div",{className:"ca-error",children:["âš ï¸ ",p]}),u?s.jsx("div",{className:"ca-loading",children:"Loading analyticsâ€¦"}):n===0?s.jsx("div",{className:"ca-empty",children:'No confidence routing data yet. Submit a query on the "Fix a Problem" tab to start collecting analytics.'}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"ca-cards",children:[s.jsxs("div",{className:"ca-card",children:[s.jsx("span",{className:"ca-card-value",children:n}),s.jsx("span",{className:"ca-card-label",children:"Total Queries"})]}),s.jsxs("div",{className:"ca-card ca-card-clarify",children:[s.jsxs("span",{className:"ca-card-value",children:[c(l),"%"]}),s.jsxs("span",{className:"ca-card-label",children:["Clarified (",l,")"]})]}),s.jsxs("div",{className:"ca-card ca-card-direct",children:[s.jsxs("span",{className:"ca-card-value",children:[c(i),"%"]}),s.jsxs("span",{className:"ca-card-label",children:["Direct (",i,")"]})]}),s.jsxs("div",{className:"ca-card ca-card-agentic",children:[s.jsxs("span",{className:"ca-card-value",children:[c(r),"%"]}),s.jsxs("span",{className:"ca-card-label",children:["Agentic RAG (",r,")"]})]}),s.jsxs("div",{className:"ca-card",children:[s.jsx("span",{className:"ca-card-value",children:b}),s.jsx("span",{className:"ca-card-label",children:"Avg Score"})]}),s.jsxs("div",{className:"ca-card",children:[s.jsx("span",{className:"ca-card-value",children:C}),s.jsx("span",{className:"ca-card-label",children:"Avg Query Length"})]})]}),s.jsxs("div",{className:"ca-distribution",children:[s.jsx("h4",{children:"Outcome Distribution"}),s.jsxs("div",{className:"ca-bar",children:[l>0&&s.jsxs("div",{className:"ca-bar-segment ca-seg-clarify",style:{width:`${c(l)}%`},title:`Clarify: ${l}`,children:[c(l),"%"]}),i>0&&s.jsxs("div",{className:"ca-bar-segment ca-seg-direct",style:{width:`${c(i)}%`},title:`Direct: ${i}`,children:[c(i),"%"]}),r>0&&s.jsxs("div",{className:"ca-bar-segment ca-seg-agentic",style:{width:`${c(r)}%`},title:`Agentic: ${r}`,children:[c(r),"%"]})]}),s.jsxs("div",{className:"ca-legend",children:[s.jsxs("span",{className:"ca-legend-item",children:[s.jsx("span",{className:"ca-dot ca-dot-clarify"})," Clarify"]}),s.jsxs("span",{className:"ca-legend-item",children:[s.jsx("span",{className:"ca-dot ca-dot-direct"})," Direct Answer"]}),s.jsxs("span",{className:"ca-legend-item",children:[s.jsx("span",{className:"ca-dot ca-dot-agentic"})," Agentic RAG"]})]})]}),v.length>0&&s.jsxs("div",{className:"ca-reasons",children:[s.jsx("h4",{children:"Top Scoring Reasons"}),s.jsx("div",{className:"ca-reason-tags",children:v.map(([a,e])=>s.jsxs("span",{className:"ca-reason-tag",children:[a.replace(/_/g," ")," ",s.jsxs("strong",{children:["(",e,")"]})]},a))})]}),s.jsxs("div",{className:"ca-table-wrap",children:[s.jsx("h4",{children:"Recent Routing Decisions"}),s.jsxs("table",{className:"ca-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Time"}),s.jsx("th",{children:"Outcome"}),s.jsx("th",{children:"Score"}),s.jsx("th",{children:"Query Len"}),s.jsx("th",{children:"Round"}),s.jsx("th",{children:"Reasons"})]})}),s.jsx("tbody",{children:t.slice(0,25).map(a=>s.jsxs("tr",{className:`ca-row-${a.outcome}`,children:[s.jsx("td",{className:"ca-time",children:a.timestamp?a.timestamp.toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"â€”"}),s.jsx("td",{children:s.jsx("span",{className:`ca-outcome-badge ca-badge-${a.outcome}`,children:a.outcome==="clarify"?"ðŸ” Clarify":a.outcome==="direct_answer"?"âœ… Direct":"ðŸ¤– Agentic"})}),s.jsx("td",{className:"ca-score",children:a.score??"â€”"}),s.jsx("td",{children:a.queryLength??"â€”"}),s.jsx("td",{children:a.round??a.clarifyRoundsCompleted??"â€”"}),s.jsx("td",{className:"ca-reasons-cell",children:(a.reasons||[]).map((e,x)=>s.jsx("span",{className:"ca-mini-tag",children:e.replace(/_/g," ")},x))})]},a.id))})]})]})]})]})}export{k as default};

import{u as D,j as e}from"./index-Clug9y5g.js";import{a as p}from"./vendor-cytoscape-hdah7_Xt.js";import{p as Y,d as J}from"./PersonaService-D9aA7hNj.js";import{S as B,C as U}from"./sparkles-DyMeu0iU.js";import{P as R}from"./plus-mlfspTQG.js";import{S as Z}from"./search-BvlZ0fxD.js";import{X as ee}from"./x-HbUnH9yy.js";import{c as V}from"./createLucideIcon-YhyuTmrv.js";import{C as se}from"./check-eCXpKYRG.js";import"./vendor-firebase-BEnYNivV.js";import"./data-courses-Cfgu6N5t.js";function te(a,{search:r="",level:m=null,topic:o=null}){return a.filter(l=>{if(r){const n=r.toLowerCase();if(!(l.title?.toLowerCase().includes(n)||l.code?.toLowerCase().includes(n)||l.tags?.topic?.toLowerCase().includes(n)||l.keywords?.some(h=>h.toLowerCase().includes(n))))return!1}return!(m&&l.tags?.level!==m||o&&l.tags?.topic!==o)})}function M(a){return(a||"").toLowerCase().replace(/[^a-z0-9\s]/g,"").trim()}function ae(a){return M(a).split(/\s+/).filter(r=>r.length>2)}function ne(a,r){if(!r)return 0;const m=ae(a);if(m.length===0)return 0;let o=0;const l=M(r.title||r.folder_name||""),n=M(r.description||"");let d=[];Array.isArray(r.extracted_tags)&&(d=d.concat(r.extracted_tags)),Array.isArray(r.transcript_tags)&&(d=d.concat(r.transcript_tags)),Array.isArray(r.tags)?d=d.concat(r.tags):r.tags&&typeof r.tags=="object"&&(d=d.concat(Object.values(r.tags).filter(j=>typeof j=="string")));const h=d.map(M);m.forEach(j=>{l.includes(j)&&(o+=30),h.some(v=>v===j||v.includes(j))&&(o+=25),n.includes(j)&&(o+=10),l.split(/\s+/).some(v=>v.startsWith(j))&&(o+=15)});const C=h.filter(j=>m.some(v=>j.includes(v))).length;return o+=C*5,o}function ie(a,r,m=8){return!a||a.trim().length<3||!r||!Array.isArray(r)?[]:r.map(l=>({...l,matchScore:ne(a,l)})).filter(l=>l.matchScore>0).sort((l,n)=>n.matchScore-l.matchScore).slice(0,m)}const le=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],re=V("clock",le);const ce=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],oe=V("layers",ce);function K(a,r){const m=Y[r];if(!m)return{label:"",type:"neutral",score:0};const o=(a.title||"").toLowerCase(),l=[...a.canonical_tags||[],...a.ai_tags||[],...a.gemini_system_tags||[],...a.transcript_tags||[],...a.extracted_tags||[]].map(h=>typeof h=="string"?h.toLowerCase():"");let n=0,d=!1;for(const h of m.boostKeywords||[]){const C=h.toLowerCase();o.includes(C)?n+=5:l.some(j=>j.includes(C))&&(n+=3)}for(const h of m.penaltyKeywords||[]){const C=h.toLowerCase();(o.includes(C)||l.some(j=>j.includes(C)))&&(n-=10,d=!0)}return n>=10?{label:"ðŸŽ¨ Persona Match",type:"relevant",score:n}:n>=5?{label:"âœ… Relevant",type:"relevant",score:n}:d&&n<0?{label:"âš™ï¸ Technical",type:"technical",score:n}:{label:"",type:"neutral",score:n}}function de(a,r){if(!r||!a)return a;const m=new RegExp(`(${r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi");return a.split(m).map((l,n)=>m.test(l)?e.jsx("mark",{className:"search-highlight",children:l},n):l)}function me({courses:a}){const{courses:r,addCourse:m,learningIntent:o}=D(),[l,n]=p.useState(""),[d,h]=p.useState(null),C=p.useRef(null),j=p.useMemo(()=>{const t=o?.primaryGoal;return t?ie(t,a,8):[]},[o,a]),v=p.useMemo(()=>{const t=o?.primaryGoal;return t&&J(t)?.id||null},[o]),w=p.useMemo(()=>j.filter(t=>!r.some(x=>x.code===t.code)),[j,r]);p.useEffect(()=>{const t=x=>{(x.ctrlKey||x.metaKey)&&x.key==="k"&&(x.preventDefault(),C.current?.focus()),x.key==="Escape"&&(l||d)&&(n(""),h(null),C.current?.blur())};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[l,d]);const A=p.useMemo(()=>te(a,{search:l,level:d}),[a,l,d]),k=t=>r.some(x=>x.code===t),_=(t,x)=>{t.stopPropagation(),k(x.code)||m(x)},z=()=>{w.forEach(t=>{m(t)})};return e.jsxs("div",{className:"course-library",children:[o?.primaryGoal&&w.length>0&&e.jsxs("div",{className:"suggested-section",children:[e.jsxs("div",{className:"suggested-header",children:[e.jsxs("span",{className:"suggested-title",children:[e.jsx(B,{size:16,className:"icon-inline"}),' Suggested for "',o.primaryGoal,'"']}),e.jsxs("button",{className:"add-all-btn",onClick:z,title:"Add all suggested courses to your path",children:[e.jsx(R,{size:14})," Add All (",w.length,")"]})]}),e.jsx("div",{className:"suggested-list",children:w.slice(0,5).map((t,x)=>{const N=v?K(t,v):null;return e.jsxs("div",{className:"suggested-card",onClick:u=>_(u,t),title:`Match score: ${t.matchScore}
${t.title}`,children:[e.jsx("span",{className:"suggested-code",children:t.code}),e.jsx("span",{className:"suggested-name",children:t.title}),N?.label&&e.jsx("span",{className:`tag tag-persona tag-persona-${N.type}`,children:N.label}),e.jsx("span",{className:"suggested-add",children:e.jsx(R,{size:14})})]},`suggested-${t.code}-${x}`)})})]}),!o?.primaryGoal&&e.jsxs("div",{className:"goal-hint",children:[e.jsx(B,{size:16,className:"icon-inline"})," Enter a ",e.jsx("strong",{children:"Primary Goal"})," above to get personalized course suggestions"]}),e.jsxs("div",{className:"library-header",children:[e.jsxs("div",{className:"search-container",children:[e.jsx(Z,{size:16,className:"search-icon"}),e.jsx("input",{ref:C,type:"text",className:"search-input",placeholder:"Search courses... (Ctrl+K)",value:l,onChange:t=>n(t.target.value)}),l&&e.jsx("button",{className:"search-clear",onClick:()=>n(""),title:"Clear search",children:e.jsx(ee,{size:14})})]}),e.jsx("div",{className:"level-filters",children:["Beginner","Intermediate","Advanced"].map(t=>e.jsx("button",{className:`level-btn ${d===t?"active":""} ${t.toLowerCase()}`,onClick:()=>h(d===t?null:t),children:t},t))})]}),e.jsxs("div",{className:"library-info",children:[l||d?e.jsxs("span",{children:[e.jsx("strong",{children:A.length})," result",A.length!==1?"s":"",l&&e.jsxs(e.Fragment,{children:[" ",'for "',e.jsx("em",{children:l}),'"']}),d&&e.jsxs(e.Fragment,{children:[" â€¢ ",d]})]}):e.jsxs("span",{children:[A.length," courses"]}),(l||d)&&e.jsx("button",{className:"clear-filters",onClick:()=>{n(""),h(null)},children:"Clear All"})]}),e.jsxs("div",{className:"course-list",children:[A.map((t,x)=>e.jsxs("div",{className:`course-card ${k(t.code)?"in-path":""}`,title:`${t.title}

Code: ${t.code}
Level: ${t.tags?.level||"N/A"}
Duration: ${t.duration?`${t.duration.toFixed(1)} hours`:"Unknown"}
Videos: ${t.video_count||0}
Versions: ${t.versions?.join(", ")||"N/A"}`,children:[e.jsxs("div",{className:"card-content",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("span",{className:"course-code",children:t.code}),t.gemini_enriched&&e.jsx("span",{className:"ai-badge",title:"AI-enriched",children:e.jsx(B,{size:12})})]}),e.jsx("h3",{className:"course-title",children:de(t.title,l)}),e.jsxs("div",{className:"card-tags",children:[t.tags?.level&&e.jsx("span",{className:`tag tag-level ${t.tags.level.toLowerCase()}`,children:t.tags.level}),t.tags?.topic&&e.jsx("span",{className:"tag tag-topic",children:t.tags.topic}),v&&(()=>{const N=K(t,v);return N.label?e.jsx("span",{className:`tag tag-persona tag-persona-${N.type}`,title:`Persona relevance: ${N.score>0?"+":""}${N.score}`,children:N.label}):null})()]}),e.jsxs("div",{className:"card-meta",children:[t.duration&&e.jsxs("span",{title:`${t.duration.toFixed(1)} hours of content`,className:"meta-item",children:[e.jsx(re,{size:12})," ",t.duration.toFixed(1),"h"]}),e.jsxs("span",{title:`${t.video_count||0} video${(t.video_count||0)===1?"":"s"}`,className:"meta-item",children:[e.jsx(U,{size:12})," ",t.video_count||0]}),e.jsxs("span",{title:`${t.versions?.length||0} UE version${(t.versions?.length||0)===1?"":"s"}`,className:"meta-item",children:[e.jsx(oe,{size:12})," ",t.versions?.length||0]})]})]}),e.jsx("button",{className:`add-btn ${k(t.code)?"added":""}`,onClick:N=>_(N,t),disabled:k(t.code),title:k(t.code)?"In path":"Add to path",children:k(t.code)?e.jsx(se,{size:16}):e.jsx(R,{size:16})})]},`${t.code}-${x}`)),A.length===0&&e.jsx("div",{className:"no-results",children:"No courses match your search."})]})]})}function he({courses:a,preSelectedSkill:r,onSkillUsed:m}){const{addCourse:o,courses:l}=D(),[n,d]=p.useState(""),[h,C]=p.useState(new Set),[j,v]=p.useState(!1),[w,A]=p.useState(""),k=p.useRef(null);p.useEffect(()=>{r&&(d(r),m&&m())},[r,m]);const _=p.useMemo(()=>{const s=new Map;return a.forEach(c=>{const i=c.tags?.topic;i&&s.set(i.toLowerCase(),{name:i,type:"topic"}),c.gemini_system_tags?.forEach(f=>{s.has(f.toLowerCase())||s.set(f.toLowerCase(),{name:f,type:"ai"})})}),Array.from(s.values()).sort((c,i)=>c.name.localeCompare(i.name))},[a]),z=p.useMemo(()=>{const s={};return a.forEach(c=>{const i=new Set;c.tags?.topic&&i.add(c.tags.topic.toLowerCase()),c.gemini_system_tags?.forEach(g=>i.add(g.toLowerCase()));const f=Array.from(i);f.forEach(g=>{s[g]||(s[g]={}),f.forEach($=>{g!==$&&(s[g][$]=(s[g][$]||0)+1)})})}),s},[a]),t=p.useMemo(()=>{if(!n.trim())return[];const s=n.toLowerCase(),c=z[s];return c?Object.entries(c).sort((i,f)=>f[1]-i[1]).slice(0,5).map(([i,f])=>{const g=a.filter(L=>[...L.gemini_system_tags||[],L.tags?.topic].filter(Boolean).some(S=>S.toLowerCase()===i)),$=g.reduce((L,P)=>{const S=P.videos?.reduce((y,b)=>y+(b.duration_minutes||0),0)||30;return L+S},0);return{name:i,count:f,courseCount:g.length,estimatedTime:$}}):[]},[n,z,a]),x=p.useMemo(()=>{if(!n.trim()||n.length<2)return[];const s=n.toLowerCase();return _.filter(c=>c.name.toLowerCase().includes(s)).slice(0,8)},[n,_]),N=p.useMemo(()=>{if(!n.trim()||n.length<2)return[];const s=n.toLowerCase(),c=s.split(/\s+/).filter(i=>i.length>2);return a.map(i=>{let f=0;const g=[i.title,i.tags?.topic,i.tags?.level,...i.gemini_system_tags||[],...i.extracted_tags||[],i.gemini_enriched?.one_sentence_summary].filter(Boolean).join(" ").toLowerCase();return c.forEach($=>{g.includes($)&&(f+=1)}),g.includes(s)&&(f+=3),i.tags?.topic?.toLowerCase().includes(s)&&(f+=5),{course:i,score:f}}).filter(i=>i.score>0).sort((i,f)=>f.score-i.score).slice(0,30).map(i=>i.course)},[n,a]),u=p.useMemo(()=>{if(N.length===0)return null;const s=new Set(l.map(y=>y.code)),c={Beginner:1,Foundation:1,Intermediate:2,Advanced:3},i=w?parseInt(w):1/0,f=[...N].sort((y,b)=>{const q=c[y.tags?.level]||2,T=c[b.tags?.level]||2;return q-T}),g={prerequisites:[],core:[],advanced:[]};let $=0;f.forEach(y=>{const b=y.tags?.level,q=s.has(y.code),T=y.videos?.reduce((X,H)=>X+(H.duration_minutes||0),0)||30;if($+T>i&&i!==1/0)return;$+=T;const F={...y,isInPath:q,estimatedTime:T};b==="Beginner"||b==="Foundation"?g.prerequisites.push(F):b==="Advanced"?g.advanced.push(F):g.core.push(F)});const L=[...g.prerequisites,...g.core,...g.advanced],P=L.reduce((y,b)=>y+b.estimatedTime,0),S=[];return L.forEach(y=>{y.gemini_enriched?.learning_outcomes?.forEach(b=>{S.includes(b)||S.push(b)})}),{tiers:g,totalCourses:L.length,totalTime:P,allCourses:L,learningOutcomes:S}},[N,l,w]),W=u?u.allCourses.map(s=>s.code).join(","):"";p.useEffect(()=>{if(u&&u.allCourses.length>0){const s=new Set(u.allCourses.filter(c=>!c.isInPath).map(c=>c.code));C(s)}},[W]);const I=p.useCallback(s=>{C(c=>{const i=new Set(c);return i.has(s)?i.delete(s):i.add(s),i})},[]),G=p.useCallback(()=>{if(!u)return;u.allCourses.filter(c=>h.has(c.code)&&!c.isInPath).forEach(c=>o(c)),C(new Set)},[u,h,o]),Q=p.useCallback(s=>{d(s),v(!1)},[]),E=s=>{if(s<60)return`${s} min`;const c=Math.floor(s/60),i=s%60;return i>0?`${c}h ${i}m`:`${c}h`};return p.useEffect(()=>{const s=c=>{k.current&&!k.current.contains(c.target)&&v(!1)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]),e.jsxs("div",{className:"skill-curriculum",children:[e.jsxs("div",{className:"sc-header",children:[e.jsx("h3",{children:"ðŸŽ¯ What do you want to teach?"}),e.jsx("p",{children:"Type a skill or phrase, or click a topic below"})]}),e.jsxs("div",{className:"sc-search",ref:k,children:[e.jsx("input",{type:"text",placeholder:"e.g., lighting fundamentals, Niagara VFX, materials...",value:n,onChange:s=>{d(s.target.value),v(!0)},onFocus:()=>v(!0)}),n&&e.jsx("button",{className:"clear-search",onClick:()=>d(""),children:"Ã—"}),j&&x.length>0&&e.jsx("div",{className:"sc-autocomplete",children:x.map(s=>e.jsxs("div",{className:`autocomplete-item ${s.type}`,onClick:()=>Q(s.name),children:[e.jsx("span",{className:"suggestion-name",children:s.name}),e.jsx("span",{className:`suggestion-type ${s.type}`,children:s.type==="topic"?"ðŸ“":"ðŸ¤–"})]},s.name))})]}),e.jsxs("div",{className:"sc-time-filter",children:[e.jsx("label",{children:"â±ï¸ Time budget:"}),e.jsxs("select",{value:w,onChange:s=>A(s.target.value),children:[e.jsx("option",{value:"",children:"No limit"}),e.jsx("option",{value:"60",children:"~1 hour"}),e.jsx("option",{value:"120",children:"~2 hours"}),e.jsx("option",{value:"180",children:"~3 hours"}),e.jsx("option",{value:"300",children:"~5 hours"}),e.jsx("option",{value:"600",children:"~10 hours"})]})]}),t.length>0&&e.jsxs("div",{className:"sc-recommendations",children:[e.jsxs("div",{className:"recommendations-header",children:[e.jsx("span",{className:"rec-icon",children:"ðŸ’¡"}),e.jsx("span",{className:"rec-title",children:"You might also need:"})]}),e.jsx("div",{className:"recommendations-list",children:t.map(s=>e.jsxs("button",{className:"rec-skill-chip",onClick:()=>d(c=>c.toLowerCase().includes(s.name.toLowerCase())?c:`${c} ${s.name}`.trim()),title:`${s.courseCount} courses â€¢ ~${E(s.estimatedTime)}`,children:[e.jsx("span",{className:"skill-name",children:s.name}),e.jsx("span",{className:"skill-count",children:s.courseCount}),e.jsxs("span",{className:"skill-time",children:["~",E(s.estimatedTime)]})]},s.name))}),e.jsx("p",{className:"rec-hint",children:"Click to add skills â€¢ Combined curriculum expands coverage"})]}),!n&&e.jsxs("div",{className:"sc-skills",children:[e.jsx("span",{className:"sc-skills-label",children:"Popular topics:"}),_.filter(s=>s.type==="topic").slice(0,12).map(s=>e.jsx("button",{className:"skill-chip",onClick:()=>d(s.name),children:s.name},s.name))]}),n&&N.length===0&&e.jsxs("div",{className:"sc-no-results",children:[e.jsxs("p",{children:['No courses found for "',n,'"']}),e.jsx("p",{className:"hint",children:"Try different keywords or select a topic above"})]}),u&&e.jsxs("div",{className:"sc-curriculum",children:[e.jsxs("div",{className:"sc-curriculum-header",children:[e.jsxs("div",{className:"curriculum-title",children:[e.jsx("h4",{children:"ðŸ“š Recommended Curriculum"}),e.jsxs("span",{className:"search-term",children:['for "',n,'"']})]}),e.jsxs("div",{className:"curriculum-stats",children:[e.jsxs("span",{children:[u.totalCourses," courses"]}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:["~",E(u.totalTime)]}),w&&e.jsx("span",{className:"time-badge",children:"â±ï¸ Fits budget"})]}),e.jsxs("button",{className:"generate-path-btn",onClick:G,disabled:h.size===0,title:`Add ${h.size} selected courses to your learning path`,children:["ðŸš€ Generate Path (",h.size,")"]})]}),u.learningOutcomes.length>0&&e.jsxs("div",{className:"sc-outcomes",children:[e.jsx("h5",{children:"ðŸŽ“ After this curriculum, learners will be able to:"}),e.jsxs("ul",{children:[u.learningOutcomes.slice(0,5).map((s,c)=>e.jsx("li",{children:s},c)),u.learningOutcomes.length>5&&e.jsxs("li",{className:"more",children:["+",u.learningOutcomes.length-5," more outcomes"]})]})]}),e.jsxs("div",{className:"curriculum-tiers",children:[u.tiers.prerequisites.length>0&&e.jsxs("div",{className:"curriculum-tier",children:[e.jsxs("div",{className:"tier-header prerequisites",children:[e.jsx("span",{className:"tier-icon",children:"ðŸŸ¢"}),e.jsx("span",{className:"tier-name",children:"Start Here"}),e.jsx("span",{className:"tier-count",children:u.tiers.prerequisites.length})]}),e.jsx("div",{className:"tier-courses",children:u.tiers.prerequisites.map(s=>e.jsx(O,{course:s,isSelected:h.has(s.code),onToggle:I,formatTime:E},s.code))})]}),u.tiers.core.length>0&&e.jsxs("div",{className:"curriculum-tier",children:[e.jsxs("div",{className:"tier-header core",children:[e.jsx("span",{className:"tier-icon",children:"ðŸ”µ"}),e.jsx("span",{className:"tier-name",children:"Core Learning"}),e.jsx("span",{className:"tier-count",children:u.tiers.core.length})]}),e.jsx("div",{className:"tier-courses",children:u.tiers.core.map(s=>e.jsx(O,{course:s,isSelected:h.has(s.code),onToggle:I,formatTime:E},s.code))})]}),u.tiers.advanced.length>0&&e.jsxs("div",{className:"curriculum-tier",children:[e.jsxs("div",{className:"tier-header advanced",children:[e.jsx("span",{className:"tier-icon",children:"ðŸŸ£"}),e.jsx("span",{className:"tier-name",children:"Advanced"}),e.jsx("span",{className:"tier-count",children:u.tiers.advanced.length})]}),e.jsx("div",{className:"tier-courses",children:u.tiers.advanced.map(s=>e.jsx(O,{course:s,isSelected:h.has(s.code),onToggle:I,formatTime:E},s.code))})]})]}),e.jsx("div",{className:"sc-actions",children:e.jsxs("button",{className:"add-to-path-btn",onClick:G,disabled:h.size===0,children:["âž• Add ",h.size," Courses to Path"]})})]})]})}function O({course:a,isSelected:r,onToggle:m,formatTime:o}){return e.jsxs("div",{className:`curriculum-course ${a.isInPath?"in-path":""} ${r?"selected":""}`,onClick:()=>!a.isInPath&&m(a.code),children:[!a.isInPath&&e.jsx("input",{type:"checkbox",checked:r,onChange:()=>{}}),e.jsxs("div",{className:"course-info",children:[e.jsx("div",{className:"course-title",children:a.title}),e.jsxs("div",{className:"course-meta",children:[e.jsx("span",{className:"course-time",children:o(a.estimatedTime)}),e.jsx("span",{className:"course-level",children:a.tags?.level}),a.isInPath&&e.jsx("span",{className:"already-added",children:"âœ“ Already in path"})]})]})]})}function we({courses:a,preSelectedSkill:r,onSkillUsed:m}){const[o,l]=p.useState("skill");return e.jsxs("div",{className:"left-panel",children:[e.jsxs("div",{className:"panel-tabs",children:[e.jsx("button",{className:`panel-tab ${o==="skill"?"active":""}`,onClick:()=>l("skill"),children:"ðŸŽ¯ Build by Skill"}),e.jsx("button",{className:`panel-tab ${o==="browse"?"active":""}`,onClick:()=>l("browse"),children:"ðŸ“š Browse All"})]}),e.jsx("div",{className:"panel-content",children:o==="skill"?e.jsx(he,{courses:a,preSelectedSkill:r,onSkillUsed:m}):e.jsx(me,{courses:a})})]})}export{we as default};

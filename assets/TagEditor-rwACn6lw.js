import{a as z,j as s}from"./index-G9aBofaO.js";import{a as c}from"./vendor-cytoscape-hdah7_Xt.js";import"./vendor-firebase-DNc0QRT5.js";import"./data-courses-Y_tFOtPD.js";function U(){const{courses:i,tags:N}=z(),[n,g]=c.useState(new Set),[d,S]=c.useState(""),[l,f]=c.useState(""),[y,m]=c.useState(!1),[r,u]=c.useState("all"),[o,x]=c.useState([]),p=c.useMemo(()=>{const e=new Set;return N?.forEach(t=>{t.label&&e.add(t.label)}),i.forEach(t=>{t.gemini_system_tags?.forEach(a=>e.add(a)),t.canonical_tags?.forEach(a=>e.add(a.split(".").pop()))}),Array.from(e).sort()},[N,i]),v=c.useMemo(()=>{if(!l.trim())return p.slice(0,20);const e=l.toLowerCase();return p.filter(t=>t.toLowerCase().includes(e)).slice(0,15)},[l,p]),h=c.useMemo(()=>{let e=i;if(r==="untagged"?e=e.filter(t=>!t.gemini_system_tags?.length&&!t.canonical_tags?.length):r==="pending"&&(e=e.filter(t=>!t.gemini_enriched)),d.trim()){const t=d.toLowerCase();e=e.filter(a=>a.code?.toLowerCase().includes(t)||a.title?.toLowerCase().includes(t)||a.tags?.topic?.toLowerCase().includes(t))}return e},[i,r,d]),k=c.useCallback(e=>{g(t=>{const a=new Set(t);return a.has(e)?a.delete(e):a.add(e),a})},[]),w=c.useCallback(()=>{g(new Set(h.map(e=>e.code)))},[h]),_=c.useCallback(()=>{g(new Set)},[]),j=c.useCallback(e=>{if(!e.trim()||n.size===0)return;const t={type:"add",tag:e.trim(),courses:Array.from(n),timestamp:new Date().toISOString()};x(a=>[...a,t]),f(""),m(!1)},[n]),T=c.useCallback(e=>{if(!e.trim()||n.size===0)return;const t={type:"remove",tag:e.trim(),courses:Array.from(n),timestamp:new Date().toISOString()};x(a=>[...a,t])},[n]),b=c.useMemo(()=>{if(n.size===0)return[];const e=i.filter(a=>n.has(a.code));if(e.length===0)return[];const t=new Set([...e[0].gemini_system_tags||[],...e[0].canonical_tags||[]]);return e.forEach(a=>{const L=new Set([...a.gemini_system_tags||[],...a.canonical_tags||[]]);for(const C of t)L.has(C)||t.delete(C)}),Array.from(t)},[n,i]),A=c.useCallback(()=>{if(o.length===0)return;const e=new Blob([JSON.stringify(o,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download=`tag_changes_${new Date().toISOString().split("T")[0]}.json`,a.click(),URL.revokeObjectURL(t)},[o]),E=c.useCallback(()=>{x([])},[]);return s.jsxs("div",{className:"tag-editor",children:[s.jsxs("div",{className:"te-header",children:[s.jsx("h2",{children:"âœï¸ Bulk Tag Editor"}),s.jsx("p",{children:"Select courses and add or remove tags efficiently"})]}),s.jsxs("div",{className:"te-toolbar",children:[s.jsx("div",{className:"te-search",children:s.jsx("input",{type:"text",placeholder:"Search courses by code, title, or topic...",value:d,onChange:e=>S(e.target.value)})}),s.jsxs("div",{className:"te-filters",children:[s.jsxs("button",{className:r==="all"?"active":"",onClick:()=>u("all"),children:["All (",i.length,")"]}),s.jsx("button",{className:r==="untagged"?"active":"",onClick:()=>u("untagged"),children:"Untagged"}),s.jsx("button",{className:r==="pending"?"active":"",onClick:()=>u("pending"),children:"Pending AI"})]}),s.jsxs("div",{className:"te-selection-actions",children:[s.jsxs("button",{onClick:w,children:["Select All (",h.length,")"]}),s.jsx("button",{onClick:_,children:"Deselect All"})]})]}),s.jsxs("div",{className:"te-content",children:[s.jsxs("div",{className:"te-courses",children:[s.jsx("div",{className:"te-courses-header",children:s.jsxs("span",{className:"selected-count",children:[n.size," selected"]})}),s.jsx("div",{className:"te-course-list",children:h.map(e=>s.jsxs("div",{className:`te-course-item ${n.has(e.code)?"selected":""}`,onClick:()=>k(e.code),children:[s.jsx("input",{type:"checkbox",checked:n.has(e.code),onChange:()=>{}}),s.jsxs("div",{className:"te-course-info",children:[s.jsxs("div",{className:"te-course-header",children:[s.jsx("span",{className:"code",children:e.code}),e.gemini_enriched?s.jsx("span",{className:"ai-badge",children:"AI"}):s.jsx("span",{className:"pending-badge",children:"Pending"})]}),s.jsx("div",{className:"te-course-title",children:e.title}),s.jsxs("div",{className:"te-course-tags",children:[e.tags?.topic&&s.jsx("span",{className:"mini-tag base",children:e.tags.topic}),e.gemini_system_tags?.slice(0,3).map(t=>s.jsx("span",{className:"mini-tag ai",children:t},t)),(e.gemini_system_tags?.length||0)>3&&s.jsxs("span",{className:"more-tags",children:["+",e.gemini_system_tags.length-3]})]})]})]},e.code))})]}),s.jsxs("div",{className:"te-actions",children:[s.jsxs("div",{className:"te-actions-section",children:[s.jsx("h3",{children:"Add Tags"}),s.jsx("p",{className:"te-hint",children:n.size>0?`Add tags to ${n.size} selected courses`:"Select courses to add tags"}),s.jsxs("div",{className:"te-tag-input-wrapper",children:[s.jsx("input",{type:"text",placeholder:"Type tag name...",value:l,onChange:e=>{f(e.target.value),m(!0)},onFocus:()=>m(!0),onKeyDown:e=>{e.key==="Enter"&&l.trim()&&j(l)},disabled:n.size===0}),s.jsx("button",{className:"add-btn",onClick:()=>j(l),disabled:!l.trim()||n.size===0,children:"+ Add"})]}),y&&v.length>0&&s.jsx("div",{className:"te-suggestions",children:v.map(e=>s.jsx("button",{className:"suggestion-btn",onClick:()=>j(e),children:e},e))})]}),n.size>0&&b.length>0&&s.jsxs("div",{className:"te-actions-section",children:[s.jsx("h3",{children:"Remove Tags"}),s.jsx("p",{className:"te-hint",children:"Tags shared by all selected courses"}),s.jsx("div",{className:"te-shared-tags",children:b.map(e=>s.jsxs("button",{className:"removable-tag",onClick:()=>T(e),title:"Click to remove from selected courses",children:[e," Ã—"]},e))})]}),o.length>0&&s.jsxs("div",{className:"te-actions-section te-pending",children:[s.jsxs("h3",{children:["Pending Changes (",o.length,")"]}),s.jsx("div",{className:"te-changes-list",children:o.slice(-5).map((e,t)=>s.jsxs("div",{className:`change-item ${e.type}`,children:[s.jsx("span",{className:"change-type",children:e.type==="add"?"+":"âˆ’"}),s.jsx("span",{className:"change-tag",children:e.tag}),s.jsxs("span",{className:"change-count",children:["(",e.courses.length," courses)"]})]},t))}),s.jsxs("div",{className:"te-actions-buttons",children:[s.jsx("button",{className:"export-btn",onClick:A,children:"ðŸ“¥ Export Changes"}),s.jsx("button",{className:"clear-btn",onClick:E,children:"ðŸ—‘ï¸ Clear"})]})]}),s.jsxs("div",{className:"te-actions-section te-stats",children:[s.jsx("h3",{children:"Quick Stats"}),s.jsxs("div",{className:"stat-row",children:[s.jsx("span",{children:"Total courses:"}),s.jsx("span",{children:i.length})]}),s.jsxs("div",{className:"stat-row",children:[s.jsx("span",{children:"AI enriched:"}),s.jsx("span",{children:i.filter(e=>e.gemini_enriched).length})]}),s.jsxs("div",{className:"stat-row",children:[s.jsx("span",{children:"Untagged:"}),s.jsx("span",{children:i.filter(e=>!e.gemini_system_tags?.length).length})]})]})]})]})]})}export{U as default};

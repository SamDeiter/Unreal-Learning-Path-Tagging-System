import{j as e,_ as _e,a as Ds,g as De}from"./index-LbGnzPdz.js";import{a as _,P as h}from"./vendor-cytoscape-hdah7_Xt.js";import{t as ye}from"./TagGraphService-B-wiM6gr.js";import{S as Fs,P as Us}from"./search-Blpc5bje.js";import{c as we}from"./createLucideIcon-YhyuTmrv.js";import{c as Ae,S as Pe,G as Bs}from"./GuidedPlayer-BaYei2NK.js";import{getFeedbackStatus as Vs,recordUpvote as Ws,recordDownvote as Gs,applyFeedbackMultiplier as zs,getBoostMap as Hs}from"./feedbackService-8U4wfPrk.js";import{b as Ks,l as Qs,c as Ys,s as Js}from"./data-courses-Y_tFOtPD.js";import{C as Xs}from"./check-eCXpKYRG.js";import{c as Ns,p as Zs,r as et,d as st,j as tt,k as nt,n as rt,m as Re,a as at}from"./vendor-firebase-DNc0QRT5.js";import{d as se,a as F}from"./logger-HX1K3TKu.js";import"./x-HbUnH9yy.js";const it=[["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],ot=we("circle-play",it);const ct=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],us=we("circle-x",ct);const lt=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],dt=we("image",lt);const ut=[["path",{d:"M13.172 2a2 2 0 0 1 1.414.586l6.71 6.71a2.4 2.4 0 0 1 0 3.408l-4.592 4.592a2.4 2.4 0 0 1-3.408 0l-6.71-6.71A2 2 0 0 1 6 9.172V3a1 1 0 0 1 1-1z",key:"16rjxf"}],["path",{d:"M2 7v6.172a2 2 0 0 0 .586 1.414l6.71 6.71a2.4 2.4 0 0 0 3.191.193",key:"178nd4"}],["circle",{cx:"10.5",cy:"6.5",r:".5",fill:"currentColor",key:"12ikhr"}]],ht=we("tags",ut);const mt=[["path",{d:"M12 19h8",key:"baeox8"}],["path",{d:"m4 17 6-6-6-6",key:"1yngyt"}]],pt=we("terminal",mt);const ft=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],gt=we("user",ft),yt=/(?:[A-Za-z]:\\[\w\\. -]+|\/(?:Users|home|tmp|var|opt|etc)\/[\w/. -]+)/g;function hs(s){return s.replace(yt,"[LOCAL_PATH]")}function Ze({onSubmit:s,detectedPersona:n,isLoading:i}){const[c,a]=_.useState(""),[o,r]=_.useState([]),[u,l]=_.useState(null),[t,d]=_.useState(""),[m,f]=_.useState(!1),g=_.useRef(null),[x,v]=_.useState(()=>{try{const w=JSON.parse(localStorage.getItem("fix-problem-history")||"[]"),b=w.map(R=>typeof R=="string"?{query:R,cartId:null}:R);return w.length>0&&typeof w[0]=="string"&&localStorage.setItem("fix-problem-history",JSON.stringify(b)),b}catch{return[]}}),M=_.useCallback(w=>{const b=hs(w.target.value);if(a(b),b.length>15){const R=ye.matchErrorSignature(b),U=ye.extractTagsFromText(b),W=R.map(X=>({tag:X.tag,confidence:X.confidence})),B=U.matches.map(X=>({tag:X.tag,confidence:X.confidence})),te=[...W,...B],de=new Set,oe=te.filter(X=>de.has(X.tag.tag_id)?!1:(de.add(X.tag.tag_id),!0));r(oe.slice(0,5))}else r([])},[]),p=_.useCallback(w=>{const b=w.clipboardData?.items;if(b){for(const R of b)if(R.type.startsWith("image/")){w.preventDefault();const U=R.getAsFile(),W=new FileReader;W.onload=B=>l(B.target.result),W.readAsDataURL(U);return}}},[]),N=_.useCallback(w=>{w.preventDefault(),w.stopPropagation(),f(!0)},[]),C=_.useCallback(w=>{w.preventDefault(),w.stopPropagation(),f(!1)},[]),S=_.useCallback(w=>{w.preventDefault(),w.stopPropagation(),f(!1);const b=w.dataTransfer?.files;if(!b||b.length===0)return;const R=b[0];if(R.type.startsWith("image/")){const U=new FileReader;U.onload=W=>l(W.target.result),U.readAsDataURL(R)}},[]),E=_.useCallback((w,b)=>{v(R=>{const U=R.map(W=>W.query===w?{...W,cartId:b}:W);return localStorage.setItem("fix-problem-history",JSON.stringify(U)),U})},[]),L=_.useCallback((w=null,b=null)=>{const R=(b||c).trim();R.length<10||(v(U=>{const W=U.filter(te=>te.query!==R),B=[{query:R,cartId:w},...W].slice(0,6);return localStorage.setItem("fix-problem-history",JSON.stringify(B)),B}),s({query:R,detectedTagIds:o.map(U=>U.tag.tag_id),selectedTagIds:[],personaHint:n?.name,pastedImage:u,errorLog:t.trim()||null,cachedCartId:w||null,updateCartIdForQuery:E}))},[c,o,n,s,u,t,E]),J=_.useCallback(w=>{w.key==="Enter"&&w.ctrlKey&&L()},[L]),ae=_.useMemo(()=>['My Blueprint Cast is giving me "Accessed None" error when trying to...',"Lumen is too noisy in my interior scene and I've tried increasing quality...","My character animation stutters when blending between states...","Nanite is causing Z-fighting on overlapping meshes...","Material instances aren't updating at runtime when I change parameters..."],[])[0];return e.jsxs("div",{className:"problem-input-container",onPaste:p,children:[e.jsxs("div",{className:"problem-input-header",children:[e.jsxs("h2",{children:[e.jsx(Fs,{size:22,className:"icon-inline"})," What's the problem?"]}),e.jsx("p",{className:"subtitle",children:"Describe your UE5 issue in plain English. We'll diagnose the root cause and teach you to fix it."})]}),e.jsxs("div",{className:"problem-input-field",children:[e.jsx("textarea",{value:c,onChange:M,onKeyDown:J,placeholder:ae,rows:5,disabled:i,"aria-label":"Problem description"}),e.jsxs("div",{className:"char-count",children:[c.length," characters",c.length<10&&c.length>0&&e.jsx("span",{className:"warning",children:" (minimum 10)"})]})]}),o.length>0&&e.jsxs("div",{className:"detected-tags",children:[e.jsxs("span",{className:"label",children:[e.jsx(ht,{size:14,className:"icon-inline"})," Detected:"]}),e.jsx("div",{className:"tag-list",children:o.map(w=>e.jsxs("span",{className:"tag-chip",title:w.tag.description||w.tag.display_name,children:[w.tag.display_name,e.jsxs("span",{className:"confidence",children:[Math.round(w.confidence*100),"%"]})]},w.tag.tag_id))})]}),e.jsxs("div",{className:`screenshot-zone ${t.trim()?"has-image":""}`,onClick:()=>{t.trim()||document.getElementById("error-log-input")?.focus()},children:[t.trim()?e.jsxs("div",{className:"pasted-preview error-log-preview",children:[e.jsx("pre",{className:"error-log-display",children:t}),e.jsx("button",{type:"button",className:"clear-error-log",onClick:w=>{w.stopPropagation(),d("")},"aria-label":"Remove error log",title:"Clear error log",children:e.jsx(us,{size:20})})]}):e.jsxs("div",{className:"drop-prompt",children:[e.jsx(pt,{size:20}),e.jsxs("span",{children:["Paste (",e.jsx("kbd",{children:"Ctrl+V"}),") an error log or build output"]})]}),e.jsx("textarea",{id:"error-log-input",className:"error-log-hidden-input",value:t,onChange:w=>d(w.target.value),onPaste:w=>{const b=w.clipboardData?.getData("text");b&&(w.preventDefault(),d(hs(b)))},rows:1})]}),e.jsx("div",{ref:g,className:`screenshot-zone ${m?"drag-over":""} ${u?"has-image":""}`,onDragOver:N,onDragLeave:C,onDrop:S,children:u?e.jsxs("div",{className:"pasted-preview",children:[e.jsx("img",{src:u,alt:"Pasted screenshot"}),e.jsx("button",{type:"button",className:"clear-error-log",onClick:()=>l(null),"aria-label":"Remove screenshot",title:"Remove screenshot",children:e.jsx(us,{size:20})})]}):e.jsxs("div",{className:"drop-prompt",children:[e.jsx(dt,{size:20}),e.jsxs("span",{children:["Paste (",e.jsx("kbd",{children:"Ctrl+V"}),") or drag a screenshot here"]})]})}),n&&e.jsxs("div",{className:"persona-context",children:[e.jsxs("span",{className:"label",children:[e.jsx(gt,{size:14,className:"icon-inline"})," Context:"]}),e.jsx("span",{className:"persona-chip",children:n.name}),e.jsx("span",{className:"hint",children:"Recommendations will be tailored for you"})]}),e.jsxs("div",{className:"problem-input-actions",children:[e.jsx("button",{className:"submit-btn primary",onClick:()=>L(),disabled:c.trim().length<10||i,children:i?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner"})," Diagnosing..."]}):e.jsx(e.Fragment,{children:"Get Diagnosis ‚Üí"})}),e.jsxs("span",{className:"hint",children:["Press ",e.jsx("kbd",{children:"Ctrl"})," + ",e.jsx("kbd",{children:"Enter"})," to submit"]})]}),x.length>0&&e.jsxs("div",{className:"query-history",children:[e.jsx("span",{className:"history-label",children:"üïò Recent questions:"}),e.jsx("div",{className:"history-chips",children:x.map((w,b)=>{const R=w.query||w,U=w.cartId||null,W=!!U;return e.jsxs("div",{className:"history-chip-row",children:[e.jsxs("button",{type:"button",className:`history-chip ${W?"cached":""}`,onClick:()=>{a(R),M({target:{value:R}}),W&&!i&&setTimeout(()=>L(U,R),50)},title:W?`${R} (cached ‚Äî instant load)`:R,disabled:i,children:[W&&e.jsx("span",{className:"cache-indicator",children:"‚ö°"}),R.length>50?R.slice(0,50)+"‚Ä¶":R]}),e.jsx("button",{type:"button",className:"history-delete",onClick:()=>{v(B=>{const te=B.filter((de,oe)=>oe!==b);return localStorage.setItem("fix-problem-history",JSON.stringify(te)),te})},title:"Remove",children:"√ó"})]},b)})})]})]})}Ze.propTypes={onSubmit:h.func.isRequired,detectedPersona:h.shape({id:h.string,name:h.string,emoji:h.string}),isLoading:h.bool};Ze.defaultProps={detectedPersona:null,isLoading:!1};const ge={engineVersion:{points:15,label:"Engine Version"},platform:{points:5,label:"Platform"},renderer:{points:10,label:"Renderer"},whatChangedRecently:{points:10,label:"Recent Changes"},goal:{points:5,label:"Goal"},features:{points:5,label:"Features"}},xt=Object.values(ge).reduce((s,n)=>s+n.points,0);function es({onUpdate:s,disabled:n}){const[i,c]=_.useState({engineVersion:"",platform:"",context:"",renderer:"",features:"",whatChangedRecently:"",goal:""}),a=_.useCallback((l,t)=>{const d={...i,[l]:t};c(d);const m={engineVersion:d.engineVersion.trim()||void 0,platform:d.platform.trim()||void 0,context:d.context.trim()||void 0,renderer:d.renderer.trim()||void 0,features:d.features?d.features.split(",").map(g=>g.trim()).filter(Boolean):[],whatChangedRecently:d.whatChangedRecently.trim()||void 0,goal:d.goal.trim()||void 0},f=Object.values(m).some(g=>g!==void 0&&(!Array.isArray(g)||g.length>0));s(f?m:null)},[i,s]),o=_.useMemo(()=>{let l=0;return i.engineVersion.trim()&&(l+=ge.engineVersion.points),i.platform&&(l+=ge.platform.points),i.renderer&&(l+=ge.renderer.points),i.whatChangedRecently.trim()&&(l+=ge.whatChangedRecently.points),i.goal.trim()&&(l+=ge.goal.points),i.features.trim()&&(l+=ge.features.points),l},[i]),r=Math.round(o/xt*100),u=o===0?"none":o<=15?"low":o<=30?"med":"high";return e.jsxs("div",{className:"case-report-card",children:[e.jsxs("div",{className:"case-report-card-header",children:[e.jsx("h3",{children:"üìã Case Details"}),e.jsx("p",{className:"case-report-card-hint",children:"Fill in what you can ‚Äî each field improves diagnosis accuracy."})]}),e.jsxs("div",{className:"case-boost-meter",children:[e.jsxs("div",{className:"case-boost-row",children:[e.jsx("span",{className:"case-boost-label",children:"Confidence Boost"}),e.jsx("span",{className:`case-boost-value case-boost-${u}`,children:o>0?`+${o} pts`:"‚Äî"})]}),e.jsx("div",{className:"case-boost-bar",children:e.jsx("div",{className:`case-boost-fill case-boost-fill-${u}`,style:{width:`${r}%`}})})]}),e.jsxs("div",{className:"case-report-fields",children:[e.jsxs("div",{className:"case-report-row",children:[e.jsxs("div",{className:"case-report-field",children:[e.jsx("label",{children:"Engine Version"}),e.jsx("input",{type:"text",placeholder:"e.g. 5.4.1",value:i.engineVersion,onChange:l=>a("engineVersion",l.target.value),disabled:n,maxLength:20})]}),e.jsxs("div",{className:"case-report-field",children:[e.jsx("label",{children:"Platform"}),e.jsxs("select",{value:i.platform,onChange:l=>a("platform",l.target.value),disabled:n,children:[e.jsx("option",{value:"",children:"Select..."}),e.jsx("option",{value:"Windows",children:"Windows"}),e.jsx("option",{value:"macOS",children:"macOS"}),e.jsx("option",{value:"Linux",children:"Linux"}),e.jsx("option",{value:"Android",children:"Android"}),e.jsx("option",{value:"iOS",children:"iOS"}),e.jsx("option",{value:"Console",children:"Console"})]})]})]}),e.jsxs("div",{className:"case-report-field",children:[e.jsx("label",{children:"Renderer"}),e.jsxs("select",{value:i.renderer,onChange:l=>a("renderer",l.target.value),disabled:n,children:[e.jsx("option",{value:"",children:"Select..."}),e.jsx("option",{value:"Lumen",children:"Lumen"}),e.jsx("option",{value:"Nanite",children:"Nanite"}),e.jsx("option",{value:"Forward",children:"Forward Shading"}),e.jsx("option",{value:"Deferred",children:"Deferred"}),e.jsx("option",{value:"Mobile",children:"Mobile"}),e.jsx("option",{value:"PathTracing",children:"Path Tracing"})]})]}),e.jsxs("div",{className:"case-report-field",children:[e.jsx("label",{children:"What changed recently?"}),e.jsx("input",{type:"text",placeholder:"e.g. Migrated to 5.4, changed lighting",value:i.whatChangedRecently,onChange:l=>a("whatChangedRecently",l.target.value),disabled:n,maxLength:300})]}),e.jsxs("div",{className:"case-report-field",children:[e.jsx("label",{children:"What are you trying to achieve?"}),e.jsx("input",{type:"text",placeholder:"e.g. Realistic interior lighting",value:i.goal,onChange:l=>a("goal",l.target.value),disabled:n,maxLength:200})]}),e.jsxs("div",{className:"case-report-field",children:[e.jsx("label",{children:"Active Features (comma separated)"}),e.jsx("input",{type:"text",placeholder:"e.g. Lumen, Nanite, VSM",value:i.features,onChange:l=>a("features",l.target.value),disabled:n,maxLength:200})]})]})]})}es.propTypes={onUpdate:h.func.isRequired,disabled:h.bool};es.defaultProps={disabled:!1};function ss({question:s,options:n,whyAsking:i,onAnswer:c,onSkip:a,isLoading:o,clarifyRound:r,maxClarifyRounds:u,conversationHistory:l}){return e.jsxs("div",{className:"clarify-step",children:[r>0&&u>1&&e.jsxs("div",{className:"clarify-round-counter",children:[e.jsxs("span",{className:"clarify-round-badge",children:["Narrowing down‚Ä¶ ",r," of ",u]}),e.jsx("div",{className:"clarify-round-bar",children:e.jsx("div",{className:"clarify-round-fill",style:{width:`${r/u*100}%`}})})]}),l.length>0&&e.jsx("div",{className:"clarify-history",children:l.map((t,d)=>e.jsxs("div",{className:`clarify-history-turn clarify-history-${t.role}`,children:[e.jsx("span",{className:"clarify-history-role",children:t.role==="assistant"?"ü§ñ Asked:":"üë§ You said:"}),e.jsx("span",{className:"clarify-history-content",children:t.content})]},d))}),e.jsxs("div",{className:"clarify-header",children:[e.jsx("span",{className:"clarify-icon",children:"ü§î"}),e.jsx("h3",{children:r>1?"One more thing to narrow it down":"Quick question before we diagnose"})]}),e.jsx("p",{className:"clarify-question",children:s}),e.jsxs("div",{className:"clarify-options",children:[(n||[]).map((t,d)=>e.jsxs("button",{className:"clarify-option-btn",onClick:()=>c(t),disabled:o,children:[e.jsx("span",{className:"clarify-option-letter",children:String.fromCharCode(65+d)}),e.jsx("span",{className:"clarify-option-text",children:t})]},d)),e.jsxs("button",{className:"clarify-option-btn clarify-option-idk",onClick:()=>c("I'm not sure ‚Äî show me foundational content on this topic"),disabled:o,children:[e.jsx("span",{className:"clarify-option-letter",children:"ü§∑"}),e.jsx("span",{className:"clarify-option-text",children:"I'm not sure"})]})]}),i&&e.jsxs("p",{className:"clarify-why",children:[e.jsx("span",{className:"clarify-why-label",children:"Why we're asking:"})," ",i]}),e.jsx("button",{className:"clarify-skip-btn",onClick:a,disabled:o,children:"Skip ‚Äî just give me the best answer you can"})]})}ss.propTypes={question:h.string.isRequired,options:h.arrayOf(h.string),whyAsking:h.string,onAnswer:h.func.isRequired,onSkip:h.func.isRequired,isLoading:h.bool,clarifyRound:h.number,maxClarifyRounds:h.number,conversationHistory:h.arrayOf(h.shape({role:h.string.isRequired,content:h.string.isRequired}))};ss.defaultProps={options:[],whyAsking:"",isLoading:!1,clarifyRound:1,maxClarifyRounds:3,conversationHistory:[]};function ts({evidence:s}){const[n,i]=_.useState(!1);return!s||s.length===0?null:e.jsxs("details",{className:"evidence-panel",open:n,onToggle:c=>i(c.target.open),children:[e.jsxs("summary",{className:"evidence-toggle",children:[e.jsx("span",{className:"evidence-icon",children:"üìé"}),"Sources (",s.length,")"]}),e.jsx("div",{className:"evidence-list",children:s.map((c,a)=>e.jsxs("div",{className:"evidence-item",children:[e.jsxs("div",{className:"evidence-item-header",children:[e.jsxs("span",{className:"evidence-ref",children:["[",a+1,"]"]}),e.jsx("span",{className:"evidence-source-badge",children:c.source==="transcript"?"üé¨ Transcript":"üìÑ Docs"}),c.videoTitle&&e.jsx("span",{className:"evidence-video-title",children:c.videoTitle}),c.timestamp&&e.jsxs("span",{className:"evidence-timestamp",children:["@ ",c.timestamp]})]}),e.jsx("p",{className:"evidence-text",children:c.text}),c.courseCode&&e.jsxs("span",{className:"evidence-course",children:["Course: ",c.courseCode]})]},a))})]})}ts.propTypes={evidence:h.arrayOf(h.shape({text:h.string,source:h.string,courseCode:h.string,videoTitle:h.string,timestamp:h.string}))};ts.defaultProps={evidence:[]};function ns({onFeedback:s,isRerunning:n}){const[i,c]=_.useState("ask"),[a,o]=_.useState(""),r=_.useCallback(()=>{c("thanks"),s({solved:!0})},[s]),u=_.useCallback(()=>{c("no-reason")},[]),l=_.useCallback(()=>{s({solved:!1,reason:a.trim()}),c("thanks")},[s,a]);return i==="thanks"?e.jsxs("div",{className:"feedback-panel feedback-thanks",children:[e.jsx("span",{className:"feedback-icon",children:"‚úÖ"}),e.jsx("span",{children:"Thanks for the feedback!"}),n&&e.jsx("span",{className:"feedback-rerunning",children:"Re-analyzing with your feedback..."})]}):i==="no-reason"?e.jsxs("div",{className:"feedback-panel feedback-reason",children:[e.jsx("p",{className:"feedback-question",children:"What didn't work?"}),e.jsx("textarea",{className:"feedback-textarea",value:a,onChange:t=>o(t.target.value),placeholder:"e.g. I already tried that, the setting doesn't exist in my version, the issue is different...",maxLength:300,rows:2,disabled:n}),e.jsx("button",{className:"feedback-submit-btn",onClick:l,disabled:a.trim().length<5||n,children:n?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner"})," Re-analyzing..."]}):"Try a different approach ‚Üí"})]}):e.jsxs("div",{className:"feedback-panel feedback-ask",children:[e.jsx("p",{className:"feedback-question",children:"Did this solve your problem?"}),e.jsxs("div",{className:"feedback-buttons",children:[e.jsx("button",{className:"feedback-btn feedback-yes",onClick:r,children:"üëç Yes"}),e.jsx("button",{className:"feedback-btn feedback-no",onClick:u,children:"üëé No"})]})]})}ns.propTypes={onFeedback:h.func.isRequired,isRerunning:h.bool};ns.defaultProps={isRerunning:!1};function rs({answer:s,onFeedback:n,onBackToVideos:i,onStartOver:c,isRerunning:a}){const[o,r]=_.useState(!1);if(!s)return null;const u=s.confidence==="high"?"#10b981":s.confidence==="med"?"#f59e0b":"#ef4444";return e.jsxs("div",{className:"answer-view",children:[e.jsxs("div",{className:"answer-header",children:[e.jsxs("h2",{className:"answer-title",children:[e.jsx("span",{className:"answer-icon",children:"üéØ"})," Most Likely Cause"]}),e.jsxs("span",{className:"answer-confidence-badge",style:{background:`${u}22`,color:u,border:`1px solid ${u}44`},children:[s.confidence," confidence"]})]}),e.jsx("p",{className:"answer-cause",children:s.mostLikelyCause}),s.fastChecks?.length>0&&e.jsxs("div",{className:"answer-section answer-fast-checks",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"section-icon",children:"‚ö°"})," Quick Checks"]}),e.jsx("ul",{children:s.fastChecks.map((l,t)=>e.jsxs("li",{children:[e.jsx("span",{className:"check-number",children:t+1}),e.jsx("span",{children:l})]},t))})]}),s.fixSteps?.length>0&&e.jsxs("div",{className:"answer-section answer-fix-steps",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"section-icon",children:"üîß"})," Fix Steps"]}),e.jsx("ol",{children:s.fixSteps.map((l,t)=>e.jsx("li",{children:l},t))})]}),s.ifStillBrokenBranches?.length>0&&e.jsxs("div",{className:"answer-section answer-branches",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"section-icon",children:"üîÄ"})," If Still Broken"]}),e.jsx("div",{className:"branch-list",children:s.ifStillBrokenBranches.map((l,t)=>e.jsxs("div",{className:"branch-item",children:[e.jsxs("span",{className:"branch-condition",children:["If ",l.condition,":"]}),e.jsx("span",{className:"branch-action",children:l.action})]},t))})]}),s.learnPath&&e.jsxs("details",{className:"answer-section answer-learn-path",open:o,onToggle:l=>r(l.target.open),children:[e.jsxs("summary",{children:[e.jsx("span",{className:"section-icon",children:"üìö"})," Learn More",e.jsxs("span",{className:"learn-path-badge",children:[s.learnPath.topicsCovered?.length||0," topics"]})]}),e.jsxs("div",{className:"learn-path-content",children:[e.jsx("p",{className:"learn-path-summary",children:s.learnPath.pathSummary}),s.learnPath.objectives&&e.jsxs("div",{className:"learn-path-objectives",children:[s.learnPath.objectives.fixSpecific?.length>0&&e.jsxs("div",{children:[e.jsx("h4",{children:"üéØ Fix-Specific"}),e.jsx("ul",{children:s.learnPath.objectives.fixSpecific.map((l,t)=>e.jsx("li",{children:l},t))})]}),s.learnPath.objectives.transferable?.length>0&&e.jsxs("div",{children:[e.jsx("h4",{children:"üîÑ Transferable Skills"}),e.jsx("ul",{children:s.learnPath.objectives.transferable.map((l,t)=>e.jsx("li",{children:l},t))})]})]})]})]}),s.whyThisResult?.length>0&&e.jsxs("div",{className:"answer-section answer-reasoning",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"section-icon",children:"üí°"})," Why This Result"]}),e.jsx("ul",{className:"reasoning-list",children:s.whyThisResult.map((l,t)=>e.jsx("li",{children:l},t))})]}),e.jsx(ts,{evidence:s.evidence}),e.jsxs("div",{className:"answer-actions",children:[e.jsx("button",{className:"answer-action-btn primary",onClick:i,children:"üé¨ Browse Related Videos"}),e.jsx("button",{className:"answer-action-btn secondary",onClick:c,children:"‚Üê Ask Another Question"})]}),e.jsx(ns,{onFeedback:n,isRerunning:a})]})}rs.propTypes={answer:h.shape({mostLikelyCause:h.string,confidence:h.oneOf(["high","med","low"]),fastChecks:h.arrayOf(h.string),fixSteps:h.arrayOf(h.string),ifStillBrokenBranches:h.arrayOf(h.shape({condition:h.string,action:h.string})),learnPath:h.shape({pathSummary:h.string,topicsCovered:h.arrayOf(h.string),objectives:h.shape({fixSpecific:h.arrayOf(h.string),transferable:h.arrayOf(h.string)})}),whyThisResult:h.arrayOf(h.string),evidence:h.array}),onFeedback:h.func.isRequired,onBackToVideos:h.func.isRequired,onStartOver:h.func.isRequired,isRerunning:h.bool};rs.defaultProps={answer:null,isRerunning:!1};function ms(s){const n=Math.round(s/60);if(n<1)return"<1 min";if(n>=60){const i=Math.floor(n/60),c=n%60;return c>0?`${i}h ${c}m`:`${i}h`}return`${n} min`}const vt={video:"üì∫",doc:"üìñ",youtube:"‚ñ∂Ô∏è"};function Ss({cart:s,onRemove:n,onClear:i,onWatchPath:c}){const a=s.reduce((t,d)=>t+(d.duration||(d.readTimeMinutes||d.durationMinutes||0)*60),0),o=s.filter(t=>(t.type||"video")==="video").length,r=s.filter(t=>t.type==="doc").length,u=s.filter(t=>t.type==="youtube").length,l=[];return o>0&&l.push(`${o} video${o!==1?"s":""}`),r>0&&l.push(`${r} doc${r!==1?"s":""}`),u>0&&l.push(`${u} YT`),e.jsxs("div",{className:"cart-panel",children:[e.jsxs("div",{className:"cart-header",children:[e.jsx("h3",{className:"cart-title",children:"üõí My Learning Path"}),s.length>0&&e.jsx("button",{className:"cart-clear-btn",onClick:i,title:"Clear all",children:"Clear"})]}),s.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cart-stats",children:[e.jsx("span",{className:"cart-stat-count",children:l.join(" ¬∑ ")}),e.jsx("span",{className:"cart-stat-dot",children:"¬∑"}),e.jsx("span",{className:"cart-stat-time",children:ms(a)})]}),a>28800&&e.jsx("div",{className:"cart-warning",children:"‚ö†Ô∏è That's over 8 hours of content ‚Äî consider narrowing your focus to the most relevant items."}),e.jsx("div",{className:"cart-items",children:s.map((t,d)=>{const m=t.itemId||t.driveId||d,f=t.type||"video",g=vt[f]||"üì∫",x=f==="video"?Ae(t.title):t.title,v=t.duration>0?ms(t.duration):t.readTimeMinutes?`${t.readTimeMinutes} min read`:t.durationMinutes?`${t.durationMinutes} min`:null;return e.jsxs("div",{className:`cart-item cart-item-${f}`,children:[e.jsx("span",{className:"cart-item-num",children:d+1}),e.jsx("span",{className:"cart-item-icon",title:f,children:g}),e.jsxs("div",{className:"cart-item-info",children:[e.jsx("span",{className:"cart-item-title",children:x}),v&&e.jsx("span",{className:"cart-item-dur",children:v})]}),e.jsx("button",{className:"cart-item-remove",onClick:()=>n(m),"aria-label":`Remove ${t.title}`,children:"√ó"})]},m)})}),e.jsx("button",{className:"cart-watch-btn",onClick:c,children:"‚ñ∂ Watch Path"})]}):e.jsxs("div",{className:"cart-empty",children:[e.jsx("span",{className:"cart-empty-icon",children:"üì∫"}),e.jsx("p",{children:"Add videos, docs, and resources to build your learning path"})]})]})}Ss.propTypes={cart:h.arrayOf(h.shape({itemId:h.string,driveId:h.string,type:h.oneOf(["video","doc","youtube"]),title:h.string.isRequired,duration:h.number,readTimeMinutes:h.number,durationMinutes:h.number})).isRequired,onRemove:h.func.isRequired,onClear:h.func.isRequired,onWatchPath:h.func.isRequired};const Cs={},Ts={};(Qs.courses||[]).forEach(s=>{Cs[s.code]=s.title,Ts[s.code]=s.versions||[]});function bt(s){const n=Ts[s];return!n||n.length===0?!1:n.every(i=>{const c=String(i).replace(/^V/i,"");return c.startsWith("4")&&!c.startsWith("4.")?/^4\d{1,2}$/.test(c):c.startsWith("4.")})}function jt(s){if(!s||s<=0)return"";const n=Math.round(s/60);return n<1?"<1 min":`${n} min`}function Xe({video:s,isAdded:n,onToggle:i,userQuery:c}){const{title:a,duration:o,driveId:r,courseCode:u,_curatedMatch:l,role:t,reason:d,matchPercent:m,watchHint:f}=s,g=m>=100?"best":m>=70?"strong":m>=40?"good":"related",x=m>=100?"Best Match":m>=70?"Strong Match":m>=40?"Good Match":"Related",v=a?.replace(/\s+(?:Part\s+[A-Z]|PT\s*\d+)$/i,"").trim()||a,M=u?Ks[u]:null,p=M?.prereqs||[],[N,C]=_.useState(()=>Vs(r)),[S,E]=_.useState(!1),L=_.useRef(null),J=_.useRef(null);_.useEffect(()=>{if(!S)return;const b=R=>{L.current&&!L.current.contains(R.target)&&E(!1)};return document.addEventListener("mousedown",b),()=>document.removeEventListener("mousedown",b)},[S]);const Q=b=>{b.stopPropagation(),Ws(r,c||""),C("up")},ae=b=>{b.stopPropagation(),Gs(r,c||""),C("down")},w=r?`https://drive.google.com/thumbnail?id=${r}&sz=w320`:null;return e.jsx("div",{ref:J,className:`video-result-card ${n?"added":""} ${l?"curated":""} ${N==="down"?"demoted":""}`,role:"button",tabIndex:0,children:e.jsxs("div",{className:"vrc-compact",children:[e.jsxs("div",{className:"vrc-thumbnail",children:[w?e.jsx("img",{src:w,alt:v,onError:b=>{b.target.style.display="none",b.target.nextSibling.style.display="flex"}}):null,e.jsx("div",{className:"vrc-thumb-fallback",style:{display:w?"none":"flex"},children:e.jsx("span",{className:"vrc-play-icon",children:e.jsx(ot,{size:24})})}),o>0&&e.jsx("span",{className:"vrc-duration",children:jt(o)})]}),e.jsxs("div",{className:"vrc-badge-row",children:[m!=null&&e.jsxs("span",{className:`vrc-match-badge vrc-match-${g}`,title:`${m}% match`,children:[e.jsx("span",{className:"vrc-match-dot"}),x]}),l&&e.jsx("span",{className:"vrc-curated-badge",children:"‚úì Solution"}),t&&t!=="core"&&e.jsxs("div",{className:"vrc-role-wrapper",ref:t==="prerequisite"?L:null,children:[e.jsxs("button",{className:`vrc-role-badge vrc-role-${t} ${t==="prerequisite"?"vrc-role-clickable":""}`,onClick:b=>{b.stopPropagation(),t==="prerequisite"&&E(R=>!R)},title:t==="prerequisite"?"Click to see why this is a prerequisite":void 0,children:[t==="prerequisite"&&"üîó Prerequisite",t==="troubleshooting"&&"üîß Troubleshooting",t==="supplemental"&&"üìö Supplemental"]}),S&&t==="prerequisite"&&e.jsxs("div",{className:"vrc-prereq-tooltip",children:[e.jsx("strong",{children:"Prerequisite Course"}),p.length>0?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"Watch these first:"}),e.jsx("ul",{className:"vrc-prereq-list",children:p.map(b=>e.jsxs("li",{children:["üìò ",Cs[b]||b,M?.reasons?.[b]&&e.jsxs("span",{className:"vrc-prereq-why",children:[" ‚Äî ",M.reasons[b]]})]},b))})]}):e.jsx("p",{children:"Watch this first ‚Äî it covers foundational concepts needed before advancing."}),d&&e.jsx("p",{className:"vrc-tip-reason",children:d})]})]}),u&&bt(u)&&e.jsx("span",{className:"vrc-ue4-badge",title:"This content was created for Unreal Engine 4 ‚Äî some details may differ in UE5",children:"‚ö†Ô∏è UE4"})]}),e.jsxs("div",{className:"vrc-info",children:[e.jsx("h4",{className:"vrc-title",children:v}),f&&f!=="‚ñ∂ Watch full video"&&e.jsx("p",{className:"vrc-timestamp-hint",children:f})]}),e.jsxs("div",{className:"vrc-actions",children:[e.jsxs("div",{className:"vrc-feedback",children:[e.jsx("button",{className:`vrc-fb-btn ${N==="up"?"active-up":""}`,onClick:Q,"aria-label":"Helpful",title:"This was helpful",children:e.jsx("span",{className:"vrc-fb-emoji",children:"üëç"})}),e.jsx("button",{className:`vrc-fb-btn ${N==="down"?"active-down":""}`,onClick:ae,"aria-label":"Not helpful",title:"Not relevant",children:e.jsx("span",{className:"vrc-fb-emoji",children:"üëé"})})]}),e.jsx("button",{className:`vrc-add-btn ${n?"vrc-added":""}`,onClick:b=>{b.stopPropagation(),i(s)},"aria-label":n?"Remove from playlist":"Add to playlist",children:n?e.jsxs(e.Fragment,{children:[e.jsx(Xs,{size:14})," Added"]}):e.jsxs(e.Fragment,{children:[e.jsx(Us,{size:14})," Add"]})})]})]})})}Xe.propTypes={video:h.shape({driveId:h.string,title:h.string.isRequired,courseName:h.string,duration:h.number,matchedTags:h.arrayOf(h.string),courseCode:h.string,topSegments:h.array,docLinks:h.array,_curatedMatch:h.bool,role:h.oneOf(["prerequisite","core","troubleshooting","supplemental"]),reason:h.string,estimatedMinutes:h.number}).isRequired,isAdded:h.bool,onToggle:h.func.isRequired,userQuery:h.string};let Fe=null;async function _t(){if(!Fe){const s=await _e(()=>import("./data-embeddings-EsTyY_EC.js"),[]);Fe=s.default||s}return Fe}function as(s,n){if(!s||!n||s.length!==n.length)return 0;let i=0,c=0,a=0;for(let r=0;r<s.length;r++)i+=s[r]*n[r],c+=s[r]*s[r],a+=n[r]*n[r];const o=Math.sqrt(c)*Math.sqrt(a);return o===0?0:i/o}async function wt(s,n=5,i=.3){const c=await _t();if(!s||!c?.courses)return[];const a=[];for(const[o,r]of Object.entries(c.courses)){const u=as(s,r.embedding);u>=i&&a.push({code:o,title:r.title,similarity:u})}return a.sort((o,r)=>r.similarity-o.similarity),a.slice(0,n)}let Ue=null,Be=null;async function Nt(){if(!Ue){const s=await _e(()=>import("./data-search-SjqZFhcO.js").then(n=>n.s),[]);Ue=s.default||s}return Ue}async function is(){if(!Be){const s=await _e(()=>import("./data-search-SjqZFhcO.js").then(n=>n.a),[]);Be=s.default||s}return Be}let Ve=null,be=null;function St(s,n=768){const i=atob(s),c=new Uint8Array(i.length);for(let r=0;r<i.length;r++)c[r]=i.charCodeAt(r);const a=new DataView(c.buffer),o=new Float32Array(n);for(let r=0;r<n;r++){const u=a.getUint16(r*2,!0);o[r]=Ct(u)}return o}function Ct(s){const n=s>>15&1,i=s>>10&31,c=s&1023;return i===0?(n?-1:1)*Math.pow(2,-14)*(c/1024):i===31?c?NaN:n?-1/0:1/0:(n?-1:1)*Math.pow(2,i-15)*(1+c/1024)}async function Tt(){if(be)return be;if(!Ve)try{const n=await fetch(new URL("../data/segment_embeddings.json",import.meta.url));if(!n.ok)throw new Error(`HTTP ${n.status}`);Ve=await n.json()}catch(n){return se("‚ö†Ô∏è segment_embeddings.json not available:",n.message),null}const s=Ve?.segments;if(!s)return null;be=new Map;for(const[n,i]of Object.entries(s))be.set(n,{vector:St(i.embedding),courseCode:i.course_code,videoKey:i.video_key,videoTitle:i.video_title,startTimestamp:i.start_timestamp,endTimestamp:i.end_timestamp,startSeconds:i.start_seconds,text:i.text,tokenEstimate:i.token_estimate});return F(`[SegmentSearch] Decoded ${be.size} segment embeddings`),be}async function ks(s,n=[]){if(!s||s.length<3)return[];const i=s.toLowerCase().split(/\s+/).filter(r=>r.length>2&&!Pe.has(r));if(i.length===0)return[];const c=await Nt(),a=[],o=c?.course_words||{};for(const[r,u]of Object.entries(o)){let l=0;const t=[];for(const d of i)if(u[d]&&(l+=u[d]*10,t.push(d)),d.length>=4)for(const[m,f]of Object.entries(u))m!==d&&m.length>=4&&(m.startsWith(d)||d.startsWith(m))&&(l+=f*3,t.includes(m)||t.push(m));if(l>=30&&t.length>0){const d=n.find(f=>f.code===r),m=await kt(r,t);a.push({courseCode:r,courseTitle:d?.title||r,score:l,matchedKeywords:t,topSegments:m,estimatedSegment:m.length>0?m[0]:null,videoCount:d?.video_count||0,duration:d?.duration_formatted||"Unknown"})}}return a.sort((r,u)=>u.score-r.score).slice(0,5)}async function kt(s,n){const c=(await is())[s];if(!c||!c.videos)return[];const a=[];for(const[o,r]of Object.entries(c.videos))if(r.segments)for(const u of r.segments){const l=u.text.toLowerCase();let t=0;const d=[];for(const m of n){const f=m.toLowerCase(),g=new RegExp(f.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi"),x=l.match(g);x&&(t+=x.length*10,d.push(m)),l.includes(f)&&(t+=5,d.includes(m)||d.push(m))}if(t>0){let m=u.text;if(m.length>120){const f=d[0]||"",g=m.toLowerCase().indexOf(f.toLowerCase());g>40&&(m="..."+m.substring(g-30)),m.length>120&&(m=m.substring(0,117)+"...")}a.push({videoKey:o,videoTitle:r.title,timestamp:u.start,startSeconds:u.start_seconds,endTimestamp:u.end,previewText:m,matchedKeywords:d,score:t})}}return a.sort((o,r)=>r.score-o.score).slice(0,3)}async function Rt(s,n=10,i=.35){if(!s)return[];const c=await Tt();if(!c)return[];const a=[];for(const[r,u]of c){const l=as(s,u.vector);l>=i&&a.push({id:r,courseCode:u.courseCode,videoKey:u.videoKey,videoTitle:u.videoTitle,timestamp:u.startTimestamp,endTimestamp:u.endTimestamp,startSeconds:u.startSeconds,previewText:u.text,similarity:l,source:"transcript"})}a.sort((r,u)=>u.similarity-r.similarity);const o=a.slice(0,n);if(o.length>0){const r=new Map;for(const[u,l]of c){const t=`${l.courseCode}:${l.videoKey}`;r.has(t)||r.set(t,[]),r.get(t).push({id:u,text:l.text,startSeconds:l.startSeconds})}for(const u of r.values())u.sort((l,t)=>l.startSeconds-t.startSeconds);for(const u of o){const l=`${u.courseCode}:${u.videoKey}`,t=r.get(l);if(!t)continue;const d=t.findIndex(g=>g.id===u.id);if(d===-1)continue;let m="";if(d>0){const x=(t[d-1].text||"").split(/[.!?]+\s*/);m=x[x.length-1]?.trim()||""}let f="";if(d<t.length-1&&(f=(t[d+1].text||"").split(/[.!?]+\s*/)[0]?.trim()||""),m||f){const g=[];m&&g.push("..."+m),g.push(u.previewText),f&&g.push(f+"..."),u.previewText=g.join(" ")}}}return o}async function We(s,n,i=[],c=8){const a=await ks(s,i);let o=[];n&&(o=await Rt(n,c,.35));const r=new Set,u=[];for(const l of o){const t=`${l.courseCode}:${l.videoKey}:${l.timestamp}`;r.has(t)||(r.add(t),u.push({...l,searchType:"semantic",score:Math.round(l.similarity*100)}))}for(const l of a)for(const t of l.topSegments||[]){const d=`${l.courseCode}:${t.videoKey}:${t.timestamp}`;r.has(d)||(r.add(d),u.push({id:`kw_${l.courseCode}_${t.videoKey}`,courseCode:l.courseCode,videoKey:t.videoKey,videoTitle:t.videoTitle,timestamp:t.timestamp,startSeconds:t.startSeconds,previewText:t.previewText,similarity:0,score:t.score,searchType:"keyword",source:"transcript"}))}return u.slice(0,c)}const It=60,Et=new Set(["rendering.lumen","rendering.nanite","rendering.virtualShadowMaps","rendering.substrate","worldbuilding.worldPartition"]);function Se(s){return!!(s.videos?.length&&s.videos[0]?.drive_id||s.source==="youtube"&&s.youtube_url||s.source==="epic_docs")}function Mt(s){const n=(s||"").toLowerCase();return/\bue\s*5\b|\bunreal\s*engine\s*5\b|\b5\.\d\b/.test(n)?5:/\bue\s*4\b|\bunreal\s*engine\s*4\b|\b4\.\d{1,2}\b/.test(n)?4:null}async function ps(s,n,i=[],c="",a=[],o=null){if(!n||n.length===0)return[];const r=s?.userQuery||"",u=r.toLowerCase();for(const j of Ys)if(j.patterns.some(T=>u.includes(T))){const T=j.courses.map(A=>{const H=n.find(Y=>Y.code===A);return!H||!Se(H)?null:{...H,_relevanceScore:200,_curatedMatch:!0,_curatedExplanation:j.explanation}}).filter(Boolean);if(T.length>0)return F("‚úÖ Curated solution match:",j.explanation),T}const l=`${r} ${c}`.trim(),t=ye.matchErrorSignature(l),d=t.map(j=>j.tag.tag_id),m=[...new Set([...i,...d])];t.length>0&&F("üîç Error signatures detected:",t.map(j=>`${j.tag.display_name} (${j.matchedSignature}, ${j.confidence})`));const f=ye.extractTagsFromText(r),g=f.matchedTagIds||[];if(g.length>0){F("üè∑Ô∏è Tag taxonomy matches:",f.matches.map(j=>`${j.tagId} (via "${j.matchedTerm}", ${j.matchType})`));for(const j of g)m.includes(j)||m.push(j)}const x=c.toLowerCase().split(/[\s\n:;,()[\]{}]+/).filter(j=>j.length>3&&!/^[0-9]+$/.test(j)).slice(0,10),v=r.toLowerCase().split(/\s+/).filter(j=>j.length>2&&!Pe.has(j)),M=new Set(v),p=r.toLowerCase();for(const[j,y]of Object.entries(Js))if(p.includes(j))for(const T of y)T.split(/\s+/).forEach(A=>{A.length>2&&!Pe.has(A)&&M.add(A)});const N=[...M],C=async j=>!j||j.length<5?[]:(await ks(j,n)).map(T=>{const A=n.find(H=>H.code===T.courseCode);return!A||!Se(A)?null:{...A,_relevanceScore:T.score,_matchedKeywords:T.matchedKeywords}}).filter(Boolean),S=j=>j.length===0?[]:n.filter(Se).map(T=>{const A=(T.title||"").toLowerCase(),H=(T.description||"").toLowerCase(),Y=[...T.canonical_tags||[],...T.gemini_system_tags||[],...T.extracted_tags||[],...T.ai_tags||[]].map(I=>typeof I=="string"?I.toLowerCase():"").join(" ");let D=0;const ne=[];for(const I of j)A.includes(I)?(D+=50,ne.push(I)):Y.includes(I)?(D+=30,ne.push(I)):H.includes(I)&&(D+=10,ne.push(I));if(g.length>0){const I=(T.canonical_tags||[]).map($=>$.toLowerCase());g.some($=>I.some(ce=>ce.includes($.split(".").pop())))&&(D*=3)}const P=new Set(ne).size;P>=2&&(D*=1+P*.3);const Z=j.length>0?P/j.length:1;return j.length>=2&&Z<.5?D*=.3:Z>=1&&(D*=2),D===0?null:{...T,_relevanceScore:D,_matchedKeywords:ne}}).filter(Boolean).sort((T,A)=>A._relevanceScore-T._relevanceScore),E=j=>m.length===0?j:j.map(y=>{const T=y.extracted_tags||y.tags||[],Y=(Array.isArray(T)?T:Object.values(T)).map(D=>typeof D=="string"?D:D.tag_id||D.name||"").filter(Boolean).some(D=>m.some(ne=>D.toLowerCase().includes(ne.toLowerCase())||ne.toLowerCase().includes(D.toLowerCase())));return{...y,_relevanceScore:Y?y._relevanceScore*2:y._relevanceScore*.5}}).sort((y,T)=>T._relevanceScore-y._relevanceScore),L=x.length>0?`${r} ${x.join(" ")}`:r,J=await C(L),Q=x.length>0?[...N,...x]:N,ae=S(Q),w=new Set,b=[];for(const j of J)w.has(j.code)||(b.push(j),w.add(j.code));for(const j of ae)if(!w.has(j.code))b.push(j),w.add(j.code);else{const y=b.find(T=>T.code===j.code);y&&(y._relevanceScore+=j._relevanceScore)}const U=(b.length>0?b[0]._relevanceScore:0)>=It;if(a.length>0){const j=U?60:100,y=U?20:40;for(const T of a)if(w.has(T.code)){const A=b.find(H=>H.code===T.code);A&&(A._relevanceScore+=T.similarity*y)}else{const A=n.find(H=>H.code===T.code);A&&Se(A)&&(b.push({...A,_relevanceScore:T.similarity*j,_matchedKeywords:["semantic-match"],_semanticMatch:!0,_tier:U?2:1}),w.add(T.code))}}b.sort((j,y)=>y._relevanceScore-j._relevanceScore);const W=E(b);if(W.length>=3)return Ge(ze(W.slice(0,5),r),o);const te=[L,s?.diagnosis?.problem_summary,...s?.intent?.systems||[]].filter(Boolean).join(" "),de=te.toLowerCase().split(/\s+/).filter(j=>j.length>2&&!Pe.has(j)),oe=await C(te),X=S(de);for(const j of[...oe,...X])w.has(j.code)||(b.push(j),w.add(j.code));b.sort((j,y)=>y._relevanceScore-j._relevanceScore);const xe=E(b);if(xe.length>=3)return Ge(ze(xe.slice(0,5),r),o);const ve=n.map(j=>{const y=ye.scoreCourseRelevance(j,Q);return{...j,_relevanceScore:y.score,_scoreBreakdown:y.breakdown,_topContributors:y.topContributors}}).filter(j=>j._relevanceScore>0&&Se(j)).sort((j,y)=>y._relevanceScore-j._relevanceScore).slice(0,5);return Ge(ze(E(ve),r),o)}function Ge(s,n){return!n||n.size===0?s:s.map(i=>{const c=n.get(i.code);return c?(F(`üìä Feedback boost: ${i.code} √ó ${c.toFixed(2)}`),{...i,_relevanceScore:i._relevanceScore*c}):i}).sort((i,c)=>c._relevanceScore-i._relevanceScore)}function ze(s,n){const i=Mt(n);return i?s.map(c=>{const o=[...c.canonical_tags||[],...c.gemini_system_tags||[],...c.extracted_tags||[]].map(r=>typeof r=="string"?r.toLowerCase():"").some(r=>[...Et].some(u=>r.includes(u.split(".").pop())));return i===4&&o?(F(`‚¨áÔ∏è UE4 demotion: ${c.code} (has UE5-only tags)`),{...c,_relevanceScore:c._relevanceScore*.2}):i===5&&o?{...c,_relevanceScore:c._relevanceScore*1.5}:c}).sort((c,a)=>a._relevanceScore-c._relevanceScore):s}let He=null;async function Lt(){if(!He){const s=await _e(()=>import("./data-courses-Y_tFOtPD.js").then(n=>n.j),[]);He=s.default||s}return He}const Ke=new Set(["help","helpful","helps","use","used","using","make","made","get","getting","look","going","come","know","thing","work","working","want","need","show","start","take","right","well"]);function fs(s){return s.replace(/ies$/i,"y").replace(/ves$/i,"f").replace(/(s|es|ing|ed|tion|ment)$/i,"").toLowerCase()}function $t(s,n){const c=n.replace(/[-_]/g," ").split(/\s+/).filter(o=>o.length>2).map(fs);return s.map(fs).some(o=>c.some(r=>o.includes(r)||r.includes(o)))}async function gs(s,n,i={}){const c=[],a=(n||"").toLowerCase().split(/\s+/).filter(p=>p.length>2),o=await Lt(),r=[],u=(n||"").toLowerCase(),l=u.split(/\s+/).filter(p=>p.length>2);for(const[p,N]of Object.entries(o))(u.includes(p)||$t(l,p))&&r.push({label:N.label,url:N.url});for(const p of s){if(p.source==="youtube"&&p.youtube_url){const C=i[p.code]||{},S=(()=>{const E=(p._matchedKeywords||[]).filter(L=>L.length>3&&!Ke.has(L.toLowerCase())).slice(0,3);return E.length>0?E:[p.topic||p.tags?.topic||"UE5"].flat().slice(0,3)})();c.push({driveId:p.youtube_url,title:Ae(p.title||p.code),duration:p.duration_seconds||0,courseCode:p.code,courseName:p.title||p.code,matchedTags:S,videoIndex:0,relevanceScore:p._relevanceScore||0,titleRelevance:0,isIntro:!1,timestampHint:null,startSeconds:0,topSegments:[],watchHint:"‚ñ∂ Watch on YouTube",docLinks:r,_curatedMatch:p._curatedMatch||!1,_curatedExplanation:p._curatedExplanation||null,role:C.role||null,reason:C.reason||null,estimatedMinutes:C.estimatedMinutes||null,_source:"youtube",_externalUrl:p.youtube_url,type:"youtube",url:p.youtube_url,channel:p.channel_name||p.channel||null,channelTrust:p.channel_trust||null,topics:p.topics||[],description:p.description||"",durationMinutes:p.duration_seconds?Math.round(p.duration_seconds/60):10});continue}if(p.source==="epic_docs"){const C=p.url||p.youtube_url||"#",S=i[p.code]||{},E=(()=>{const L=(p._matchedKeywords||[]).filter(J=>J.length>3&&!Ke.has(J.toLowerCase())).slice(0,3);return L.length>0?L:[p.topic||p.tags?.topic||"UE5"].flat().slice(0,3)})();c.push({driveId:`doc_${p.code}`,title:Ae(p.title||p.code),duration:0,courseCode:p.code,courseName:p.title||p.code,matchedTags:E,videoIndex:0,relevanceScore:p._relevanceScore||0,titleRelevance:0,isIntro:!1,timestampHint:null,startSeconds:0,topSegments:[],watchHint:"üìñ Read Epic Docs",docLinks:[{label:p.title||"Epic Docs",url:C},...r],_curatedMatch:p._curatedMatch||!1,_curatedExplanation:p._curatedExplanation||null,role:S.role||null,reason:S.reason||null,estimatedMinutes:S.estimatedMinutes||null,_source:"epic_docs",_externalUrl:C,type:"doc",url:C,topics:p.topics||[],description:p.description||"",readTimeMinutes:10});continue}const N=p.videos||[];if(N.length!==0)for(let C=0;C<N.length;C++){const S=N[C];if(!S.drive_id)continue;const E=S.title||S.name||`Video ${C+1}`,L=E.toLowerCase(),J=Ae(E),Q=a.filter(I=>L.includes(I)).length,ae=Q*50,w=await At(p.code,E,C),b=await Pt(p.code,w,a),R=L.includes("intro")||L.includes("introduction")||L.includes("wrap up")||L.includes("outro")||L.includes("overview")||L.includes("getting started")||L.includes("welcome")||L.includes("course intro")||L.includes("what you'll learn")||L.includes("what we'll cover")||L.includes("summary")||L.includes("objectives")||/\bpart\s*a\b/i.test(E)&&C===0,U=R?.15:1,W=!R&&b.topSegments&&b.topSegments.length>0?15:0,B=S.duration_seconds||S.durationSeconds||0,te=B/60,de=te<2?.4:te<5?.7:te>20?1.1:1,oe=new Set;for(const I of b.topSegments||[])for(const q of I.matchedKeywords||[])oe.add(q);const X=oe.size,xe=Q>=2||Q===1&&X>=1?1:X>=2?.8:X===1?.3:Q===1?.5:.15,Ce=(p._relevanceScore||0)*xe,ve=(ae+b.score+W+Ce)*U*de,y=Q===0&&b.score<30?Math.min(ve,40):ve,T=zs(S.drive_id,y);let A="‚ñ∂ Watch full video";const Y=(b.topSegments||[]).filter(I=>!B||I.startSeconds<=B)[0]||(b.bestSegment&&(!B||b.bestSegment.startSeconds<=B)?b.bestSegment:null);if(Y){const I=Y.timestamp||"0:00",q=Y.previewText,$=q.length>60?q.substring(0,57)+"...":q;A=Y.startSeconds<5?`üìç Start of video ‚Äî "${$}"`:`üìç Jump to ${I} ‚Äî "${$}"`}const D=i[p.code]||{},ne=(()=>{const I=(p._matchedKeywords||[]).filter(q=>q.length>3&&!Ke.has(q.toLowerCase())).slice(0,3);return I.length>0?I:[p.topic||p.tags?.topic||"UE5"].flat().slice(0,3)})(),P=b.bestSegment?.startSeconds||0,Z=B&&P>B?0:P;c.push({driveId:S.drive_id,title:J,duration:S.duration_seconds||0,courseCode:p.code,courseName:p.title||p.code,matchedTags:ne,videoIndex:C,relevanceScore:T,titleRelevance:Q,isIntro:R,timestampHint:Z>0&&b.bestSegment?.timestamp||null,startSeconds:Z,topSegments:b.topSegments||[],watchHint:A,docLinks:r,_curatedMatch:p._curatedMatch||!1,_curatedExplanation:p._curatedExplanation||null,role:D.role||null,reason:D.reason||null,estimatedMinutes:D.estimatedMinutes||null})}}const t=new Map;for(const p of c){const N=t.get(p.driveId);(!N||p.relevanceScore>N.relevanceScore)&&t.set(p.driveId,p)}const d=Array.from(t.values());d.sort((p,N)=>N.relevanceScore-p.relevanceScore);const m=new Map,f=2,g=d.filter(p=>{const N=m.get(p.courseCode)||0;return N>=f?!1:(m.set(p.courseCode,N+1),!0)}),x=new Set;for(const p of g)p.isIntro||x.add(p.courseCode);const v=g.filter(p=>!(p.isIntro&&x.has(p.courseCode)));if(v.length>3){const p=v.map(E=>E.relevanceScore),N=p[Math.floor(p.length/2)],C=Math.max(N*.5,10),S=v.filter(E=>E.relevanceScore>=C);if(S.length>=3){const E=S.slice(0,6);return ys(E,a),E}}const M=v.slice(0,6);return ys(M,a),M}function ys(s,n){if(s.length===0)return;const i=Math.max(s[0].relevanceScore,1);for(const c of s){c.matchPercent=Math.min(100,Math.round(c.relevanceScore/i*100));const a=[];if(c._curatedMatch&&a.push("Known solution for this problem"),c.titleRelevance>0){const o=n.filter(r=>(c.title||"").toLowerCase().includes(r)).slice(0,3);o.length>0&&a.push(`Title matches: ${o.join(", ")}`)}if(c.topSegments.length>0){const o=new Set;for(const u of c.topSegments)for(const l of u.matchedKeywords||[])o.add(l);const r=[...o].slice(0,4);r.length>0&&a.push(`Transcript mentions: ${r.join(", ")}`)}c.matchedTags.length>0&&a.length<2&&a.push(`Tagged: ${c.matchedTags.slice(0,3).join(", ")}`),c.matchReason=a.length>0?a.join(" ¬∑ "):"Related to your query"}}async function At(s,n,i){const a=(await is())[s];if(!a?.videos)return null;const o=m=>(m||"").toLowerCase().replace(/\.mp4$/i,"").replace(/_/g," ").replace(/\s+/g," ").trim(),r=o(n),u=r.split(" ").filter(m=>m.length>2),l=Object.keys(a.videos);for(const m of l)if(o(a.videos[m].title||"")===r)return m;let t=null,d=0;for(const m of l){const f=o(a.videos[m].title||""),g=o(m),x=f+" "+g;let v=0;for(const M of u)new RegExp(`(^|\\s|_)${M.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&")}(\\s|_|$)`,"i").test(x)&&v++;v>0&&v>d&&(d=v,t=m)}if(t&&d>=Math.max(1,u.length*.5))return t;for(const m of l){const f=o(a.videos[m].title||""),g=o(m);if(r.includes(f)||f.includes(r)||r.includes(g)||g.includes(r))return m}return i<l.length?l[i]:l[0]||null}async function Pt(s,n,i){const c={score:0,bestSegment:null,topSegments:[]},o=(await is())[s];if(!o?.videos||!n)return c;const r=o.videos[n];if(!r?.segments)return c;const u=[];for(const d of r.segments){const m=d.text.toLowerCase();let f=0;const g=[];for(const x of i)if(m.includes(x)){const v=m.split(x).length-1;f+=v*10,g.push(x)}if(f>0){let x=d.text;if(x.length>100){const v=x.toLowerCase().indexOf(g[0]||"");v>30&&(x="..."+x.substring(v-20)),x.length>100&&(x=x.substring(0,97)+"...")}u.push({timestamp:d.start,startSeconds:d.start_seconds,previewText:x,matchedKeywords:g,score:f})}}u.sort((d,m)=>m.score-d.score);const l=u.slice(0,3);return{score:u.reduce((d,m)=>d+m.score,0),bestSegment:l[0]||null,topSegments:l}}let Qe=null,je=null;function Ot(s,n=768){const i=atob(s),c=new Uint8Array(i.length);for(let r=0;r<i.length;r++)c[r]=i.charCodeAt(r);const a=new DataView(c.buffer),o=new Float32Array(n);for(let r=0;r<n;r++){const u=a.getUint16(r*2,!0);o[r]=qt(u)}return o}function qt(s){const n=s>>15&1,i=s>>10&31,c=s&1023;return i===0?(n?-1:1)*Math.pow(2,-14)*(c/1024):i===31?c?NaN:n?-1/0:1/0:(n?-1:1)*Math.pow(2,i-15)*(1+c/1024)}async function Dt(){if(je)return je;if(!Qe)try{const n=await fetch(new URL("../data/docs_embeddings.json",import.meta.url));if(!n.ok)throw new Error(`HTTP ${n.status}`);Qe=await n.json()}catch(n){return se("‚ö†Ô∏è docs_embeddings.json not available:",n.message),null}const s=Qe?.docs;if(!s)return null;je=new Map;for(const[n,i]of Object.entries(s)){let c;if(typeof i.embedding=="string")c=Ot(i.embedding);else if(Array.isArray(i.embedding))c=new Float32Array(i.embedding);else{se(`[DocsSearch] Skipping doc ${n}: unknown embedding format (${typeof i.embedding})`);continue}je.set(n,{vector:c,slug:i.slug,url:i.url,title:i.title,section:i.section,text:i.text,tokenEstimate:i.token_estimate})}return F(`[DocsSearch] Decoded ${je.size} doc embeddings`),je}async function xs(s,n=5,i=.35){if(!s)return[];const c=await Dt();if(!c)return[];const a=[];for(const[o,r]of c){const u=as(s,r.vector);u>=i&&a.push({id:o,slug:r.slug,url:r.url,title:r.title,section:r.section,previewText:r.text,similarity:u,source:"epic_docs"})}return a.sort((o,r)=>r.similarity-o.similarity),a.slice(0,n)}let Ie=null;async function Rs(){if(Ie)return Ie;try{const s=await _e(()=>import("./data-courses-Y_tFOtPD.js").then(n=>n.j),[]);return Ie=s.default||s,Ie}catch(s){return se("‚ö†Ô∏è doc_links.json not available:",s.message),{}}}const Ee={beginner:0,intermediate:1,advanced:2};function vs(s){return s.replace(/ies$/i,"y").replace(/ves$/i,"f").replace(/(es|s|ing|ed|tion|ment)$/i,"").toLowerCase()}function Me(s,n){const i=s.split(/[\s_-]+/).filter(a=>a.length>2).map(vs),c=n.split(/[\s_-]+/).filter(a=>a.length>2).map(vs);return i.some(a=>c.some(o=>a===o||a.includes(o)||o.includes(a)))}async function Is(s,{maxTier:n="advanced",limit:i=10}={}){const c=await Rs();if(!c||!s?.length)return[];const a=Ee[n]??2,o=s.map(t=>t.toLowerCase()),r=[];for(const[t,d]of Object.entries(c)){if((Ee[d.tier]??1)>a)continue;let f=0;const g=t.toLowerCase(),x=(d.label||"").toLowerCase(),v=(d.url||"").split("/").pop().replace(/-/g," ").toLowerCase(),M=(d.tags||[]).map(C=>C.toLowerCase()),p=(d.description||"").toLowerCase();let N=0;for(const C of o){let S=!1;g===C?(f+=15,S=!0):g.includes(C)?(f+=8,S=!0):C.includes(g)?(f+=6,S=!0):d.subsystem===C?(f+=5,S=!0):x.includes(C)?(f+=6,S=!0):M.includes(C)?(f+=2,S=!0):M.some(E=>E.includes(C)||C.includes(E))?(f+=1,S=!0):v.includes(C)?(f+=2,S=!0):p.includes(C)?(f+=1,S=!0):Me(C,g)?(f+=4,S=!0):Me(C,x)?(f+=3,S=!0):(M.some(E=>Me(C,E))||Me(C,p))&&(f+=1,S=!0),S&&N++}N>=2&&(f+=N*5),f>=3&&r.push({key:t,label:d.label,description:d.description||"",url:d.url,tier:d.tier,subsystem:d.subsystem,readTimeMinutes:d.readTimeMinutes||10,prerequisites:d.prerequisites||[],sections:d.sections||[],keySteps:d.keySteps||[],seeAlso:d.seeAlso||[],_score:f,source:"epic_docs"})}r.sort((t,d)=>d._score!==t._score?d._score-t._score:(Ee[t.tier]??1)-(Ee[d.tier]??1));const u=[];for(const t of r){const d=new Set(t.key.split(/[-_]+/).filter(f=>f.length>2));u.some(f=>{const g=new Set(f.key.split(/[-_]+/).filter(v=>v.length>2));return[...d].filter(v=>g.has(v)).length/Math.min(d.size,g.size)>.6})||u.push(t)}const l=u.length>0?u[0]._score:1;return u.slice(0,i).map(({_score:t,...d})=>({...d,_rawScore:t,matchScore:Math.round(t/Math.max(l,1)*100)}))}async function Ft(s,{limit:n=8}={}){const i=await Rs();if(!i)return[];const c=await Is(s,{limit:n*2});if(!c.length)return[];const a=new Map(c.map(t=>[t.key,t.matchScore??0])),o=new Map(c.map(t=>[t.key,t._rawScore??0])),r=new Set,u=[];function l(t){if(r.has(t))return;r.add(t);const d=i[t];if(d){for(const m of d.prerequisites||[])l(m);u.push({key:t,label:d.label,description:d.description||"",keySteps:d.keySteps||[],seeAlso:d.seeAlso||[],url:d.url,tier:d.tier,subsystem:d.subsystem,readTimeMinutes:d.readTimeMinutes||10,matchScore:a.get(t)??0,_rawScore:o.get(t)??0,source:"epic_docs"})}}for(const t of c)l(t.key);return u.sort((t,d)=>(d._rawScore??0)-(t._rawScore??0)),u.slice(0,n)}const bs={prerequisite:0,core:1,troubleshooting:2,supplemental:3};function Ut(s){return s.estimated_minutes?s.estimated_minutes:s.total_duration_seconds?Math.round(s.total_duration_seconds/60):(s.videos?.length||1)*10}function js(s,n){if(n.size===0)return 0;const i=new Set([...s.canonical_tags||[],...s.gemini_system_tags||[],...s.transcript_tags||[]].map(a=>typeof a=="string"?a.toLowerCase():""));if(i.size===0)return 0;let c=0;for(const a of i)(n.has(a)||n.has(a.split(".").pop()))&&c++;return c/i.size}function Bt(s,n){const i=[...s.canonical_tags||[],...s.gemini_system_tags||[]].map(u=>typeof u=="string"?u.toLowerCase():""),c=new Set(n.map(u=>u.toLowerCase()));let a=!1;for(const u of i)if(c.has(u)||c.has(u.split(".").pop())){a=!0;break}const o=i.some(u=>{const l=ye.getTag(u);return l?.tag_type==="symptom"||l?.tag_type==="error_code"});let r=!1;for(const u of i){const l=ye.edgesBySource?.get(u)||[];for(const t of l)if(t.relation==="subtopic"&&c.has(t.target)){r=!0;break}if(r)break}return r?"prerequisite":o?"troubleshooting":a?"core":"supplemental"}function _s(s,n,i={}){const{timeBudgetMinutes:c=1/0,maxItems:a=8,preferTroubleshooting:o=!1,diversity:r=!0}=i;if(!s||s.length===0)return{path:[],metadata:{totalMinutes:0,tagCoverage:0,diversityScore:1,itemCount:0}};const u=s.map(v=>({course:v,role:Bt(v,n),estimatedMinutes:Ut(v),score:v._relevanceScore||0}));u.sort((v,M)=>{const p=bs[v.role]-bs[M.role];return p!==0?p:M.score-v.score}),o&&u.sort((v,M)=>{const p=v.role==="troubleshooting"?0:1,N=M.role==="troubleshooting"?0:1;return p!==N?p-N:M.score-v.score});const l=[],t=new Set;let d=0;for(const v of u){if(l.length>=a)break;if(d+v.estimatedMinutes>c||r&&l.length>0&&js(v.course,t)>.7)continue;const M=Vt(v,n);l.push({course:v.course,role:v.role,reason:M,estimatedMinutes:v.estimatedMinutes}),d+=v.estimatedMinutes,[...v.course.canonical_tags||[],...v.course.gemini_system_tags||[]].map(N=>typeof N=="string"?N.toLowerCase():"").forEach(N=>{t.add(N),t.add(N.split(".").pop())})}const m=new Set(n.map(v=>v.toLowerCase()));let f=0;for(const v of m)(t.has(v)||t.has(v.split(".").pop()))&&f++;const g=m.size>0?f/m.size:0;let x=1;if(l.length>1){let v=0;const M=new Set;for(const p of l)v+=js(p.course,M),[...p.course.canonical_tags||[]].map(C=>C?.toLowerCase?.()||"").forEach(C=>M.add(C));x=1-v/l.length}return{path:l,metadata:{totalMinutes:d,tagCoverage:Math.round(g*100)/100,diversityScore:Math.round(x*100)/100,itemCount:l.length}}}function Vt(s,n){const{course:i,role:c}=s,a=[...i.canonical_tags||[],...i.gemini_system_tags||[]].map(u=>typeof u=="string"?u.toLowerCase():""),o=new Set(n.map(u=>u.toLowerCase())),r=a.filter(u=>o.has(u)||o.has(u.split(".").pop()));switch(c){case"prerequisite":return`Foundation course ‚Äî covers prerequisite concepts for ${r.slice(0,2).join(", ")}`;case"core":return`Directly covers: ${r.slice(0,3).join(", ")}`;case"troubleshooting":return"Troubleshooting guide ‚Äî addresses symptoms related to your query";case"supplemental":return"Related content ‚Äî expands on topics connected to your query";default:return"Relevant to your search"}}let fe=null;async function Es(){if(fe!=null)return fe;try{const s=await _e(()=>import("./data-courses-Y_tFOtPD.js").then(n=>n.y),[]);return fe=s.default||s,fe}catch{return fe={channels:{},resources:[]},fe}}const Le={beginner:0,intermediate:1,advanced:2};async function Ms(s,{maxTier:n="advanced",limit:i=5}={}){if(!s?.length)return[];const c=await Es();if(!c?.resources?.length)return[];const a=Le[n]??2,o=new Set(s.map(l=>l.toLowerCase())),r=[];for(const l of c.resources){if((Le[l.tier]??1)>a)continue;const d=(l.topics||[]).map(g=>g.toLowerCase()),m=(l.tag_ids||[]).map(g=>g.toLowerCase());let f=0;for(const g of d){o.has(g)&&(f+=5);for(const x of o)(g.includes(x)||x.includes(g))&&(f+=2)}for(const g of m){o.has(g)&&(f+=5);const x=g.split(".");for(const v of x)o.has(v)&&(f+=3)}if(f>0){const g=c.channels?.[l.channelKey];r.push({id:l.id,title:l.title,url:l.url,channelName:g?.name||"Unreal Engine",channelTrust:"official",tier:l.tier,durationMinutes:l.durationMinutes,topics:l.topics,tag_ids:l.tag_ids||[],description:l.description||"",keyTakeaways:l.keyTakeaways||[],chapters:l.chapters||[],source:"epic_youtube",_score:f})}}const u=/\b(ue\s*5|unreal\s*engine\s*5|5\.\d)/i;for(const l of r)l._isUE5=u.test(l.title)||(l.topics||[]).some(t=>u.test(t));return r.sort((l,t)=>l._isUE5!==t._isUE5?l._isUE5?-1:1:t._score!==l._score?t._score-l._score:(Le[l.tier]??1)-(Le[t.tier]??1)),r.slice(0,i).map(({_score:l,_isUE5:t,...d})=>d)}async function Wt(s,{limit:n=5}={}){if(!s?.length)return[];const i=await Es();if(!i?.resources?.length)return[];const c=new Set(s.map(o=>o.toLowerCase())),a=[];for(const o of i.resources){const r=(o.tag_ids||[]).map(l=>l.toLowerCase());let u=0;for(const l of r)c.has(l)&&(u+=5);if(u>0){const l=i.channels?.[o.channelKey];a.push({id:o.id,title:o.title,url:o.url,channelName:l?.name||"Unreal Engine",channelTrust:"official",tier:o.tier,durationMinutes:o.durationMinutes,topics:o.topics,tag_ids:o.tag_ids||[],description:o.description||"",keyTakeaways:o.keyTakeaways||[],chapters:o.chapters||[],source:"epic_youtube",_score:u})}}return a.sort((o,r)=>r._score-o._score),a.slice(0,n).map(({_score:o,...r})=>r)}async function Gt(s,n=[]){if(!s?.length)return{topics:[],firstPartyVideos:0,docsArticles:0,youtubeResources:0,coverageScore:0,gaps:[]};const i=await Is(s,{limit:10}),c=await Ms(s,{limit:10}),a={};for(const l of s){const t=l.toLowerCase(),d=n.filter(x=>{const v=(x.tags||[]).map(p=>p.toLowerCase()),M=(x.title||"").toLowerCase();return v.some(p=>p.includes(t))||M.includes(t)}).length,m=i.filter(x=>x.key?.toLowerCase().includes(t)||x.subsystem?.toLowerCase()===t||x.label?.toLowerCase().includes(t)).length,f=c.filter(x=>{const v=(x.topics||[]).some(p=>p.toLowerCase().includes(t)),M=(x.tag_ids||[]).some(p=>p.toLowerCase().includes(t));return v||M}).length,g=d+m+f;a[l]={firstPartyVideos:d,docsArticles:m,youtubeResources:f,total:g,covered:g>0}}const o=Object.values(a).filter(l=>l.covered).length,r=s.length>0?o/s.length:0,u=Object.entries(a).filter(([,l])=>!l.covered).map(([l])=>l);return{topics:s,topicCoverage:a,firstPartyVideos:n.length,docsArticles:i.length,youtubeResources:c.length,coverageScore:r,gaps:u}}async function zt(s,n=[],{maxDocs:i=5,maxYoutube:c=3}={}){if(!s?.length)return{docs:[],youtube:[],totalTimeMinutes:0,coverageScore:0};const a=await Ft(s,{limit:i}),o=await Ms(s,{limit:c}),r=await Wt(s,{limit:c}),u=new Set(o.map(g=>g.id)),l=[...o];for(const g of r)u.has(g.id)||(l.push(g),u.add(g.id));const t=n.reduce((g,x)=>g+(x.durationMinutes||10),0),d=a.reduce((g,x)=>g+(x.readTimeMinutes||10),0),m=l.reduce((g,x)=>g+(x.durationMinutes||15),0),f=await Gt(s,n);return{docs:a,youtube:l,totalTimeMinutes:t+d+m,coverageScore:f.coverageScore,gaps:f.gaps,externalEnabled:!0}}const os={QUERY_SUBMITTED:"query_submitted",DIAGNOSIS_GENERATED:"diagnosis_generated",LEARNING_PATH_GENERATED:"learning_path_generated"};let Ye=null;function Ht(){return Ye||(Ye=`session_${Date.now()}_${Math.random().toString(36).substring(2,9)}`),Ye}async function cs(s,n={}){try{const i=Ns(),c={event:s,session_id:Ht(),...n,timestamp:Zs(),client_timestamp:new Date().toISOString()};await et(st(i,"analytics_events"),c)}catch(i){se("[Analytics] Failed to track event:",s,i.message)}}function Kt(s,n=[],i=null){return cs(os.QUERY_SUBMITTED,{query_length:s?.length||0,query_preview:s?.substring(0,100),detected_tag_count:n.length,detected_tags:n.slice(0,5),persona_id:i})}function Qt(s){return cs(os.DIAGNOSIS_GENERATED,{diagnosis_id:s?.diagnosis_id,root_causes_count:s?.root_causes?.length||0,signals_count:s?.signals_to_watch_for?.length||0,generalization_scope:s?.generalization_scope?.slice(0,3)})}function Yt(s,n,i=!0){return cs(os.LEARNING_PATH_GENERATED,{fix_specific_count:s?.fix_specific?.length||0,transferable_count:s?.transferable?.length||0,course_count:n?.length||0,passed_validation:i})}const Ls="ue5_video_cart";function Jt(){try{const s=localStorage.getItem(Ls);return s?JSON.parse(s):[]}catch{return[]}}function Je(s){try{localStorage.setItem(Ls,JSON.stringify(s))}catch{}}function $e(s){return s.itemId||s.driveId||s.id||`${s.type}_${s.url}`}function Xt(){const[s,n]=_.useState(Jt),i=_.useCallback(t=>{n(d=>{const m=$e(t);if(d.some(x=>$e(x)===m))return d;const f={...t,itemId:m,type:t.type||"video"},g=[...d,f];return Je(g),g})},[]),c=_.useCallback(t=>{n(d=>{const m=d.filter(f=>$e(f)!==t&&f.driveId!==t);return Je(m),m})},[]),a=_.useCallback(()=>{n([]),Je([])},[]),o=_.useCallback(t=>s.some(d=>$e(d)===t||d.driveId===t),[s]),r=s.filter(t=>(t.type||"video")==="video").length,u=_.useMemo(()=>s.reduce((t,d)=>t+(d.duration||(d.readTimeMinutes||d.durationMinutes||0)*60),0),[s]),l=_.useMemo(()=>{const t={video:[],doc:[],youtube:[]};for(const d of s){const m=d.type||"video";(t[m]||t.video).push(d)}return t},[s]);return{cart:s,addToCart:i,removeFromCart:c,clearCart:a,isInCart:o,videoCount:r,totalDuration:u,itemsByType:l}}const z={INPUT:"input",LOADING:"loading",CLARIFYING:"clarifying",ANSWERED:"answered",DIAGNOSIS:"diagnosis",GUIDED:"guided",ERROR:"error"},Zt=new Set(["the","and","for","are","but","not","you","all","can","has","her","was","one","our","out","its","how","why","with","from","they","been","have","this","that","what","when","your","into","wrong","looks","seems","weird","bad","broken","issue","problem","help","work","working","doesn","isn","getting","keep","keeps"]);function en(){const[s,n]=_.useState(z.INPUT),[i,c]=_.useState(null),[a,o]=_.useState(null),[r,u]=_.useState(null),[l,t]=_.useState([]),[d,m]=_.useState(null),[f,g]=_.useState(null),[x,v]=_.useState(null),[M,p]=_.useState(!1),[N,C]=_.useState(null),[S,E]=_.useState([]),{cart:L,addToCart:J,removeFromCart:Q,clearCart:ae,isInCart:w}=Xt(),b=Ds(),R=_.useMemo(()=>b?.courses||[],[b?.courses]),U=_.useCallback(()=>{try{const y=localStorage.getItem("detected_persona");return y?JSON.parse(y):null}catch{return null}},[]),W=_.useCallback(async(y,T,A,H)=>{try{const D=[...T.diagnosis?.matched_tag_ids||[],...y.detectedTagIds||[]].flatMap(q=>q.split(/[._]/).filter($=>$.length>2&&$!=="unreal"&&$!=="engine")),ne=(y.query||"").toLowerCase().split(/\s+/).filter(q=>q.length>2&&!Zt.has(q)),P=[...new Set(ne)],Z=q=>P.some($=>$.includes(q));Z("mesh")&&!Z("skeletal")&&P.push("static mesh","static meshes","import","importing"),(Z("size")||Z("scale"))&&P.push("scale","transform");const I=[...new Set([...D,...P])].slice(0,15);if(F(`[DocTopics] ${P.join(", ")}`),F(`[AllTopics] ${I.join(", ")}`),P.length>0){const q=await zt(P,A,{maxDocs:5,maxYoutube:3});for(const $ of H)$.type==="doc"&&!q.docs.some(ce=>ce.url===$._externalUrl)&&q.docs.push({label:$.title,url:$._externalUrl||$.url,description:$.description||"",readTimeMinutes:$.readTimeMinutes||10,tier:"intermediate"}),$.type==="youtube"&&!q.youtube.some(ce=>ce.url===$._externalUrl)&&q.youtube.push({title:$.title,url:$._externalUrl||$.url,channelName:$.channel||"YouTube",channelTrust:$.channelTrust||null,durationMinutes:$.durationMinutes||10,tier:"intermediate"});q.docs.sort(($,ce)=>(ce._rawScore??ce.matchScore??0)-($._rawScore??$.matchScore??0)),u(q),F(`[Blended] ${q.docs.length} docs, ${q.youtube.length} YT, coverage: ${(q.coverageScore*100).toFixed(0)}%`)}}catch(Y){se("‚ö†Ô∏è Blended path skipped:",Y.message)}},[]),B=_.useCallback(async(y,T)=>{ae(),n(z.LOADING),o(null),m(null),g(null),C(y);const A=T||x;y.pastedImage&&F("[ProblemFirst] Screenshot attached (base64 length):",y.pastedImage.length),y.errorLog&&F("[ProblemFirst] Error log attached:",y.errorLog.slice(0,200));try{if(y.cachedCartId){F(`[Cache] Checking Firestore for cart: ${y.cachedCartId}`);try{const O=De(),k=Ns(O),re=tt(k,"adaptive_carts",y.cachedCartId),he=await nt(re);if(he.exists()){const ie=he.data(),me=ie.cached_at?.toDate?.()||new Date(ie.created_at||0),le=Date.now()-me.getTime(),pe=1440*60*1e3;if(le<pe){F(`[Cache Hit] Cart is ${Math.round(le/6e4)}min old ‚Äî using cached result`);const K={...ie,userQuery:y.query,retrievedPassages:[]},G=await ps(K,R,y.selectedTagIds||[],y.errorLog||"",[],null);K.matchedCourses=G;const ee=[...K.diagnosis?.matched_tag_ids||[],...y.detectedTagIds||[],...y.selectedTagIds||[]],V=_s(G,ee,{preferTroubleshooting:!0,diversity:!0,timeBudgetMinutes:300}),Ne={};for(const ke of V.path)Ne[ke.course.code]={role:ke.role,reason:ke.reason,estimatedMinutes:ke.estimatedMinutes};const ue=await gs(G,y.query,Ne);if(ue.length>0){t(ue),c(K),n(z.DIAGNOSIS),F(`[Cache] Loaded ${ue.length} videos from cached cart ‚Äî 0 Gemini calls`);return}se("[Cache] Cached cart produced 0 videos ‚Äî falling through to fresh diagnosis")}else F(`[Cache Expired] Cart is ${Math.round(le/36e5)}h old ‚Äî refreshing`)}else F(`[Cache Miss] Cart ${y.cachedCartId} not found in Firestore`)}catch(O){se("[Cache Error] Falling through to fresh diagnosis:",O.message)}}await Kt(y.query,y.detectedTagIds,U()?.id);const H=De(),Y=rt(H,"us-central1");let D=null,ne=[],P=[],Z=[];try{const O=Re(Y,"embedQuery"),k=Re(Y,"expandQuery"),[re,he]=await Promise.allSettled([O({query:y.query}),k({query:y.query})]);if(he.status==="fulfilled"&&he.value.data?.expansions&&(Z=he.value.data.expansions,F(`[QueryExpansion] ${Z.length} variants: ${Z.join(" | ")}`)),re.status==="fulfilled"&&re.value.data?.success&&re.value.data?.embedding){D=re.value.data.embedding;const[ie,me,le]=await Promise.allSettled([wt(D,8,.35),We(y.query,D,[],8),xs(D,6,.35)]);if(ie.status==="fulfilled"?ne=ie.value:se("‚ö†Ô∏è Course semantic search failed:",ie.reason?.message),me.status==="fulfilled"){const K=me.value.map(G=>({text:G.previewText,courseCode:G.courseCode,videoTitle:G.videoTitle,timestamp:G.timestamp,similarity:G.similarity,source:"transcript"}));P.push(...K),F(`[RAG] ${K.length} transcript passages`)}else se("‚ö†Ô∏è Segment search failed:",me.reason?.message);if(le.status==="fulfilled"){const K=le.value.map(G=>({text:G.previewText,url:G.url,title:G.title,section:G.section,similarity:G.similarity,source:"epic_docs"}));P.push(...K),F(`[RAG] ${K.length} doc passages`)}else se("‚ö†Ô∏è Docs search failed:",le.reason?.message);if(Z.length>0){const K=Z.map(V=>We(V,null,[],4).catch(()=>[])),G=await Promise.allSettled(K);let ee=0;for(const V of G)if(V.status==="fulfilled"&&V.value.length>0){const Ne=V.value.map(ue=>({text:ue.previewText,courseCode:ue.courseCode,videoTitle:ue.videoTitle,timestamp:ue.timestamp,similarity:(ue.similarity||0)*.9,source:"transcript"}));P.push(...Ne),ee+=Ne.length}ee>0&&F(`[QueryExpansion] +${ee} passages from expanded queries`)}P.sort((K,G)=>(G.similarity||0)-(K.similarity||0));const pe=new Set;P=P.filter(K=>{const G=(K.text||"").trim().toLowerCase().slice(0,120);return pe.has(G)?!1:(pe.add(G),!0)}),F(`[RAG] Total: ${P.length} passages after rank+dedup (with expansions)`)}}catch(O){se("‚ö†Ô∏è Semantic search skipped:",O.message)}if(P.length>2)try{const k=await Re(Y,"rerankPassages")({query:y.query,passages:P.slice(0,20)});k.data?.success&&k.data?.reranked&&(P=k.data.reranked,k.data.fallback||F("[Rerank] Passages re-ranked by Gemini cross-encoder"))}catch(O){se("‚ö†Ô∏è Re-ranking skipped:",O.message)}P=P.slice(0,8);let I,q=!0;try{const O=Re(Y,"queryLearningPath");let k=await O({query:y.query,mode:"problem-first",detectedTagIds:y.detectedTagIds,personaHint:y.personaHint,retrievedContext:P.slice(0,8),caseReport:A||void 0,conversationHistory:y._conversationHistory||S});if(!k.data.success&&k.data.error==="off_topic"){o(k.data.message||"This doesn't appear to be a UE5 question. Please describe a specific Unreal Engine 5 issue."),n(z.ERROR);return}if(k.data.responseType==="NEEDS_CLARIFICATION"){E(re=>[...re,{role:"assistant",content:k.data.question}]),g({question:k.data.question,options:k.data.options||[],whyAsking:k.data.whyAsking||"",query:k.data.query,caseReport:k.data.caseReport,clarifyRound:k.data.clarifyRound||1,maxClarifyRounds:k.data.maxClarifyRounds||3,conversationHistory:k.data.conversationHistory||[]}),n(z.CLARIFYING);return}if(k.data.responseType==="NEEDS_MORE_CONTEXT"){F(`[AgenticRAG] Cloud function requested ${k.data.searchQueries?.length} targeted searches: ${k.data.searchQueries?.join(" | ")}`);try{const re=(k.data.searchQueries||[]).flatMap(ee=>[We(ee,null,[],4).catch(()=>[]),xs(null,3,.3,ee).catch(()=>[])]),he=await Promise.allSettled(re),ie=[];for(const ee of he)if(!(ee.status!=="fulfilled"||!Array.isArray(ee.value)))for(const V of ee.value)(V.previewText||V.text)&&ie.push({text:V.previewText||V.text||"",courseCode:V.courseCode||"",videoTitle:V.videoTitle||V.title||"",timestamp:V.timestamp||"",similarity:(V.similarity||0)*.85,source:V.url?"epic_docs":"transcript",url:V.url||"",title:V.title||"",section:V.section||""});F(`[AgenticRAG] Found ${ie.length} additional passages`);const me=[...P,...ie],le=new Set,pe=me.filter(ee=>{const V=(ee.text||"").trim().toLowerCase().slice(0,120);return le.has(V)?!1:(le.add(V),!0)});pe.sort((ee,V)=>(V.similarity||0)-(ee.similarity||0));const K=pe.slice(0,12);F(`[AgenticRAG] Re-submitting with ${K.length} enriched passages`);const G=await O({query:y.query,mode:"problem-first",detectedTagIds:y.detectedTagIds,personaHint:y.personaHint,retrievedContext:K,caseReport:A||void 0,conversationHistory:y._conversationHistory||S,agenticRound:k.data.agenticRound||1});G.data?.responseType==="ANSWER"?(k=G,P=K):se("[AgenticRAG] Retry didn't produce ANSWER, using original result")}catch(re){se("[AgenticRAG] Escalation failed, proceeding with best-effort:",re.message)}}if(!k.data.success)throw new Error(k.data.message||"Failed to process query");k.data.responseType==="ANSWER"&&m({mostLikelyCause:k.data.mostLikelyCause,confidence:k.data.confidence,fastChecks:k.data.fastChecks||[],fixSteps:k.data.fixSteps||[],ifStillBrokenBranches:k.data.ifStillBrokenBranches||[],whyThisResult:k.data.whyThisResult||[],evidence:k.data.evidence||[],learnPath:k.data.learnPath}),I=k.data.cart}catch(O){const k=O.message?.includes("429")||O.code==="resource-exhausted";if(O.message?.includes("off_topic")||O.message?.includes("not a UE5")){o(`This doesn't appear to be a UE5 question. Try describing a specific Unreal Engine 5 issue, for example:
‚Ä¢ "Lumen reflections flickering"
‚Ä¢ "Blueprint compile error"
‚Ä¢ "Niagara particles not spawning"`),n(z.ERROR);return}se(`‚ö†Ô∏è Gemini ${k?"rate limited (429)":"error"}: ${O.message}. Falling back to local matching.`),q=!1,I={diagnosis:{problem_summary:y.query,matched_tag_ids:y.detectedTagIds||[]},objectives:[],intent:{systems:[]}}}I.userQuery=y.query,I.retrievedPassages=P,I._localFallback=!q;const $=at(De()).currentUser,ce=$?await Hs($.uid):null,Te=await ps(I,R,y.selectedTagIds||[],y.errorLog||"",ne,ce);I.matchedCourses=Te;const Ps=[...I.diagnosis?.matched_tag_ids||[],...y.detectedTagIds||[],...y.selectedTagIds||[]],Os=_s(Te,Ps,{preferTroubleshooting:!0,diversity:!0,timeBudgetMinutes:300}),ls={};for(const O of Os.path)ls[O.course.code]={role:O.role,reason:O.reason,estimatedMinutes:O.estimatedMinutes};const qe=await gs(Te,y.query,ls),ds=qe.filter(O=>!O.type||O.type==="video"),qs=qe.filter(O=>O.type==="doc"||O.type==="youtube");if(qe.length===0){o(`We couldn't find UE5 content matching your query. Try describing a specific Unreal Engine problem, for example:
‚Ä¢ "Blueprint compile error LNK2019"
‚Ä¢ "Lumen reflections flickering in indoor scene"
‚Ä¢ "Niagara particle system not spawning"
‚Ä¢ "UMG widget not rendering"`),n(z.ERROR);return}t(ds),c(I),await W(y,I,ds,qs),n(d?z.ANSWERED:z.DIAGNOSIS),y.updateCartIdForQuery&&I.cart_id&&(y.updateCartIdForQuery(y.query,I.cart_id),F(`[Cache] Saved cart_id ${I.cart_id} to history for: "${y.query.substring(0,40)}..."`)),await Qt(I.diagnosis),await Yt(I.objectives,Te,I.validation?.approved)}catch(H){console.error("[ProblemFirst] Error:",H),o(H.message||"An unexpected error occurred"),n(z.ERROR)}},[R,U,ae,x,d,W,S]),te=_.useCallback(()=>n(z.INPUT),[]),de=_.useCallback(()=>{n(z.INPUT),c(null),t([]),o(null),u(null),m(null),g(null),v(null),p(!1),E([])},[]),oe=_.useCallback(y=>{if(!N)return;const T=[...S,{role:"user",content:y}];E(T);const A={...N,_conversationHistory:T};B(A,x)},[N,x,B,S]),X=_.useCallback(()=>{if(!N)return;const y=[...S,{role:"user",content:"(skipped ‚Äî proceed with best effort)"}];E(y);const T={...N,_conversationHistory:y};B(T,x)},[N,x,B,S]),xe=_.useCallback(y=>{if(y.solved||!N)return;p(!0);const T={...x||{},exclusions:[...(x||{}).exclusions||[],y.reason||"Previous solution did not work"]};v(T),B(N,T)},[N,x,B]),Ce=_.useCallback(()=>{n(z.DIAGNOSIS)},[]),ve=_.useCallback(y=>{w(y.driveId)?Q(y.driveId):J(y)},[w,J,Q]),j=_.useCallback(()=>{L.length>0&&n(z.GUIDED)},[L]);return{stage:s,diagnosisData:i,error:a,blendedPath:r,videoResults:l,answerData:d,clarifyData:f,isRerunning:M,courses:R,cart:L,addToCart:J,removeFromCart:Q,clearCart:ae,isInCart:w,handleSubmit:B,handleReset:de,handleAskAgain:te,handleClarifyAnswer:oe,handleClarifySkip:X,handleFeedback:xe,handleBackToVideos:Ce,handleVideoToggle:ve,handleWatchPath:j,setCaseReport:v,getDetectedPersona:U}}function sn(s,n,i=null){const c=new Map,a=[];for(const t of s){const d=t.type||"video";if(d==="doc"||d==="youtube"){const f=a.filter(x=>x.startsWith("_doc_")).length===0,g=`_doc_${t.itemId||t.url||t.driveId}`;a.push(g),c.set(g,{course:{code:t.itemId||t.driveId||`${d}_${t.url}`,title:t.title,_readingStep:!0,_resourceType:d,_description:t.description||"",_keySteps:f&&i?.length>0?i:t.keyTakeaways||t.keySteps||[],_seeAlso:t.seeAlso||[],_url:t.url,_tier:t.tier,_channel:t.channel||t.channelName,_channelTrust:t.channelTrust,_subsystem:t.subsystem,_topics:t.topics||[],_sections:t.sections||[],_chapters:t.chapters||[],_readTimeMinutes:t.readTimeMinutes||t.durationMinutes||10,videos:[]}});continue}const m=t.courseCode;if(!c.has(m)){const f=n.find(g=>g.code===m);a.push(m),c.set(m,{course:f?{...f,videos:[]}:{code:m,title:t.courseName,videos:[]},videos:[]})}c.get(m).videos.push({drive_id:t.driveId,title:t.title,duration_seconds:t.duration,_videoIndex:t.videoIndex??999})}const o=a.map(t=>{const d=c.get(t);return d.videos?.length>0&&(d.videos.sort((m,f)=>m._videoIndex-f._videoIndex),d.course.videos=d.videos),d.course}),r=new Set(["100.01","100.02"]),u=o.filter(t=>r.has(t.code)),l=o.filter(t=>!r.has(t.code));return[...u,...l]}function _n(){const{stage:s,diagnosisData:n,error:i,blendedPath:c,videoResults:a,answerData:o,clarifyData:r,isRerunning:u,courses:l,cart:t,addToCart:d,removeFromCart:m,clearCart:f,isInCart:g,handleSubmit:x,handleReset:v,handleAskAgain:M,handleClarifyAnswer:p,handleClarifySkip:N,handleFeedback:C,handleBackToVideos:S,handleVideoToggle:E,handleWatchPath:L,setCaseReport:J,getDetectedPersona:Q}=en();return e.jsxs("div",{className:"problem-first-page",children:[e.jsxs("header",{className:"page-header",children:[e.jsx("h1",{children:"üîß Fix a Problem"}),e.jsx("p",{children:"Describe your issue. We'll diagnose it and show you how to fix it."})]}),(s===z.INPUT||s===z.LOADING)&&e.jsxs("div",{className:"pf-input-layout",children:[e.jsx("div",{className:"pf-input-main",children:e.jsx(Ze,{onSubmit:x,detectedPersona:Q(),isLoading:s===z.LOADING})}),e.jsx("aside",{className:"pf-input-sidebar",children:e.jsx(es,{onUpdate:J,disabled:s===z.LOADING})})]}),s===z.CLARIFYING&&r&&e.jsx(ss,{question:r.question,options:r.options,whyAsking:r.whyAsking,onAnswer:p,onSkip:N,isLoading:!1,clarifyRound:r.clarifyRound||1,maxClarifyRounds:r.maxClarifyRounds||3,conversationHistory:r.conversationHistory||[]}),s===z.ANSWERED&&o&&e.jsx(rs,{answer:o,onFeedback:C,onBackToVideos:S,onStartOver:v,isRerunning:u}),s===z.ERROR&&e.jsxs("div",{className:"error-state",children:[e.jsx("div",{className:"error-icon",children:"‚ö†Ô∏è"}),e.jsx("h3",{children:"Something went wrong"}),e.jsx("p",{children:i}),e.jsx("button",{className:"retry-btn",onClick:v,children:"Try Again"})]}),s===z.DIAGNOSIS&&n&&e.jsxs("div",{className:"shopping-layout",children:[e.jsxs("div",{className:"results-column",children:[e.jsxs("div",{className:"tldr-diagnosis",children:[e.jsxs("div",{className:"tldr-user-query",children:[e.jsx("span",{className:"tldr-query-label",children:"üîç You asked:"}),e.jsx("p",{className:"tldr-query-text",children:n.userQuery})]}),n._localFallback&&e.jsxs("div",{className:"tldr-fallback-notice",style:{background:"rgba(255, 193, 7, 0.1)",border:"1px solid rgba(255, 193, 7, 0.3)",borderRadius:"8px",padding:"8px 14px",margin:"8px 0",fontSize:"0.85rem",color:"var(--text-muted, #aaa)"},children:["‚ö° ",e.jsx("strong",{children:"Fast results"})," ‚Äî AI diagnosis temporarily unavailable. Videos matched by tag taxonomy. Try again in a moment for AI-powered results."]}),n.diagnosis?.problem_summary&&e.jsx("p",{className:"tldr-bridge",children:"Based on your question, we think these videos will help you:"})]}),e.jsxs("h2",{className:"results-title",children:["üé¨ Videos for You (",a.length,")"]}),a.length===0&&e.jsx("div",{className:"no-results",children:e.jsx("p",{children:"No matching videos found. Try rephrasing your question."})}),e.jsx(tn,{videoResults:a,isInCart:g,handleVideoToggle:E,userQuery:n?.userQuery||""}),c?.docs?.length>0&&e.jsx(nn,{docs:c.docs,isInCart:g,addToCart:d,removeFromCart:m}),c?.youtube?.length>0&&e.jsx(an,{youtube:c.youtube,isInCart:g,addToCart:d,removeFromCart:m}),e.jsxs("div",{className:"results-actions-bottom",children:[e.jsx("button",{className:"back-btn",onClick:v,children:"‚Üê Start Over"}),e.jsx("button",{className:"ask-again-btn",onClick:M,children:"+ Ask Another Question"})]})]}),e.jsx("div",{className:"cart-column",children:e.jsx(Ss,{cart:t,onRemove:m,onClear:f,onWatchPath:L})})]}),s===z.GUIDED&&e.jsx(Bs,{courses:sn(t,l,n?.microLesson?.quick_fix?.steps),diagnosis:n?.diagnosis,problemSummary:n?.diagnosis?.problem_summary,pathSummary:n?.pathSummary,microLesson:n?.microLesson,fixRecipe:o?{mostLikelyCause:o.mostLikelyCause,fixSteps:o.fixSteps||[],fastChecks:o.fastChecks||[]}:null,onComplete:()=>{},onExit:()=>S()})]})}const ws=[{key:"prerequisite",icon:"üîó",label:"Prerequisite",desc:"Build the foundation first ‚Äî these cover concepts you'll need before tackling the main topic."},{key:"core",icon:"‚≠ê",label:"Core",desc:"These directly address your question and are the most important videos to watch."},{key:"troubleshooting",icon:"üîß",label:"Troubleshooting",desc:"Debugging helpers ‚Äî watch these if you're hitting errors or unexpected behavior."},{key:"supplemental",icon:"üìö",label:"Supplemental",desc:"Go deeper ‚Äî extra context and advanced techniques for when you're ready."}];function tn({videoResults:s,isInCart:n,handleVideoToggle:i,userQuery:c}){const a={};for(const o of ws)a[o.key]=[];a._other=[];for(const o of s){const r=o.role||"_other";(a[r]||a._other).push(o)}return e.jsxs(e.Fragment,{children:[ws.filter(o=>a[o.key].length>0).map(o=>e.jsxs("div",{className:"role-section",children:[e.jsxs("div",{className:"role-section-header",children:[e.jsxs("h3",{className:"role-section-title",children:[o.icon," ",o.label,e.jsx("span",{className:"role-section-count",children:a[o.key].length})]}),e.jsx("p",{className:"role-section-desc",children:o.desc})]}),e.jsx("div",{className:"video-results-grid",children:a[o.key].map(r=>e.jsx("div",{className:"video-result-wrapper",id:`video-${r.driveId}`,children:e.jsx(Xe,{video:r,isAdded:n(r.driveId),onToggle:i,userQuery:c})},r.driveId))})]},o.key)),a._other.length>0&&e.jsxs("div",{className:"role-section",children:[e.jsxs("div",{className:"role-section-header",children:[e.jsxs("h3",{className:"role-section-title",children:["üìé Related ",e.jsx("span",{className:"role-section-count",children:a._other.length})]}),e.jsx("p",{className:"role-section-desc",children:"Additional videos that may be relevant to your query."})]}),e.jsx("div",{className:"video-results-grid",children:a._other.map(o=>e.jsx("div",{className:"video-result-wrapper",id:`video-${o.driveId}`,children:e.jsx(Xe,{video:o,isAdded:n(o.driveId),onToggle:i,userQuery:c})},o.driveId))})]})]})}function nn({docs:s,isInCart:n,addToCart:i,removeFromCart:c}){return e.jsxs("div",{className:"blended-section",children:[e.jsxs("div",{className:"blended-section-header",children:[e.jsx("h2",{className:"blended-section-title",children:"üìö Recommended Reading"}),e.jsxs("p",{className:"blended-section-desc",children:["Official Unreal Engine documentation to deepen your understanding.",s.reduce((a,o)=>a+(o.readTimeMinutes||10),0)>0&&` (~${s.reduce((a,o)=>a+(o.readTimeMinutes||10),0)} min total read time)`]})]}),e.jsx("div",{className:"doc-cards-grid",children:s.map((a,o)=>{const r=`doc_${a.key||o}`,u=n(r);return e.jsxs("div",{className:`doc-card ${u?"doc-card-added":""}`,children:[e.jsxs("a",{href:a.url,target:"_blank",rel:"noopener noreferrer",className:"doc-card-link",onClick:l=>l.stopPropagation(),children:[e.jsxs("div",{className:"doc-card-header",children:[a.matchScore!=null&&e.jsx(rn,{matchScore:a.matchScore}),e.jsx("span",{className:`tier-badge tier-${a.tier||"intermediate"}`,children:a.tier||"intermediate"}),a.subsystem&&e.jsx("span",{className:"subsystem-tag",children:a.subsystem})]}),e.jsx("h4",{className:"doc-card-title",children:a.label}),a.description&&e.jsx("p",{className:"doc-card-desc",children:a.description}),e.jsxs("div",{className:"doc-card-footer",children:[e.jsx("span",{className:"doc-source-badge",children:"üìÑ Epic Docs"}),e.jsxs("span",{className:"doc-read-time",children:[a.readTimeMinutes||10," min read"]})]})]}),e.jsx("button",{className:`doc-add-btn ${u?"doc-added":""}`,onClick:()=>{u?c(r):i({type:"doc",itemId:r,title:a.label,description:a.description||"",keySteps:a.keySteps||[],seeAlso:a.seeAlso||[],sections:a.sections||[],url:a.url,tier:a.tier||"intermediate",subsystem:a.subsystem,readTimeMinutes:a.readTimeMinutes||10})},title:u?"Remove from path":"Add to learning path",children:u?"‚úì Added":"‚ûï Add"})]},a.key||o)})})]})}function rn({matchScore:s}){const n=s>=90?"best":s>=60?"strong":s>=30?"good":"related",i=s>=90?"Best Match":s>=60?"Strong":s>=30?"Good":"Related";return e.jsxs("span",{className:`doc-match-badge doc-match-${n}`,title:`${s}% relevancy`,children:[e.jsx("span",{className:"doc-match-dot"}),i]})}function an({youtube:s,isInCart:n,addToCart:i,removeFromCart:c}){return e.jsxs("div",{className:"blended-section",children:[e.jsxs("div",{className:"blended-section-header",children:[e.jsx("h2",{className:"blended-section-title",children:"üì∫ Official Epic YouTube"}),e.jsx("p",{className:"blended-section-desc",children:"Official Unreal Engine tutorials from Epic Games."})]}),e.jsx("div",{className:"doc-cards-grid",children:s.map(a=>{const o=a.id||`yt_${a.url}`,r=n(o),u=a.url?.match(/[?&]v=([^&]+)/),l=u?u[1]:null;return e.jsxs("div",{className:`doc-card yt-card-with-thumb ${r?"doc-card-added":""}`,children:[e.jsxs("a",{href:a.url,target:"_blank",rel:"noopener noreferrer",className:"doc-card-link",onClick:t=>t.stopPropagation(),children:[l&&e.jsxs("div",{className:"yt-thumb-wrapper",children:[e.jsx("img",{className:"yt-thumb-img",src:`https://img.youtube.com/vi/${l}/mqdefault.jpg`,alt:a.title,loading:"lazy"}),e.jsxs("span",{className:"yt-thumb-duration",children:[a.durationMinutes," min"]}),e.jsx("span",{className:"yt-thumb-play",children:"‚ñ∂"})]}),e.jsxs("div",{className:"doc-card-header",children:[e.jsx("span",{className:`tier-badge tier-${a.tier||"intermediate"}`,children:a.tier||"intermediate"}),e.jsx("span",{className:"external-badge",children:"Official ‚Ä¢ YouTube"})]}),e.jsx("h4",{className:"doc-card-title",children:a.title}),e.jsxs("div",{className:"doc-card-footer",children:[e.jsxs("span",{className:"doc-source-badge",children:["üì∫ ",a.channelName]}),e.jsxs("span",{className:"doc-read-time",children:[a.durationMinutes," min"]})]})]}),e.jsx("button",{className:`doc-add-btn ${r?"doc-added":""}`,onClick:()=>{r?c(o):i({type:"youtube",itemId:o,title:a.title,description:a.description||"",keyTakeaways:a.keyTakeaways||[],chapters:a.chapters||[],topics:a.topics||[],url:a.url,channelName:a.channelName,channelTrust:a.channelTrust,tier:a.tier||"intermediate",durationMinutes:a.durationMinutes||15})},title:r?"Remove from path":"Add to learning path",children:r?"‚úì Added":"‚ûï Add"})]},a.id)})})]})}function $s({diagnosis:s}){if(!s)return null;const n=s.root_causes?.length||0,i=s.signals_to_watch_for?.length||0,c=s.variables_that_matter?.length||0,a=s.variables_that_do_not?.length||0;return e.jsxs("div",{className:"diagnosis-card",children:[e.jsxs("div",{className:"diagnosis-header",children:[e.jsx("h3",{children:"üî¨ Diagnosis"}),e.jsxs("span",{className:"diagnosis-id",children:["ID: ",s.diagnosis_id?.slice(-8)||"N/A"]})]}),e.jsx("p",{className:"problem-summary",children:s.problem_summary}),e.jsxs("div",{className:"diagnosis-sections",children:[e.jsxs("details",{className:"diagnosis-section root-causes",children:[e.jsxs("summary",{children:[e.jsx("span",{className:"icon",children:"üéØ"}),"Root Causes",e.jsxs("span",{className:"count",children:["(",n,")"]})]}),e.jsx("ul",{children:(s.root_causes||[]).map((o,r)=>e.jsx("li",{children:o},r))})]}),e.jsxs("details",{className:"diagnosis-section signals",children:[e.jsxs("summary",{children:[e.jsx("span",{className:"icon",children:"üëÅÔ∏è"}),"Signals to Watch For",e.jsxs("span",{className:"count",children:["(",i,")"]})]}),e.jsx("ul",{children:(s.signals_to_watch_for||[]).map((o,r)=>e.jsx("li",{children:o},r))})]}),e.jsxs("details",{className:"diagnosis-section variables-matter",children:[e.jsxs("summary",{children:[e.jsx("span",{className:"icon",children:"‚úÖ"}),"Variables That Matter",e.jsxs("span",{className:"count",children:["(",c,")"]})]}),e.jsx("ul",{children:(s.variables_that_matter||[]).map((o,r)=>e.jsx("li",{children:o},r))})]}),e.jsxs("details",{className:"diagnosis-section variables-dont-matter",children:[e.jsxs("summary",{children:[e.jsx("span",{className:"icon",children:"‚ùå"}),"Variables That Don't",e.jsxs("span",{className:"count",children:["(",a,")"]})]}),e.jsx("ul",{children:(s.variables_that_do_not||[]).map((o,r)=>e.jsx("li",{children:o},r))})]}),s.generalization_scope?.length>0&&e.jsxs("details",{className:"diagnosis-section generalization",open:!0,children:[e.jsxs("summary",{children:[e.jsx("span",{className:"icon",children:"üîÑ"}),"Where Else This Applies",e.jsxs("span",{className:"count",children:["(",s.generalization_scope.length,")"]})]}),e.jsx("div",{className:"scope-chips",children:s.generalization_scope.map((o,r)=>e.jsx("span",{className:"scope-chip",children:o},r))})]})]})]})}$s.propTypes={diagnosis:h.shape({diagnosis_id:h.string,problem_summary:h.string,root_causes:h.arrayOf(h.string),signals_to_watch_for:h.arrayOf(h.string),variables_that_matter:h.arrayOf(h.string),variables_that_do_not:h.arrayOf(h.string),generalization_scope:h.arrayOf(h.string)})};$s.defaultProps={diagnosis:null};function on(s){if(!s||s<=0)return null;const n=Math.floor(s/3600),i=Math.floor(s%3600/60);return n>0?i>0?`${n} hr ${i} min`:`${n} hr`:`${i} min`}function cn(s,n=320){const i=s?.drive_id||s?.driveId;return i?`https://drive.google.com/thumbnail?id=${i}&sz=w${n}`:null}function ln(s,n=320){const i=s?.videos?.[0];return cn(i,n)}function As({objectives:s,courses:n,validation:i,onCourseClick:c,onAddToCart:a,isCourseInCart:o}){const{fixCourses:r,learnCourses:u}=_.useMemo(()=>{if(!n||n.length===0)return{fixCourses:[],learnCourses:[]};const t=Math.ceil(n.length/2);return{fixCourses:n.slice(0,t),learnCourses:n.slice(t)}},[n]),l=_.useMemo(()=>i?{approved:i.approved,reason:i.reason,hasIssues:i.issues?.length>0}:null,[i]);return e.jsxs("div",{className:"adaptive-cart",children:[l&&!l.approved&&e.jsxs("div",{className:"validation-warning",children:[e.jsx("span",{className:"icon",children:"‚ö†Ô∏è"}),e.jsxs("div",{className:"content",children:[e.jsx("strong",{children:"Quality Check:"})," ",l.reason,i.suggestions?.length>0&&e.jsx("ul",{className:"suggestions",children:i.suggestions.map((t,d)=>e.jsx("li",{children:t},d))})]})]}),e.jsxs("section",{className:"cart-section fix-now",children:[e.jsxs("div",{className:"section-header",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"icon",children:"üîß"}),"Fix Now"]}),e.jsx("p",{className:"description",children:"These solve your immediate problem:"})]}),e.jsx("div",{className:"objectives-list",children:(s?.fix_specific||[]).map((t,d)=>e.jsxs("div",{className:"objective-item fix",children:[e.jsx("span",{className:"number",children:d+1}),e.jsx("span",{className:"text",children:t})]},d))}),r.length>0&&e.jsx("div",{className:"course-list",children:r.map(t=>e.jsx(Oe,{course:t,type:"fix",onClick:()=>c?.(t),onAddToCart:a,isInCart:o?.(t)},t.id||t.code))})]}),e.jsxs("section",{className:"cart-section learn-forever",children:[e.jsxs("div",{className:"section-header",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"icon",children:"üéì"}),"Learn Forever"]}),e.jsx("p",{className:"description",children:"These help you diagnose similar issues in the future:"})]}),e.jsx("div",{className:"objectives-list transferable",children:(s?.transferable||[]).map((t,d)=>e.jsxs("div",{className:"objective-item transferable",children:[e.jsx("span",{className:"number",children:d+1}),e.jsx("span",{className:"text",children:t}),e.jsx("span",{className:"badge",children:"Transferable"})]},d))}),s?.transferable?.length===0&&e.jsx("div",{className:"empty-warning",children:"‚ö†Ô∏è No transferable objectives generated. This path may not teach reusable skills."}),u.length>0&&e.jsx("div",{className:"course-list",children:u.map(t=>e.jsx(Oe,{course:t,type:"learn",onClick:()=>c?.(t),onAddToCart:a,isInCart:o?.(t)},t.id||t.code))})]}),e.jsxs("div",{className:"cart-summary",children:[e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"value",children:s?.fix_specific?.length||0}),e.jsx("span",{className:"label",children:"Fix Objectives"})]}),e.jsxs("div",{className:"stat highlight",children:[e.jsx("span",{className:"value",children:s?.transferable?.length||0}),e.jsx("span",{className:"label",children:"Transferable Skills"})]}),e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"value",children:n?.length||0}),e.jsx("span",{className:"label",children:"Recommended Courses"})]})]})]})}function Oe({course:s,type:n,onClick:i,onAddToCart:c,isInCart:a}){const[o,r]=_.useState(!1),u=_.useMemo(()=>{if(s.duration)return s.duration;if(s.duration_minutes)return`${s.duration_minutes} min`;if(s.durationMinutes)return`${s.durationMinutes} min`;if(s.videos?.length){const f=s.videos.reduce((g,x)=>g+(x.duration_seconds||0),0);return f>0?on(f):null}return null},[s]),l=_.useMemo(()=>typeof s.difficulty=="string"?s.difficulty:typeof s.difficulty=="number"?["Beginner","Beginner","Intermediate","Intermediate","Advanced","Expert"][s.difficulty]||"Intermediate":s.gemini_skill_level?s.gemini_skill_level:null,[s]),t=_.useMemo(()=>ln(s),[s]),d=s.video_count||s.videos?.length||null,m=f=>{f.stopPropagation(),c?.(s)};return e.jsxs("div",{className:`course-card ${n} ${a?"in-cart":""}`,onClick:i,role:"button",tabIndex:0,onKeyDown:f=>f.key==="Enter"&&i?.(),children:[t&&!o&&e.jsx("div",{className:"course-thumbnail",children:e.jsx("img",{src:t,alt:s.title,loading:"lazy",onError:()=>r(!0)})}),e.jsxs("div",{className:"course-info",children:[e.jsx("h4",{className:"title",children:s.title||s.name}),s.gemini_outcomes?.[0]&&e.jsxs("p",{className:"description",children:[s.gemini_outcomes[0].slice(0,100),"..."]}),e.jsxs("div",{className:"meta",children:[u&&e.jsxs("span",{className:"duration",children:["‚è±Ô∏è ",u]}),d&&e.jsxs("span",{className:"video-count",children:["üé¨ ",d," videos"]}),l&&e.jsx("span",{className:`difficulty ${l.toLowerCase()}`,children:l})]})]}),e.jsx("div",{className:"course-action",children:c?e.jsx("button",{className:`add-btn ${a?"added":""}`,onClick:m,"aria-label":a?"Added to path":"Add to path",children:a?"‚úì Added":"+ Add"}):e.jsx("span",{className:"arrow",children:"‚Üí"})})]})}Oe.propTypes={course:h.shape({id:h.string,code:h.string,title:h.string,name:h.string,description:h.string,duration:h.string,durationMinutes:h.number,difficulty:h.string}).isRequired,type:h.oneOf(["fix","learn"]),onClick:h.func};Oe.defaultProps={type:"fix",onClick:null};As.propTypes={objectives:h.shape({fix_specific:h.arrayOf(h.string),transferable:h.arrayOf(h.string)}),courses:h.arrayOf(h.object),validation:h.shape({approved:h.bool,reason:h.string,issues:h.arrayOf(h.string),suggestions:h.arrayOf(h.string)}),onCourseClick:h.func};As.defaultProps={objectives:null,courses:[],validation:null,onCourseClick:null};export{As as AdaptiveLearningCart,$s as DiagnosisCard,_n as ProblemFirst,Ze as ProblemInput};

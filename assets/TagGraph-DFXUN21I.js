import{j as e}from"./index-D88X6lad.js";import{a as l,w as ne,c as ae,b as ie}from"./vendor-cytoscape-hdah7_Xt.js";import"./vendor-firebase-BQvzIQYL.js";import"./data-courses-Dhl1VM8P.js";function V(r,d,a,W,u){const f=(Math.max(d,Math.min(a,r))-d)/(a-d||1);return W+f*(u-W)}function le(r,d,a){return V(r,d,a,20,60)}function re(r,d,a){return V(r,d,a,3,10)}function ce(r,d,a){return V(r,d,a,.6,1)}const U={scripting:{bg:"#a371f7",border:"#8957e5"},rendering:{bg:"#58a6ff",border:"#1f6feb"},animation:{bg:"#3fb950",border:"#238636"},environment:{bg:"#f0883e",border:"#d47616"},character:{bg:"#f778ba",border:"#db61a2"},multiplayer:{bg:"#56d4dd",border:"#39c5cf"},ai:{bg:"#d29922",border:"#bb8009"},ui:{bg:"#bc8cff",border:"#a371f7"},optimization:{bg:"#ff7b72",border:"#f85149"},cinematic:{bg:"#79c0ff",border:"#58a6ff"},audio:{bg:"#7ee787",border:"#56d364"},procedural:{bg:"#ffa657",border:"#f0883e"},default:{bg:"#8b949e",border:"#6e7681"}};function de(r){if(!r)return U.default;const d=r.split(".")[0]?.toLowerCase();return U[d]||U.default}const he=[{selector:"node",style:{width:"data(size)",height:"data(size)","background-color":"data(bgColor)","border-width":2,"border-color":"data(borderColor)",label:"data(label)","font-size":"10px",color:"#e6edf3","text-valign":"bottom","text-halign":"center","text-margin-y":8,"text-outline-width":2,"text-outline-color":"#0d1117","transition-property":"opacity, background-color, border-color","transition-duration":"0ms","z-index":10}},{selector:"edge",style:{width:"data(width)","line-color":"#58a6ff","curve-style":"bezier",opacity:"data(opacity)","z-index":1}},{selector:"node[!hasConnections]",style:{opacity:.4,"background-color":"#6e7681"}},{selector:"node.highlight",style:{"background-color":"#a371f7","border-color":"#8957e5","border-width":3,"z-index":12}},{selector:"node.neighbor",style:{"background-color":"#3fb950","border-color":"#238636",opacity:1,"z-index":11}},{selector:"node.dimmed",style:{opacity:.15}},{selector:"edge.highlight",style:{"line-color":"#a371f7",opacity:1,"z-index":2}},{selector:"edge.dimmed",style:{opacity:.05}},{selector:"node.focused",style:{"background-color":"#f0883e","border-color":"#d29922","border-width":4,"z-index":13}}],K={name:"cose-bilkent",idealEdgeLength:300,nodeRepulsion:4e4,nestingFactor:.1,gravity:.15,gravityRange:3,numIter:2500,tile:!0,tilingPaddingVertical:80,tilingPaddingHorizontal:80,nodeDimensionsIncludeLabels:!0,randomize:!0,edgeElasticity:.45,componentSpacing:100,nodeOverlap:10,fit:!0,padding:40,quality:"default",stop:void 0};function ue(r,d={}){const{padding:a=20,maxIterations:W=50,gridSize:u=200,stiffness:b=.05,useLabels:f=!0}=d,L=r.map(g=>{const y=g.position(),N=g.boundingBox({includeLabels:f});return{id:g.id(),node:g,x:y.x,y:y.y,originalX:y.x,originalY:y.y,width:N.w,height:N.h,halfWidth:N.w/2+a,halfHeight:N.h/2+a,locked:g.locked(),mass:1}});for(let g=0;g<W;g++){let y=0;const N=new Map;L.forEach((s,E)=>{const R=Math.floor((s.x-s.halfWidth)/u),Y=Math.floor((s.x+s.halfWidth)/u),v=Math.floor((s.y-s.halfHeight)/u),z=Math.floor((s.y+s.halfHeight)/u);for(let m=R;m<=Y;m++)for(let C=v;C<=z;C++){const j=`${m},${C}`;N.has(j)||N.set(j,[]),N.get(j).push(E)}});const D=new Set;if(L.forEach((s,E)=>{if(s.locked)return;const R=Math.floor((s.x-s.halfWidth)/u),Y=Math.floor((s.x+s.halfWidth)/u),v=Math.floor((s.y-s.halfHeight)/u),z=Math.floor((s.y+s.halfHeight)/u);for(let m=R;m<=Y;m++)for(let C=v;C<=z;C++){const j=N.get(`${m},${C}`);if(j)for(const H of j){if(E>=H)continue;const F=`${E}-${H}`;if(D.has(F))continue;D.add(F);const S=L[H];let n=s.x-S.x,I=s.y-S.y;n===0&&I===0&&(n=Math.random()-.5||.01,I=Math.random()-.5||.01);const A=s.halfWidth+S.halfWidth,B=s.halfHeight+S.halfHeight;if(Math.abs(n)<A&&Math.abs(I)<B){const O=A-Math.abs(n),P=B-Math.abs(I);let $=0,X=0;O<P?$=n>0?O:-O:X=I>0?P:-P,S.locked?(s.x+=$,s.y+=X):(s.x+=$*.5,s.y+=X*.5,S.x-=$*.5,S.y-=X*.5),y=Math.max(y,Math.abs($),Math.abs(X))}}}if(!s.locked){const m=s.originalX-s.x,C=s.originalY-s.y;s.x+=m*b,s.y+=C*b}}),y<1)break}const x={};return L.forEach(g=>{x[g.id]={x:g.x,y:g.y}}),x}function ge({tags:r=[],edges:d=[]}){const a=l.useRef(null),W=l.useRef(null),u=l.useRef(null),[b,f]=l.useState(null),[L,x]=l.useState(null),[g,y]=l.useState({x:0,y:0}),[N,D]=l.useState(null),[s,E]=l.useState(null),[R,Y]=l.useState(0),[v,z]=l.useState(""),[m,C]=l.useState(50),[j,H]=l.useState(!1),[F,S]=l.useState(!1),[n,I]=l.useState(null);l.useEffect(()=>{u.current=b},[b]);const{minCount:A,maxCount:B,minWeight:O,maxWeight:P}=l.useMemo(()=>{const t=r.map(c=>c.count),i=d.map(c=>c.weight);return{minCount:Math.min(...t,0),maxCount:Math.max(...t,100),minWeight:Math.min(...i,0),maxWeight:Math.max(...i,100)}},[r,d]),$=l.useMemo(()=>{const i=[...r].sort((o,T)=>T.count-o.count).slice(0,m),c=new Set(i.map(o=>o.id)),k=d.filter(o=>o.weight>=R&&c.has(o.sourceTagId)&&c.has(o.targetTagId)&&o.sourceTagId!==o.targetTagId),w=new Set;k.forEach(o=>{w.add(o.sourceTagId),w.add(o.targetTagId)});const h=i.filter(o=>w.has(o.id)).map(o=>{const T=le(o.count,A,B),G=Math.max(o.label.length*7+40,T),se=T+30,Z=de(o.id);return{data:{id:o.id,label:o.label,count:o.count,size:T,width:G,height:se,hasConnections:w.has(o.id),bgColor:Z.bg,borderColor:Z.border,category:o.id.split(".")[0]||"other"}}}),p=k.map(o=>({data:{id:`${o.sourceTagId}-${o.targetTagId}`,source:o.sourceTagId,target:o.targetTagId,weight:o.weight,width:re(o.weight,O,P),opacity:ce(o.weight,O,P)}}));return[...h,...p]},[r,d,R,m,A,B,O,P]),X=l.useMemo(()=>{if(!v.trim())return[];const t=v.toLowerCase();return r.filter(i=>i.label.toLowerCase().includes(t)).slice(0,10)},[r,v]),Q=l.useCallback((t,i)=>{const c=t.getElementById(i);if(!c||c.length===0)return null;const k=c.data(),w=c.neighborhood("edge"),M=[];return w.forEach(h=>{const p=h.data(),o=p.source===i?p.target:p.source,T=t.getElementById(o);T&&T.length>0&&M.push({id:o,label:T.data("label"),weight:p.weight})}),M.sort((h,p)=>p.weight-h.weight),{label:k.label,count:k.count,neighborCount:M.length,topConnections:M.slice(0,5)}},[]),J=l.useCallback(t=>{a.current=t,setTimeout(()=>S(!0),0)},[]);l.useEffect(()=>{if(!F)return;const t=a.current;if(!t)return;const i=h=>{const p=h.target,o=p.id();if(!u.current){const G=p.closedNeighborhood();p.addClass("highlight"),G.edges().addClass("highlight"),G.nodes().not(p).addClass("neighbor"),t.elements().not(G).addClass("dimmed")}x(o),I(Q(t,o));const T=h.renderedPosition||h.position;y({x:T.x+15,y:T.y-10})},c=()=>{u.current||t.elements().removeClass("highlight neighbor dimmed"),x(null),I(null)},k=h=>{const o=h.target.id();u.current===o?(f(null),t.elements().removeClass("focused highlight neighbor dimmed")):f(o),D(o),E(Q(t,o))},w=h=>{h.target===t&&(f(null),D(null),E(null),t.elements().removeClass("focused highlight neighbor dimmed"))},M=h=>{h.target.isNode&&h.target.isNode()&&y({x:h.renderedPosition.x+15,y:h.renderedPosition.y-10})};return t.on("mouseover","node",i),t.on("mouseout","node",c),t.on("tap","node",k),t.on("tap",w),t.on("mousemove",M),()=>{t.off("mouseover","node",i),t.off("mouseout","node",c),t.off("tap","node",k),t.off("tap",w),t.off("mousemove",M)}},[Q,F]),l.useEffect(()=>{if(!a.current)return;const t=a.current;if(t.elements().removeClass("focused highlight neighbor dimmed"),b){const i=t.getElementById(b);if(i&&i.length>0){const c=i.closedNeighborhood();i.addClass("focused"),c.edges().addClass("highlight"),c.nodes().not(i).addClass("neighbor"),t.elements().not(c).addClass("dimmed")}}},[b]);const _=l.useCallback(()=>{a.current&&a.current.fit(null,50)},[]),q=l.useCallback(()=>{f(null),a.current&&a.current.elements().removeClass("focused highlight neighbor dimmed")},[]),ee=l.useCallback(()=>{if(a.current&&!j){H(!0);const t=a.current.layout(K);t.on("layoutstop",()=>H(!1)),t.run()}},[j]),te=l.useCallback(t=>{if(f(t),z(""),a.current){const i=a.current.getElementById(t);i&&i.length>0&&a.current.animate({center:{eles:i},zoom:1.5,duration:300})}},[]);l.useEffect(()=>{if(!F||!a.current)return;const t=a.current,i=()=>{const c=t.nodes();if(c.length===0)return;const k=ue(c,{padding:30,gridSize:200,maxIterations:50,stiffness:.05});t.batch(()=>{c.forEach(w=>{const M=w.id();k[M]&&w.position(k[M])})})};return t.on("layoutstop",i),t.elements().length>0&&i(),()=>{t.off("layoutstop",i)}},[F,j]),l.useEffect(()=>{const t=i=>{if(!(i.target.tagName==="INPUT"||i.target.tagName==="TEXTAREA"))switch(i.key){case"Escape":q();break;case"f":case"F":_();break;case"+":case"=":a.current&&a.current.zoom(a.current.zoom()*1.2);break;case"-":case"_":a.current&&a.current.zoom(a.current.zoom()*.8);break}};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[q,_]);const oe=l.useCallback(()=>{D(null),E(null)},[]);return{cyRef:a,containerRef:W,focusedNodeId:b,hoveredNode:L,tooltipPosition:g,tooltipData:n,pinnedNode:N,pinnedData:s,minWeightFilter:R,setMinWeightFilter:Y,searchQuery:v,setSearchQuery:z,maxNodesDisplay:m,setMaxNodesDisplay:C,isLayoutRunning:j,maxWeight:P,filteredElements:$,searchResults:X,handleCy:J,handleFitToScreen:_,handleClearFocus:q,handleRunLayout:ee,handleSearchSelect:te,handleUnpin:oe}}ae.use(ie);function xe({tags:r=[],edges:d=[]}){const{containerRef:a,focusedNodeId:W,hoveredNode:u,tooltipPosition:b,tooltipData:f,pinnedNode:L,pinnedData:x,minWeightFilter:g,setMinWeightFilter:y,searchQuery:N,setSearchQuery:D,maxNodesDisplay:s,setMaxNodesDisplay:E,isLayoutRunning:R,maxWeight:Y,filteredElements:v,searchResults:z,handleCy:m,handleFitToScreen:C,handleClearFocus:j,handleRunLayout:H,handleSearchSelect:F,handleUnpin:S}=ge({tags:r,edges:d});return e.jsxs("div",{className:"tag-graph",children:[e.jsxs("div",{className:"graph-controls",children:[e.jsxs("div",{className:"control-group search-group",children:[e.jsx("label",{children:"Search Tags"}),e.jsx("input",{type:"text",placeholder:"Type to search...",value:N,onChange:n=>D(n.target.value)}),z.length>0&&e.jsx("div",{className:"search-results",children:z.map(n=>e.jsxs("button",{className:"search-result-item",onClick:()=>F(n.id),children:[e.jsx("span",{className:"result-label",children:n.label}),e.jsx("span",{className:"result-count",children:n.count})]},n.id))})]}),e.jsxs("div",{className:"control-group",children:[e.jsxs("label",{children:["Min Edge Weight: ",g.toFixed(0)]}),e.jsx("div",{className:"slider-row",children:e.jsx("input",{type:"range",min:0,max:Y,step:1,value:g,onChange:n=>y(Number(n.target.value))})})]}),e.jsxs("div",{className:"control-group",children:[e.jsxs("label",{children:["Show Top ",s===r.length?"All":s," Tags"]}),e.jsxs("div",{className:"slider-row",children:[e.jsx("input",{type:"range",min:10,max:r.length,step:10,value:s,onChange:n=>E(Number(n.target.value))}),e.jsx("button",{className:"show-all-btn",onClick:()=>E(r.length),title:"Show all tags",children:"All"})]})]}),e.jsxs("div",{className:"control-group buttons",children:[e.jsx("button",{onClick:C,title:"Fit graph to screen",children:"ðŸ” Fit"}),e.jsx("button",{onClick:H,disabled:R,title:"Recalculate node positions",children:R?"â³ Running...":"ðŸ”„ Re-layout"}),W&&e.jsx("button",{onClick:j,className:"clear-focus",title:"Deselect the focused node",children:"âœ• Clear Focus"})]}),e.jsxs("div",{className:"graph-stats",children:[e.jsxs("span",{children:["Nodes: ",v.filter(n=>!n.data.source).length]}),e.jsxs("span",{children:["Edges: ",v.filter(n=>n.data.source).length]})]}),e.jsxs("div",{className:"graph-tips",children:["ðŸ’¡ ",e.jsx("strong",{children:"Click"})," node to focus â€¢ ",e.jsx("strong",{children:"Hover"})," for connections â€¢ ",e.jsx("strong",{children:"Esc"})," to reset â€¢ ",e.jsx("strong",{children:"F"})," to fit"]}),e.jsx("div",{className:"category-legend",children:Object.entries(U).filter(([n])=>n!=="default").slice(0,8).map(([n,I])=>e.jsxs("div",{className:"legend-item",children:[e.jsx("span",{className:"legend-dot",style:{backgroundColor:I.bg}}),e.jsx("span",{className:"legend-label",children:n})]},n))})]}),e.jsxs("div",{className:"graph-container",ref:a,children:[e.jsx(ne,{elements:v,stylesheet:he,layout:K,cy:m,style:{width:"100%",height:"calc(100vh - 200px)"},wheelSensitivity:.8,boxSelectionEnabled:!1,autounselectify:!0,userPanningEnabled:!0,userZoomingEnabled:!0,minZoom:.3,maxZoom:3,pan:{x:0,y:0}}),u&&f&&e.jsxs("div",{className:"graph-tooltip",style:{left:b.x,top:b.y},children:[e.jsx("div",{className:"tooltip-header",children:e.jsx("span",{className:"tooltip-label",children:f.label})}),e.jsxs("div",{className:"tooltip-stats",children:[e.jsxs("span",{children:["Count: ",f.count]}),e.jsxs("span",{children:["Connections: ",f.neighborCount]})]}),f.topConnections.length>0&&e.jsxs("div",{className:"tooltip-connections",children:[e.jsx("div",{className:"connections-title",children:"Top Connections:"}),f.topConnections.map(n=>e.jsxs("div",{className:"connection-item",children:[e.jsx("span",{className:"conn-label",children:n.label}),e.jsx("span",{className:"conn-weight",children:n.weight.toFixed(1)})]},n.id))]})]}),L&&x&&e.jsxs("div",{className:"pinned-stats-panel",children:[e.jsxs("div",{className:"pinned-header",children:[e.jsxs("h3",{children:["ðŸ“Œ ",x.label]}),e.jsx("button",{className:"unpin-btn",onClick:S,title:"Unpin",children:"âœ•"})]}),e.jsxs("div",{className:"pinned-stats",children:[e.jsxs("div",{className:"stat-row",title:"Number of courses that include this tag",children:[e.jsx("span",{className:"stat-label",children:"Count:"}),e.jsx("span",{className:"stat-value",children:x.count}),e.jsx("span",{className:"stat-hint",children:"courses with this tag"})]}),e.jsxs("div",{className:"stat-row",title:"Number of other tags that appear together with this tag",children:[e.jsx("span",{className:"stat-label",children:"Connections:"}),e.jsx("span",{className:"stat-value",children:x.neighborCount}),e.jsx("span",{className:"stat-hint",children:"related tags"})]})]}),x.topConnections.length>0&&e.jsxs("div",{className:"pinned-connections",children:[e.jsx("h4",{title:"Tags that most frequently appear together with this tag",children:"Top Connections"}),e.jsx("p",{className:"connections-hint",children:"Tags that often appear together (weight = co-occurrence strength)"}),x.topConnections.map(n=>e.jsxs("div",{className:"pinned-connection-item",title:`Weight ${n.weight.toFixed(0)}: How strongly ${n.label} is associated with ${x.label}`,children:[e.jsx("span",{className:"conn-name",children:n.label}),e.jsx("span",{className:"conn-strength",children:n.weight.toFixed(0)})]},n.id))]})]})]})]})}export{xe as default};

import{g as xe,a as Ie,j as e}from"./index-D51OkiHD.js";import{a as L}from"./vendor-cytoscape-hdah7_Xt.js";import{p as Me}from"./data-courses-CmDFBIif.js";import{s as Te,u as ze,B as Pe,A as se,G as Re,C as Le,b as oe,a as le,V as ce}from"./segmentSearchService-BUV8JveJ.js";import{n as be,m as we}from"./vendor-firebase-DNc0QRT5.js";import{d as H,a as ie}from"./logger-CDyjTpW_.js";import{c as S}from"./createLucideIcon-YhyuTmrv.js";import{C as qe,S as ne}from"./sparkles-DyMeu0iU.js";import{C as Ge}from"./check-eCXpKYRG.js";import{M as $e}from"./message-square-B9rM_FIo.js";import"./feedbackService-B8ZCZPG_.js";import"./x-HbUnH9yy.js";import"./plus-mlfspTQG.js";const Oe=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Ee=S("arrow-left",Oe);const Ke=[["path",{d:"M17 10c.7-.7 1.69 0 2.5 0a2.5 2.5 0 1 0 0-5 .5.5 0 0 1-.5-.5 2.5 2.5 0 1 0-5 0c0 .81.7 1.8 0 2.5l-7 7c-.7.7-1.69 0-2.5 0a2.5 2.5 0 0 0 0 5c.28 0 .5.22.5.5a2.5 2.5 0 1 0 5 0c0-.81-.7-1.8 0-2.5Z",key:"w610uw"}]],De=S("bone",Ke);const Be=[["path",{d:"m18 16 4-4-4-4",key:"1inbqp"}],["path",{d:"m6 8-4 4 4 4",key:"15zrgr"}],["path",{d:"m14.5 4-5 16",key:"e7oirm"}]],He=S("code-xml",Be);const Fe=[["path",{d:"M2.7 10.3a2.41 2.41 0 0 0 0 3.41l7.59 7.59a2.41 2.41 0 0 0 3.41 0l7.59-7.59a2.41 2.41 0 0 0 0-3.41l-7.59-7.59a2.41 2.41 0 0 0-3.41 0Z",key:"1f1r0c"}]],We=S("diamond",Fe);const Ue=[["line",{x1:"6",x2:"10",y1:"11",y2:"11",key:"1gktln"}],["line",{x1:"8",x2:"8",y1:"9",y2:"13",key:"qnk9ow"}],["line",{x1:"15",x2:"15.01",y1:"12",y2:"12",key:"krot7o"}],["line",{x1:"18",x2:"18.01",y1:"10",y2:"10",key:"1lcuu1"}],["path",{d:"M17.32 5H6.68a4 4 0 0 0-3.978 3.59c-.006.052-.01.101-.017.152C2.604 9.416 2 14.456 2 16a3 3 0 0 0 3 3c1 0 1.5-.5 2-1l1.414-1.414A2 2 0 0 1 9.828 16h4.344a2 2 0 0 1 1.414.586L17 18c.5.5 1 1 2 1a3 3 0 0 0 3-3c0-1.545-.604-6.584-.685-7.258-.007-.05-.011-.1-.017-.151A4 4 0 0 0 17.32 5z",key:"mfqc10"}]],Ve=S("gamepad-2",Ue);const Ye=[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]],Qe=S("loader",Ye);const Ze=[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]],Je=S("map",Ze);const Xe=[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]],et=S("palette",Xe);const tt=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],de=S("refresh-cw",tt);const at=[["path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z",key:"m3kijz"}],["path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z",key:"1fmvmk"}],["path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0",key:"1f8sc4"}],["path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5",key:"qeys4"}]],ue=S("rocket",at);const st=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],it=S("target",st);const nt=[["path",{d:"M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978",key:"1n3hpd"}],["path",{d:"M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978",key:"rfe1zi"}],["path",{d:"M18 9h1.5a1 1 0 0 0 0-5H18",key:"7xy6bh"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z",key:"1mhfuq"}],["path",{d:"M6 9H4.5a1 1 0 0 1 0-5H6",key:"tex48p"}]],rt=S("trophy",nt);const ot=[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]],lt=S("wand-sparkles",ot);const ct=[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z",key:"1ngwbx"}]],dt=S("wrench",ct);function ut(u){return Me.personas.find(m=>m.id===u)||null}function me(u){return u?Array.isArray(u.onboardingMessaging)&&u.onboardingMessaging.length>0?u.onboardingMessaging:{gamedev_gary:["ðŸŽ® Industry-standard for AAA and indie games","âš¡ Blueprint visual scripting - no C++ required to start","ðŸŒ Deploy to PC, console, and mobile"]}[u.id]||[]:[]}const mt={indie_isaac:{boostKeywords:["blueprint","gameplay","prototype","interaction","UI","UMG","save game","inventory","input","level design","your first","getting started","project","widget","player controller"],penaltyKeywords:["deep C++","networking","multiplayer","dedicated server","mass production","automotive","archviz"],requiredTopics:["viewport","blueprint","lighting","packaging"]},logic_liam:{boostKeywords:["C++","architecture","systems","framework","subsystem","profiling","optimization","GAS","gameplay ability","replication","networking","debugging","performance","memory","API","programming"],penaltyKeywords:["marketing","brand","product viz","archviz","automotive","configurator"],requiredTopics:["blueprint","C++","profiling"]},animator_alex:{boostKeywords:["animation","sequencer","cinematic","character","mocap","keyframe","motion","camera","performance","acting","lighting","storytelling","retarget"],penaltyKeywords:["networking","multiplayer","dedicated server","automotive","archviz","digital twin","manufacturing"],requiredTopics:["animation","sequencer","lighting"]},rigger_regina:{boostKeywords:["control rig","IK","FK","constraint","deformation","skinning","retarget","skeleton","bone","joint","weight","character","rig","animation"],penaltyKeywords:["networking","multiplayer","automotive","archviz","marketing","brand","digital twin"],requiredTopics:["animation","control rig","character"]},designer_cpg:{boostKeywords:["lighting","materials","lookdev","product viz","motion design","camera","presentation","rendering","photorealistic","studio","environment","scene","visualization"],penaltyKeywords:["deep C++","networking","multiplayer","dedicated server","GAS","gameplay ability","digital twin"],requiredTopics:["lighting","materials","camera"]},architect_amy:{boostKeywords:["archviz","architectural","interior","building","walkthrough","visualization","real estate","photorealistic","twinmotion"],penaltyKeywords:["multiplayer","gameplay","automotive","manufacturing"],requiredTopics:["lighting","materials"]},simulation_sam:{boostKeywords:["simulation","digital twin","training","enterprise","industrial","defense","manufacturing","factory"],penaltyKeywords:["archviz","automotive","gameplay","indie"],requiredTopics:["blueprint","simulation"]},vfx_victor:{boostKeywords:["vfx","effects","compositing","particles","niagara","explosion","destruction","smoke","fire","post-process"],penaltyKeywords:["archviz","automotive","manufacturing","digital twin"],requiredTopics:["niagara","effects"]},automotive_andy:{boostKeywords:["automotive","vehicle","car","configurator","showroom","paint","headlight","wheel","dashboard","lighting studio"],penaltyKeywords:["archviz","gameplay","digital twin","multiplayer"],requiredTopics:["materials","lighting"]}};async function re(u){try{const m=xe(),_=be(m);await we(_,"logTelemetry")({type:"onboarding_rag",...u}),H("[OnboardingTelemetry] Logged:",u.outcome,u)}catch(m){ie("[OnboardingTelemetry] Failed to log:",m.message)}}const ae="idle",pe="planning",he="searching",ge="assembling",fe="done",ye="error";function pt(){const[u,m]=L.useState(ae),[_,c]=L.useState(null),[s,y]=L.useState(null),g=L.useCallback(async o=>{m(pe),c(null),y(null);const N=xe(),v=be(N),x=we(v,"queryLearningPath"),Y=Date.now();try{H("[OnboardingRAG] Step 1 â€” Calling Planner CF...");const F=(await x({persona:o,mode:"onboarding",onboardingStep:"plan"})).data;if(!F?.success)throw new Error(F?.error||"Planner failed");const{searchQueries:h=[],archetype:Q="unknown"}=F;H("[OnboardingRAG] Planner returned:",{searchQueries:h,archetype:Q}),m(he),H("[OnboardingRAG] Step 2 â€” Running local segment search...");let q=[];for(const T of h.slice(0,5))try{const W=(await Te(T,null,[],4)).map(z=>({videoTitle:z.videoTitle||z.courseTitle||"Unknown",courseCode:z.courseCode||"unknown",videoId:z.videoKey||z.videoId||"",timestamp:z.timestamp||"0:00",text:z.topSegments?.[0]?.preview||z.text||""}));q.push(...W)}catch(O){ie(`[OnboardingRAG] Search failed for "${T}":`,O.message)}const J=new Set;q=q.filter(T=>{const O=`${T.courseCode}::${T.videoId}`;return J.has(O)?!1:(J.add(O),!0)}),H(`[OnboardingRAG] Retrieved ${q.length} unique passages`),m(ge),H("[OnboardingRAG] Step 3 â€” Calling Assembler CF...");const I=(await x({persona:o,mode:"onboarding",onboardingStep:"assemble",archetype:Q,passages:q.slice(0,15)})).data;if(!I?.success)throw new Error(I?.error||"Assembler failed");return H("[OnboardingRAG] Curriculum ready:",I.curriculum?.title),re({outcome:"rag_success",archetype:Q,passagesFound:q.length,modulesReturned:(I.curriculum?.modules||[]).length,searchQueries:h.length,pipelineDurationMs:Date.now()-Y}),c({...I,passages:q}),m(fe),{...I,passages:q}}catch(j){return ie("[OnboardingRAG] Pipeline error:",j.message),re({outcome:"rag_fallback",errorMessage:j.message||"Unknown error",pipelineDurationMs:Date.now()-Y}),y(j.message||"Something went wrong"),m(ye),null}},[]),k=L.useCallback(()=>{m(ae),c(null),y(null)},[]);return{generateRAGPath:g,resetRAG:k,ragState:u,ragResult:_,ragError:s,RAG_STATES:{IDLE:ae,PLANNING:pe,SEARCHING:he,ASSEMBLING:ge,DONE:fe,ERROR:ye}}}function ht({docs:u,isInCart:m,addToCart:_,removeFromCart:c}){return u?.length?e.jsxs("div",{className:"blended-section",children:[e.jsxs("div",{className:"blended-section-header",children:[e.jsx("h2",{className:"blended-section-title",children:"ðŸ“š Recommended Reading"}),e.jsx("p",{className:"blended-section-desc",children:"Official Unreal Engine documentation related to your learning path."})]}),e.jsx("div",{className:"doc-cards-grid",children:u.map((s,y)=>{const g=`doc_${s.key||y}`,k=m(g);return e.jsxs("div",{className:`doc-card ${k?"doc-card-added":""}`,children:[e.jsxs("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"doc-card-link",onClick:o=>o.stopPropagation(),children:[e.jsxs("div",{className:"doc-card-header",children:[e.jsx("span",{className:`tier-badge tier-${s.tier||"intermediate"}`,children:s.tier||"intermediate"}),s.subsystem&&e.jsx("span",{className:"subsystem-tag",children:s.subsystem})]}),e.jsx("h4",{className:"doc-card-title",children:s.label}),s.description&&e.jsx("p",{className:"doc-card-desc",children:s.description}),e.jsxs("div",{className:"doc-card-footer",children:[e.jsx("span",{className:"doc-source-badge",children:"ðŸ“„ Epic Docs"}),e.jsxs("span",{className:"doc-read-time",children:[s.readTimeMinutes||10," min read"]})]})]}),e.jsx("button",{className:`doc-add-btn ${k?"doc-added":""}`,onClick:()=>{k?c(g):_({type:"doc",itemId:g,title:s.label,description:s.description||"",keySteps:s.keySteps||[],seeAlso:s.seeAlso||[],sections:s.sections||[],url:s.url,tier:s.tier||"intermediate",subsystem:s.subsystem,readTimeMinutes:s.readTimeMinutes||10})},title:k?"Remove from path":"Add to learning path",children:k?"âœ“ Added":"âž• Add"})]},s.key||y)})})]}):null}function gt({youtube:u,isInCart:m,addToCart:_,removeFromCart:c}){return u?.length?e.jsxs("div",{className:"blended-section",children:[e.jsxs("div",{className:"blended-section-header",children:[e.jsx("h2",{className:"blended-section-title",children:"ðŸ“º Official Epic YouTube"}),e.jsx("p",{className:"blended-section-desc",children:"Official Unreal Engine tutorials from Epic Games."})]}),e.jsx("div",{className:"doc-cards-grid",children:u.map(s=>{const y=s.id||`yt_${s.url}`,g=m(y),k=s.url?.match(/[?&]v=([^&]+)/),o=k?k[1]:null;return e.jsxs("div",{className:`doc-card yt-card-with-thumb ${g?"doc-card-added":""}`,children:[e.jsxs("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"doc-card-link",onClick:N=>N.stopPropagation(),children:[o&&e.jsxs("div",{className:"yt-thumb-wrapper",children:[e.jsx("img",{className:"yt-thumb-img",src:`https://img.youtube.com/vi/${o}/mqdefault.jpg`,alt:s.title,loading:"lazy"}),e.jsxs("span",{className:"yt-thumb-duration",children:[s.durationMinutes," min"]}),e.jsx("span",{className:"yt-thumb-play",children:"â–¶"})]}),e.jsxs("div",{className:"doc-card-header",children:[e.jsx("span",{className:`tier-badge tier-${s.tier||"intermediate"}`,children:s.tier||"intermediate"}),e.jsx("span",{className:"external-badge",children:"Official â€¢ YouTube"})]}),e.jsx("h4",{className:"doc-card-title",children:s.title}),e.jsxs("div",{className:"doc-card-footer",children:[e.jsxs("span",{className:"doc-source-badge",children:["ðŸ“º ",s.channelName]}),e.jsxs("span",{className:"doc-read-time",children:[s.durationMinutes," min"]})]})]}),e.jsx("button",{className:`doc-add-btn ${g?"doc-added":""}`,onClick:()=>{g?c(y):_({type:"youtube",itemId:y,title:s.title,description:s.description||"",keyTakeaways:s.keyTakeaways||[],chapters:s.chapters||[],topics:s.topics||[],url:s.url,channelName:s.channelName,channelTrust:s.channelTrust,tier:s.tier||"intermediate",durationMinutes:s.durationMinutes||15})},title:g?"Remove from path":"Add to learning path",children:g?"âœ“ Added":"âž• Add"})]},s.id)})})]}):null}const ve=[{key:"prerequisite",icon:"ðŸ”—",label:"Prerequisite",desc:"Build the foundation first â€” these cover concepts you'll need before tackling the main topic."},{key:"core",icon:"â­",label:"Core",desc:"These directly address your learning goals and are the most important courses to watch."},{key:"supplemental",icon:"ðŸ“š",label:"Supplemental",desc:"Go deeper â€” extra context and advanced techniques for when you're ready."}];function ft({courses:u,isInCart:m,addToCart:_,removeFromCart:c,userQuery:s}){const y=u.map(o=>{const N=(o.title||o.name||"").replace(/_/g," "),v=N.toLowerCase(),x=o.videos?.[0]?.drive_id||o.driveId||o.code||`course-${o.order}`,j=o.code?.startsWith("100")||v.includes("quickstart")||v.includes("introduction")||v.includes("intro ")||v.includes("getting started")||v.includes("your first")?"prerequisite":o.quickWin?"core":"supplemental";return{course:o,video:{title:N,duration:(o.duration||45)*60,driveId:x,courseCode:o.code,role:j,reason:o.learningOutcome||"",matchPercent:o.matchScore||75,matchedTags:o.matchedTags||[]}}}),g={};for(const o of ve)g[o.key]=[];g._other=[];for(const o of y){const N=o.video.role||"_other";(g[N]||g._other).push(o)}const k=y.length;return e.jsxs(e.Fragment,{children:[e.jsxs("h2",{className:"results-title",children:["ðŸŽ¬ Videos for You (",k,")"]}),ve.filter(o=>g[o.key].length>0).map(o=>e.jsxs("div",{className:"role-section",children:[e.jsxs("div",{className:"role-section-header",children:[e.jsxs("h3",{className:"role-section-title",children:[o.icon," ",o.label,e.jsx("span",{className:"role-section-count",children:g[o.key].length})]}),e.jsx("p",{className:"role-section-desc",children:o.desc})]}),e.jsx("div",{className:"video-results-grid",children:g[o.key].map(({course:N,video:v})=>e.jsx("div",{className:"video-result-wrapper",id:`video-${v.driveId}`,children:e.jsx(ce,{video:v,isAdded:m(v.driveId),onToggle:x=>{m(x.driveId)?c(x.driveId):_({...N,driveId:x.driveId,itemId:x.driveId,title:x.title,duration:x.duration,type:"video"})},userQuery:s})},v.driveId))})]},o.key)),g._other.length>0&&e.jsxs("div",{className:"role-section",children:[e.jsxs("div",{className:"role-section-header",children:[e.jsxs("h3",{className:"role-section-title",children:["ðŸ“Ž Related ",e.jsx("span",{className:"role-section-count",children:g._other.length})]}),e.jsx("p",{className:"role-section-desc",children:"Additional videos that may be relevant to your learning goals."})]}),e.jsx("div",{className:"video-results-grid",children:g._other.map(({course:o,video:N})=>e.jsx("div",{className:"video-result-wrapper",id:`video-${N.driveId}`,children:e.jsx(ce,{video:N,isAdded:m(N.driveId),onToggle:v=>{m(v.driveId)?c(v.driveId):_({...o,driveId:v.driveId,itemId:v.driveId,title:v.title,duration:v.duration,type:"video"})},userQuery:s})},N.driveId))})]})]})}const $=[{id:"startPrompt",question:"What do you want to learn in UE5?",subtitle:"Describe in your own words (optional â€” helps personalize your path)",type:"freetext",placeholder:"e.g. I want to make a small RPG with inventory and combat..."},{id:"role",question:"Which best describes your role?",subtitle:"This determines your learning persona",type:"choice",options:[{value:"indie_isaac",label:"Indie Game Dev",description:"Solo/small-team â€” prototype fast, ship it",icon:Ve},{value:"logic_liam",label:"Games Programmer",description:"Architecture, systems, performance",icon:He},{value:"animator_alex",label:"Animator / Film Artist",description:"Cinematics, sequencer, real-time previews",icon:qe},{value:"rigger_regina",label:"Rigger / Character TD",description:"Control Rig, deformation, retargeting",icon:De},{value:"designer_cpg",label:"Designer (Retail/CPG)",description:"Product viz, lighting, stunning visuals",icon:We}]},{id:"experience",question:"How many years of 3D / game engine experience do you have?",type:"choice",options:[{value:"beginner",label:"0â€“1 years",description:"Brand new to 3D or engines",icon:ne},{value:"junior",label:"2â€“5 years",description:"Used Maya, Blender, or another engine",icon:et},{value:"mid",label:"5â€“10 years",description:"Professional with shipped work",icon:lt},{value:"senior",label:"10+ years",description:"Senior / lead level",icon:dt}]},{id:"goal",question:"What do you want to achieve in your first 10 hours?",type:"choice",options:[{value:"explore",label:"Explore and understand UE5",icon:Je},{value:"project",label:"Start a specific project",icon:it},{value:"skill",label:"Learn a specific skill",icon:Pe},{value:"portfolio",label:"Build a portfolio piece",icon:rt},{value:"transition",label:"Transition from another tool",icon:se}]}];function Mt(){const{courses:u}=Ie(),[m,_]=L.useState(0),[c,s]=L.useState({startPrompt:"",role:null,experience:null,goal:null}),[y,g]=L.useState(null),[k,o]=L.useState(null),{generateRAGPath:N,resetRAG:v,ragState:x,ragError:Y,RAG_STATES:j}=pt(),F=[j.PLANNING,j.SEARCHING,j.ASSEMBLING].includes(x),h=L.useMemo(()=>c.role?ut(c.role):null,[c.role]),Q=()=>{const n=$[1].options.find(C=>C.value===c.role),b=$[2].options.find(C=>C.value===c.experience),w=$[3].options.find(C=>C.value===c.goal);return[c.startPrompt?`Goal: ${c.startPrompt}.`:"",`Role: ${n?.label||c.role}.`,`Experience: ${b?.label||c.experience}.`,`Objective: ${w?.label||c.goal}.`].filter(Boolean).join(" ")},q=async()=>{h&&localStorage.setItem("detected_persona",JSON.stringify(h));const n=Q(),b=h?`${h.name} â€” ${h.industry}`:"General",w=await N(n,b);if(w?.curriculum?.modules?.length>0){const D=w.passages||[],C={};D.forEach(t=>{t.videoTitle&&(C[t.videoTitle.toLowerCase()]=t),t.videoId&&(C[t.videoId.toLowerCase()]=t)});const U=t=>{if(!u||!t)return null;const r=t.toLowerCase();return u.find(d=>d.videos?.some(a=>{const l=(a.title||a.name||"").toLowerCase();return l===r||l.includes(r)||r.includes(l)}))},V=(t,r)=>{const d=new Set(["the","and","for","are","with","from","this","that","your","into","how","can","will","has","was","been","have","what","when","not","unreal","engine","ue5","learn","using","about","getting","started","introduction","overview","course","module","lesson","video"]),a=(t||"").toLowerCase().split(/[\s\-_/()]+/).filter(f=>f.length>2&&!d.has(f)),l=(r||"").toLowerCase().split(/[\s\-_/()]+/).filter(f=>f.length>2&&!d.has(f));if(a.length===0||l.length===0)return 0;let p=0;for(const f of a)for(const M of l){if(f===M){p++;break}if(f.length>4&&M.length>4&&(f.includes(M)||M.includes(f))){p+=.5;break}}return p/Math.max(a.length,l.length)},P=new Set,G=(w.curriculum.modules||[]).map(t=>{let r=null;if(t.videoId&&u&&(r=u.find(a=>!P.has(a.title)&&a.videos?.some(l=>l.drive_id&&(l.title===t.videoId||l.name===t.videoId||l.drive_id===t.videoId)))),!r){const a=(t.videoId||"").toLowerCase(),l=C[a];l?.videoTitle&&(r=U(l.videoTitle),r&&P.has(r.title)&&(r=null))}if(!r&&u){let a=0,l=null;for(const p of D){if(!p.videoTitle)continue;const f=U(p.videoTitle);if(!f||P.has(f.title))continue;const M=V(t.title+" "+(t.description||""),p.videoTitle);M>a&&M>=.15&&(a=M,l=f)}r=l}if(!r&&u){let a=0,l=null;for(const p of u){if(P.has(p.title)||!p.videos?.length||!p.videos[0]?.drive_id)continue;const f=V(t.title+" "+(t.description||""),p.title||p.name||"");f>a&&f>=.15&&(a=f,l=p)}r=l}return r&&P.add(r.title),r?{...r,ragTitle:t.title,ragDescription:t.description,enriched:!0}:{title:t.title,name:t.title,description:t.description,code:`rag-${t.title.replace(/\s+/g,"-").toLowerCase().slice(0,30)}`,videos:[],enriched:!1}}),A=G.filter(t=>t.enriched&&t.videos?.length>0&&t.videos[0]?.drive_id),Z={indie_isaac:"games",logic_liam:"games",animator_alex:"animation",rigger_regina:"animation",designer_cpg:"visualization",architect_amy:"architecture",simulation_sam:"simulation",vfx_victor:"vfx",automotive_andy:"automotive"}[h?.id]||"general",i=A.filter(t=>{const r=(t.tags?.industry||"general").toLowerCase(),d=(t.title||t.name||"").toLowerCase();if(r!=="general"&&r!==Z)return!1;const a=[{match:["automotive","vehicle design","configurator","car paint","vred"],allow:["automotive"]},{match:["archviz","architectural","twinmotion","for architecture","aeco"],allow:["architecture","visualization"]},{match:["legacy production","virtual production","broadcast","icvfx","ndisplay"],allow:["animation","vfx","film","media"]}];for(const l of a)if(l.match.some(p=>d.includes(p))&&!l.allow.includes(Z))return!1;return!0});if(re({outcome:"enrichment",totalModules:G.length,enrichedCount:i.length,enrichmentRate:G.length>0?Math.round(i.length/G.length*100):0}),i.length>=3){let t=0;const r=i.slice(0,8).map((d,a)=>{const l=d.duration||45;t+=l;const p=oe(d.videos,d.ai_tags);return{...d,order:a+1,cumulativeTime:t,milestone:t>=120&&t<180?"2hr":t>=300&&t<360?"5hr":t>=600?"10hr":null,quickWin:a<2,learningOutcome:p}});g({persona:h,courses:r,totalTime:t,messaging:me(h),source:"rag"});try{const d=r.flatMap(a=>[...a.ai_tags?.topics||[],...(a.tag_ids||[]).flatMap(l=>l.split(".")),...a.tags?.subsystem?[a.tags.subsystem]:[],...a.tags?.feature?[a.tags.feature]:[],...Object.values(a.tags||{}).filter(l=>typeof l=="string"&&l.length>2),...(a.title||a.name||"").split(/[\s_-]+/).filter(l=>l.length>3)]).map(a=>a.toLowerCase()).filter((a,l,p)=>p.indexOf(a)===l&&!["introduction","unreal","engine","workshop","first","project","games","your","quickstart"].includes(a)).slice(0,15);if(d.length>0){const a=await le(d,[],{maxDocs:5,maxYoutube:3});o(a)}}catch(d){console.warn("[Personas] Blended path fetch failed:",d.message)}return}}await J()},J=async()=>{if(!h||!u)return;const n=mt[h.id]||{boostKeywords:h.keywords||[],penaltyKeywords:[],requiredTopics:[]},b=c.experience||"beginner",w={beginner:["beginner","","general"],junior:["beginner","","general","intermediate"],mid:["beginner","","general","intermediate"],senior:["beginner","","general","intermediate","advanced"]},D=w[b]||w.beginner,C=u.filter(i=>{const t=(i.tags?.level||"").toLowerCase();return D.includes(t)}).filter(i=>i.videos?.length>0&&i.videos[0]?.drive_id),U=b==="junior",P=C.map(i=>{let t=0;const r=[...Array.isArray(i.ai_tags)?i.ai_tags:[],...Array.isArray(i.canonical_tags)?i.canonical_tags:[]];i.tags?.topic&&r.push(i.tags.topic),i.tags?.industry&&r.push(i.tags.industry);const d=r.map(R=>typeof R=="string"?R.toLowerCase():""),a=(i.title||i.name||"").toLowerCase(),l=`${a} ${d.join(" ")}`;for(const R of n.boostKeywords){const B=R.toLowerCase();a.includes(B)&&(t+=5),d.some(te=>te.includes(B))&&(t+=3)}for(const R of n.penaltyKeywords){const B=R.toLowerCase();l.includes(B)&&(t-=10)}const p=(i.tags?.industry||"general").toLowerCase(),M={indie_isaac:"games",logic_liam:"games",animator_alex:"animation",rigger_regina:"animation",designer_cpg:"visualization",architect_amy:"architecture",simulation_sam:"simulation",vfx_victor:"vfx",automotive_andy:"automotive"}[h.id]||"general";p!=="general"&&p!==M&&(t-=200),p===M&&p!=="general"&&(t+=15);const Ae=[{match:["legacy production","virtual production","broadcast","live action","compositing","stage operator","icvfx","ndisplay","cinematography","film production","in-camera","on-set"],allowPersonas:["animation","vfx","film","media"]},{match:["for automotive","automotive","vehicle design","configurator","car paint","vred"],allowPersonas:["automotive"]},{match:["archviz","architectural","twinmotion","for architecture","for design","aeco"],allowPersonas:["architecture","design"]},{match:["digital twin","crowd simulation"],allowPersonas:["simulation","enterprise"]},{match:["manufacturing","factory","assembly line"],allowPersonas:["manufacturing","enterprise"]}];for(const R of Ae)if(R.match.some(te=>a.includes(te))&&!R.allowPersonas.includes(M)){t-=200;break}if((a.includes("executive")||a.includes("leadership")||a.includes("management overview"))&&(t-=30),b==="beginner"){const R=["multiplayer","networking","dedicated server","optimization","profiling","c++ programming","source control","packaging","deployment"];for(const B of R)l.includes(B)&&(t-=15)}i.code?.startsWith("100")&&(t+=40),a.includes("introduction")&&(t+=50),a.includes("intro")&&!a.includes("introduction")&&(t+=40),(a.includes("quickstart")||a.includes("your first"))&&(t+=35),a.includes("getting started")&&(t+=30),a.includes("fundamental")&&t>=0&&(t+=10);const Se=oe(i.videos,i.ai_tags);return{...i,relevanceScore:t,learningOutcome:Se}}).sort((i,t)=>t.relevanceScore-i.relevanceScore),G=new Set;let A=P.filter(i=>{const t=(i.title||i.name||"").toLowerCase().replace(/\s+for\s+(games|automotive|aec|architecture|simulation|film).*$/i,"").replace(/[^a-z0-9]/g,"").replace(/\d+$/g,"");return G.has(t)?!1:(G.add(t),!0)});if(U){let i=0;const t=3;A=A.filter(r=>{if((r.tags?.level||"").toLowerCase()==="intermediate"){if(i>=t)return!1;i++}return!0})}if(A=A.filter(i=>i.videos?.length>0&&i.videos.some(t=>t.drive_id)),A=A.slice(0,8),n.requiredTopics&&n.requiredTopics.length>0){for(const i of n.requiredTopics){const t=i.toLowerCase();if(!A.some(d=>{const a=(d.title||d.name||"").toLowerCase(),l=[...Array.isArray(d.ai_tags)?d.ai_tags:[],...Array.isArray(d.canonical_tags)?d.canonical_tags:[]].map(p=>typeof p=="string"?p.toLowerCase():"").join(" ");return a.includes(t)||l.includes(t)})){const d=P.find(a=>{if(A.some(f=>f.code===a.code))return!1;const l=(a.title||a.name||"").toLowerCase(),p=[...Array.isArray(a.ai_tags)?a.ai_tags:[],...Array.isArray(a.canonical_tags)?a.canonical_tags:[]].map(f=>typeof f=="string"?f.toLowerCase():"").join(" ");return l.includes(t)||p.includes(t)});d&&A.length>=8?A[A.length-1]=d:d&&A.push(d)}}A.sort((i,t)=>(t.relevanceScore||0)-(i.relevanceScore||0))}let E=0;const Z=A.map((i,t)=>{const r=i.duration||45;return E+=r,{...i,order:t+1,cumulativeTime:E,milestone:E>=120&&E<180?"2hr":E>=300&&E<360?"5hr":E>=600?"10hr":null,quickWin:t<2}});g({persona:h,courses:Z,totalTime:E,messaging:me(h),source:"local"});try{const i=Z.flatMap(t=>[...t.ai_tags?.topics||[],...(t.tag_ids||[]).flatMap(r=>r.split(".")),...t.tags?.subsystem?[t.tags.subsystem]:[],...t.tags?.feature?[t.tags.feature]:[],...Object.values(t.tags||{}).filter(r=>typeof r=="string"&&r.length>2),...(t.title||t.name||"").split(/[\s_-]+/).filter(r=>r.length>3)]).map(t=>t.toLowerCase()).filter((t,r,d)=>d.indexOf(t)===r&&!["introduction","unreal","engine","workshop","first","project","games","your","quickstart"].includes(t)).slice(0,15);if(i.length>0){const t=await le(i,[],{maxDocs:5,maxYoutube:3});o(t)}}catch(i){console.warn("[Personas] Blended path fetch failed:",i.message)}},[X,I]=L.useState(null),{cart:T,addToCart:O,removeFromCart:W,clearCart:z,isInCart:ee}=ze(),je=(n,b)=>{s(w=>({...w,[n]:b})),$[m].type==="choice"&&m<$.length-1&&_(w=>w+1)},ke=()=>{m<$.length-1&&_(n=>n+1)},Ne=()=>{_(0),s({startPrompt:"",role:null,experience:null,goal:null}),g(null),o(null),I(null),z(),v(),localStorage.removeItem("detected_persona")},_e=()=>{_(1),s(n=>({...n,role:null,experience:null,goal:null})),g(null),I(null),v(),localStorage.removeItem("detected_persona")},Ce=c.role&&c.experience&&c.goal,K=$[m];return e.jsxs("div",{className:"personas-page",children:[e.jsxs("header",{className:"personas-header",children:[e.jsxs("h1",{children:[e.jsx(ue,{size:24,className:"icon-inline"})," New to UE5? Let's Get You Started"]}),e.jsx("p",{className:"personas-subtitle",children:"Answer a few quick questions and we'll create your personalized first 10-hour learning path"})]}),F?e.jsx("section",{className:"quiz-section rag-loading",children:e.jsxs("div",{className:"rag-loader",children:[e.jsx(Qe,{size:40,className:"spin-icon"}),e.jsxs("h2",{children:[x===j.PLANNING&&"Analyzing your profile...",x===j.SEARCHING&&"Searching course library...",x===j.ASSEMBLING&&"Building your curriculum..."]}),e.jsxs("p",{className:"rag-loader-sub",children:[x===j.PLANNING&&"Our AI is understanding your learning goals",x===j.SEARCHING&&"Finding the most relevant video segments",x===j.ASSEMBLING&&"Crafting a personalized learning path"]}),e.jsx("div",{className:"rag-progress-bar",children:e.jsx("div",{className:"rag-progress-fill",style:{width:x===j.PLANNING?"33%":x===j.SEARCHING?"66%":"90%"}})})]})}):y?X?e.jsx("div",{className:"guided-player-breakout",children:e.jsx(Re,{courses:(()=>{const n=w=>{if(!w?.videos?.length)return w;const D=[...w.videos].sort((C,U)=>{const V=P=>{const G=(P.title||P.name||"").match(/part\s*(\d+)/i);return G?parseInt(G[1],10):999};return V(C)-V(U)});return{...w,videos:D}};return(T.length>0?T.map(w=>y?.courses?.find(C=>C.code===w.code||C.title===w.title)||w):[X]).map(n)})(),problemSummary:`New to UE5 â€” ${h?.name||"General"}, ${$[2].options.find(n=>n.value===c.experience)?.label||""}, wants to ${$[3].options.find(n=>n.value===c.goal)?.label||"explore"}`,pathSummary:{path_summary:`A personalized learning path for ${y.persona.name}. This path covers foundational UE5 skills tailored to your background, starting with the essentials and building toward hands-on projects.`,topics_covered:y.courses.map(n=>n.title||n.name)},onComplete:()=>I(null),onExit:()=>I(null)})}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"shopping-layout",children:[e.jsxs("div",{className:"results-column",children:[e.jsxs("div",{className:"path-header",children:[e.jsx("span",{className:"path-icon",children:e.jsx(ue,{size:40})}),e.jsxs("div",{children:[e.jsx("h2",{children:"Your Personalized Learning Path"}),e.jsxs("p",{children:["Optimized for ",y.persona.name," â€” pick the courses you want to watch"]})]}),e.jsxs("div",{className:"path-actions",children:[e.jsxs("button",{className:"switch-persona-btn",onClick:_e,children:[e.jsx(de,{size:14})," Switch Persona"]}),e.jsxs("button",{className:"reset-btn",onClick:Ne,children:[e.jsx(de,{size:16})," Start Over"]})]})]}),h&&e.jsx("div",{className:"persona-result-card",children:e.jsxs("div",{className:"persona-result-header",children:[h.emoji&&e.jsx("span",{className:"persona-emoji",children:h.emoji}),e.jsxs("div",{children:[e.jsx("h3",{children:h.name}),e.jsx("p",{children:h.description})]})]})}),e.jsx("div",{className:"motivation-messages",children:y.messaging.map((n,b)=>e.jsx("div",{className:"motivation-card",children:n},b))}),e.jsx(ft,{courses:y.courses,isInCart:ee,addToCart:O,removeFromCart:W,userQuery:c.startPrompt||""}),k?.docs?.length>0&&e.jsx(ht,{docs:k.docs,isInCart:ee,addToCart:O,removeFromCart:W}),k?.youtube?.length>0&&e.jsx(gt,{youtube:k.youtube,isInCart:ee,addToCart:O,removeFromCart:W}),e.jsx("div",{className:"path-summary",children:e.jsxs("p",{children:["Total time:"," ",e.jsxs("strong",{children:[Math.round(y.totalTime/60*10)/10," hours"]})]})})]}),e.jsx("div",{className:"cart-column",children:e.jsx(Le,{cart:T,onRemove:W,onClear:z,onWatchPath:()=>{T.length>0&&I(T[0])}})})]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"quiz-progress",children:$.map((n,b)=>e.jsx("div",{className:`progress-step ${b<=m?"active":""} ${n.type==="freetext"?c[n.id]||b<m?"completed":"":c[n.id]?"completed":""}`,children:(n.type==="freetext"?b<m:c[n.id])?e.jsx(Ge,{size:16}):b+1},n.id))}),Y&&e.jsx("div",{className:"rag-error-banner",children:"âš ï¸ AI personalization unavailable â€” using local recommendations instead."}),e.jsxs("section",{className:"quiz-section",children:[e.jsx("h2",{children:K.question}),K.subtitle&&e.jsx("p",{className:"quiz-subtitle",children:K.subtitle}),K.type==="freetext"?e.jsxs("div",{className:"freetext-input",children:[e.jsxs("div",{className:"freetext-wrapper",children:[e.jsx($e,{size:18,className:"freetext-icon"}),e.jsx("textarea",{value:c.startPrompt,onChange:n=>s(b=>({...b,startPrompt:n.target.value})),placeholder:K.placeholder,rows:3,className:"freetext-textarea"})]}),e.jsxs("button",{className:"freetext-next",onClick:ke,children:[c.startPrompt?"Next":"Skip"," ",e.jsx(se,{size:16})]})]}):e.jsx("div",{className:"quiz-options",children:K.options.map(n=>{const b=n.icon||ne;return e.jsxs("button",{className:`quiz-option ${c[K.id]===n.value?"selected":""}`,onClick:()=>je(K.id,n.value),children:[e.jsx("span",{className:"option-icon-wrapper",children:e.jsx(b,{size:18})}),e.jsxs("span",{className:"option-content",children:[e.jsx("span",{className:"option-label",children:n.label}),n.description&&e.jsx("span",{className:"option-description",children:n.description})]})]},n.value)})}),e.jsxs("div",{className:"quiz-nav",children:[m>0&&e.jsxs("button",{className:"quiz-back",onClick:()=>_(n=>n-1),children:[e.jsx(Ee,{size:16})," Back"]}),Ce&&e.jsxs("button",{className:"quiz-generate",onClick:q,disabled:F,children:["Generate My Path ",e.jsx(se,{size:16})]})]})]}),h&&e.jsxs("div",{className:"persona-preview",children:[e.jsx("span",{className:"preview-icon",children:h.emoji?e.jsx("span",{style:{fontSize:"32px"},children:h.emoji}):e.jsx(ne,{size:32})}),e.jsxs("div",{className:"preview-text",children:[e.jsx("strong",{children:h.name}),e.jsx("p",{children:h.description})]})]})]})]})}export{Mt as default};

WEBVTT

1
00:00:00.000 --> 00:00:05.960
We've looked at a lot of different blending nodes that we have available inside the AnimGraph.

2
00:00:05.960 --> 00:00:08.640
And now we're going to take a look at state machines.

3
00:00:08.640 --> 00:00:12.960
Now this is where you can set up all of this animation logic, but in more of a modular

4
00:00:12.960 --> 00:00:17.400
fashion, where you can sort of compartmentalize what your character's animations look like

5
00:00:17.400 --> 00:00:23.320
in each state, and then define the rules to transition from one state to another, essentially

6
00:00:23.320 --> 00:00:26.960
determining when you can transition from something like your running state into your

7
00:00:26.960 --> 00:00:31.560
jumping state, and then into your landing and falling states, or anything really that

8
00:00:31.560 --> 00:00:33.840
you want your character to do.

9
00:00:33.840 --> 00:00:37.719
Now the reason we build this into a state machine is because if we were to directly

10
00:00:37.719 --> 00:00:42.880
use the AnimGraph for all of this logic, instead of making use of these modular building blocks

11
00:00:42.880 --> 00:00:46.640
of a state machine, you'd end up with a lot of nodes and you'd probably find it quite

12
00:00:46.640 --> 00:00:50.439
difficult to keep track of what's going on.

13
00:00:50.439 --> 00:00:53.920
So back into the engine, I've unhooked the animation blending tests that we were kind

14
00:00:53.920 --> 00:00:58.480
of experimenting with before for our zombie walk, and hooked back up the logic that already

15
00:00:58.480 --> 00:01:01.079
existed for our character in this third person template.

16
00:01:01.079 --> 00:01:06.760
And I'm just going to open up the state machine here, our main state state machine.

17
00:01:06.760 --> 00:01:10.740
So this is an example of a fairly simple state machine where we have a character who can

18
00:01:10.740 --> 00:01:15.480
idle, they can run around, and they can jump.

19
00:01:15.480 --> 00:01:19.719
Just to understand sort of what's going on here and what these different states are doing,

20
00:01:19.719 --> 00:01:23.920
I'm going to hit play inside the level and show us transitioning between the different

21
00:01:23.920 --> 00:01:25.400
states.

22
00:01:25.400 --> 00:01:31.719
So if I hit play, just make sure that our third person character is set as our preview instance.

23
00:01:31.719 --> 00:01:35.120
Strike this out of the way a little bit so we can see the character moving.

24
00:01:35.120 --> 00:01:38.759
You can see as we're moving around, we're in the locomotion state.

25
00:01:38.759 --> 00:01:43.159
But as soon as I jump, you can see that we transition between all the different states

26
00:01:43.159 --> 00:01:45.640
that we have set up for the jump.

27
00:01:45.640 --> 00:01:49.960
So as we jump, we go into the jump state, and then as we're coming back down, we enter

28
00:01:49.960 --> 00:01:54.680
the fall loop, and then as we hit the ground, we're going into that land animation.

29
00:01:54.680 --> 00:01:59.560
When that finishes, it transitions back to the locomotion state.

30
00:01:59.560 --> 00:02:03.319
When you're setting up a state machine, you'll always have an entry node here at the start,

31
00:02:03.319 --> 00:02:06.680
which is typically used to define the default state of your character.

32
00:02:06.680 --> 00:02:10.639
So in most common cases with a locomotion setup, that's going to be like your character's

33
00:02:10.639 --> 00:02:12.800
idle state.

34
00:02:12.800 --> 00:02:18.360
You then drag off this and choose add state, or you could right click and add state and

35
00:02:18.360 --> 00:02:21.760
rename that to whatever you like, whatever the state is.

36
00:02:21.760 --> 00:02:22.760
And then you can connect it up.

37
00:02:22.760 --> 00:02:27.439
And if you double click this, this is where you'd set up all of your animation logic for

38
00:02:27.439 --> 00:02:28.920
this state.

39
00:02:28.920 --> 00:02:31.360
So typically, these tend to be quite straightforward.

40
00:02:31.360 --> 00:02:35.320
You would just drag an animation in and connect it up and hit compile.

41
00:02:35.320 --> 00:02:41.880
And you'll see that that animation just plays because that's our entry or our default state.

42
00:02:41.879 --> 00:02:43.319
Now these can get a bit more complex.

43
00:02:43.319 --> 00:02:49.000
For example, you can apply additive animations inside here to the current pose that the character's

44
00:02:49.000 --> 00:02:50.000
in.

45
00:02:50.000 --> 00:02:53.519
So with this example, it looks like the landing animation would play on top of whatever animation

46
00:02:53.519 --> 00:02:57.000
locomotion pose we're currently in.

47
00:02:57.000 --> 00:03:01.479
If I reconnect those up and just delete this.

48
00:03:01.479 --> 00:03:04.800
But as you can see, these can get quite complex.

49
00:03:04.800 --> 00:03:08.120
Now once you've created all the different states for your characters, you'll want to

50
00:03:08.120 --> 00:03:12.879
determine when your character is allowed to transition into these different states.

51
00:03:12.879 --> 00:03:18.599
And you do that by setting up some transition rules, which are these white icons here.

52
00:03:18.599 --> 00:03:23.080
Now the main purpose of these transition rules really is to output like a true or a false

53
00:03:23.080 --> 00:03:24.840
response.

54
00:03:24.840 --> 00:03:29.840
So if I open this up, this is where you would set up the logic to say, okay, what information

55
00:03:29.840 --> 00:03:33.759
is going to allow me to transition into this state?

56
00:03:33.759 --> 00:03:39.120
In this example, when we're transitioning from the falling to the jump state, we're

57
00:03:39.120 --> 00:03:41.519
saying, okay, are we falling?

58
00:03:41.519 --> 00:03:48.439
If we are, and our velocity in the Z axis is greater than 100, then yes, you can enter

59
00:03:48.439 --> 00:03:54.199
that will allow us to enter the jump state.

60
00:03:54.199 --> 00:03:59.359
Now when you have one of these transition rules selected inside the details panel here,

61
00:03:59.359 --> 00:04:01.879
you get a preview of what that logic might look like.

62
00:04:01.879 --> 00:04:05.400
So it's useful to just have that and not have to double click each time.

63
00:04:05.400 --> 00:04:10.599
As you can see as well, when you hover over, you also get a bit of a preview of that.

64
00:04:10.599 --> 00:04:14.199
You also have access to the blend settings here where you can control, you know, the

65
00:04:14.199 --> 00:04:18.680
duration of the blend into this state and how that blend might be calculated using different

66
00:04:18.680 --> 00:04:19.680
curves.

67
00:04:19.680 --> 00:04:23.759
And oops, you can even add your own custom curves to that as well.

68
00:04:23.759 --> 00:04:27.600
So if you wanted to get into the jump a little quicker, for example, you could change this

69
00:04:27.600 --> 00:04:34.520
to 0.95 maybe, and then change how the animation blend is calculated and just get that looking

70
00:04:34.520 --> 00:04:37.600
how you want.

71
00:04:37.600 --> 00:04:41.760
So a state machine is essentially a collection of many animation graphs containing the logic

72
00:04:41.760 --> 00:04:46.000
of what your character should look like in those different states, as well as a place

73
00:04:46.000 --> 00:04:54.000
to determine the rules that allow your character to transition into these different states.


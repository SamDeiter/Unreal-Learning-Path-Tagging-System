WEBVTT

1
00:00:00.000 --> 00:00:07.000
Let's now look at how we might capture some layered facial performances.

2
00:00:07.000 --> 00:00:13.160
So if you familiarize yourself with the animation blueprint of the MetaHuman, so we're in the

3
00:00:13.160 --> 00:00:19.080
FaceAnimBP here that you can see is loaded, we can actually make a couple of additions

4
00:00:19.080 --> 00:00:24.780
that allow a bit more user-friendly for when we're working inside of Unreal Engine.

5
00:00:24.780 --> 00:00:29.920
So the first thing we want to do here, and we'll get closer into these details here in

6
00:00:29.920 --> 00:00:35.560
a second, but just to give you an overview, the first thing we want to do is add the weighted

7
00:00:35.560 --> 00:00:39.920
moving average with an alpha node to act as a denoiser.

8
00:00:39.920 --> 00:00:45.320
And the second thing we'll do is that we'll add in a layered switch for selecting the

9
00:00:45.320 --> 00:00:47.600
driving animation.

10
00:00:47.600 --> 00:00:54.640
So if we look at the first setup here, we want to add the weighted moving average.

11
00:00:54.640 --> 00:00:59.320
So all we need to do is promote the alpha, which you can see here, so just drag your

12
00:00:59.320 --> 00:01:03.320
cursor from the green pin and drag it out and then let go.

13
00:01:03.320 --> 00:01:06.040
And then you want to create a variable.

14
00:01:06.040 --> 00:01:10.840
In this instance, we called it WMA alpha, but essentially you can rename it to whatever

15
00:01:10.840 --> 00:01:11.840
you'd like.

16
00:01:11.840 --> 00:01:15.760
You just want to make sure you compile your blueprint.

17
00:01:15.760 --> 00:01:18.360
Once you've created a new variable, make sure you save it.

18
00:01:18.360 --> 00:01:21.280
And then the default value here is going to be 0.8.

19
00:01:21.320 --> 00:01:23.400
So just compile and save.

20
00:01:23.400 --> 00:01:27.320
And then we have that alpha setup there.

21
00:01:27.320 --> 00:01:34.360
And then we also want to make sure that we have the switch setup to switch between the

22
00:01:34.360 --> 00:01:39.260
live link face data and also the body animation in the neck.

23
00:01:39.260 --> 00:01:46.800
So this will allow us to alter the neck performance if we want to with the metahuman.

24
00:01:46.800 --> 00:01:53.920
So essentially we begin by duplicating the layer blend per bone, body pose and use cache

25
00:01:53.920 --> 00:01:55.160
body pose.

26
00:01:55.160 --> 00:01:57.440
So you can see that we've got that duplicated there.

27
00:01:57.440 --> 00:02:02.760
We want to rename the new body pose to face pose and then connect it to the open modify

28
00:02:02.760 --> 00:02:05.120
curve in teeth controls.

29
00:02:05.120 --> 00:02:06.160
I appreciate it.

30
00:02:06.160 --> 00:02:07.440
Just listen to my voice.

31
00:02:07.440 --> 00:02:10.160
It's going to be a little bit difficult to follow here.

32
00:02:10.160 --> 00:02:13.640
Essentially we're just copying what we can see in the box here.

33
00:02:13.640 --> 00:02:18.480
So in the layer blend per bone, we want to drag out from the blend pose 0 and create

34
00:02:18.480 --> 00:02:23.920
the use cache pose, which is a face pose, and then duplicate that.

35
00:02:23.920 --> 00:02:28.600
And then we just want to repeat the connections from the original layer blend per bone node

36
00:02:28.600 --> 00:02:30.420
in the duplicated node.

37
00:02:30.420 --> 00:02:35.560
So then we want to create a blend node, promote it to the alpha and to a variable and name

38
00:02:35.560 --> 00:02:39.840
it llface, a live link face or anim neck switch.

39
00:02:40.040 --> 00:02:44.300
And then we want to connect the original layer blend per bone nodes to the blend node, which

40
00:02:44.300 --> 00:02:48.120
is the original to A and then duplicate to B.

41
00:02:48.120 --> 00:02:52.160
And then we just want to connect the blend node to the local component node in the AR

42
00:02:52.160 --> 00:02:53.160
kit.

43
00:02:53.160 --> 00:02:56.760
And then once you've done all that, we can compile and save.

44
00:02:56.760 --> 00:03:03.480
And then if we switch over to the event graph in this face and in BP, we can essentially

45
00:03:03.480 --> 00:03:09.220
create an update here to the editor switch, which will allow us to preview the facial

46
00:03:09.220 --> 00:03:15.300
performance without having to simulate the meta human, which is really nice update here.

47
00:03:15.300 --> 00:03:22.860
So if we create update in editor as a bull, so you can see we've created a new bull here

48
00:03:22.860 --> 00:03:24.460
that's called update in editor.

49
00:03:24.460 --> 00:03:30.260
And if you just drag it out and select the get option, we'll create a get version of

50
00:03:30.260 --> 00:03:31.260
this variable.

51
00:03:31.260 --> 00:03:36.060
A little shortcut there is if you hold down control on your keyboard and left mouse drag

52
00:03:36.100 --> 00:03:40.220
from the bull into the graph, it will automatically create a get.

53
00:03:40.220 --> 00:03:46.220
And if you hold alt and left mouse drag from your variable into the event graph, you will

54
00:03:46.220 --> 00:03:48.340
create a set variable.

55
00:03:48.340 --> 00:03:52.820
So in case you want to speed up that process, that's a little shortcut for you.

56
00:03:52.820 --> 00:03:58.700
So essentially, after creating this get node, we want to create a set update animation in

57
00:03:58.700 --> 00:03:59.700
editor.

58
00:03:59.700 --> 00:04:04.820
So first of all, we want to right click and create a get owning component, drag off that

59
00:04:04.860 --> 00:04:08.420
and then type in set update animation in editor.

60
00:04:08.420 --> 00:04:10.220
And then you'll be able to create that.

61
00:04:10.220 --> 00:04:14.780
And then we just want to create a branch from this bull, go in from the blueprint update

62
00:04:14.780 --> 00:04:20.980
animation, check that bull, connect the bull into the update state as well.

63
00:04:20.980 --> 00:04:26.340
True will go into the update state and then false will return into the branch that was

64
00:04:26.340 --> 00:04:30.340
already created in the set ARKit head rotation.

65
00:04:30.340 --> 00:04:34.620
And then still in the event graph, we want to go to the end of the chain and find this

66
00:04:34.620 --> 00:04:37.540
ARKit set up here.

67
00:04:37.540 --> 00:04:42.300
And we want to copy this and then we want to move into our construction script that

68
00:04:42.300 --> 00:04:44.140
you can see here on the right.

69
00:04:44.140 --> 00:04:50.740
So we'll copy this, paste this or control C from the event graph, control V into the

70
00:04:50.740 --> 00:04:52.060
construction script.

71
00:04:52.060 --> 00:04:56.140
And then at the end of the construction, after the create a dynamic material instance, you

72
00:04:56.140 --> 00:05:02.100
can plug that ARKit set up in there and then just plug that into the same node that we

73
00:05:02.100 --> 00:05:05.940
were outputting the retarget set up there.

74
00:05:05.940 --> 00:05:10.220
So we've just inserted this into the construction script.

75
00:05:10.220 --> 00:05:15.180
And then lastly here, we want to go into the function, which is ARKit set up.

76
00:05:15.180 --> 00:05:16.220
So that's what we're looking for.

77
00:05:16.220 --> 00:05:19.380
You can find the functions on the left hand side of the blueprint.

78
00:05:19.380 --> 00:05:24.260
So again, we want to create the update and editor a bullion if we haven't already got

79
00:05:24.260 --> 00:05:30.660
one to then create a get into a set.

80
00:05:30.660 --> 00:05:36.180
And we can drag in from the CAS to face anim blueprints.

81
00:05:36.180 --> 00:05:43.860
So drag off there, we can create a as face anim BP pin searching for the set update and

82
00:05:43.860 --> 00:05:44.860
editor.

83
00:05:44.860 --> 00:05:48.580
And this creates a set update and editor node with a connected target.

84
00:05:48.580 --> 00:05:54.780
And then also connect the get update and editor and set li-link face head to the set update

85
00:05:54.780 --> 00:05:55.780
and editor.

86
00:05:55.780 --> 00:05:57.940
And then you can compile and save.

87
00:05:57.940 --> 00:06:03.420
And that is your complete setup for just modifying the MetaHuman blueprint for a little bit more

88
00:06:03.420 --> 00:06:08.980
quality of life settings available to you inside the editor.

89
00:06:08.980 --> 00:06:13.260
And then to get everything recorded, we'll use the take recorder again, or you can add

90
00:06:13.260 --> 00:06:18.980
the MetaHuman blueprint actor to the source as you've done previously.

91
00:06:18.980 --> 00:06:25.120
You can uncheck the MetaHuman BP actor recorded properties here, and then only check back

92
00:06:25.120 --> 00:06:30.780
on the face recorded properties, the animation track and the transform track.

93
00:06:30.780 --> 00:06:36.260
And that will give you the facial capture information you need for the performance.
